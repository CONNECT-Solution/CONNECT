<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project abortOnError="false" name="ValidateConnectionManagerForAllService" resourceRoot="${projectDir}" runType="SEQUENTIAL" soapui-version="5.1.2" activeEnvironment="Default" id="379039d2-294d-4f3b-a951-9eb8a9e940aa" xmlns:con="http://eviware.com/soapui/config">
  <con:settings/>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitydocquery}EntityDocQueryBindingSoap" definition="${projectDir}/../../../target/wsdl/EntityDocQuery.wsdl" name="EntityDocQueryBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="4d4c005d-9ef2-40be-8239-cb3c201aa851" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
    </con:endpoints>
    <con:operation action="urn:gov:hhs:fha:nhinc:entitydocquery:RespondingGateway_CrossGatewayQueryRequest" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayQuery" inputName="RespondingGateway_CrossGatewayQueryRequest" isOneWay="false" name="RespondingGateway_CrossGatewayQuery" outputName="RespondingGateway_CrossGatewayQueryResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="b652a22a-1601-4be2-9568-5f9f3dcb908c">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitydocretrieve}EntityDocRetrieveBindingSoap" definition="${projectDir}/../../../target/wsdl/EntityDocRetrieve.wsdl" name="EntityDocRetrieveBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="c628d288-121d-410e-9928-90221d74e676" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/DocumentRetrieve/2_0/EntityService/EntityDocRetrieve</con:endpoint>
      <con:endpoint>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:endpoint>
    </con:endpoints>
    <con:operation action="urn:gov:hhs:fha:nhinc:entitydocretrieve:RespondingGateway_CrossGatewayRetrieveRequestMessage" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayRetrieve" inputName="RespondingGateway_CrossGatewayRetrieveRequest" isOneWay="false" name="RespondingGateway_CrossGatewayRetrieve" outputName="RespondingGateway_CrossGatewayRetrieveResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="cd892068-3390-4e0c-b62b-6514f50e3585">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincentityxdr:async:request}EntityXDRAsyncRequest_Binding" definition="${projectDir}/../../../target/wsdl/EntityXDRRequest.wsdl" name="EntityXDRAsyncRequest_Binding" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="fda17240-975d-4fdb-8a7f-688b30b6494b" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:endpoint>
    </con:endpoints>
    <con:operation action="" anonymous="optional" bindingOperationName="ProvideAndRegisterDocumentSet-bAsyncRequest" inputName="" isOneWay="false" name="ProvideAndRegisterDocumentSet-bAsyncRequest" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="6980b632-a3fb-47ab-bad5-7f39729a13b6">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncreq}EntityPatientDiscoveryAsyncReqBindingSoap" definition="${projectDir}/../../../target/wsdl/EntityPatientDiscoveryAsyncReq.wsdl" name="EntityPatientDiscoveryAsyncReqBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="c1f42e24-d845-4315-8746-5ed46b2065f0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:endpoint>
    </con:endpoints>
    <con:operation action="" anonymous="optional" bindingOperationName="ProcessPatientDiscoveryAsyncReq" inputName="ProcessPatientDiscoveryAsyncReqAsyncRequest" isOneWay="false" name="ProcessPatientDiscoveryAsyncReq" outputName="ProcessPatientDiscoveryAsyncReqAsyncResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="4c9a8baf-e4f5-4d36-8e38-8a7ea8020186">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncresp}EntityPatientDiscoveryAsyncRespBindingSoap" definition="${projectDir}/../../../target/wsdl/EntityPatientDiscoveryAsyncResp.wsdl" name="EntityPatientDiscoveryAsyncRespBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="eb786b71-3258-4c0e-9add-a4aa68b6971c" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:endpoint>
    </con:endpoints>
    <con:operation action="" bindingOperationName="ProcessPatientDiscoveryAsyncResp" inputName="ProcessPatientDiscoveryAsyncRespAsyncRequest" isOneWay="false" name="ProcessPatientDiscoveryAsyncResp" outputName="ProcessPatientDiscoveryAsyncRespAsyncResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" anonymous="optional" id="839cb3bb-2a97-412f-b75d-b59d3c1fd573">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincentityxdr}EntityXDR_Binding" definition="${projectDir}/../../../target/wsdl/EntityXDR.wsdl" name="EntityXDR_Binding" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="97d7200c-e891-45b7-9c1b-0b018a3a974b" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionUnsecured</con:endpoint>
      <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionUnsecured</con:endpoint>
    </con:endpoints>
    <con:operation action="" anonymous="optional" bindingOperationName="ProvideAndRegisterDocumentSet-b" inputName="" isOneWay="false" name="ProvideAndRegisterDocumentSet-b" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="50123969-71b4-4ea4-aac6-9750fff337d0">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitypatientdiscovery}EntityPatientDiscoveryBindingSoap" definition="${projectDir}/../../../target/wsdl/EntityPatientDiscovery.wsdl" name="EntityPatientDiscoveryBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="20cbccd8-a236-4b53-99ee-eb7080ef305f" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:endpoint>
    </con:endpoints>
    <con:operation action="urn:gov:hhs:fha:nhinc:entitypatientdiscovery:RespondingGateway_PRPA_IN201305UV02RequestMessage" bindingOperationName="RespondingGateway_PRPA_IN201305UV02" inputName="RespondingGateway_PRPA_IN201305UV02Request" isOneWay="false" name="RespondingGateway_PRPA_IN201305UV02" outputName="RespondingGateway_PRPA_IN201306UV02Response" receivesAttachments="false" sendsAttachments="false" type="Request-Response" anonymous="optional" id="6c597f1e-3ddf-4952-9d5e-a3c4f02bd805">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entityadmindistribution}AdministrativeDistribution_Binding_Soap12" definition="${projectDir}/../../../target/wsdl/EntityAdminDist.wsdl" name="AdministrativeDistribution_Binding_Soap12" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="8deed0d9-69e9-483f-b84e-50125946675d" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/AdminDistribution/1_0/AdministrativeDistribution_Service</con:endpoint>
    </con:endpoints>
    <con:operation action="urn:oasis:names:tc:emergency:EDXL:DE:1.0:SendAlertMessage" anonymous="optional" bindingOperationName="SendAlertMessage" inputName="" isOneWay="false" name="SendAlertMessage" sendsAttachments="false" type="One-Way" id="ca98377d-2785-4163-85fc-8813346b52a4">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincentityxdr:async:response}EntityXDRAsyncResponse_Binding" definition="${projectDir}/../../../target/wsdl/EntityXDRResponse.wsdl" name="EntityXDRAsyncResponse_Binding" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="9049d628-1ceb-4f41-a96a-e214e836af99" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:endpoint>
      <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:endpoint>
    </con:endpoints>
    <con:operation action="" anonymous="optional" bindingOperationName="ProvideAndRegisterDocumentSet-bAsyncResponse" inputName="" isOneWay="false" name="ProvideAndRegisterDocumentSet-bAsyncResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="4bd8da83-4ba0-40cd-940f-962847f7e10d">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entityadmindistribution}AdministrativeDistribution_Binding_Soap12" definition="${projectDir}/../../../target/wsdl/EntityAdminDist_g1.wsdl" name="AdministrativeDistribution_Binding_Soap12_g1" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="61ec69f6-5136-4e8b-8b0f-9ca3400f3a26" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:endpoint>
    </con:endpoints>
    <con:operation action="urn:oasis:names:tc:emergency:EDXL:DE:1.0:SendAlertMessage" bindingOperationName="SendAlertMessage" inputName="" isOneWay="false" name="SendAlertMessage" sendsAttachments="false" type="One-Way" id="c3fba2f7-4f5d-4774-88ad-890c4968dd5f">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdapterPatientDiscoveryBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:adapterpatientdiscovery}AdapterPatientDiscoveryBindingSoap" soapVersion="1_2" anonymous="optional" definition="${projectDir}/../../../target/wsdl/AdapterPatientDiscovery.wsdl" id="ac9dbab6-8be4-403d-a898-08b2798a546f" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>https://localhost:${HttpsDefaultPort}/Adapter/PatientDiscovery/A_0/AdapterPatientDiscovery</con:endpoint>
    </con:endpoints>
    <con:operation isOneWay="false" action="urn:RespondingGateway_PRPA_IN201305UV02" name="RespondingGateway_PRPA_IN201305UV02" bindingOperationName="RespondingGateway_PRPA_IN201305UV02" type="Request-Response" outputName="RespondingGateway_PRPA_IN201306UV02Response" inputName="RespondingGateway_PRPA_IN201305UV02Request" receivesAttachments="false" sendsAttachments="false" id="4e339533-5ddb-4cea-a384-8e4fefd7894a">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:testSuite name="CM_w_urn:oid_ReqMsg_w_urn:oid" id="7fdeb3d5-f4f7-44c4-88d8-7b9e595c2605">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="53f821fb-e99b-4318-a86d-66e62b517650" keepSession="false" maxResults="0" name="Document Submission Deferred Req" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="bdf59451-acdb-4364-b6a1-b0d2ba2ea533">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmissionRequest";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="d3e06608-f8e8-4903-b3dc-dcd00b42b48d">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="c56f956b-5ee9-4287-a4c6-3b2fe822aa77">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission Deferred Req" type="request" id="b6b56d8a-1f55-4825-8787-b807dfcda859">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDRAsyncRequest_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-bAsyncRequest</con:operation>
          <con:request incomingWss="" name="Doc Submission Deferred Req" outgoingWss="" useWsAddressing="true" wssPasswordType="" id="8583c6ec-da14-49ca-a417-c408025ab6b4">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_w_urn:oid" testCase="Document Submission Deferred Req">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>                `  
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->
  
               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList> 

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="19cde7d0-7f6e-45bd-83c3-993282a4ca30"/>
            <con:assertion type="SOAP Fault Assertion" id="f34bb0db-2a53-4f45-b756-95c1ac9e44fe"/>
            <con:assertion name="Match content of @status" type="XPath Match" id="bf00915c-0628-4893-885d-7fa4f62bb52f">
              <con:configuration>
                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
							//ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:RequestAccepted</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="4ce75b67-9d9d-4e41-822f-dca244f80acb">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" name="Verify RelatesTo" id="bf278e72-9a08-4b8c-b47e-0b48ea007de9">
              <con:configuration>
                <scriptText>import com.eviware.soapui.support.XmlHolder;
def request = new XmlHolder(messageExchange.requestContentAsXml);
def response = new XmlHolder(messageExchange.responseContentAsXml);
request.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
response.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
assert request["//add:MessageID/text()"] == response["//add:RelatesTo/text()"];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincentityxdr:async:request:ProvideAndRegisterDocumentSet-bAsyncRequest_RequestMessage" generateMessageId="true" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:33Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:33Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:33</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="dc3b8bf1-91e1-4aeb-b865-8b5c6b388a4f" keepSession="false" maxResults="0" name="Document Submission Deferred Resp" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="089d0c01-5a78-46e6-9c2a-5f19154450a5">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmissionResponse";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="060185e1-a84b-436c-bfef-7aa159183fe1">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_ornuid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="30fcc34d-2039-4e4e-bef6-87e984576152">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission Deferred Resp" type="request" id="3f8e3d0a-480a-4fa3-ae2b-d25b9c42d258">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDRAsyncResponse_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-bAsyncResponse</con:operation>
          <con:request name="Doc Submission Deferred Resp" id="1cdbe500-333d-4c3e-a7a4-f35959bbaf6c">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_w_urn:oid" testCase="Document Submission Deferred Resp">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
               <urn1:prefix>Ms.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>?addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>SkagerBerg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                     <!--Zero or more repetitions:-->
                     <urn1:translation/>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Karl S. Skagerberg</urn1:fullName>
                  <urn1:prefix>?</urn1:prefix>
                  <urn1:suffix>?</urn1:suffix>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <!--Optional:-->
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy notes</urn1:originalText>
               <!--Zero or more repetitions:-->
               <urn1:translation/>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <!--Optional:-->
                     <urn1:version>2.0</urn1:version>
                     <!--Optional:-->
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <!--Optional:-->
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <!--Optional:-->
                     <urn1:conditions>
                        <!--Optional:-->
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <!--Optional:-->
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <!--Zero or more repetitions:-->
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <!--Zero or more repetitions:-->
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:721645965035</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:146207300753</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:783710993742</urn1:signatureValue>
            </urn1:samlSignature>
            <!--Optional:-->
            <urn1:samlIssuer>
               <!--Optional:-->
               <urn1:issuer>?</urn1:issuer>
               <!--Optional:-->
               <urn1:issuerFormat>?</urn1:issuerFormat>
            </urn1:samlIssuer>
            <!--Optional:-->
            <urn1:messageId>?</urn1:messageId>
            <!--1 or more repetitions:-->
            <urn1:relatesToList>uuid:088a26e8-6b03-4bf8-84f1-737dc94be2e0</urn1:relatesToList>
         </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn:RegistryResponse status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" requestId="?"><!--Optional:-->
            <urn2:ResponseSlotList>
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
            </urn2:ResponseSlotList>
            <!--Optional:-->
            <urn2:RegistryErrorList highestSeverity="?">
               <!--1 or more repetitions:-->
               <urn2:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn2:RegistryError>
            </urn2:RegistryErrorList>
         </urn:RegistryResponse>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="0bff1e09-df05-4f9a-9aee-80bd420293c3"/>
            <con:assertion type="Schema Compliance" id="547c6418-39f1-43e5-80e2-7fd71528dda5">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="5bba5a1f-87ea-4c95-a219-96c4be6149f7"/>
            <con:assertion type="XPath Match" name="Match content of @status" id="cde7dc48-6c03-4e4a-9dcc-32584710ac5c">
              <con:configuration>
                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
//ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:ResponseAccepted</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                <ignoreComments>false</ignoreComments>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:36Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:36Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:36</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="fa57d83c-8474-4625-9186-b3902fdda4ab" keepSession="false" maxResults="0" name="Document Submission" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="ec823139-c0f5-4755-ba17-373909081fa5">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmission";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="3b93b0d5-026c-4ae5-af09-4d080b0aaa5f">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_ornuid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="e20e2fd9-2314-4350-8204-0d862aafcb14">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission" type="request" id="0d2bd0f9-32fa-43c6-999a-360d38bd1a01">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDR_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-b</con:operation>
          <con:request incomingWss="" name="Doc Submission" outgoingWss="" wssPasswordType="" id="2fe2532c-a203-4109-bf65-f96c00f35d06">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_w_urn:oid" testCase="Document Submission">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->
  
               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList> 

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="43c740c5-3774-4b6f-8b3d-6d999e65129f"/>
            <con:assertion type="SOAP Fault Assertion" id="3cd880d6-dcd1-4dcc-8b78-555c117ca39f"/>
            <con:assertion type="XPath Match" id="70c28e68-7c0e-4c9c-87af-0a1f577ed8e7">
              <con:configuration>
                <path>declare namespace ns11='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
							//ns11:RegistryResponse[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="a257edb0-6d3c-4121-8f4d-d7c8a4f45c10">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="{urn:gov:hhs:fha:nhinc:nhincentityxdr}ProvideAndRegisterDocumentSet-b" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:38Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:38Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:38</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="62ebf4c2-b4e0-4465-b715-df30e72f945a" keepSession="false" maxResults="0" name="Patient Discovery Deferred Req" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="81af862b-a4b0-4fcd-b617-a494a1054df6">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscoveryRequest";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="5372a580-7c08-40a9-8a30-7c8f2595e76e">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_ornuid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="53282d7d-66ca-442b-8498-253f637637bf">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery Deferred Req" type="request" id="181c302e-a878-4846-a31d-7694e09c933e">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryAsyncReqBindingSoap</con:interface>
          <con:operation>ProcessPatientDiscoveryAsyncReq</con:operation>
          <con:request name="Patient Discovery Deferred Req" useWsAddressing="true" id="07b10ba5-025d-4b6c-8e31-dc90ff26d83d">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_w_urn:oid" testCase="Patient Discovery Deferred Req">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithurnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#RemoteHCID}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#LocalPatientID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <!--Optional:-->
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <!--Optional:-->
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="fc9565cd-8f81-4c70-894a-174434b715cd"/>
            <con:assertion type="SOAP Fault Assertion" id="0c19da5c-b59a-404d-aafe-ea55fb9a8fde"/>
            <con:assertion name="Verify Receiver" type="XPath Match" id="aba349f5-a612-4e2c-9791-e9f1b3d16460">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:receiver[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                <content>1.1</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Verify Sender" type="XPath Match" id="489cd592-ab95-4136-9ad1-6ecc32992993">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:sender[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                <content>2.2</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Verify Message" type="XPath Match" id="68e0ce62-ecb3-46b7-9009-286f58c50188">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:acknowledgement[1]/ns3:acknowledgementDetail[1]/ns3:text[1]/text()</path>
                <content>Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="7f27eef5-ac60-4ae5-80c6-23e7bc694c8d">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" name="Verify RelatesTo" id="67370828-9cf7-43ba-931e-372531c6612c">
              <con:configuration>
                <scriptText>import com.eviware.soapui.support.XmlHolder;
def request = new XmlHolder(messageExchange.requestContentAsXml);
def response = new XmlHolder(messageExchange.responseContentAsXml);
request.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
response.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
assert request["//add:MessageID/text()"] == response["//add:RelatesTo/text()"];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncreq:ProcessPatientDiscoveryAsyncReqAsyncRequest" addDefaultTo="true" messageID="uuid:6666666666.66666.666.66" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:40Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:40Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:40</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="e98901ca-10ae-4725-ac64-5b2bd8da2b3e" keepSession="false" maxResults="0" name="Patient Discovery Deferred Resp" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="768f0c83-b2c5-4f65-9efe-26056b9d38ef">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscoveryResponse";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="6c680380-c2b4-4644-9da4-4eec941651c1">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="98487023-a3c4-4213-9337-e0c49df8a7d8">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery Deferred Resp" type="request" id="f11e4593-c3ba-47cc-b641-f2061027c5c8">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryAsyncRespBindingSoap</con:interface>
          <con:operation>ProcessPatientDiscoveryAsyncResp</con:operation>
          <con:request name="Patient Discovery Deferred Resp" id="9d8a4d8c-6e2f-4572-824b-fa5612bf42e6">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_w_urn:oid" testCase="Patient Discovery Deferred Resp">
      <urn:RespondingGateway_PRPA_IN201306UV02Request>
         <urn:PRPA_IN201306UV02 ITSVersion="XML_1.0">
            <urn:id root="2.2" extension="-5a3e95b1:11d1fa33d45:-8e45"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <!--1 or more repetitions:-->
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithurnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:code codeSystem="2.16.840.1.113883.1.6" code="PRPA_TE201306UV"/>
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="2.2"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:subject typeCode="SUBJ">
                  <urn:registrationEvent classCode="REG" moodCode="EVN">
                     <urn:id nullFlavor="NA"/>
                     <urn:statusCode code="active"/>
                     <urn:subject1 typeCode="SBJ">
                        <urn:patient classCode="PAT">
                           <urn:id extension="D123402" root="2.2"/>
                           <urn:statusCode code="SD"/>
                           <urn:patientPerson>
                              <urn:name>
                                 <urn:family partType="FAM">Younger</urn:family>
                                 <urn:given partType="GIV">Gallow</urn:given>
                              </urn:name>
                              <urn:administrativeGenderCode code="M"/>
                              <urn:birthTime value="19630804"/>
                              <urn:addr>
                                 <urn:city>LEESBURG</urn:city>
                                 <urn:state>VA</urn:state>
                                 <urn:postalCode>20176</urn:postalCode>
                              </urn:addr>
                           </urn:patientPerson>
                           <urn:providerOrganization determinerCode="" classCode="">
                              <urn:id root="2.2"/>
                              <urn:contactParty xsi:nil="true" classCode="CON" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                           </urn:providerOrganization>
                        </urn:patient>
                     </urn:subject1>
                     <urn:custodian typeCode="">
                        <urn:assignedEntity classCode="">
                           <urn:id root="2.2"/>
                        </urn:assignedEntity>
                     </urn:custodian>
                  </urn:registrationEvent>
               </urn:subject>
               <urn:queryAck>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:queryResponseCode code="OK"/>
                  <urn:resultTotalQuantity value="1"/>
                  <urn:resultCurrentQuantity value="1"/>
                  <urn:resultRemainingQuantity value="0"/>
               </urn:queryAck>
               <urn:queryByParameter>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="M"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="19630804"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectId>
                        <urn:value extension="D123401" root="1.1"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">Younger</urn:family>
                           <urn:given partType="GIV">Gallow</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectName>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201306UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201306UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="c04c3975-06c0-45a9-b3e2-a713665655cb"/>
            <con:assertion type="SOAP Fault Assertion" id="bf9af998-c600-4702-9014-a16e3613d736"/>
            <con:assertion name="Match content of [typeCode/@code]" type="XPath Match" id="52ad8f1f-a780-42fb-b805-e55658781ea5">
              <con:configuration>
                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:typeCode[1]/@code</path>
                <content>CA</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Match content of [acknowledgementDetail/text/text()]" type="XPath Match" id="434c71e8-1491-4f30-a73e-d09c4cd8eb69">
              <con:configuration>
                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:acknowledgementDetail[1]/ns2:text/text()</path>
                <content>Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="83d7ae3c-a455-4686-9883-1db8d8dd5ccf">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:42Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:42Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:42</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="fe917e9c-4e89-4ce8-9828-05b542fb1be0" keepSession="false" maxResults="0" name="Patient Discovery" searchProperties="true">
      <con:settings/>
      <con:testStep name="clear correlations table" type="groovy" id="f5395d4b-2ab2-4bef-8bdb-555fe804dbdc">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
			sql.execute('delete from ' + context.findProperty('PatientCorrelationTable'))
			}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="41d3b4ab-c675-4421-b5d1-c951cd4b304e">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="93d5571a-c808-45a9-be89-2131faba6e5f">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Check Passthru" id="b89076e7-e68b-4410-b798-7e99bd57aa2c">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscovery";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	/**def ln = System.getProperty('line.separator');
	def policyEngineFile = new File(dir + "/" + "PolicyEngineProxyConfig.xml");
	def policyEngineFileNew = new File(dir + "/" + "PolicyEngineProxyConfig.xml.NEW");
	policyEngineFile.eachLine() {
		line ->
		if(line.contains(alias)) {
			policyEngineFileNew &lt;&lt; replaceAlias + ln;
		} else {
			policyEngineFileNew &lt;&lt; line + ln;
		}
	}

	policyEngineFile.delete();
	policyEngineFileNew.renameTo(new File(dir + "/" + "PolicyEngineProxyConfig.xml"));
	**/
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
	testRunner.gotoStepByName("Patient Discovery");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Set Up PassThru" id="2476093f-e51b-40bd-a501-b9ca9f8ccf93">
        <con:settings/>
        <con:config>
          <script>log.info "Setting Patient Discovery Adapter to unsecured";
def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "PatientDiscoveryProxyConfig.xml", log);
def alias = 'adapterpatientdiscovery'
def aliasName= 'adapterpatientdiscoverywssecured';
def replaceAlias = 'adapterpatientdiscoverywsunsecured';

nhinc.FileUtils.updateSpringConfig(dir, "PatientDiscoveryProxyConfig.xml",
	alias, aliasName, replaceAlias, log);
/**
def pdConfigFile = new File(dir + "/" + "PatientDiscoveryProxyConfig.xml");
def pdConfigFileNew = new File(dir + "/" + "PatientDiscoveryProxyConfig.xml.NEW");
pdConfigFile.eachLine() {
	line ->
	if(line.contains(alias)) {
		pdConfigFileNew &lt;&lt; replaceAlias + ln;
	} else {
		pdConfigFileNew &lt;&lt; line + ln;
	}
}

pdConfigFile.delete();
pdConfigFileNew.renameTo(new File(dir + "/" + "PatientDiscoveryProxyConfig.xml"));
**/
log.info "Modifying internalExchangeInfo for adapterpatientdiscovery mock."

nhinc.FileUtils.createOrUpdateConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterpatientdiscovery", "http://localhost:1720/MockPDAdapter", "2.0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery" type="request" id="485c0ce9-c900-490a-9f8d-9589f0e7fd48">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryBindingSoap</con:interface>
          <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
          <con:request name="Patient Discovery" id="f955add0-d085-4702-8612-dac8fc96312d">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_w_urn:oid" testCase="Patient Discovery">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithurnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#LocalHCIDWithurnoid}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#SubjectID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>${#Project#City}</urn1:city>
               <urn1:country>${#Project#Country}</urn1:country>
               <urn1:state>${#Project#State}</urn1:state>
               <urn1:streetAddress>${#Project#StreetAddress}</urn1:streetAddress>
               <urn1:zipCode>${#Project#ZipCode}</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>${#Project#DOB}</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>${#Project#FamilyName}</urn1:familyName>
               <urn1:givenName>${#Project#GivenName}</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>${#Project#SSN}</urn1:SSN>
            <urn1:uniquePatientId>${#Project#UniquePatientId}</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTH</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
               <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="28ec97e9-08db-4fc9-804a-a70ef59b36fb"/>
            <con:assertion disabled="true" type="Schema Compliance" id="51758be6-5f53-4adf-a1e2-8213b8000353">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="34eb15e1-5462-44cc-9b77-189a4b4e18a3"/>
            <con:assertion name="Check for existance of [ns3:controlActProcess]" type="XPath Match" id="d68800d1-671b-4692-ab49-228e1040505a">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
				exists( //ns3:PRPA_IN201306UV02/ns3:controlActProcess)</path>
                <content>true</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Given Name XPath Match" type="XPath Match" id="b47519a6-ab6e-4efe-85b9-abd611e0b07c">
              <con:configuration>
                <path>declare namespace ns1='urn:hl7-org:v3';
				//ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:given[1]</path>
                <content>${#Project#GivenName}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Family Name XPath Match" type="XPath Match" id="c7cd6316-98a9-4ad7-9862-9227ed7607a1">
              <con:configuration>
                <path>declare namespace ns1='urn:hl7-org:v3';
				//ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:family[1]</path>
                <content>${#Project#FamilyName}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Skip Mock" id="6b866d06-603d-4388-96a5-4ecc1146e035">
        <con:settings/>
        <con:config>
          <script>def runMock = context.findProperty("PassThruOn").toBoolean();

if(!runMock){
	testRunner.gotoStepByName("count correlations");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="bed859f5-4ef0-4927-a7ce-4517dbb1b1c9">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="Set Up PassThru" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterPatientDiscoveryBindingSoap</con:interface>
          <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
          <con:path>/MockPDAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="fa5e72b5-a19b-4551-937b-60c4dcc4d35d">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3">
   <soap:Header/>
   <soap:Body>
   <PRPA_IN201306UV02 xmlns="urn:hl7-org:v3" xmlns:ns2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns3="http://www.w3.org/2005/08/addressing" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:patientcorrelationfacade" ITSVersion="XML_1.0">
   <id root="1.1" extension="13318247:13b4e0b839b:-7ff4"/>
   <creationTime value="20121129212833"/>
   <interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
   <processingCode code="P"/>
   <processingModeCode code="T"/>
   <acceptAckCode code="NE"/>
   <receiver typeCode="RCV">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="1.2.345.678.999"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="${#Project#LocalHCIDWithurnoid}"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </receiver>
   <sender typeCode="SND">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="2.2"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="${#Project#RemoteHCID}"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </sender>
   <acknowledgement>
   	<typeId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
   	<typeCode code="AA"/><targetMessage xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   </acknowledgement>
   <controlActProcess classCode="CACT" moodCode="EVN">
   	<code code="PRPA_TE201306UV" codeSystem="2.16.840.1.113883.1.6"/>
   	<subject typeCode="SUBJ">
   		<registrationEvent classCode="REG" moodCode="EVN">
   			<id nullFlavor="NA"/>
   			<statusCode code="active"/>
   				<subject1 typeCode="SBJ">
   					<patient classCode="PAT">
   						<id root="1.1" extension="D123401"/>
   						<statusCode code="SD"/>
   						<patientPerson classCode="PSN" determinerCode="INSTANCE">
   							<name>
   								<family partType="FAM">Younger</family>
   								<given partType="GIV">Gallow</given>
   							</name>
   							<telecom value="tel:+1-888-555-1234"/>
   							<administrativeGenderCode code="M"/>
   							<birthTime value="19630804"/>
   							<addr><city>LEESBURG</city><state>VA</state><postalCode>20176</postalCode></addr>
   							<asOtherIDs classCode="SD">
   								<id root="2.16.840.1.113883.4.1" extension="999123401"/>
   								<scopingOrganization classCode="ORG" determinerCode="INSTANCE">
   									<id root="2.16.840.1.113883.4.1"/>
   								</scopingOrganization>
   							</asOtherIDs>
   						</patientPerson>
   						<providerOrganization classCode="ORG" determinerCode="INSTANCE">
   							<id root="1.1"/>
   							<contactParty xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   							</providerOrganization>
   							<subjectOf1>
   								<queryMatchObservation classCode="CASE" moodCode="EVN">
   									<code code="IHE_PDQ"/>
   									<value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="INT" value="100"/>
   								</queryMatchObservation>
   							</subjectOf1>
   						</patient>
   					</subject1>
   					<custodian typeCode="CST">
   						<assignedEntity classCode="ASSIGNED">
   							<id root="1.1"/>
   							<code code="NotHealthDataLocator" codeSystem="1.3.6.1.4.1.19376.1.2.27.2"/>
   						</assignedEntity>
   					</custodian>
   				</registrationEvent>
   			</subject>
   			<queryAck>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<queryResponseCode code="OK"/>
   			</queryAck>
   			<queryByParameter>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<statusCode code="new"/>
   				<responseModalityCode code="R"/>
   				<responsePriorityCode code="I"/>
   				<parameterList>
   					<livingSubjectAdministrativeGender>
   						<value code="M"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectAdministrativeGender>
   					<livingSubjectBirthTime>
   						<value value="19630804"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectBirthTime>
   					<livingSubjectId>
   						<value root="1.1" extension="1111"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectId>
   					<livingSubjectName>
   						<value>
   							<family partType="FAM">Younger</family>
   							<given partType="GIV">Gallow</given>
                        		</value>
                        		<semanticsText representation="TXT"/>
                        	</livingSubjectName>
                     </parameterList>
                 </queryByParameter>
             </controlActProcess>
     </PRPA_IN201306UV02>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
        </con:config>
      </con:testStep>
      <con:testStep name="count correlations" type="groovy" id="8d710f5f-d1cc-4d4d-b3d3-e0cbb19934a2">
        <con:settings/>
        <con:config>
          <script>def pdCorrelations = 1;

if(context.findProperty("PassThruOn").toBoolean()) {
	pdCorrelations = 0;
}

log.info "Assert ${pdCorrelations} number of correlations"

context.withSql('PatientCorrelationDB') { sql -> 
		assert pdCorrelations == sql.firstRow('select count(*) from ' + context.findProperty('PatientCorrelationTable'))[0]
		}</script>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
//nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
	nhinc.FileUtils.restoreFile(dir, "PatientDiscoveryProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:45Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:45Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:45</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="801f7f15-5164-41c3-907f-9c0a9db42262" keepSession="false" maxResults="0" name="Document Query" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="70d7a08b-66fb-4b1a-ab73-022539e6b35e">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docquery.30.inboundDocQuery";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
	testRunner.gotoStepByName("Document Query");
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="69539b90-3356-4365-b1be-80ede0df5270">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="b3b10669-0f96-42ff-8066-81c941995873">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="update config" type="groovy" id="fcb96683-20ea-474c-82a1-6ec0ceb0ffce">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="c9705dae-0336-4d18-ba52-0d25127c368b">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="f4dcf414-1ac3-4533-ba4a-d461758a5fa3">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="f74e405b-f419-4081-afba-42f15f525492">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="900f2b62-90ba-498e-a630-cfd51b797b7b">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_w_urn:oid" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
         <urn2:Slot name="$XDSDocumentEntryClassCode">
            <urn2:ValueList>
                    <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>         
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
         <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="e4554ad2-36a8-4ddb-a9fe-a8bc5aa1c88c"/>
            <con:assertion type="Schema Compliance" id="830535fb-342d-48f7-97c0-90119fd0c295">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="72bca6ac-1105-4808-8f6e-3bae1c722b69"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="6804acb1-cdfa-4ec1-8c1b-51a3215d1a57">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
log.info("xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx");
def passThruOn = context.findProperty('PassThruOn').toBoolean();
def documentID = null;
log.info("passthruon is " + passThruOn);
if(passThruOn){
	documentID = context.findProperty('DQPTDocID');
}else {
	documentID = context.findProperty('DQDocID')
}

log.info("Doc ID used xxxx: " + documentID);
def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:48Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:48Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:48</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="08c7914d-69d5-40a5-951d-5774a8836aad" keepSession="false" maxResults="0" name="Document Retrieve" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="5fd57009-33a4-40ad-aa1e-553f56bc4666">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docretrieve.30.inbound";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="9f0afb01-0bc8-4fbe-8686-3ad8749c1ea5">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="1e69a869-9383-4bd3-bfba-a2ea7234695c">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Retrieve" type="request" id="0f41e115-f8ea-421b-87f6-ca53123a9ed4">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocRetrieveBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation>
          <con:request incomingWss="" name="Document Retrieve" outgoingWss="" wssPasswordType="" id="1392a6d6-304b-453b-b190-6639493ab200">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@expand-mtom-attachments">true</con:setting>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:ihe:iti:xds-b:2007" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_w_urn:oid" testCase="Document Retrieve">
      <urn:RespondingGateway_CrossGatewayRetrieveRequest>
         <urn1:RetrieveDocumentSetRequest>
            <urn1:DocumentRequest>
               <urn1:HomeCommunityId>${#Project#RemoteHCID}</urn1:HomeCommunityId>
               <urn1:RepositoryUniqueId>${#Project#DRRepoID}</urn1:RepositoryUniqueId>
               <urn1:DocumentUniqueId>${#Project#DRDocID}</urn1:DocumentUniqueId>
            </urn1:DocumentRequest>
         </urn1:RetrieveDocumentSetRequest>
         <urn:assertion>
            <urn2:nationalProviderId>1234567890</urn2:nationalProviderId>         
            <urn2:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>AddrCity</urn2:city>
               <urn2:country>AddrCountry</urn2:country>
               <urn2:state>AddrState</urn2:state>
               <urn2:streetAddress>AddrStreet</urn2:streetAddress>
               <urn2:zipCode>AddrZip</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn2:dateOfBirth>
            <urn2:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSignature>
            <urn2:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveWitnessSignature>
            <urn2:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:description>${#Project#LocalHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn2:homeCommunityId>
               <urn2:name>${#Project#LocalHCDescription}</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sandy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
               <urn2:fullName>Sandy S. Smith</urn2:fullName>
            </urn2:personName>
            <urn2:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5436</urn2:extension>
               <urn2:localNumber>253-6849</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Addr2City</urn2:city>
               <urn2:country>Addr2Country</urn2:country>
               <urn2:state>Addr2State</urn2:state>
               <urn2:streetAddress>Addr2Street</urn2:streetAddress>
               <urn2:zipCode>Addr2Zip</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sammy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>s</urn2:secondNameOrInitials>
               <urn2:fullName>Sammy S. Smith</urn2:fullName>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5424</urn2:extension>
               <urn2:localNumber>542-6823</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn2:SSN>
            <urn2:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn2:uniquePatientId>
            <urn2:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>addrCode</urn2:code>
                  <urn2:codeSystem>addrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>addrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>addrCode</urn2:displayName>
                  <urn2:originalText>addrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Burnell</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>FL</urn2:state>
               <urn2:streetAddress>825 North</urn2:streetAddress>
               <urn2:zipCode>32184</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Scott</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S.</urn2:secondNameOrInitials>
               <urn2:fullName>Scott S. Smith</urn2:fullName>
            </urn2:witnessName>
            <urn2:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>8432</urn2:extension>
               <urn2:localNumber>985-2239</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:personName>
                  <urn2:familyName>Skagerberg</urn2:familyName>
                  <urn2:givenName>Karl</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>nameCode</urn2:code>
                     <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                     <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                     <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                     <urn2:displayName>nameCode</urn2:displayName>
                     <urn2:originalText>nameCode</urn2:originalText>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
                  <urn2:fullName>Kasrl S. Skagerberg</urn2:fullName>
               </urn2:personName>
               <urn2:userName>kskagerb</urn2:userName>
               <urn2:org>
                  <urn2:description>${#Project#LocalHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn2:homeCommunityId>
                  <urn2:name>${#Project#LocalHCDescription}</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>307969004</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Public Health</urn2:displayName>
                  <urn2:originalText>Public Health</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:code>PUBLICHEALTH</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Use or disclosure of Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:authInstant>2009-04-16T13:15:39Z</urn2:authInstant>
               <urn2:sessionIndex>987</urn2:sessionIndex>
               <urn2:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn2:authContextClassRef>
               <urn2:subjectLocalityAddress>1.1.1.1</urn2:subjectLocalityAddress>
               <urn2:subjectLocalityDNSName>connectopensource.org</urn2:subjectLocalityDNSName>
            </urn2:samlAuthnStatement>
            <urn2:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:decision>Permit</urn2:decision>
               <urn2:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn2:resource>
               <urn2:action>TestSaml</urn2:action>
               <urn2:evidence>
                  <urn2:assertion>
                     <urn2:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn2:id>
                     <urn2:issueInstant>2009-04-16T13:10:39.093Z</urn2:issueInstant>
                     <urn2:version>2.0</urn2:version>
                     <urn2:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn2:issuerFormat>
                     <urn2:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn2:issuer>
                     <urn2:conditions>
                        <urn2:notBefore>2009-04-16T13:10:39.093Z</urn2:notBefore>
                        <urn2:notOnOrAfter>2009-12-31T12:00:00.000Z</urn2:notOnOrAfter>
                     </urn2:conditions>
                     <urn2:accessConsentPolicy>urn:oid:1.2.3.4</urn2:accessConsentPolicy>
                     <urn2:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn2:instanceAccessConsentPolicy>
                  </urn2:assertion>
               </urn2:evidence>
            </urn2:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn2:nhinTargetCommunity>
               <urn2:homeCommunity>
                  <urn2:description>${#Project#RemoteHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#RemoteHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#RemoteHCDescription}</urn2:name>
               </urn2:homeCommunity>
            </urn2:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayRetrieveRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="39755654-c594-49d0-b695-6d9eababab55"/>
            <con:assertion type="SOAP Fault Assertion" id="aa2f5ecc-87fc-43cb-b6fe-2bd189436a1a"/>
            <con:assertion disabled="true" type="Schema Compliance" id="955a23dc-6f29-40f5-929f-dd722deef341">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Doc Repository ID" type="XPath Match" id="8e4b2af0-8b3c-4bf0-9d9a-1179b37cb30d">
              <con:configuration>
                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
					//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:RepositoryUniqueId[1]</path>
                <content>${#Project#DRRepoID}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Doc ID" type="XPath Match" id="3f6046fe-edad-464e-9f0c-5eca4cdac60c">
              <con:configuration>
                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
					//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:DocumentUniqueId[1]</path>
                <content>${#Project#DRDocID}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Document Data" type="GroovyScriptAssertion" id="0b37146d-8bb2-4e90-be14-c6ce70c2a17c">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
					def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
					holder.namespaces["ns"]="urn:ihe:iti:xds-b:2007"
					def docData = holder["//ns:RetrieveDocumentSetResponse[1]/ns:DocumentResponse[1]/ns:Document[1]"]
					log.info docData.toString()
					assert (docData.size() != 0)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitydocretrieve/EntityDocRetrievePortType/RespondingGateway_CrossGatewayRetrieveRequest" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>CorrectedRemoteHCID</con:name>
          <con:value>urn:oid:2.2</con:value>
        </con:property>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:50Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:50Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:50</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="61dc50b8-2600-4cdf-899e-d4f6079d9602" keepSession="false" maxResults="0" name="Admin Distribution" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="bbe48155-b4a7-4757-ad4d-e9a64fb9e675">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "admindist.inboundAdminDist";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="da33cc40-026e-43f5-8286-f9d046800086">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="5e5d1201-ac50-4ee9-b334-dfe049f38fe9">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Admin Distribution" type="request" id="8b46b6df-486f-404b-bb8e-9c15dbff9528">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdministrativeDistribution_Binding_Soap12_g1</con:interface>
          <con:operation>SendAlertMessage</con:operation>
          <con:request name="Admin Distribution" id="6a96d77a-eb27-432f-9513-31353a375680">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:emergency:EDXL:DE:1.0">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_w_urn:oid" testCase="Admin Distribution">
      <urn:RespondingGateway_SendAlertMessage>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253987546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>${#TestCase#UserId}</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>80584001</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Psychiatrist</urn1:displayName>
                  <urn1:originalText>Psychiatrist</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PSYCHOTHERAPY</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-09-01T13:00:00.000Z</urn1:authInstant>
               <urn1:sessionIndex>mySessionIndex</urn1:sessionIndex>
               <urn1:authContextClassRef>myContextClassRef</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>mySubjectLocalityAddress</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>mySubjectLocalityDns</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>myAuthzDecisionStatementResource</urn1:resource>
               <urn1:action>myAuthzDecisionStatementAction</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>AuthzDecisionStatementEvidenceAssertionId</urn1:id>
                     <urn1:issueInstant>2009-09-02T14:00:00.000Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuer>CN=Mr Saml User,OU=SU,O=Mr SAML Org,L=Chantilly,ST=VA,C=US</urn1:issuer>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>urn:oid:1.2.3.4</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:243113487404</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:159355901562</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:383675305350</urn1:signatureValue>
            </urn1:samlSignature>
            </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
               <urn1:list>?</urn1:list>
               <urn1:region>?</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn2:EDXLDistribution>
            <urn2:distributionID>633990682441061250</urn2:distributionID>
            <urn2:senderID>actor@2.16.840.1.113883.3.166</urn2:senderID>
            <urn2:dateTimeSent>2010-08-14T12:18:13.512375-08:00</urn2:dateTimeSent>
            <urn2:distributionStatus>Actual</urn2:distributionStatus>
            <urn2:distributionType>Update</urn2:distributionType>
            <urn2:combinedConfidentiality>Public</urn2:combinedConfidentiality>
            <!--Optional:-->
            <urn2:language>?</urn2:language>
            <!--Zero or more repetitions:-->
            <urn2:senderRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:senderRole>
            <!--Zero or more repetitions:-->
            <urn2:recipientRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:recipientRole>
            <!--Zero or more repetitions:-->
            <urn2:keyword>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:keyword>
            <!--Zero or more repetitions:-->
            <urn2:distributionReference>?</urn2:distributionReference>
            <!--Zero or more repetitions:-->
            <urn2:explicitAddress>
               <urn2:explicitAddressScheme>modified_IHEIntendedRecipient</urn2:explicitAddressScheme>
               <!--1 or more repetitions:-->
               <urn2:explicitAddressValue>^^^^^^^^^2.16.840.1.113883.3.166|0000000001</urn2:explicitAddressValue>
            </urn2:explicitAddress>
            <!--Zero or more repetitions:-->
            <urn2:targetArea>
               <!--Zero or more repetitions:-->
               <urn2:circle>?</urn2:circle>
               <!--Zero or more repetitions:-->
               <urn2:polygon>?</urn2:polygon>
               <!--Zero or more repetitions:-->
               <urn2:country>?</urn2:country>
               <!--Zero or more repetitions:-->
               <urn2:subdivision>?</urn2:subdivision>
               <!--Zero or more repetitions:-->
               <urn2:locCodeUN>?</urn2:locCodeUN>
            </urn2:targetArea>
            <!--Zero or more repetitions:-->
            <urn2:contentObject>
               <!--Optional:-->
               <urn2:contentDescription>PH Alert Message</urn2:contentDescription>
               <!--Zero or more repetitions:-->
               <urn2:contentKeyword>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:contentKeyword>
               <!--Optional:-->
               <urn2:incidentID>TEST</urn2:incidentID>
               <!--Optional:-->
               <urn2:incidentDescription>This is a test message</urn2:incidentDescription>
               <!--Zero or more repetitions:-->
               <urn2:originatorRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:originatorRole>
               <!--Zero or more repetitions:-->
               <urn2:consumerRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:consumerRole>
               <!--Optional:-->
               <urn2:confidentiality>Public</urn2:confidentiality>
               <!--You have a CHOICE of the next 2 items at this level-->
		<urn2:nonXMLContent>
                  <urn2:mimeType>application/pdf</urn2:mimeType>
                  <!--Optional:-->
                  <urn2:size>19</urn2:size>
                  <!--Optional:-->
                  <urn2:digest>?</urn2:digest>
                  <!--Optional:-->
                  <urn2:uri>?</urn2:uri>
                  <!--Optional:-->
                  <urn2:contentData>LDLIHAPIISDALKDF902383K1182K4J49DFNF3KR0482HJ1029F393</urn2:contentData>
               </urn2:nonXMLContent>
               <!--You may enter ANY elements at this point-->
            </urn2:contentObject>
         </urn2:EDXLDistribution>
      </urn:RespondingGateway_SendAlertMessage>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="delay" name="Delay" id="03c27f17-7c7d-4f4d-8576-37d728048a3a">
        <con:settings/>
        <con:config>
          <delay>10000</delay>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:52Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:52Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:52</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="CM_w_urn:oid_ReqMsg_wo_urn:oid" id="e94356fa-42a4-4ca0-afbd-1071b7d35dca">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="53f821fb-e99b-4318-a86d-66e62b517650" keepSession="false" maxResults="0" name="Document Submission Deferred Req" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="33ae6b8d-3444-43c5-b3f1-db67ebcb298b">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmissionRequest";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="3bd8facf-7d58-496c-83ea-7156cb55333e">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="f8622781-91d8-4e0b-bba5-8aa596caea7e">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission Deferred Req" type="request" id="dafdef91-6ed5-419d-b42a-2cb685069f13">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDRAsyncRequest_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-bAsyncRequest</con:operation>
          <con:request incomingWss="" name="Doc Submission Deferred Req" outgoingWss="" useWsAddressing="true" wssPasswordType="" id="b8859516-0a2e-421d-8316-4aae0febc8e6">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Submission Deferred Req">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>                  
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->
  
               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList> 

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="8cd99c4a-f37e-46d3-bb22-4744b3ba99a0"/>
            <con:assertion type="SOAP Fault Assertion" id="286202b1-2c5f-4ed6-ba25-0460d7258b11"/>
            <con:assertion name="Match content of @status" type="XPath Match" id="7918dc23-90aa-4864-9620-b16ebd15867b">
              <con:configuration>
                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
							//ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:RequestAccepted</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="56fca6a2-753b-4bfc-9306-5be64258303b">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" name="Verify RelatesTo" id="810b4e07-ade7-4822-a908-e3fe2ab5d84b">
              <con:configuration>
                <scriptText>import com.eviware.soapui.support.XmlHolder;
def request = new XmlHolder(messageExchange.requestContentAsXml);
def response = new XmlHolder(messageExchange.responseContentAsXml);
request.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
response.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
assert request["//add:MessageID/text()"] == response["//add:RelatesTo/text()"];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincentityxdr:async:request:ProvideAndRegisterDocumentSet-bAsyncRequest_RequestMessage" generateMessageId="true" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:14Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:14Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:14</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="dc3b8bf1-91e1-4aeb-b865-8b5c6b388a4f" keepSession="false" maxResults="0" name="Document Submission Deferred Resp" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="6a4f78f1-161e-4a1d-ac68-0e93559f8cb6">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmissionResponse";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="db4e2961-dfd6-4de0-8935-6b39d565dcdb">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_ornuid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="ee7b1768-1649-4300-becc-c6793783f4d9">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission Deferred Resp" type="request" id="c95f3c87-dcd7-4ce1-a250-6783f27dae0a">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDRAsyncResponse_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-bAsyncResponse</con:operation>
          <con:request name="Doc Submission Deferred Resp" id="854199a4-5288-45e9-92bc-a796d04c965d">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Submission Deferred Resp">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
               <urn1:prefix>Ms.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>?addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>SkagerBerg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                     <!--Zero or more repetitions:-->
                     <urn1:translation/>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Karl S. Skagerberg</urn1:fullName>
                  <urn1:prefix>?</urn1:prefix>
                  <urn1:suffix>?</urn1:suffix>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <!--Optional:-->
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy notes</urn1:originalText>
               <!--Zero or more repetitions:-->
               <urn1:translation/>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <!--Optional:-->
                     <urn1:version>2.0</urn1:version>
                     <!--Optional:-->
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <!--Optional:-->
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <!--Optional:-->
                     <urn1:conditions>
                        <!--Optional:-->
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <!--Optional:-->
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <!--Zero or more repetitions:-->
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <!--Zero or more repetitions:-->
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:721645965035</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:146207300753</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:783710993742</urn1:signatureValue>
            </urn1:samlSignature>
            <!--Optional:-->
            <urn1:samlIssuer>
               <!--Optional:-->
               <urn1:issuer>?</urn1:issuer>
               <!--Optional:-->
               <urn1:issuerFormat>?</urn1:issuerFormat>
            </urn1:samlIssuer>
            <!--Optional:-->
            <urn1:messageId>?</urn1:messageId>
            <!--1 or more repetitions:-->
            <urn1:relatesToList>uuid:088a26e8-6b03-4bf8-84f1-737dc94be2e0</urn1:relatesToList>
         </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn:RegistryResponse status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" requestId="?"><!--Optional:-->
            <urn2:ResponseSlotList>
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
            </urn2:ResponseSlotList>
            <!--Optional:-->
            <urn2:RegistryErrorList highestSeverity="?">
               <!--1 or more repetitions:-->
               <urn2:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn2:RegistryError>
            </urn2:RegistryErrorList>
         </urn:RegistryResponse>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="737c7c81-ac89-4bbe-b088-44e8b8352eae"/>
            <con:assertion type="Schema Compliance" id="d9414a32-bf2c-4324-af1e-8c3fc5ece1a2">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="b6686095-fb61-4643-9a0b-b8b1653c018a"/>
            <con:assertion type="XPath Match" name="Match content of @status" id="5bfb1fab-0817-4f73-80f9-7f3149b4e33e">
              <con:configuration>
                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
//ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:ResponseAccepted</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                <ignoreComments>false</ignoreComments>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:16Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:16Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:16</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="fa57d83c-8474-4625-9186-b3902fdda4ab" keepSession="false" maxResults="0" name="Document Submission" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="f1622d0b-0549-4825-a097-ca3a194ba40e">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmission";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="aa01cd8c-aad4-4fa6-8097-1716417ebccc">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_ornuid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="5daaf9bd-1222-4f3e-99f0-ede1e5ed3e5d">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission" type="request" id="785eee0c-a477-4a76-bae7-8a3c6a4b4c74">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDR_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-b</con:operation>
          <con:request incomingWss="" name="Doc Submission" outgoingWss="" wssPasswordType="" id="e28e45b2-9c03-4920-8588-fa3e21cb35f9">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Submission">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->
  
               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList> 

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="0e8ace17-88c1-4f82-a13a-50019b5e90be"/>
            <con:assertion type="SOAP Fault Assertion" id="12f611f4-7600-46b8-8a84-e12734acfc45"/>
            <con:assertion type="XPath Match" id="aca6bfcf-190c-4b0b-8eef-8604b5ce0018">
              <con:configuration>
                <path>declare namespace ns11='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
							//ns11:RegistryResponse[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="2c92e413-d0ce-449f-8d91-8bcc45d476cb">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="{urn:gov:hhs:fha:nhinc:nhincentityxdr}ProvideAndRegisterDocumentSet-b" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:17Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:17Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:17</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="62ebf4c2-b4e0-4465-b715-df30e72f945a" keepSession="false" maxResults="0" name="Patient Discovery Deferred Req" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="7c65c60f-21a4-45eb-93ab-2c012f9bf78c">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscoveryRequest";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="e9d1aa35-59d2-4a2e-acdc-221bbea15e0c">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_ornuid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="89881abb-6fee-4ddc-8b4b-5b231fad259b">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery Deferred Req" type="request" id="9fe34948-0051-409e-8035-07570f656f57">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryAsyncReqBindingSoap</con:interface>
          <con:operation>ProcessPatientDiscoveryAsyncReq</con:operation>
          <con:request name="Patient Discovery Deferred Req" useWsAddressing="true" id="6ff83a54-50f3-4cec-ba97-d176fca6164c">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_wo_urn:oid" testCase="Patient Discovery Deferred Req">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithouturnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#RemoteHCID}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#LocalPatientID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <!--Optional:-->
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <!--Optional:-->
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="bcfa98ce-55bb-426d-a956-bb2ec1677d0d"/>
            <con:assertion type="SOAP Fault Assertion" id="8e0fe1af-3f3f-4289-ae59-82812cf84274"/>
            <con:assertion name="Verify Receiver" type="XPath Match" id="45c28850-f9d1-4cba-a666-1d89aae87cf4">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:receiver[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                <content>1.1</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Verify Sender" type="XPath Match" id="5d946eb9-530f-45a1-9f49-045c98aca79f">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:sender[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                <content>2.2</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Verify Message" type="XPath Match" id="417a5161-fee8-4e77-befe-809ff0f45e54">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:acknowledgement[1]/ns3:acknowledgementDetail[1]/ns3:text[1]/text()</path>
                <content>Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="cf9b4f61-c6bd-466e-b430-8fe3cae345a2">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" name="Verify RelatesTo" id="4ef6b195-27c3-45b5-ad3f-433f8f54c222">
              <con:configuration>
                <scriptText>import com.eviware.soapui.support.XmlHolder;
def request = new XmlHolder(messageExchange.requestContentAsXml);
def response = new XmlHolder(messageExchange.responseContentAsXml);
request.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
response.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
assert request["//add:MessageID/text()"] == response["//add:RelatesTo/text()"];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncreq:ProcessPatientDiscoveryAsyncReqAsyncRequest" addDefaultTo="true" messageID="uuid:6666666666.66666.666.66" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:19Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:19Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:19</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="e98901ca-10ae-4725-ac64-5b2bd8da2b3e" keepSession="false" maxResults="0" name="Patient Discovery Deferred Resp" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="aded90d4-9416-4cb8-b75f-a3f6bd5b68b1">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscoveryResponse";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="18fdb9a2-78da-4a69-9d09-ca953813f7f8">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="67a5f597-409f-422a-ac3e-e5ad7dec4139">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery Deferred Resp" type="request" id="7970080a-20aa-4381-89b9-b0f1e65a0abe">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryAsyncRespBindingSoap</con:interface>
          <con:operation>ProcessPatientDiscoveryAsyncResp</con:operation>
          <con:request name="Patient Discovery Deferred Resp" id="c9664b47-e0c1-4d66-8c30-400d3b6e5755">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_wo_urn:oid" testCase="Patient Discovery Deferred Resp">
      <urn:RespondingGateway_PRPA_IN201306UV02Request>
         <urn:PRPA_IN201306UV02 ITSVersion="XML_1.0">
            <urn:id root="2.2" extension="-5a3e95b1:11d1fa33d45:-8e45"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <!--1 or more repetitions:-->
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithouturnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:code codeSystem="2.16.840.1.113883.1.6" code="PRPA_TE201306UV"/>
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="2.2"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:subject typeCode="SUBJ">
                  <urn:registrationEvent classCode="REG" moodCode="EVN">
                     <urn:id nullFlavor="NA"/>
                     <urn:statusCode code="active"/>
                     <urn:subject1 typeCode="SBJ">
                        <urn:patient classCode="PAT">
                           <urn:id extension="D123402" root="2.2"/>
                           <urn:statusCode code="SD"/>
                           <urn:patientPerson>
                              <urn:name>
                                 <urn:family partType="FAM">Younger</urn:family>
                                 <urn:given partType="GIV">Gallow</urn:given>
                              </urn:name>
                              <urn:administrativeGenderCode code="M"/>
                              <urn:birthTime value="19630804"/>
                              <urn:addr>
                                 <urn:city>LEESBURG</urn:city>
                                 <urn:state>VA</urn:state>
                                 <urn:postalCode>20176</urn:postalCode>
                              </urn:addr>
                           </urn:patientPerson>
                           <urn:providerOrganization determinerCode="" classCode="">
                              <urn:id root="2.2"/>
                              <urn:contactParty xsi:nil="true" classCode="CON" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                           </urn:providerOrganization>
                        </urn:patient>
                     </urn:subject1>
                     <urn:custodian typeCode="">
                        <urn:assignedEntity classCode="">
                           <urn:id root="2.2"/>
                        </urn:assignedEntity>
                     </urn:custodian>
                  </urn:registrationEvent>
               </urn:subject>
               <urn:queryAck>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:queryResponseCode code="OK"/>
                  <urn:resultTotalQuantity value="1"/>
                  <urn:resultCurrentQuantity value="1"/>
                  <urn:resultRemainingQuantity value="0"/>
               </urn:queryAck>
               <urn:queryByParameter>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="M"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="19630804"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectId>
                        <urn:value extension="D123401" root="1.1"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">Younger</urn:family>
                           <urn:given partType="GIV">Gallow</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectName>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201306UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201306UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="10b3b99e-b017-44da-910b-11e89a81bdb4"/>
            <con:assertion type="SOAP Fault Assertion" id="2045cf49-c598-4143-b814-90d694688190"/>
            <con:assertion name="Match content of [typeCode/@code]" type="XPath Match" id="81b3babc-e220-4a7e-91e9-4f6270cf1cd3">
              <con:configuration>
                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:typeCode[1]/@code</path>
                <content>CA</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Match content of [acknowledgementDetail/text/text()]" type="XPath Match" id="2d894385-a9bf-4c3d-89ec-be02ae02b926">
              <con:configuration>
                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:acknowledgementDetail[1]/ns2:text/text()</path>
                <content>Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="efac3cb1-584e-4d9e-a8ac-c416c743885a">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:21Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:21Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:21</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="fe917e9c-4e89-4ce8-9828-05b542fb1be0" keepSession="false" maxResults="0" name="Patient Discovery" searchProperties="true">
      <con:settings/>
      <con:testStep name="clear correlations table" type="groovy" id="f0bad028-662a-4cb8-97a3-9e0243f899d2">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
			sql.execute('delete from ' + context.findProperty('PatientCorrelationTable'))
			}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="5dd5cb2b-b326-458d-b705-07966e9a4fb9">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="9f86c235-dc9e-44b0-885f-b35381bd8eb8">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Check Passthru" id="5972c72c-4f36-4102-ad78-c8e5b7401553">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscovery";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	/**def ln = System.getProperty('line.separator');
	def policyEngineFile = new File(dir + "/" + "PolicyEngineProxyConfig.xml");
	def policyEngineFileNew = new File(dir + "/" + "PolicyEngineProxyConfig.xml.NEW");
	policyEngineFile.eachLine() {
		line ->
		if(line.contains(alias)) {
			policyEngineFileNew &lt;&lt; replaceAlias + ln;
		} else {
			policyEngineFileNew &lt;&lt; line + ln;
		}
	}

	policyEngineFile.delete();
	policyEngineFileNew.renameTo(new File(dir + "/" + "PolicyEngineProxyConfig.xml"));
	**/
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
	testRunner.gotoStepByName("Patient Discovery");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Set Up PassThru" id="9b4dadf4-0ef3-4896-9d0a-ad2ffe1e5613">
        <con:settings/>
        <con:config>
          <script>log.info "Setting Patient Discovery Adapter to unsecured";
def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "PatientDiscoveryProxyConfig.xml", log);
def alias = 'adapterpatientdiscovery'
def aliasName= 'adapterpatientdiscoverywssecured';
def replaceAlias = 'adapterpatientdiscoverywsunsecured';

nhinc.FileUtils.updateSpringConfig(dir, "PatientDiscoveryProxyConfig.xml",
	alias, aliasName, replaceAlias, log);
/**
def pdConfigFile = new File(dir + "/" + "PatientDiscoveryProxyConfig.xml");
def pdConfigFileNew = new File(dir + "/" + "PatientDiscoveryProxyConfig.xml.NEW");
pdConfigFile.eachLine() {
	line ->
	if(line.contains(alias)) {
		pdConfigFileNew &lt;&lt; replaceAlias + ln;
	} else {
		pdConfigFileNew &lt;&lt; line + ln;
	}
}

pdConfigFile.delete();
pdConfigFileNew.renameTo(new File(dir + "/" + "PatientDiscoveryProxyConfig.xml"));
**/
log.info "Modifying internalExchangeInfo for adapterpatientdiscovery mock."

nhinc.FileUtils.createOrUpdateConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterpatientdiscovery", "http://localhost:1720/MockPDAdapter", "2.0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery" type="request" id="d560ab6d-b21f-4eb5-9be8-d675665a137e">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryBindingSoap</con:interface>
          <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
          <con:request name="Patient Discovery" id="a2bfc7f9-2091-4bec-a907-5e69f3f87024">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_wo_urn:oid" testCase="Patient Discovery">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithouturnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#LocalHCIDWithouturnoid}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#SubjectID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>${#Project#City}</urn1:city>
               <urn1:country>${#Project#Country}</urn1:country>
               <urn1:state>${#Project#State}</urn1:state>
               <urn1:streetAddress>${#Project#StreetAddress}</urn1:streetAddress>
               <urn1:zipCode>${#Project#ZipCode}</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>${#Project#DOB}</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>${#Project#FamilyName}</urn1:familyName>
               <urn1:givenName>${#Project#GivenName}</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>${#Project#SSN}</urn1:SSN>
            <urn1:uniquePatientId>${#Project#UniquePatientId}</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTH</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
               <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="670c0c61-abd6-47d5-85b8-f80fa42d22cf"/>
            <con:assertion disabled="true" type="Schema Compliance" id="dacf1193-50cb-41cf-8579-f73b94482748">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="abb642c5-7691-410b-b226-254abcdd6172"/>
            <con:assertion name="Check for existance of [ns3:controlActProcess]" type="XPath Match" id="88596dad-ae42-4bd6-88b0-a3627b4ca7c9">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
				exists( //ns3:PRPA_IN201306UV02/ns3:controlActProcess)</path>
                <content>true</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Given Name XPath Match" type="XPath Match" id="91b4461d-c5ab-450f-816d-37801880c35e">
              <con:configuration>
                <path>declare namespace ns1='urn:hl7-org:v3';
				//ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:given[1]</path>
                <content>${#Project#GivenName}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Family Name XPath Match" type="XPath Match" id="a2d891eb-ae4e-4056-8683-538551c65183">
              <con:configuration>
                <path>declare namespace ns1='urn:hl7-org:v3';
				//ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:family[1]</path>
                <content>${#Project#FamilyName}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Skip Mock" id="bd4efc34-2568-44d1-b3eb-5d18b8e761eb">
        <con:settings/>
        <con:config>
          <script>def runMock = context.findProperty("PassThruOn").toBoolean();

if(!runMock){
	testRunner.gotoStepByName("count correlations");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="f70e06b8-9baa-4f1b-ac53-dcc124da4c1b">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="Set Up PassThru" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterPatientDiscoveryBindingSoap</con:interface>
          <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
          <con:path>/MockPDAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="b787c6c0-774f-40a4-9a53-bc1e20aba85f">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3">
   <soap:Header/>
   <soap:Body>
   <PRPA_IN201306UV02 xmlns="urn:hl7-org:v3" xmlns:ns2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns3="http://www.w3.org/2005/08/addressing" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:patientcorrelationfacade" ITSVersion="XML_1.0">
   <id root="1.1" extension="13318247:13b4e0b839b:-7ff4"/>
   <creationTime value="20121129212833"/>
   <interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
   <processingCode code="P"/>
   <processingModeCode code="T"/>
   <acceptAckCode code="NE"/>
   <receiver typeCode="RCV">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="1.2.345.678.999"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="${#Project#LocalHCIDWithouturnoid}"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </receiver>
   <sender typeCode="SND">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="2.2"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="${#Project#RemoteHCID}"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </sender>
   <acknowledgement>
   	<typeId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
   	<typeCode code="AA"/><targetMessage xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   </acknowledgement>
   <controlActProcess classCode="CACT" moodCode="EVN">
   	<code code="PRPA_TE201306UV" codeSystem="2.16.840.1.113883.1.6"/>
   	<subject typeCode="SUBJ">
   		<registrationEvent classCode="REG" moodCode="EVN">
   			<id nullFlavor="NA"/>
   			<statusCode code="active"/>
   				<subject1 typeCode="SBJ">
   					<patient classCode="PAT">
   						<id root="1.1" extension="D123401"/>
   						<statusCode code="SD"/>
   						<patientPerson classCode="PSN" determinerCode="INSTANCE">
   							<name>
   								<family partType="FAM">Younger</family>
   								<given partType="GIV">Gallow</given>
   							</name>
   							<telecom value="tel:+1-888-555-1234"/>
   							<administrativeGenderCode code="M"/>
   							<birthTime value="19630804"/>
   							<addr><city>LEESBURG</city><state>VA</state><postalCode>20176</postalCode></addr>
   							<asOtherIDs classCode="SD">
   								<id root="2.16.840.1.113883.4.1" extension="999123401"/>
   								<scopingOrganization classCode="ORG" determinerCode="INSTANCE">
   									<id root="2.16.840.1.113883.4.1"/>
   								</scopingOrganization>
   							</asOtherIDs>
   						</patientPerson>
   						<providerOrganization classCode="ORG" determinerCode="INSTANCE">
   							<id root="1.1"/>
   							<contactParty xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   							</providerOrganization>
   							<subjectOf1>
   								<queryMatchObservation classCode="CASE" moodCode="EVN">
   									<code code="IHE_PDQ"/>
   									<value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="INT" value="100"/>
   								</queryMatchObservation>
   							</subjectOf1>
   						</patient>
   					</subject1>
   					<custodian typeCode="CST">
   						<assignedEntity classCode="ASSIGNED">
   							<id root="1.1"/>
   							<code code="NotHealthDataLocator" codeSystem="1.3.6.1.4.1.19376.1.2.27.2"/>
   						</assignedEntity>
   					</custodian>
   				</registrationEvent>
   			</subject>
   			<queryAck>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<queryResponseCode code="OK"/>
   			</queryAck>
   			<queryByParameter>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<statusCode code="new"/>
   				<responseModalityCode code="R"/>
   				<responsePriorityCode code="I"/>
   				<parameterList>
   					<livingSubjectAdministrativeGender>
   						<value code="M"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectAdministrativeGender>
   					<livingSubjectBirthTime>
   						<value value="19630804"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectBirthTime>
   					<livingSubjectId>
   						<value root="1.1" extension="1111"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectId>
   					<livingSubjectName>
   						<value>
   							<family partType="FAM">Younger</family>
   							<given partType="GIV">Gallow</given>
                        		</value>
                        		<semanticsText representation="TXT"/>
                        	</livingSubjectName>
                     </parameterList>
                 </queryByParameter>
             </controlActProcess>
     </PRPA_IN201306UV02>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
        </con:config>
      </con:testStep>
      <con:testStep name="count correlations" type="groovy" id="0f289e43-b868-412d-b688-c138b6b4a70c">
        <con:settings/>
        <con:config>
          <script>def pdCorrelations = 1;

if(context.findProperty("PassThruOn").toBoolean()) {
	pdCorrelations = 0;
}

log.info "Assert ${pdCorrelations} number of correlations"

context.withSql('PatientCorrelationDB') { sql -> 
		assert pdCorrelations == sql.firstRow('select count(*) from ' + context.findProperty('PatientCorrelationTable'))[0]
		}</script>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
//nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
	nhinc.FileUtils.restoreFile(dir, "PatientDiscoveryProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:23Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:23Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:23</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="801f7f15-5164-41c3-907f-9c0a9db42262" keepSession="false" maxResults="0" name="Document Query" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="fbf08418-3b59-4e48-886b-42b5813f02d6">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docquery.30.inboundDocQuery";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
	testRunner.gotoStepByName("Document Query");
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="f9d9ae18-e361-4081-be4d-b0c95397be1b">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="2b1bd35a-84b3-4dd8-beb7-9ef69d08e2ee">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="update config" type="groovy" id="6830c4b3-bb3d-4459-8dc3-e14cc476a3e8">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="c217ffe0-ce6b-4c21-a4c7-f20432c732c6">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="72495242-a3d5-4778-9ed5-f79387c50d55">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="bffe99a7-1559-4de0-9e6c-70d5b0a356f6">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="ca4bee26-73fb-40db-bbea-32ba82b9399c">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
         <urn2:Slot name="$XDSDocumentEntryClassCode">
            <urn2:ValueList>
                    <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>         
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
         <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="6f1aab4e-c447-4de9-9a90-24e26d6f792c"/>
            <con:assertion type="Schema Compliance" id="5981a6af-fc61-4c50-85f3-fa47e9ee1f1f">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="f8a125a9-2f1c-4b02-b6cb-c2630cee865d"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="561c55dd-d864-402c-8d0d-7773961d1aa5">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
log.info("xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx");
def passThruOn = context.findProperty('PassThruOn').toBoolean();
def documentID = null;
log.info("passthruon is " + passThruOn);
if(passThruOn){
	documentID = context.findProperty('DQPTDocID');
}else {
	documentID = context.findProperty('DQDocID')
}

log.info("Doc ID used xxxx: " + documentID);
def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:26Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:26Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:26</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="08c7914d-69d5-40a5-951d-5774a8836aad" keepSession="false" maxResults="0" name="Document Retrieve" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="f1d30174-5d85-491a-9332-12ce2ea7da47">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docretrieve.30.inbound";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="66fe3fe4-d462-4009-b6ec-e58d3f4645c5">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="6d703314-ad1f-4249-ab79-a9a311ce22d4">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Retrieve" type="request" id="241d280b-42a3-4c73-bde5-fa6a4c2172d5">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocRetrieveBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation>
          <con:request incomingWss="" name="Document Retrieve" outgoingWss="" wssPasswordType="" id="d4d08e71-68e2-4e4c-a715-f44bede24562">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@expand-mtom-attachments">true</con:setting>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:ihe:iti:xds-b:2007" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Retrieve">
      <urn:RespondingGateway_CrossGatewayRetrieveRequest>
         <urn1:RetrieveDocumentSetRequest>
            <urn1:DocumentRequest>
               <urn1:HomeCommunityId>${#Project#RemoteHCID}</urn1:HomeCommunityId>
               <urn1:RepositoryUniqueId>${#Project#DRRepoID}</urn1:RepositoryUniqueId>
               <urn1:DocumentUniqueId>${#Project#DRDocID}</urn1:DocumentUniqueId>
            </urn1:DocumentRequest>
         </urn1:RetrieveDocumentSetRequest>
         <urn:assertion>
            <urn2:nationalProviderId>1234567890</urn2:nationalProviderId>         
            <urn2:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>AddrCity</urn2:city>
               <urn2:country>AddrCountry</urn2:country>
               <urn2:state>AddrState</urn2:state>
               <urn2:streetAddress>AddrStreet</urn2:streetAddress>
               <urn2:zipCode>AddrZip</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn2:dateOfBirth>
            <urn2:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSignature>
            <urn2:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveWitnessSignature>
            <urn2:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:description>${#Project#LocalHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn2:homeCommunityId>
               <urn2:name>${#Project#LocalHCDescription}</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sandy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
               <urn2:fullName>Sandy S. Smith</urn2:fullName>
            </urn2:personName>
            <urn2:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5436</urn2:extension>
               <urn2:localNumber>253-6849</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Addr2City</urn2:city>
               <urn2:country>Addr2Country</urn2:country>
               <urn2:state>Addr2State</urn2:state>
               <urn2:streetAddress>Addr2Street</urn2:streetAddress>
               <urn2:zipCode>Addr2Zip</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sammy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>s</urn2:secondNameOrInitials>
               <urn2:fullName>Sammy S. Smith</urn2:fullName>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5424</urn2:extension>
               <urn2:localNumber>542-6823</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn2:SSN>
            <urn2:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn2:uniquePatientId>
            <urn2:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>addrCode</urn2:code>
                  <urn2:codeSystem>addrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>addrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>addrCode</urn2:displayName>
                  <urn2:originalText>addrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Burnell</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>FL</urn2:state>
               <urn2:streetAddress>825 North</urn2:streetAddress>
               <urn2:zipCode>32184</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Scott</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S.</urn2:secondNameOrInitials>
               <urn2:fullName>Scott S. Smith</urn2:fullName>
            </urn2:witnessName>
            <urn2:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>8432</urn2:extension>
               <urn2:localNumber>985-2239</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:personName>
                  <urn2:familyName>Skagerberg</urn2:familyName>
                  <urn2:givenName>Karl</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>nameCode</urn2:code>
                     <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                     <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                     <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                     <urn2:displayName>nameCode</urn2:displayName>
                     <urn2:originalText>nameCode</urn2:originalText>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
                  <urn2:fullName>Kasrl S. Skagerberg</urn2:fullName>
               </urn2:personName>
               <urn2:userName>kskagerb</urn2:userName>
               <urn2:org>
                  <urn2:description>${#Project#LocalHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn2:homeCommunityId>
                  <urn2:name>${#Project#LocalHCDescription}</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>307969004</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Public Health</urn2:displayName>
                  <urn2:originalText>Public Health</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:code>PUBLICHEALTH</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Use or disclosure of Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:authInstant>2009-04-16T13:15:39Z</urn2:authInstant>
               <urn2:sessionIndex>987</urn2:sessionIndex>
               <urn2:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn2:authContextClassRef>
               <urn2:subjectLocalityAddress>1.1.1.1</urn2:subjectLocalityAddress>
               <urn2:subjectLocalityDNSName>connectopensource.org</urn2:subjectLocalityDNSName>
            </urn2:samlAuthnStatement>
            <urn2:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:decision>Permit</urn2:decision>
               <urn2:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn2:resource>
               <urn2:action>TestSaml</urn2:action>
               <urn2:evidence>
                  <urn2:assertion>
                     <urn2:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn2:id>
                     <urn2:issueInstant>2009-04-16T13:10:39.093Z</urn2:issueInstant>
                     <urn2:version>2.0</urn2:version>
                     <urn2:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn2:issuerFormat>
                     <urn2:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn2:issuer>
                     <urn2:conditions>
                        <urn2:notBefore>2009-04-16T13:10:39.093Z</urn2:notBefore>
                        <urn2:notOnOrAfter>2009-12-31T12:00:00.000Z</urn2:notOnOrAfter>
                     </urn2:conditions>
                     <urn2:accessConsentPolicy>urn:oid:1.2.3.4</urn2:accessConsentPolicy>
                     <urn2:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn2:instanceAccessConsentPolicy>
                  </urn2:assertion>
               </urn2:evidence>
            </urn2:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn2:nhinTargetCommunity>
               <urn2:homeCommunity>
                  <urn2:description>${#Project#RemoteHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#RemoteHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#RemoteHCDescription}</urn2:name>
               </urn2:homeCommunity>
            </urn2:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayRetrieveRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="e51101e0-bbd0-4531-b5e8-afaedbdb62df"/>
            <con:assertion type="SOAP Fault Assertion" id="1290cee0-927a-4d19-85ac-640028f5ab45"/>
            <con:assertion disabled="true" type="Schema Compliance" id="05410f95-42b5-4304-8c7d-52aa02835d9c">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Doc Repository ID" type="XPath Match" id="c71082c6-0b6c-46d8-9bd3-ea262da3b655">
              <con:configuration>
                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
					//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:RepositoryUniqueId[1]</path>
                <content>${#Project#DRRepoID}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Doc ID" type="XPath Match" id="208aa4dd-70a7-4d55-ba47-95bf154397cd">
              <con:configuration>
                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
					//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:DocumentUniqueId[1]</path>
                <content>${#Project#DRDocID}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Document Data" type="GroovyScriptAssertion" id="5f5ac775-f83d-4616-846f-853d54de8fba">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
					def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
					holder.namespaces["ns"]="urn:ihe:iti:xds-b:2007"
					def docData = holder["//ns:RetrieveDocumentSetResponse[1]/ns:DocumentResponse[1]/ns:Document[1]"]
					log.info docData.toString()
					assert (docData.size() != 0)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitydocretrieve/EntityDocRetrievePortType/RespondingGateway_CrossGatewayRetrieveRequest" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>CorrectedRemoteHCID</con:name>
          <con:value>urn:oid:2.2</con:value>
        </con:property>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:28Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:28Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:28</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" id="61dc50b8-2600-4cdf-899e-d4f6079d9602" keepSession="false" maxResults="0" name="Admin Distribution" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="6b19d572-c942-4e28-9bdb-6965e9bb6476">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "admindist.inboundAdminDist";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWurnoid" id="51d870ab-22e0-4b41-ab95-edb3ad531a46">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_With_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWurnoid" id="44f52978-6855-474e-a87a-9edea31084d1">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_With_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Admin Distribution" type="request" id="0827bbaf-5258-44c5-9275-1516aa6890d8">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdministrativeDistribution_Binding_Soap12_g1</con:interface>
          <con:operation>SendAlertMessage</con:operation>
          <con:request name="Admin Distribution" id="c4b65b8e-b4dd-4c43-b375-27a9268a1690">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:emergency:EDXL:DE:1.0">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_w_urn:oid_ReqMsg_wo_urn:oid" testCase="Admin Distribution">
      <urn:RespondingGateway_SendAlertMessage>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253987546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>${#TestCase#UserId}</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>80584001</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Psychiatrist</urn1:displayName>
                  <urn1:originalText>Psychiatrist</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PSYCHOTHERAPY</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-09-01T13:00:00.000Z</urn1:authInstant>
               <urn1:sessionIndex>mySessionIndex</urn1:sessionIndex>
               <urn1:authContextClassRef>myContextClassRef</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>mySubjectLocalityAddress</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>mySubjectLocalityDns</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>myAuthzDecisionStatementResource</urn1:resource>
               <urn1:action>myAuthzDecisionStatementAction</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>AuthzDecisionStatementEvidenceAssertionId</urn1:id>
                     <urn1:issueInstant>2009-09-02T14:00:00.000Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuer>CN=Mr Saml User,OU=SU,O=Mr SAML Org,L=Chantilly,ST=VA,C=US</urn1:issuer>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>urn:oid:1.2.3.4</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:243113487404</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:159355901562</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:383675305350</urn1:signatureValue>
            </urn1:samlSignature>
            </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
               <urn1:list>?</urn1:list>
               <urn1:region>?</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn2:EDXLDistribution>
            <urn2:distributionID>633990682441061250</urn2:distributionID>
            <urn2:senderID>actor@2.16.840.1.113883.3.166</urn2:senderID>
            <urn2:dateTimeSent>2010-08-14T12:18:13.512375-08:00</urn2:dateTimeSent>
            <urn2:distributionStatus>Actual</urn2:distributionStatus>
            <urn2:distributionType>Update</urn2:distributionType>
            <urn2:combinedConfidentiality>Public</urn2:combinedConfidentiality>
            <!--Optional:-->
            <urn2:language>?</urn2:language>
            <!--Zero or more repetitions:-->
            <urn2:senderRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:senderRole>
            <!--Zero or more repetitions:-->
            <urn2:recipientRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:recipientRole>
            <!--Zero or more repetitions:-->
            <urn2:keyword>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:keyword>
            <!--Zero or more repetitions:-->
            <urn2:distributionReference>?</urn2:distributionReference>
            <!--Zero or more repetitions:-->
            <urn2:explicitAddress>
               <urn2:explicitAddressScheme>modified_IHEIntendedRecipient</urn2:explicitAddressScheme>
               <!--1 or more repetitions:-->
               <urn2:explicitAddressValue>^^^^^^^^^2.16.840.1.113883.3.166|0000000001</urn2:explicitAddressValue>
            </urn2:explicitAddress>
            <!--Zero or more repetitions:-->
            <urn2:targetArea>
               <!--Zero or more repetitions:-->
               <urn2:circle>?</urn2:circle>
               <!--Zero or more repetitions:-->
               <urn2:polygon>?</urn2:polygon>
               <!--Zero or more repetitions:-->
               <urn2:country>?</urn2:country>
               <!--Zero or more repetitions:-->
               <urn2:subdivision>?</urn2:subdivision>
               <!--Zero or more repetitions:-->
               <urn2:locCodeUN>?</urn2:locCodeUN>
            </urn2:targetArea>
            <!--Zero or more repetitions:-->
            <urn2:contentObject>
               <!--Optional:-->
               <urn2:contentDescription>PH Alert Message</urn2:contentDescription>
               <!--Zero or more repetitions:-->
               <urn2:contentKeyword>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:contentKeyword>
               <!--Optional:-->
               <urn2:incidentID>TEST</urn2:incidentID>
               <!--Optional:-->
               <urn2:incidentDescription>This is a test message</urn2:incidentDescription>
               <!--Zero or more repetitions:-->
               <urn2:originatorRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:originatorRole>
               <!--Zero or more repetitions:-->
               <urn2:consumerRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:consumerRole>
               <!--Optional:-->
               <urn2:confidentiality>Public</urn2:confidentiality>
               <!--You have a CHOICE of the next 2 items at this level-->
		<urn2:nonXMLContent>
                  <urn2:mimeType>application/pdf</urn2:mimeType>
                  <!--Optional:-->
                  <urn2:size>19</urn2:size>
                  <!--Optional:-->
                  <urn2:digest>?</urn2:digest>
                  <!--Optional:-->
                  <urn2:uri>?</urn2:uri>
                  <!--Optional:-->
                  <urn2:contentData>LDLIHAPIISDALKDF902383K1182K4J49DFNF3KR0482HJ1029F393</urn2:contentData>
               </urn2:nonXMLContent>
               <!--You may enter ANY elements at this point-->
            </urn2:contentObject>
         </urn2:EDXLDistribution>
      </urn:RespondingGateway_SendAlertMessage>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="delay" name="Delay" id="eeaba244-ba46-495c-9b8b-aa94e40bc622">
        <con:settings/>
        <con:config>
          <delay>10000</delay>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:30Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:30Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:30</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="CM_wo_urn:oid_ReqMsg_w_urn:oid" id="7e1cf4c8-d0bd-4f8d-be2a-c7e4d5fb9e73">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission Deferred Req" searchProperties="true" id="083075b3-a102-4a73-a0ef-7363e9d86144">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="c4d18544-64bd-45ff-9d0f-ed91cc83afcb">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmissionRequest";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="c302a7fa-ce45-497e-b89d-fa3e778c1990">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="a8c4b25f-ef74-4ba4-8fbf-76618e021be3">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission Deferred Req" type="request" id="e342b498-e34b-46d7-8220-2832eb010108">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDRAsyncRequest_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-bAsyncRequest</con:operation>
          <con:request incomingWss="" name="Doc Submission Deferred Req" outgoingWss="" useWsAddressing="true" wssPasswordType="" id="9378545c-048d-44f9-ab46-a8e6e541cc5b">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_w_urn:oid" testCase="Document Submission Deferred Req">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>                `  
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->
  
               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList> 

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="b0560929-4426-4338-8d44-cac5b3cbf4b5"/>
            <con:assertion type="SOAP Fault Assertion" id="9023a1f6-4393-43e4-8ac4-304fbfda6d3c"/>
            <con:assertion name="Match content of @status" type="XPath Match" id="4d4f42d7-f32b-4e52-beee-cb4267a51c4f">
              <con:configuration>
                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
							//ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:RequestAccepted</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="06d2dcdc-ffb2-496e-86af-bebf0a552468">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" name="Verify RelatesTo" id="c120f5f2-60f8-40e4-9e95-d7c516c11dda">
              <con:configuration>
                <scriptText>import com.eviware.soapui.support.XmlHolder;
def request = new XmlHolder(messageExchange.requestContentAsXml);
def response = new XmlHolder(messageExchange.responseContentAsXml);
request.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
response.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
assert request["//add:MessageID/text()"] == response["//add:RelatesTo/text()"];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincentityxdr:async:request:ProvideAndRegisterDocumentSet-bAsyncRequest_RequestMessage" generateMessageId="true" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:33Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:33Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:33</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission Deferred Resp" searchProperties="true" id="73615e80-81c7-43f6-b94c-02ca26512307">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="0265a985-9842-402e-a125-4033f733d732">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmissionResponse";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="d930a4fe-1d32-42ea-8d63-41fd402ff498">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="71b5d9ce-d7c3-475d-956e-5b5b46e85a00">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission Deferred Resp" type="request" id="ef2ba605-5d3e-49f7-899f-e18ff43b8bd8">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDRAsyncResponse_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-bAsyncResponse</con:operation>
          <con:request name="Doc Submission Deferred Resp" id="33380ded-e577-46d3-9dda-a2e466840781">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_w_urn:oid" testCase="Document Submission Deferred Resp">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
               <urn1:prefix>Ms.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>?addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>SkagerBerg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                     <!--Zero or more repetitions:-->
                     <urn1:translation/>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Karl S. Skagerberg</urn1:fullName>
                  <urn1:prefix>?</urn1:prefix>
                  <urn1:suffix>?</urn1:suffix>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <!--Optional:-->
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy notes</urn1:originalText>
               <!--Zero or more repetitions:-->
               <urn1:translation/>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <!--Optional:-->
                     <urn1:version>2.0</urn1:version>
                     <!--Optional:-->
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <!--Optional:-->
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <!--Optional:-->
                     <urn1:conditions>
                        <!--Optional:-->
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <!--Optional:-->
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <!--Zero or more repetitions:-->
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <!--Zero or more repetitions:-->
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:721645965035</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:146207300753</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:783710993742</urn1:signatureValue>
            </urn1:samlSignature>
            <!--Optional:-->
            <urn1:samlIssuer>
               <!--Optional:-->
               <urn1:issuer>?</urn1:issuer>
               <!--Optional:-->
               <urn1:issuerFormat>?</urn1:issuerFormat>
            </urn1:samlIssuer>
            <!--Optional:-->
            <urn1:messageId>?</urn1:messageId>
            <!--1 or more repetitions:-->
            <urn1:relatesToList>uuid:088a26e8-6b03-4bf8-84f1-737dc94be2e0</urn1:relatesToList>
         </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn:RegistryResponse status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" requestId="?"><!--Optional:-->
            <urn2:ResponseSlotList>
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
            </urn2:ResponseSlotList>
            <!--Optional:-->
            <urn2:RegistryErrorList highestSeverity="?">
               <!--1 or more repetitions:-->
               <urn2:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn2:RegistryError>
            </urn2:RegistryErrorList>
         </urn:RegistryResponse>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="759cbc27-94ae-4d3d-936e-703b741716da"/>
            <con:assertion type="Schema Compliance" id="a084afd3-73ec-43ad-a3e2-bc3a5c078ea4">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="cb980d08-5dfa-4ee6-941e-6c13091cf0ba"/>
            <con:assertion type="XPath Match" name="Match content of @status" id="73004d0e-9999-436a-b23d-cab2b71234d1">
              <con:configuration>
                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
//ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:ResponseAccepted</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                <ignoreComments>false</ignoreComments>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:36Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:36Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:36</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission" searchProperties="true" id="8e374641-c3df-49b8-bcb5-489579c242a7">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="68ea4a7e-3f99-471d-a4ab-68597c266bd1">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmission";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="24c90f8e-2c51-4b41-a36b-9fd62723d9fc">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="69b771d2-66ab-4195-b022-d73e2878bc63">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission" type="request" id="bd7d5709-ca17-477b-b57b-dab3dad222e0">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDR_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-b</con:operation>
          <con:request incomingWss="" name="Doc Submission" outgoingWss="" wssPasswordType="" id="ca5d5aa7-b93f-4b7b-879b-cad4ef4146e0">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_w_urn:oid" testCase="Document Submission">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->
  
               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList> 

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="b97b8a5b-add0-46f9-8c49-cf999546fad4"/>
            <con:assertion type="SOAP Fault Assertion" id="1a1adba7-32d0-4579-8614-f5f607bfe7e7"/>
            <con:assertion type="XPath Match" id="b7a5bc5b-602e-4709-98da-e881b78affde">
              <con:configuration>
                <path>declare namespace ns11='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
							//ns11:RegistryResponse[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="9b08e1c0-4de6-4da5-a7f9-2f0676de3148">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="{urn:gov:hhs:fha:nhinc:nhincentityxdr}ProvideAndRegisterDocumentSet-b" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:38Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:38Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:38</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery Deferred Req" searchProperties="true" id="252d4d4a-efc1-4795-819d-de0905236bec">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="832fb89f-c878-43fe-80a2-3c64cc5732c7">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscoveryRequest";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="67dd988b-8f30-4741-831a-66a7a3a21b72">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="45ff1a2d-1057-4072-8cd6-e7417f68ff25">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery Deferred Req" type="request" id="28d9e4bc-98e7-47c2-a5a1-a6985aecece6">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryAsyncReqBindingSoap</con:interface>
          <con:operation>ProcessPatientDiscoveryAsyncReq</con:operation>
          <con:request name="Patient Discovery Deferred Req" useWsAddressing="true" id="e171e789-95fd-42b1-9a4c-cfc1f406c85f">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_w_urn:oid" testCase="Patient Discovery Deferred Req">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithurnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#RemoteHCID}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#LocalPatientID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <!--Optional:-->
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <!--Optional:-->
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="6fe8bd77-9b66-4224-8be1-a184e5c303b7"/>
            <con:assertion type="SOAP Fault Assertion" id="b7bc74c4-8f00-4723-bb3a-156af001a055"/>
            <con:assertion name="Verify Receiver" type="XPath Match" id="6443c6d1-8855-4273-9580-700fb8852c0e">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:receiver[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                <content>1.1</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Verify Sender" type="XPath Match" id="3f163ede-fcb5-4904-991c-738d378f25a9">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:sender[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                <content>2.2</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Verify Message" type="XPath Match" id="e80bfece-41ae-47c1-9e5d-bf6cbe367574">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:acknowledgement[1]/ns3:acknowledgementDetail[1]/ns3:text[1]/text()</path>
                <content>Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="613c5816-ae8d-4601-a718-69b7c7338c7b">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" name="Verify RelatesTo" id="58868888-35a3-4c3b-bc06-5e6f3f59d652">
              <con:configuration>
                <scriptText>import com.eviware.soapui.support.XmlHolder;
def request = new XmlHolder(messageExchange.requestContentAsXml);
def response = new XmlHolder(messageExchange.responseContentAsXml);
request.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
response.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
assert request["//add:MessageID/text()"] == response["//add:RelatesTo/text()"];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncreq:ProcessPatientDiscoveryAsyncReqAsyncRequest" addDefaultTo="true" messageID="uuid:6666666666.66666.666.66" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:40Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:40Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:40</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery Deferred Resp" searchProperties="true" id="9ca79422-092e-4520-b75e-8e2558e6b327">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="c682416b-4f55-4fd2-ac1a-b29578aafd0e">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscoveryResponse";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="f11a63b2-8d78-4506-8025-c08efef9dc40">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="0ea7d182-c4a3-4519-870e-b30262d31b34">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery Deferred Resp" type="request" id="72243354-e9f6-4c36-ad19-2ad7ccd147c6">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryAsyncRespBindingSoap</con:interface>
          <con:operation>ProcessPatientDiscoveryAsyncResp</con:operation>
          <con:request name="Patient Discovery Deferred Resp" id="85a4ab71-7560-45b9-854f-230a4b2ca6a6">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_w_urn:oid" testCase="Patient Discovery Deferred Resp">
      <urn:RespondingGateway_PRPA_IN201306UV02Request>
         <urn:PRPA_IN201306UV02 ITSVersion="XML_1.0">
            <urn:id root="2.2" extension="-5a3e95b1:11d1fa33d45:-8e45"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <!--1 or more repetitions:-->
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithurnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:code codeSystem="2.16.840.1.113883.1.6" code="PRPA_TE201306UV"/>
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="2.2"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:subject typeCode="SUBJ">
                  <urn:registrationEvent classCode="REG" moodCode="EVN">
                     <urn:id nullFlavor="NA"/>
                     <urn:statusCode code="active"/>
                     <urn:subject1 typeCode="SBJ">
                        <urn:patient classCode="PAT">
                           <urn:id extension="D123402" root="2.2"/>
                           <urn:statusCode code="SD"/>
                           <urn:patientPerson>
                              <urn:name>
                                 <urn:family partType="FAM">Younger</urn:family>
                                 <urn:given partType="GIV">Gallow</urn:given>
                              </urn:name>
                              <urn:administrativeGenderCode code="M"/>
                              <urn:birthTime value="19630804"/>
                              <urn:addr>
                                 <urn:city>LEESBURG</urn:city>
                                 <urn:state>VA</urn:state>
                                 <urn:postalCode>20176</urn:postalCode>
                              </urn:addr>
                           </urn:patientPerson>
                           <urn:providerOrganization determinerCode="" classCode="">
                              <urn:id root="2.2"/>
                              <urn:contactParty xsi:nil="true" classCode="CON" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                           </urn:providerOrganization>
                        </urn:patient>
                     </urn:subject1>
                     <urn:custodian typeCode="">
                        <urn:assignedEntity classCode="">
                           <urn:id root="2.2"/>
                        </urn:assignedEntity>
                     </urn:custodian>
                  </urn:registrationEvent>
               </urn:subject>
               <urn:queryAck>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:queryResponseCode code="OK"/>
                  <urn:resultTotalQuantity value="1"/>
                  <urn:resultCurrentQuantity value="1"/>
                  <urn:resultRemainingQuantity value="0"/>
               </urn:queryAck>
               <urn:queryByParameter>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="M"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="19630804"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectId>
                        <urn:value extension="D123401" root="1.1"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">Younger</urn:family>
                           <urn:given partType="GIV">Gallow</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectName>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201306UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201306UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="796ce205-6300-410a-b6b1-2afd5aed443a"/>
            <con:assertion type="SOAP Fault Assertion" id="c4475fc8-0c0c-45e5-862d-0b36ccc058cb"/>
            <con:assertion name="Match content of [typeCode/@code]" type="XPath Match" id="0aad408e-dd74-43c0-819f-926ffc6314f3">
              <con:configuration>
                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:typeCode[1]/@code</path>
                <content>CA</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Match content of [acknowledgementDetail/text/text()]" type="XPath Match" id="2084cfa7-1a55-4f20-bfd1-ebf70ce98c3e">
              <con:configuration>
                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:acknowledgementDetail[1]/ns2:text/text()</path>
                <content>Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="2e380ea0-694a-4fa9-b8e5-7defbe344912">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:42Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:42Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:42</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery" searchProperties="true" id="5ff3ce2c-41bf-42fc-b86d-3934451ce7ed">
      <con:settings/>
      <con:testStep name="clear correlations table" type="groovy" id="5fb8779a-4e06-4dc3-a88d-7a38ca48ba28">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
			sql.execute('delete from ' + context.findProperty('PatientCorrelationTable'))
			}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="33937b6c-6a68-4ed6-97de-61e4df58f25d">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="4ad68236-eb98-45cd-836c-ec4b0eb940de">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Check Passthru" id="ea92f783-8d98-4d46-b141-0ea03fcf7b21">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscovery";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	/**def ln = System.getProperty('line.separator');
	def policyEngineFile = new File(dir + "/" + "PolicyEngineProxyConfig.xml");
	def policyEngineFileNew = new File(dir + "/" + "PolicyEngineProxyConfig.xml.NEW");
	policyEngineFile.eachLine() {
		line ->
		if(line.contains(alias)) {
			policyEngineFileNew &lt;&lt; replaceAlias + ln;
		} else {
			policyEngineFileNew &lt;&lt; line + ln;
		}
	}

	policyEngineFile.delete();
	policyEngineFileNew.renameTo(new File(dir + "/" + "PolicyEngineProxyConfig.xml"));
	**/
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
	testRunner.gotoStepByName("Patient Discovery");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Set Up PassThru" id="cd9d532a-ed16-4d3f-981d-94a4ab48c794">
        <con:settings/>
        <con:config>
          <script>log.info "Setting Patient Discovery Adapter to unsecured";
def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "PatientDiscoveryProxyConfig.xml", log);
def alias = 'adapterpatientdiscovery'
def aliasName= 'adapterpatientdiscoverywssecured';
def replaceAlias = 'adapterpatientdiscoverywsunsecured';

nhinc.FileUtils.updateSpringConfig(dir, "PatientDiscoveryProxyConfig.xml",
	alias, aliasName, replaceAlias, log);
/**
def pdConfigFile = new File(dir + "/" + "PatientDiscoveryProxyConfig.xml");
def pdConfigFileNew = new File(dir + "/" + "PatientDiscoveryProxyConfig.xml.NEW");
pdConfigFile.eachLine() {
	line ->
	if(line.contains(alias)) {
		pdConfigFileNew &lt;&lt; replaceAlias + ln;
	} else {
		pdConfigFileNew &lt;&lt; line + ln;
	}
}

pdConfigFile.delete();
pdConfigFileNew.renameTo(new File(dir + "/" + "PatientDiscoveryProxyConfig.xml"));
**/
log.info "Modifying internalExchangeInfo for adapterpatientdiscovery mock."

nhinc.FileUtils.createOrUpdateConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterpatientdiscovery", "http://localhost:1720/MockPDAdapter", "2.0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery" type="request" id="49016056-35e5-4abc-b673-756899826260">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryBindingSoap</con:interface>
          <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
          <con:request name="Patient Discovery" id="47f602ff-69df-4592-ac8b-fa30b863a3ea">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_w_urn:oid" testCase="Patient Discovery">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithurnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#LocalHCIDWithurnoid}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#SubjectID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>${#Project#City}</urn1:city>
               <urn1:country>${#Project#Country}</urn1:country>
               <urn1:state>${#Project#State}</urn1:state>
               <urn1:streetAddress>${#Project#StreetAddress}</urn1:streetAddress>
               <urn1:zipCode>${#Project#ZipCode}</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>${#Project#DOB}</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>${#Project#FamilyName}</urn1:familyName>
               <urn1:givenName>${#Project#GivenName}</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>${#Project#SSN}</urn1:SSN>
            <urn1:uniquePatientId>${#Project#UniquePatientId}</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTH</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
               <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="df340917-ea4a-4bd5-9414-4315e04ea4aa"/>
            <con:assertion disabled="true" type="Schema Compliance" id="1df7401a-7fa1-4687-99e3-d899f1fd8715">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="5d278929-ff2b-4af4-b543-18c2278731f6"/>
            <con:assertion name="Check for existance of [ns3:controlActProcess]" type="XPath Match" id="6b0e7ff0-44e8-4da7-9d7e-e71bc72d6adc">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
				exists( //ns3:PRPA_IN201306UV02/ns3:controlActProcess)</path>
                <content>true</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Given Name XPath Match" type="XPath Match" id="203d5822-6008-4d14-95c3-81d438f6e734">
              <con:configuration>
                <path>declare namespace ns1='urn:hl7-org:v3';
				//ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:given[1]</path>
                <content>${#Project#GivenName}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Family Name XPath Match" type="XPath Match" id="ca9e3f03-2029-4635-9460-e8d7673e099d">
              <con:configuration>
                <path>declare namespace ns1='urn:hl7-org:v3';
				//ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:family[1]</path>
                <content>${#Project#FamilyName}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Skip Mock" id="c88f08da-dfbf-4ba4-b7ee-7a2d1e5dcb43">
        <con:settings/>
        <con:config>
          <script>def runMock = context.findProperty("PassThruOn").toBoolean();

if(!runMock){
	testRunner.gotoStepByName("count correlations");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="bb703250-f97f-4340-bc10-296715a64f47">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="Set Up PassThru" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterPatientDiscoveryBindingSoap</con:interface>
          <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
          <con:path>/MockPDAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="849a1fb5-e8ab-4930-99e5-58035e4f63dc">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3">
   <soap:Header/>
   <soap:Body>
   <PRPA_IN201306UV02 xmlns="urn:hl7-org:v3" xmlns:ns2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns3="http://www.w3.org/2005/08/addressing" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:patientcorrelationfacade" ITSVersion="XML_1.0">
   <id root="1.1" extension="13318247:13b4e0b839b:-7ff4"/>
   <creationTime value="20121129212833"/>
   <interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
   <processingCode code="P"/>
   <processingModeCode code="T"/>
   <acceptAckCode code="NE"/>
   <receiver typeCode="RCV">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="1.2.345.678.999"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="${#Project#LocalHCIDWithurnoid}"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </receiver>
   <sender typeCode="SND">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="2.2"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="${#Project#RemoteHCID}"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </sender>
   <acknowledgement>
   	<typeId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
   	<typeCode code="AA"/><targetMessage xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   </acknowledgement>
   <controlActProcess classCode="CACT" moodCode="EVN">
   	<code code="PRPA_TE201306UV" codeSystem="2.16.840.1.113883.1.6"/>
   	<subject typeCode="SUBJ">
   		<registrationEvent classCode="REG" moodCode="EVN">
   			<id nullFlavor="NA"/>
   			<statusCode code="active"/>
   				<subject1 typeCode="SBJ">
   					<patient classCode="PAT">
   						<id root="1.1" extension="D123401"/>
   						<statusCode code="SD"/>
   						<patientPerson classCode="PSN" determinerCode="INSTANCE">
   							<name>
   								<family partType="FAM">Younger</family>
   								<given partType="GIV">Gallow</given>
   							</name>
   							<telecom value="tel:+1-888-555-1234"/>
   							<administrativeGenderCode code="M"/>
   							<birthTime value="19630804"/>
   							<addr><city>LEESBURG</city><state>VA</state><postalCode>20176</postalCode></addr>
   							<asOtherIDs classCode="SD">
   								<id root="2.16.840.1.113883.4.1" extension="999123401"/>
   								<scopingOrganization classCode="ORG" determinerCode="INSTANCE">
   									<id root="2.16.840.1.113883.4.1"/>
   								</scopingOrganization>
   							</asOtherIDs>
   						</patientPerson>
   						<providerOrganization classCode="ORG" determinerCode="INSTANCE">
   							<id root="1.1"/>
   							<contactParty xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   							</providerOrganization>
   							<subjectOf1>
   								<queryMatchObservation classCode="CASE" moodCode="EVN">
   									<code code="IHE_PDQ"/>
   									<value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="INT" value="100"/>
   								</queryMatchObservation>
   							</subjectOf1>
   						</patient>
   					</subject1>
   					<custodian typeCode="CST">
   						<assignedEntity classCode="ASSIGNED">
   							<id root="1.1"/>
   							<code code="NotHealthDataLocator" codeSystem="1.3.6.1.4.1.19376.1.2.27.2"/>
   						</assignedEntity>
   					</custodian>
   				</registrationEvent>
   			</subject>
   			<queryAck>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<queryResponseCode code="OK"/>
   			</queryAck>
   			<queryByParameter>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<statusCode code="new"/>
   				<responseModalityCode code="R"/>
   				<responsePriorityCode code="I"/>
   				<parameterList>
   					<livingSubjectAdministrativeGender>
   						<value code="M"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectAdministrativeGender>
   					<livingSubjectBirthTime>
   						<value value="19630804"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectBirthTime>
   					<livingSubjectId>
   						<value root="1.1" extension="1111"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectId>
   					<livingSubjectName>
   						<value>
   							<family partType="FAM">Younger</family>
   							<given partType="GIV">Gallow</given>
                        		</value>
                        		<semanticsText representation="TXT"/>
                        	</livingSubjectName>
                     </parameterList>
                 </queryByParameter>
             </controlActProcess>
     </PRPA_IN201306UV02>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
        </con:config>
      </con:testStep>
      <con:testStep name="count correlations" type="groovy" id="bab1402a-cd33-45d7-89a6-6793b7c0160b">
        <con:settings/>
        <con:config>
          <script>def pdCorrelations = 1;

if(context.findProperty("PassThruOn").toBoolean()) {
	pdCorrelations = 0;
}

log.info "Assert ${pdCorrelations} number of correlations"

context.withSql('PatientCorrelationDB') { sql -> 
		assert pdCorrelations == sql.firstRow('select count(*) from ' + context.findProperty('PatientCorrelationTable'))[0]
		}</script>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
//nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
	nhinc.FileUtils.restoreFile(dir, "PatientDiscoveryProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:45Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:45Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:45</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Query" searchProperties="true" id="a852c6ef-bcc5-47c6-8c2a-608dff3b134f">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="af205425-1e7a-4a3a-86f6-46d2ba6ddf5b">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docquery.30.inboundDocQuery";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
	testRunner.gotoStepByName("Document Query");
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="172af0d8-578d-44a1-b969-9e954aa59be7">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="f6cb12c8-18aa-4e2b-a057-0e4296321dac">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="update config" type="groovy" id="4fef29ea-4e64-4210-9bbd-4a73700ca414">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="39690a68-fd50-499f-a360-8a4ec1b84b13">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="84166654-8a7f-4a8a-b484-8aee21b64e9c">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="45a812d9-f5a9-405a-884f-f700eb5b2afc">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="17542baa-2704-4b6d-9daf-5b3b324bece6">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_w_urn:oid" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
         <urn2:Slot name="$XDSDocumentEntryClassCode">
            <urn2:ValueList>
                    <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>         
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
         <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="fb4c6d32-1312-43db-90db-da8e5c63e8b7"/>
            <con:assertion type="Schema Compliance" id="fd273f0e-7b46-4212-b1b1-282af5f84057">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="81bc0eaa-ec41-4217-a4b7-24eed11e9dd1"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="30f43595-2d56-4ca4-bfed-e0d4b3c8a4b7">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
log.info("xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx");
def passThruOn = context.findProperty('PassThruOn').toBoolean();
def documentID = null;
log.info("passthruon is " + passThruOn);
if(passThruOn){
	documentID = context.findProperty('DQPTDocID');
}else {
	documentID = context.findProperty('DQDocID')
}

log.info("Doc ID used xxxx: " + documentID);
def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:48Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:48Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:48</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Retrieve" searchProperties="true" id="b0e0d2df-03d4-463b-859b-c83e01de09bd">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="9240f498-1f45-4f8d-b1c9-a11759690b25">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docretrieve.30.inbound";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="ac9228ef-db1c-4f66-99ff-13add7bf6833">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="a4fa299d-cb68-4666-b6ca-0c5cd57c0004">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Retrieve" type="request" id="292a0aec-0f89-47b9-8486-06ac5b61b490">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocRetrieveBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation>
          <con:request incomingWss="" name="Document Retrieve" outgoingWss="" wssPasswordType="" id="279da55a-931b-45d5-8d29-355bc3248c7e">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@expand-mtom-attachments">true</con:setting>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:ihe:iti:xds-b:2007" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_w_urn:oid" testCase="Document Retrieve">
      <urn:RespondingGateway_CrossGatewayRetrieveRequest>
         <urn1:RetrieveDocumentSetRequest>
            <urn1:DocumentRequest>
               <urn1:HomeCommunityId>${#Project#RemoteHCID}</urn1:HomeCommunityId>
               <urn1:RepositoryUniqueId>${#Project#DRRepoID}</urn1:RepositoryUniqueId>
               <urn1:DocumentUniqueId>${#Project#DRDocID}</urn1:DocumentUniqueId>
            </urn1:DocumentRequest>
         </urn1:RetrieveDocumentSetRequest>
         <urn:assertion>
            <urn2:nationalProviderId>1234567890</urn2:nationalProviderId>         
            <urn2:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>AddrCity</urn2:city>
               <urn2:country>AddrCountry</urn2:country>
               <urn2:state>AddrState</urn2:state>
               <urn2:streetAddress>AddrStreet</urn2:streetAddress>
               <urn2:zipCode>AddrZip</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn2:dateOfBirth>
            <urn2:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSignature>
            <urn2:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveWitnessSignature>
            <urn2:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:description>${#Project#LocalHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn2:homeCommunityId>
               <urn2:name>${#Project#LocalHCDescription}</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sandy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
               <urn2:fullName>Sandy S. Smith</urn2:fullName>
            </urn2:personName>
            <urn2:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5436</urn2:extension>
               <urn2:localNumber>253-6849</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Addr2City</urn2:city>
               <urn2:country>Addr2Country</urn2:country>
               <urn2:state>Addr2State</urn2:state>
               <urn2:streetAddress>Addr2Street</urn2:streetAddress>
               <urn2:zipCode>Addr2Zip</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sammy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>s</urn2:secondNameOrInitials>
               <urn2:fullName>Sammy S. Smith</urn2:fullName>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5424</urn2:extension>
               <urn2:localNumber>542-6823</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn2:SSN>
            <urn2:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn2:uniquePatientId>
            <urn2:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>addrCode</urn2:code>
                  <urn2:codeSystem>addrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>addrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>addrCode</urn2:displayName>
                  <urn2:originalText>addrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Burnell</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>FL</urn2:state>
               <urn2:streetAddress>825 North</urn2:streetAddress>
               <urn2:zipCode>32184</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Scott</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S.</urn2:secondNameOrInitials>
               <urn2:fullName>Scott S. Smith</urn2:fullName>
            </urn2:witnessName>
            <urn2:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>8432</urn2:extension>
               <urn2:localNumber>985-2239</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:personName>
                  <urn2:familyName>Skagerberg</urn2:familyName>
                  <urn2:givenName>Karl</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>nameCode</urn2:code>
                     <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                     <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                     <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                     <urn2:displayName>nameCode</urn2:displayName>
                     <urn2:originalText>nameCode</urn2:originalText>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
                  <urn2:fullName>Kasrl S. Skagerberg</urn2:fullName>
               </urn2:personName>
               <urn2:userName>kskagerb</urn2:userName>
               <urn2:org>
                  <urn2:description>${#Project#LocalHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn2:homeCommunityId>
                  <urn2:name>${#Project#LocalHCDescription}</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>307969004</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Public Health</urn2:displayName>
                  <urn2:originalText>Public Health</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:code>PUBLICHEALTH</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Use or disclosure of Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:authInstant>2009-04-16T13:15:39Z</urn2:authInstant>
               <urn2:sessionIndex>987</urn2:sessionIndex>
               <urn2:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn2:authContextClassRef>
               <urn2:subjectLocalityAddress>1.1.1.1</urn2:subjectLocalityAddress>
               <urn2:subjectLocalityDNSName>connectopensource.org</urn2:subjectLocalityDNSName>
            </urn2:samlAuthnStatement>
            <urn2:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:decision>Permit</urn2:decision>
               <urn2:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn2:resource>
               <urn2:action>TestSaml</urn2:action>
               <urn2:evidence>
                  <urn2:assertion>
                     <urn2:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn2:id>
                     <urn2:issueInstant>2009-04-16T13:10:39.093Z</urn2:issueInstant>
                     <urn2:version>2.0</urn2:version>
                     <urn2:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn2:issuerFormat>
                     <urn2:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn2:issuer>
                     <urn2:conditions>
                        <urn2:notBefore>2009-04-16T13:10:39.093Z</urn2:notBefore>
                        <urn2:notOnOrAfter>2009-12-31T12:00:00.000Z</urn2:notOnOrAfter>
                     </urn2:conditions>
                     <urn2:accessConsentPolicy>urn:oid:1.2.3.4</urn2:accessConsentPolicy>
                     <urn2:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn2:instanceAccessConsentPolicy>
                  </urn2:assertion>
               </urn2:evidence>
            </urn2:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn2:nhinTargetCommunity>
               <urn2:homeCommunity>
                  <urn2:description>${#Project#RemoteHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#RemoteHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#RemoteHCDescription}</urn2:name>
               </urn2:homeCommunity>
            </urn2:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayRetrieveRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="7ee07144-819f-4eaa-96da-b2b6ff78f381"/>
            <con:assertion type="SOAP Fault Assertion" id="4e799b44-4ef8-4301-b78f-fd09c4d02ce0"/>
            <con:assertion disabled="true" type="Schema Compliance" id="7ff921a7-5a1c-42af-9d57-fabbf8cbeccb">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Doc Repository ID" type="XPath Match" id="068723e5-d321-42a9-94a9-c72b9af1f320">
              <con:configuration>
                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
					//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:RepositoryUniqueId[1]</path>
                <content>${#Project#DRRepoID}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Doc ID" type="XPath Match" id="3971c889-4d5f-470b-8001-379f4c827ca8">
              <con:configuration>
                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
					//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:DocumentUniqueId[1]</path>
                <content>${#Project#DRDocID}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Document Data" type="GroovyScriptAssertion" id="d269fa01-a222-4409-8eea-c3bf4f899361">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
					def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
					holder.namespaces["ns"]="urn:ihe:iti:xds-b:2007"
					def docData = holder["//ns:RetrieveDocumentSetResponse[1]/ns:DocumentResponse[1]/ns:Document[1]"]
					log.info docData.toString()
					assert (docData.size() != 0)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitydocretrieve/EntityDocRetrievePortType/RespondingGateway_CrossGatewayRetrieveRequest" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>CorrectedRemoteHCID</con:name>
          <con:value>urn:oid:2.2</con:value>
        </con:property>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:50Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:50Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:50</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Admin Distribution" searchProperties="true" id="2e211e0c-fbf0-4fc2-be55-412304c6e499">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="83cc0ffb-035b-48de-925e-2857fb405032">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "admindist.inboundAdminDist";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="d95c2bdf-b727-418f-a28d-6904b0bb23d7">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="63e14b42-7dea-415e-bbf6-3fa894348acc">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Admin Distribution" type="request" id="4f660367-a85a-4bb0-a729-75f50f183896">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdministrativeDistribution_Binding_Soap12_g1</con:interface>
          <con:operation>SendAlertMessage</con:operation>
          <con:request name="Admin Distribution" id="70db1531-e8f3-4725-bf89-4b048ff61b05">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:emergency:EDXL:DE:1.0">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_w_urn:oid" testCase="Admin Distribution">
      <urn:RespondingGateway_SendAlertMessage>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253987546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>${#TestCase#UserId}</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCIDWithurnoid}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>80584001</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Psychiatrist</urn1:displayName>
                  <urn1:originalText>Psychiatrist</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PSYCHOTHERAPY</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-09-01T13:00:00.000Z</urn1:authInstant>
               <urn1:sessionIndex>mySessionIndex</urn1:sessionIndex>
               <urn1:authContextClassRef>myContextClassRef</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>mySubjectLocalityAddress</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>mySubjectLocalityDns</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>myAuthzDecisionStatementResource</urn1:resource>
               <urn1:action>myAuthzDecisionStatementAction</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>AuthzDecisionStatementEvidenceAssertionId</urn1:id>
                     <urn1:issueInstant>2009-09-02T14:00:00.000Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuer>CN=Mr Saml User,OU=SU,O=Mr SAML Org,L=Chantilly,ST=VA,C=US</urn1:issuer>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>urn:oid:1.2.3.4</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:243113487404</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:159355901562</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:383675305350</urn1:signatureValue>
            </urn1:samlSignature>
            </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
               <urn1:list>?</urn1:list>
               <urn1:region>?</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn2:EDXLDistribution>
            <urn2:distributionID>633990682441061250</urn2:distributionID>
            <urn2:senderID>actor@2.16.840.1.113883.3.166</urn2:senderID>
            <urn2:dateTimeSent>2010-08-14T12:18:13.512375-08:00</urn2:dateTimeSent>
            <urn2:distributionStatus>Actual</urn2:distributionStatus>
            <urn2:distributionType>Update</urn2:distributionType>
            <urn2:combinedConfidentiality>Public</urn2:combinedConfidentiality>
            <!--Optional:-->
            <urn2:language>?</urn2:language>
            <!--Zero or more repetitions:-->
            <urn2:senderRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:senderRole>
            <!--Zero or more repetitions:-->
            <urn2:recipientRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:recipientRole>
            <!--Zero or more repetitions:-->
            <urn2:keyword>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:keyword>
            <!--Zero or more repetitions:-->
            <urn2:distributionReference>?</urn2:distributionReference>
            <!--Zero or more repetitions:-->
            <urn2:explicitAddress>
               <urn2:explicitAddressScheme>modified_IHEIntendedRecipient</urn2:explicitAddressScheme>
               <!--1 or more repetitions:-->
               <urn2:explicitAddressValue>^^^^^^^^^2.16.840.1.113883.3.166|0000000001</urn2:explicitAddressValue>
            </urn2:explicitAddress>
            <!--Zero or more repetitions:-->
            <urn2:targetArea>
               <!--Zero or more repetitions:-->
               <urn2:circle>?</urn2:circle>
               <!--Zero or more repetitions:-->
               <urn2:polygon>?</urn2:polygon>
               <!--Zero or more repetitions:-->
               <urn2:country>?</urn2:country>
               <!--Zero or more repetitions:-->
               <urn2:subdivision>?</urn2:subdivision>
               <!--Zero or more repetitions:-->
               <urn2:locCodeUN>?</urn2:locCodeUN>
            </urn2:targetArea>
            <!--Zero or more repetitions:-->
            <urn2:contentObject>
               <!--Optional:-->
               <urn2:contentDescription>PH Alert Message</urn2:contentDescription>
               <!--Zero or more repetitions:-->
               <urn2:contentKeyword>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:contentKeyword>
               <!--Optional:-->
               <urn2:incidentID>TEST</urn2:incidentID>
               <!--Optional:-->
               <urn2:incidentDescription>This is a test message</urn2:incidentDescription>
               <!--Zero or more repetitions:-->
               <urn2:originatorRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:originatorRole>
               <!--Zero or more repetitions:-->
               <urn2:consumerRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:consumerRole>
               <!--Optional:-->
               <urn2:confidentiality>Public</urn2:confidentiality>
               <!--You have a CHOICE of the next 2 items at this level-->
		<urn2:nonXMLContent>
                  <urn2:mimeType>application/pdf</urn2:mimeType>
                  <!--Optional:-->
                  <urn2:size>19</urn2:size>
                  <!--Optional:-->
                  <urn2:digest>?</urn2:digest>
                  <!--Optional:-->
                  <urn2:uri>?</urn2:uri>
                  <!--Optional:-->
                  <urn2:contentData>LDLIHAPIISDALKDF902383K1182K4J49DFNF3KR0482HJ1029F393</urn2:contentData>
               </urn2:nonXMLContent>
               <!--You may enter ANY elements at this point-->
            </urn2:contentObject>
         </urn2:EDXLDistribution>
      </urn:RespondingGateway_SendAlertMessage>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="delay" name="Delay" id="4b3e5da1-f72e-448e-8190-b16444d73210">
        <con:settings/>
        <con:config>
          <delay>10000</delay>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:47:52Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:57:52Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:47:52</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="CM_wo_urn:oid_ReqMsg_wo_urn:oid" id="b900084c-5ee3-4dc5-8109-5125641206e3">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission Deferred Req" searchProperties="true" id="cc159217-7f96-42f3-a8d9-bb92dd1c759d">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="8b17953d-99d3-4e0d-9a81-8ff7f5f6c701">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmissionRequest";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="d2fbf7ab-7815-4a01-bbd8-8dffba178b14">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="2fa06f6e-b668-44c3-b729-bced766d69e2">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission Deferred Req" type="request" id="b0e21907-41c1-49f1-af70-0f28a385009b">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDRAsyncRequest_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-bAsyncRequest</con:operation>
          <con:request incomingWss="" name="Doc Submission Deferred Req" outgoingWss="" useWsAddressing="true" wssPasswordType="" id="c1c61cf2-01fb-4407-97f3-ec2b419e3779">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Submission Deferred Req">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>                  
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->
  
               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList> 

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="29700324-8afa-4392-83df-360bde843b05"/>
            <con:assertion type="SOAP Fault Assertion" id="cac3943c-213b-44db-9112-ece4fabeca83"/>
            <con:assertion name="Match content of @status" type="XPath Match" id="ad381e6d-d55c-46d1-ab2f-02c27c6d7878">
              <con:configuration>
                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
							//ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:RequestAccepted</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="df70a893-b1e0-4481-a74d-b32960504c0c">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" name="Verify RelatesTo" id="f5d0e1e0-3ecf-43a3-9197-c2bd1cc178d8">
              <con:configuration>
                <scriptText>import com.eviware.soapui.support.XmlHolder;
def request = new XmlHolder(messageExchange.requestContentAsXml);
def response = new XmlHolder(messageExchange.responseContentAsXml);
request.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
response.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
assert request["//add:MessageID/text()"] == response["//add:RelatesTo/text()"];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincentityxdr:async:request:ProvideAndRegisterDocumentSet-bAsyncRequest_RequestMessage" generateMessageId="true" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:14Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:14Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:14</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission Deferred Resp" searchProperties="true" id="c99addd8-85c3-4d56-a78b-1100fc98b319">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="acbdfac4-8566-4578-946b-5200cebec136">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmissionResponse";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="4b1a8722-908d-4ce9-9bf4-9493ce9c7a7b">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="a08f1477-a38a-47f0-92b6-5c6ef5fc4eb4">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission Deferred Resp" type="request" id="1bd68b2a-707b-44a2-8a64-3ba8bf58fdbc">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDRAsyncResponse_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-bAsyncResponse</con:operation>
          <con:request name="Doc Submission Deferred Resp" id="7bc73563-3dba-4d12-b46b-de8f2e5ae940">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Submission Deferred Resp">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
               <urn1:prefix>Ms.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>?addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>SkagerBerg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                     <!--Zero or more repetitions:-->
                     <urn1:translation/>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Karl S. Skagerberg</urn1:fullName>
                  <urn1:prefix>?</urn1:prefix>
                  <urn1:suffix>?</urn1:suffix>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <!--Optional:-->
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy notes</urn1:originalText>
               <!--Zero or more repetitions:-->
               <urn1:translation/>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <!--Optional:-->
                     <urn1:version>2.0</urn1:version>
                     <!--Optional:-->
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <!--Optional:-->
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <!--Optional:-->
                     <urn1:conditions>
                        <!--Optional:-->
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <!--Optional:-->
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <!--Zero or more repetitions:-->
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <!--Zero or more repetitions:-->
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:721645965035</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:146207300753</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:783710993742</urn1:signatureValue>
            </urn1:samlSignature>
            <!--Optional:-->
            <urn1:samlIssuer>
               <!--Optional:-->
               <urn1:issuer>?</urn1:issuer>
               <!--Optional:-->
               <urn1:issuerFormat>?</urn1:issuerFormat>
            </urn1:samlIssuer>
            <!--Optional:-->
            <urn1:messageId>?</urn1:messageId>
            <!--1 or more repetitions:-->
            <urn1:relatesToList>uuid:088a26e8-6b03-4bf8-84f1-737dc94be2e0</urn1:relatesToList>
         </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn:RegistryResponse status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" requestId="?"><!--Optional:-->
            <urn2:ResponseSlotList>
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
            </urn2:ResponseSlotList>
            <!--Optional:-->
            <urn2:RegistryErrorList highestSeverity="?">
               <!--1 or more repetitions:-->
               <urn2:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn2:RegistryError>
            </urn2:RegistryErrorList>
         </urn:RegistryResponse>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="beb38465-6f7f-4de8-a988-f73b11d752d0"/>
            <con:assertion type="Schema Compliance" id="5a096369-97c0-4aac-a94e-017c987d3c1e">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="c3a6298f-1c76-487e-a2d3-b6c41226c63d"/>
            <con:assertion type="XPath Match" name="Match content of @status" id="d292602b-7308-4206-9e87-298950a129dc">
              <con:configuration>
                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
//ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:ResponseAccepted</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                <ignoreComments>false</ignoreComments>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:16Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:16Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:16</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission" searchProperties="true" id="64d4c0f0-b32d-44c5-be53-6a4efb317a19">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="d3bc9231-9653-455c-a6c3-24bde49db07c">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docsubmission.inboundDocSubmission";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="baad3a20-ffb2-4e4a-a930-3b5bddb529ae">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="91132779-586c-4636-acf7-fbb5b30691aa">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Doc Submission" type="request" id="1131f65f-2989-44f6-b830-58d83f296911">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityXDR_Binding</con:interface>
          <con:operation>ProvideAndRegisterDocumentSet-b</con:operation>
          <con:request incomingWss="" name="Doc Submission" outgoingWss="" wssPasswordType="" id="ec75fe5d-ab31-4db6-b7c9-740989665fe8">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Submission">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->
  
               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList> 

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="9ca2bbcd-fa6b-4865-ad17-56792a65f818"/>
            <con:assertion type="SOAP Fault Assertion" id="c29e18d0-5189-47f1-b55d-58a736f75fae"/>
            <con:assertion type="XPath Match" id="cb144bdd-fcd6-4e1a-9fa8-1bf0456b984b">
              <con:configuration>
                <path>declare namespace ns11='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
							//ns11:RegistryResponse[1]/@status</path>
                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="820418b4-965a-495f-b19a-fdf90baee5e4">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="{urn:gov:hhs:fha:nhinc:nhincentityxdr}ProvideAndRegisterDocumentSet-b" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:17Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:17Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:17</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery Deferred Req" searchProperties="true" id="a132ec61-a714-459f-88e4-3b9cc666fe46">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="f157a9fd-02c4-4a4b-b49a-5e8c3464d41b">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscoveryRequest";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="be2736a0-4fe9-4dde-b6c0-190adeafbccd">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="cf0c52ca-ccf7-4a5c-8269-ffc8a6151cc6">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery Deferred Req" type="request" id="0bd094b7-23ab-4213-b6d4-6a00f7cee65a">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryAsyncReqBindingSoap</con:interface>
          <con:operation>ProcessPatientDiscoveryAsyncReq</con:operation>
          <con:request name="Patient Discovery Deferred Req" useWsAddressing="true" id="3d573705-26c4-4499-a2df-468f6c94bcb3">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_wo_urn:oid" testCase="Patient Discovery Deferred Req">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithouturnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#RemoteHCID}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#LocalPatientID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <!--Optional:-->
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <!--Optional:-->
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="daa7199c-5804-4aa3-968a-8678dd5c7815"/>
            <con:assertion type="SOAP Fault Assertion" id="7619507c-023f-4bfa-b1fe-b0cf01775a75"/>
            <con:assertion name="Verify Receiver" type="XPath Match" id="11a85ff1-bb67-4a5f-9eef-e56c0e7829c5">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:receiver[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                <content>1.1</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Verify Sender" type="XPath Match" id="0a8c0bff-5a4f-4e88-816d-efc963d2aff4">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:sender[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                <content>2.2</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Verify Message" type="XPath Match" id="1ee1b7a4-42b8-4f63-90ac-bbfe1ab76c31">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
							//ns3:MCCI_IN000002UV01[1]/ns3:acknowledgement[1]/ns3:acknowledgementDetail[1]/ns3:text[1]/text()</path>
                <content>Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="30113de4-07ec-4332-93e5-bbccc2ea4593">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" name="Verify RelatesTo" id="92d98d19-6897-4e2b-915f-298da0a5a5a2">
              <con:configuration>
                <scriptText>import com.eviware.soapui.support.XmlHolder;
def request = new XmlHolder(messageExchange.requestContentAsXml);
def response = new XmlHolder(messageExchange.responseContentAsXml);
request.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
response.namespaces["add"] = "http://www.w3.org/2005/08/addressing";
assert request["//add:MessageID/text()"] == response["//add:RelatesTo/text()"];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncreq:ProcessPatientDiscoveryAsyncReqAsyncRequest" addDefaultTo="true" messageID="uuid:6666666666.66666.666.66" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:19Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:19Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:19</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery Deferred Resp" searchProperties="true" id="7dd2aa73-3f18-47a7-87cb-b33ad5bd171c">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="09a51dd0-2287-408c-b1e1-71728b91d9de">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscoveryResponse";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="1c02d760-ec2f-422c-817a-e437cdb3d87b">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="0b27643b-b119-4077-88f0-4e18d25cbf6e">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery Deferred Resp" type="request" id="9020a006-5b6b-43b4-a030-c4cc07ee11c8">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryAsyncRespBindingSoap</con:interface>
          <con:operation>ProcessPatientDiscoveryAsyncResp</con:operation>
          <con:request name="Patient Discovery Deferred Resp" id="0e8a4dd8-169f-4f76-b1b6-56fd5b00c4bc">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_wo_urn:oid" testCase="Patient Discovery Deferred Resp">
      <urn:RespondingGateway_PRPA_IN201306UV02Request>
         <urn:PRPA_IN201306UV02 ITSVersion="XML_1.0">
            <urn:id root="2.2" extension="-5a3e95b1:11d1fa33d45:-8e45"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <!--1 or more repetitions:-->
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithouturnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:code codeSystem="2.16.840.1.113883.1.6" code="PRPA_TE201306UV"/>
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="2.2"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:subject typeCode="SUBJ">
                  <urn:registrationEvent classCode="REG" moodCode="EVN">
                     <urn:id nullFlavor="NA"/>
                     <urn:statusCode code="active"/>
                     <urn:subject1 typeCode="SBJ">
                        <urn:patient classCode="PAT">
                           <urn:id extension="D123402" root="2.2"/>
                           <urn:statusCode code="SD"/>
                           <urn:patientPerson>
                              <urn:name>
                                 <urn:family partType="FAM">Younger</urn:family>
                                 <urn:given partType="GIV">Gallow</urn:given>
                              </urn:name>
                              <urn:administrativeGenderCode code="M"/>
                              <urn:birthTime value="19630804"/>
                              <urn:addr>
                                 <urn:city>LEESBURG</urn:city>
                                 <urn:state>VA</urn:state>
                                 <urn:postalCode>20176</urn:postalCode>
                              </urn:addr>
                           </urn:patientPerson>
                           <urn:providerOrganization determinerCode="" classCode="">
                              <urn:id root="2.2"/>
                              <urn:contactParty xsi:nil="true" classCode="CON" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                           </urn:providerOrganization>
                        </urn:patient>
                     </urn:subject1>
                     <urn:custodian typeCode="">
                        <urn:assignedEntity classCode="">
                           <urn:id root="2.2"/>
                        </urn:assignedEntity>
                     </urn:custodian>
                  </urn:registrationEvent>
               </urn:subject>
               <urn:queryAck>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:queryResponseCode code="OK"/>
                  <urn:resultTotalQuantity value="1"/>
                  <urn:resultCurrentQuantity value="1"/>
                  <urn:resultRemainingQuantity value="0"/>
               </urn:queryAck>
               <urn:queryByParameter>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="M"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="19630804"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectId>
                        <urn:value extension="D123401" root="1.1"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">Younger</urn:family>
                           <urn:given partType="GIV">Gallow</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectName>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201306UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201306UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="2ef67b88-f564-41a1-b4f5-426482c35758"/>
            <con:assertion type="SOAP Fault Assertion" id="4cba1642-3fc5-4b3b-93af-1d8180a4c6a6"/>
            <con:assertion name="Match content of [typeCode/@code]" type="XPath Match" id="e98f7458-37c9-4399-8b2f-a1dbde77d0a0">
              <con:configuration>
                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:typeCode[1]/@code</path>
                <content>CA</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Match content of [acknowledgementDetail/text/text()]" type="XPath Match" id="e7c272fb-a70b-4135-a84c-ce1fe7ccb57b">
              <con:configuration>
                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:acknowledgementDetail[1]/ns2:text/text()</path>
                <content>Success</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Schema Compliance" type="Schema Compliance" id="1bb39d19-49b3-4260-aa80-9a6e9f17f402">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:21Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:21Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:21</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery" searchProperties="true" id="d25f8aed-a52b-478e-8c50-78bb43f0c41f">
      <con:settings/>
      <con:testStep name="clear correlations table" type="groovy" id="917d648f-5f27-47cd-b47c-dc1a659bfe3e">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
			sql.execute('delete from ' + context.findProperty('PatientCorrelationTable'))
			}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="268275e3-a4f9-44c5-8419-964764e8d0dc">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="75002cb4-ed8d-49be-8644-08c420b382ee">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Check Passthru" id="fadebb6b-275d-4e9e-bc25-e5a9139b177e">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "patientDiscovery.inboundPatientDiscovery";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	/**def ln = System.getProperty('line.separator');
	def policyEngineFile = new File(dir + "/" + "PolicyEngineProxyConfig.xml");
	def policyEngineFileNew = new File(dir + "/" + "PolicyEngineProxyConfig.xml.NEW");
	policyEngineFile.eachLine() {
		line ->
		if(line.contains(alias)) {
			policyEngineFileNew &lt;&lt; replaceAlias + ln;
		} else {
			policyEngineFileNew &lt;&lt; line + ln;
		}
	}

	policyEngineFile.delete();
	policyEngineFileNew.renameTo(new File(dir + "/" + "PolicyEngineProxyConfig.xml"));
	**/
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
	testRunner.gotoStepByName("Patient Discovery");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Set Up PassThru" id="6a40927e-ae3c-44ff-96b3-40229b05b9db">
        <con:settings/>
        <con:config>
          <script>log.info "Setting Patient Discovery Adapter to unsecured";
def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "PatientDiscoveryProxyConfig.xml", log);
def alias = 'adapterpatientdiscovery'
def aliasName= 'adapterpatientdiscoverywssecured';
def replaceAlias = 'adapterpatientdiscoverywsunsecured';

nhinc.FileUtils.updateSpringConfig(dir, "PatientDiscoveryProxyConfig.xml",
	alias, aliasName, replaceAlias, log);
/**
def pdConfigFile = new File(dir + "/" + "PatientDiscoveryProxyConfig.xml");
def pdConfigFileNew = new File(dir + "/" + "PatientDiscoveryProxyConfig.xml.NEW");
pdConfigFile.eachLine() {
	line ->
	if(line.contains(alias)) {
		pdConfigFileNew &lt;&lt; replaceAlias + ln;
	} else {
		pdConfigFileNew &lt;&lt; line + ln;
	}
}

pdConfigFile.delete();
pdConfigFileNew.renameTo(new File(dir + "/" + "PatientDiscoveryProxyConfig.xml"));
**/
log.info "Modifying internalExchangeInfo for adapterpatientdiscovery mock."

nhinc.FileUtils.createOrUpdateConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterpatientdiscovery", "http://localhost:1720/MockPDAdapter", "2.0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Patient Discovery" type="request" id="5480fe8b-4e24-450a-965b-494eea8d566e">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityPatientDiscoveryBindingSoap</con:interface>
          <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
          <con:request name="Patient Discovery" id="32cea230-891d-4bfd-88ff-ecba5a2d7014">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_wo_urn:oid" testCase="Patient Discovery">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCIDWithouturnoid}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#LocalHCIDWithouturnoid}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#SubjectID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>${#Project#City}</urn1:city>
               <urn1:country>${#Project#Country}</urn1:country>
               <urn1:state>${#Project#State}</urn1:state>
               <urn1:streetAddress>${#Project#StreetAddress}</urn1:streetAddress>
               <urn1:zipCode>${#Project#ZipCode}</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>${#Project#DOB}</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>${#Project#FamilyName}</urn1:familyName>
               <urn1:givenName>${#Project#GivenName}</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>${#Project#SSN}</urn1:SSN>
            <urn1:uniquePatientId>${#Project#UniquePatientId}</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTH</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
               <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="c6beefbf-ddf2-4aaf-b4bf-d60d5a97e63b"/>
            <con:assertion disabled="true" type="Schema Compliance" id="c87296b2-1750-4bed-a309-08134771a7fc">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="acd3da0a-7c46-404e-a5fa-8cbb5a6293f8"/>
            <con:assertion name="Check for existance of [ns3:controlActProcess]" type="XPath Match" id="82d51856-470c-4ea0-9752-3aa507b69f2e">
              <con:configuration>
                <path>declare namespace ns3='urn:hl7-org:v3';
				exists( //ns3:PRPA_IN201306UV02/ns3:controlActProcess)</path>
                <content>true</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Given Name XPath Match" type="XPath Match" id="e9a81646-bb70-4aca-87da-030823923822">
              <con:configuration>
                <path>declare namespace ns1='urn:hl7-org:v3';
				//ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:given[1]</path>
                <content>${#Project#GivenName}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Family Name XPath Match" type="XPath Match" id="eb1af6bd-a1d1-4121-b1da-f41dda55a5bd">
              <con:configuration>
                <path>declare namespace ns1='urn:hl7-org:v3';
				//ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:family[1]</path>
                <content>${#Project#FamilyName}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Skip Mock" id="096efef9-18f1-449e-b4e8-52a89658d3f1">
        <con:settings/>
        <con:config>
          <script>def runMock = context.findProperty("PassThruOn").toBoolean();

if(!runMock){
	testRunner.gotoStepByName("count correlations");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="83d88867-83e8-44ca-b9bd-a39f0b53d8b2">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="Set Up PassThru" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterPatientDiscoveryBindingSoap</con:interface>
          <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
          <con:path>/MockPDAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="7cc2da4d-6d56-4629-8051-da018dc13e20">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3">
   <soap:Header/>
   <soap:Body>
   <PRPA_IN201306UV02 xmlns="urn:hl7-org:v3" xmlns:ns2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns3="http://www.w3.org/2005/08/addressing" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:patientcorrelationfacade" ITSVersion="XML_1.0">
   <id root="1.1" extension="13318247:13b4e0b839b:-7ff4"/>
   <creationTime value="20121129212833"/>
   <interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
   <processingCode code="P"/>
   <processingModeCode code="T"/>
   <acceptAckCode code="NE"/>
   <receiver typeCode="RCV">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="1.2.345.678.999"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="${#Project#LocalHCIDWithouturnoid}"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </receiver>
   <sender typeCode="SND">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="2.2"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="${#Project#RemoteHCID}"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </sender>
   <acknowledgement>
   	<typeId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
   	<typeCode code="AA"/><targetMessage xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   </acknowledgement>
   <controlActProcess classCode="CACT" moodCode="EVN">
   	<code code="PRPA_TE201306UV" codeSystem="2.16.840.1.113883.1.6"/>
   	<subject typeCode="SUBJ">
   		<registrationEvent classCode="REG" moodCode="EVN">
   			<id nullFlavor="NA"/>
   			<statusCode code="active"/>
   				<subject1 typeCode="SBJ">
   					<patient classCode="PAT">
   						<id root="1.1" extension="D123401"/>
   						<statusCode code="SD"/>
   						<patientPerson classCode="PSN" determinerCode="INSTANCE">
   							<name>
   								<family partType="FAM">Younger</family>
   								<given partType="GIV">Gallow</given>
   							</name>
   							<telecom value="tel:+1-888-555-1234"/>
   							<administrativeGenderCode code="M"/>
   							<birthTime value="19630804"/>
   							<addr><city>LEESBURG</city><state>VA</state><postalCode>20176</postalCode></addr>
   							<asOtherIDs classCode="SD">
   								<id root="2.16.840.1.113883.4.1" extension="999123401"/>
   								<scopingOrganization classCode="ORG" determinerCode="INSTANCE">
   									<id root="2.16.840.1.113883.4.1"/>
   								</scopingOrganization>
   							</asOtherIDs>
   						</patientPerson>
   						<providerOrganization classCode="ORG" determinerCode="INSTANCE">
   							<id root="1.1"/>
   							<contactParty xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   							</providerOrganization>
   							<subjectOf1>
   								<queryMatchObservation classCode="CASE" moodCode="EVN">
   									<code code="IHE_PDQ"/>
   									<value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="INT" value="100"/>
   								</queryMatchObservation>
   							</subjectOf1>
   						</patient>
   					</subject1>
   					<custodian typeCode="CST">
   						<assignedEntity classCode="ASSIGNED">
   							<id root="1.1"/>
   							<code code="NotHealthDataLocator" codeSystem="1.3.6.1.4.1.19376.1.2.27.2"/>
   						</assignedEntity>
   					</custodian>
   				</registrationEvent>
   			</subject>
   			<queryAck>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<queryResponseCode code="OK"/>
   			</queryAck>
   			<queryByParameter>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<statusCode code="new"/>
   				<responseModalityCode code="R"/>
   				<responsePriorityCode code="I"/>
   				<parameterList>
   					<livingSubjectAdministrativeGender>
   						<value code="M"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectAdministrativeGender>
   					<livingSubjectBirthTime>
   						<value value="19630804"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectBirthTime>
   					<livingSubjectId>
   						<value root="1.1" extension="1111"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectId>
   					<livingSubjectName>
   						<value>
   							<family partType="FAM">Younger</family>
   							<given partType="GIV">Gallow</given>
                        		</value>
                        		<semanticsText representation="TXT"/>
                        	</livingSubjectName>
                     </parameterList>
                 </queryByParameter>
             </controlActProcess>
     </PRPA_IN201306UV02>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
        </con:config>
      </con:testStep>
      <con:testStep name="count correlations" type="groovy" id="d794d4b6-4b20-4083-90cd-d93ef241da54">
        <con:settings/>
        <con:config>
          <script>def pdCorrelations = 1;

if(context.findProperty("PassThruOn").toBoolean()) {
	pdCorrelations = 0;
}

log.info "Assert ${pdCorrelations} number of correlations"

context.withSql('PatientCorrelationDB') { sql -> 
		assert pdCorrelations == sql.firstRow('select count(*) from ' + context.findProperty('PatientCorrelationTable'))[0]
		}</script>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
//nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
	nhinc.FileUtils.restoreFile(dir, "PatientDiscoveryProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:23Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:23Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:23</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Query" searchProperties="true" id="86b589c5-9a1c-4e9d-ba80-9fde57ead30d">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="27934370-87ea-4ebe-910b-3f80469c2e76">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docquery.30.inboundDocQuery";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
	testRunner.gotoStepByName("Document Query");
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="36323f66-e8a9-44d7-afd5-41d7fe5ac3ee">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="35602b32-e706-43e2-8b62-9f050b075cc3">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="update config" type="groovy" id="6046a19e-72e2-41cb-abda-53d3e7162f2d">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="972c266b-51c0-4cba-83ac-f8a30d298f05">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="438d2126-03f6-4d3d-a3b6-47d544438e06">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="312dc687-27b2-4cea-8210-b12f04cb60e8">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="6f4dd3b8-7874-4d5a-a6d7-2aed5440cb13">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
         <urn2:Slot name="$XDSDocumentEntryClassCode">
            <urn2:ValueList>
                    <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>         
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
         <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="74fa6a13-17c9-447a-a992-492d09a4f6d4"/>
            <con:assertion type="Schema Compliance" id="595912b2-148e-4a51-885f-8b63451ac33e">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="c6ae87c0-e112-4611-8783-57fd53aab274"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="a8d908f5-2ea7-4004-8502-ebf48e1b58d9">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
log.info("xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx");
def passThruOn = context.findProperty('PassThruOn').toBoolean();
def documentID = null;
log.info("passthruon is " + passThruOn);
if(passThruOn){
	documentID = context.findProperty('DQPTDocID');
}else {
	documentID = context.findProperty('DQDocID')
}

log.info("Doc ID used xxxx: " + documentID);
def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:26Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:26Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:26</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Retrieve" searchProperties="true" id="ceec6035-1427-4921-90d4-1f2a7a94c986">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="f3ff0553-7e08-493e-bfe7-0debbab023a1">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "docretrieve.30.inbound";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="e08f3246-3698-4563-8e8e-8597d1fa34c5">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="75473620-8c58-4ede-8c05-1360ddd2bffc">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Retrieve" type="request" id="81116d11-48bb-418c-aef9-34b0905c91a4">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocRetrieveBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation>
          <con:request incomingWss="" name="Document Retrieve" outgoingWss="" wssPasswordType="" id="af910e3a-d9d6-4467-9665-6daad3a9719a">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@expand-mtom-attachments">true</con:setting>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:ihe:iti:xds-b:2007" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_wo_urn:oid" testCase="Document Retrieve">
      <urn:RespondingGateway_CrossGatewayRetrieveRequest>
         <urn1:RetrieveDocumentSetRequest>
            <urn1:DocumentRequest>
               <urn1:HomeCommunityId>${#Project#RemoteHCID}</urn1:HomeCommunityId>
               <urn1:RepositoryUniqueId>${#Project#DRRepoID}</urn1:RepositoryUniqueId>
               <urn1:DocumentUniqueId>${#Project#DRDocID}</urn1:DocumentUniqueId>
            </urn1:DocumentRequest>
         </urn1:RetrieveDocumentSetRequest>
         <urn:assertion>
            <urn2:nationalProviderId>1234567890</urn2:nationalProviderId>         
            <urn2:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>AddrCity</urn2:city>
               <urn2:country>AddrCountry</urn2:country>
               <urn2:state>AddrState</urn2:state>
               <urn2:streetAddress>AddrStreet</urn2:streetAddress>
               <urn2:zipCode>AddrZip</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn2:dateOfBirth>
            <urn2:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSignature>
            <urn2:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveWitnessSignature>
            <urn2:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:description>${#Project#LocalHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn2:homeCommunityId>
               <urn2:name>${#Project#LocalHCDescription}</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sandy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
               <urn2:fullName>Sandy S. Smith</urn2:fullName>
            </urn2:personName>
            <urn2:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5436</urn2:extension>
               <urn2:localNumber>253-6849</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Addr2City</urn2:city>
               <urn2:country>Addr2Country</urn2:country>
               <urn2:state>Addr2State</urn2:state>
               <urn2:streetAddress>Addr2Street</urn2:streetAddress>
               <urn2:zipCode>Addr2Zip</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sammy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>s</urn2:secondNameOrInitials>
               <urn2:fullName>Sammy S. Smith</urn2:fullName>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5424</urn2:extension>
               <urn2:localNumber>542-6823</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn2:SSN>
            <urn2:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn2:uniquePatientId>
            <urn2:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>addrCode</urn2:code>
                  <urn2:codeSystem>addrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>addrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>addrCode</urn2:displayName>
                  <urn2:originalText>addrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Burnell</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>FL</urn2:state>
               <urn2:streetAddress>825 North</urn2:streetAddress>
               <urn2:zipCode>32184</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Scott</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S.</urn2:secondNameOrInitials>
               <urn2:fullName>Scott S. Smith</urn2:fullName>
            </urn2:witnessName>
            <urn2:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>8432</urn2:extension>
               <urn2:localNumber>985-2239</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:personName>
                  <urn2:familyName>Skagerberg</urn2:familyName>
                  <urn2:givenName>Karl</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>nameCode</urn2:code>
                     <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                     <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                     <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                     <urn2:displayName>nameCode</urn2:displayName>
                     <urn2:originalText>nameCode</urn2:originalText>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
                  <urn2:fullName>Kasrl S. Skagerberg</urn2:fullName>
               </urn2:personName>
               <urn2:userName>kskagerb</urn2:userName>
               <urn2:org>
                  <urn2:description>${#Project#LocalHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn2:homeCommunityId>
                  <urn2:name>${#Project#LocalHCDescription}</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>307969004</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Public Health</urn2:displayName>
                  <urn2:originalText>Public Health</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:code>PUBLICHEALTH</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Use or disclosure of Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:authInstant>2009-04-16T13:15:39Z</urn2:authInstant>
               <urn2:sessionIndex>987</urn2:sessionIndex>
               <urn2:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn2:authContextClassRef>
               <urn2:subjectLocalityAddress>1.1.1.1</urn2:subjectLocalityAddress>
               <urn2:subjectLocalityDNSName>connectopensource.org</urn2:subjectLocalityDNSName>
            </urn2:samlAuthnStatement>
            <urn2:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:decision>Permit</urn2:decision>
               <urn2:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn2:resource>
               <urn2:action>TestSaml</urn2:action>
               <urn2:evidence>
                  <urn2:assertion>
                     <urn2:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn2:id>
                     <urn2:issueInstant>2009-04-16T13:10:39.093Z</urn2:issueInstant>
                     <urn2:version>2.0</urn2:version>
                     <urn2:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn2:issuerFormat>
                     <urn2:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn2:issuer>
                     <urn2:conditions>
                        <urn2:notBefore>2009-04-16T13:10:39.093Z</urn2:notBefore>
                        <urn2:notOnOrAfter>2009-12-31T12:00:00.000Z</urn2:notOnOrAfter>
                     </urn2:conditions>
                     <urn2:accessConsentPolicy>urn:oid:1.2.3.4</urn2:accessConsentPolicy>
                     <urn2:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn2:instanceAccessConsentPolicy>
                  </urn2:assertion>
               </urn2:evidence>
            </urn2:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn2:nhinTargetCommunity>
               <urn2:homeCommunity>
                  <urn2:description>${#Project#RemoteHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#RemoteHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#RemoteHCDescription}</urn2:name>
               </urn2:homeCommunity>
            </urn2:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayRetrieveRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="10fd8dd5-ff65-494a-84b4-ce462b67f650"/>
            <con:assertion type="SOAP Fault Assertion" id="b8aeab0e-66c1-4237-9f54-70ed6302ebb0"/>
            <con:assertion disabled="true" type="Schema Compliance" id="d6e64b43-19ab-4d4a-91d7-cfc33e1b93d1">
              <con:configuration>
                <definition/>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Doc Repository ID" type="XPath Match" id="ec2c587a-a922-4c54-b9cc-34cf7e3fac85">
              <con:configuration>
                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
					//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:RepositoryUniqueId[1]</path>
                <content>${#Project#DRRepoID}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Doc ID" type="XPath Match" id="32731c85-ee31-42b2-9fd0-a8a14b798f14">
              <con:configuration>
                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
					//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:DocumentUniqueId[1]</path>
                <content>${#Project#DRDocID}</content>
                <allowWildcards>false</allowWildcards>
                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              </con:configuration>
            </con:assertion>
            <con:assertion name="Document Data" type="GroovyScriptAssertion" id="e68b7541-5c06-4276-bc38-da4de637cdf0">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
					def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
					holder.namespaces["ns"]="urn:ihe:iti:xds-b:2007"
					def docData = holder["//ns:RetrieveDocumentSetResponse[1]/ns:DocumentResponse[1]/ns:Document[1]"]
					log.info docData.toString()
					assert (docData.size() != 0)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitydocretrieve/EntityDocRetrievePortType/RespondingGateway_CrossGatewayRetrieveRequest" mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>CorrectedRemoteHCID</con:name>
          <con:value>urn:oid:2.2</con:value>
        </con:property>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:28Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:28Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:28</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Admin Distribution" searchProperties="true" id="03ab9a27-eaf9-487a-9577-d5439d2c69d7">
      <con:settings/>
      <con:testStep type="groovy" name="Check Passthru" id="e0d31a35-4cb5-4d4f-8d9a-cfa8165dcb5d">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def dir = context.findProperty('GatewayPropDir');
def file = "gateway.properties";
def passthruProp = "admindist.inboundAdminDist";

def passthruValue = FileUtils.readProperty(dir, file, passthruProp, log);
log.info "Passthrough property value = ${passthruValue}";

if(passthruValue != null){
	testRunner.testCase.setPropertyValue("PassThruOn", "true");
	FileUtils.backupFile(dir, "PolicyEngineProxyConfig.xml", log);
	//Updating PolicyEngine for passthrough
	def alias = 'adapterpolicyengineorchestrator';
	def aliasName = 'adapterpolicyengineorchestratorsamljava';
	def replaceName = 'adapterpolicyengineorchestratornoopdeny';
	
	FileUtils.updateSpringConfig(dir, "PolicyEngineProxyConfig.xml", alias,
		aliasName, replaceName, log);
	
} else {
	testRunner.testCase.setPropertyValue("PassThruOn", "false");
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy exchangeInfoWOurnoid" id="c49f244e-1cb1-487e-ba64-7133560f3622">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "exchangeInfo_Without_urnoid.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = context.findProperty("GatewayPropDir");
def destFile = "exchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Copy InternalConnnectionInfoWOurnoid" id="910976bf-bf1c-40b8-b060-b1677e863ca5">
        <con:settings/>
        <con:config>
          <script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
//def projectPropPath = groovyUtils.projectPath
def projectPropPath = context.expand('${projectDir}')

def sourceDir = projectPropPath;
def sourceFile = "internalExchangeInfo_Without_urnoid.xml";
def destDir = context.findProperty("GatewayPropDir");
def destFile = "internalExchangeInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.copyFile(sourceDir, sourceFile, destDir, destFile, log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Admin Distribution" type="request" id="f678c1d5-cf46-4b77-a73d-7fa01efcb94c">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdministrativeDistribution_Binding_Soap12_g1</con:interface>
          <con:operation>SendAlertMessage</con:operation>
          <con:request name="Admin Distribution" id="e12dd2c6-b356-4440-b288-d10c8ff3da43">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:emergency:EDXL:DE:1.0">
   <soap:Header/>
   <soap:Body testSuite="Entity_CM_wo_urn:oid_ReqMsg_wo_urn:oid" testCase="Admin Distribution">
      <urn:RespondingGateway_SendAlertMessage>
         <urn:assertion>
            <urn1:nationalProviderId>1234567890</urn1:nationalProviderId>         
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253987546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>${#TestCase#UserId}</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCIDWithouturnoid}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>80584001</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Psychiatrist</urn1:displayName>
                  <urn1:originalText>Psychiatrist</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PSYCHOTHERAPY</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-09-01T13:00:00.000Z</urn1:authInstant>
               <urn1:sessionIndex>mySessionIndex</urn1:sessionIndex>
               <urn1:authContextClassRef>myContextClassRef</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>mySubjectLocalityAddress</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>mySubjectLocalityDns</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>myAuthzDecisionStatementResource</urn1:resource>
               <urn1:action>myAuthzDecisionStatementAction</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>AuthzDecisionStatementEvidenceAssertionId</urn1:id>
                     <urn1:issueInstant>2009-09-02T14:00:00.000Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuer>CN=Mr Saml User,OU=SU,O=Mr SAML Org,L=Chantilly,ST=VA,C=US</urn1:issuer>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>urn:oid:1.2.3.4</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:243113487404</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:159355901562</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:383675305350</urn1:signatureValue>
            </urn1:samlSignature>
            </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
               <urn1:list>?</urn1:list>
               <urn1:region>?</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn2:EDXLDistribution>
            <urn2:distributionID>633990682441061250</urn2:distributionID>
            <urn2:senderID>actor@2.16.840.1.113883.3.166</urn2:senderID>
            <urn2:dateTimeSent>2010-08-14T12:18:13.512375-08:00</urn2:dateTimeSent>
            <urn2:distributionStatus>Actual</urn2:distributionStatus>
            <urn2:distributionType>Update</urn2:distributionType>
            <urn2:combinedConfidentiality>Public</urn2:combinedConfidentiality>
            <!--Optional:-->
            <urn2:language>?</urn2:language>
            <!--Zero or more repetitions:-->
            <urn2:senderRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:senderRole>
            <!--Zero or more repetitions:-->
            <urn2:recipientRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:recipientRole>
            <!--Zero or more repetitions:-->
            <urn2:keyword>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:keyword>
            <!--Zero or more repetitions:-->
            <urn2:distributionReference>?</urn2:distributionReference>
            <!--Zero or more repetitions:-->
            <urn2:explicitAddress>
               <urn2:explicitAddressScheme>modified_IHEIntendedRecipient</urn2:explicitAddressScheme>
               <!--1 or more repetitions:-->
               <urn2:explicitAddressValue>^^^^^^^^^2.16.840.1.113883.3.166|0000000001</urn2:explicitAddressValue>
            </urn2:explicitAddress>
            <!--Zero or more repetitions:-->
            <urn2:targetArea>
               <!--Zero or more repetitions:-->
               <urn2:circle>?</urn2:circle>
               <!--Zero or more repetitions:-->
               <urn2:polygon>?</urn2:polygon>
               <!--Zero or more repetitions:-->
               <urn2:country>?</urn2:country>
               <!--Zero or more repetitions:-->
               <urn2:subdivision>?</urn2:subdivision>
               <!--Zero or more repetitions:-->
               <urn2:locCodeUN>?</urn2:locCodeUN>
            </urn2:targetArea>
            <!--Zero or more repetitions:-->
            <urn2:contentObject>
               <!--Optional:-->
               <urn2:contentDescription>PH Alert Message</urn2:contentDescription>
               <!--Zero or more repetitions:-->
               <urn2:contentKeyword>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:contentKeyword>
               <!--Optional:-->
               <urn2:incidentID>TEST</urn2:incidentID>
               <!--Optional:-->
               <urn2:incidentDescription>This is a test message</urn2:incidentDescription>
               <!--Zero or more repetitions:-->
               <urn2:originatorRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:originatorRole>
               <!--Zero or more repetitions:-->
               <urn2:consumerRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:consumerRole>
               <!--Optional:-->
               <urn2:confidentiality>Public</urn2:confidentiality>
               <!--You have a CHOICE of the next 2 items at this level-->
		<urn2:nonXMLContent>
                  <urn2:mimeType>application/pdf</urn2:mimeType>
                  <!--Optional:-->
                  <urn2:size>19</urn2:size>
                  <!--Optional:-->
                  <urn2:digest>?</urn2:digest>
                  <!--Optional:-->
                  <urn2:uri>?</urn2:uri>
                  <!--Optional:-->
                  <urn2:contentData>LDLIHAPIISDALKDF902383K1182K4J49DFNF3KR0482HJ1029F393</urn2:contentData>
               </urn2:nonXMLContent>
               <!--You may enter ANY elements at this point-->
            </urn2:contentObject>
         </urn2:EDXLDistribution>
      </urn:RespondingGateway_SendAlertMessage>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="delay" name="Delay" id="a5185319-7128-4c7e-b2ff-34466920341f">
        <con:settings/>
        <con:config>
          <delay>10000</delay>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-11T13:48:30Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-11T13:58:30Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/11/2013 13:48:30</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-11T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:requirements/>
  <con:properties>
    <con:property>
      <con:name>AAMappingDB</con:name>
      <con:value>assigningauthoritydb</con:value>
    </con:property>
    <con:property>
      <con:name>AAMappingTable</con:name>
      <con:value>aa_to_home_community_mapping</con:value>
    </con:property>
    <con:property>
      <con:name>AD_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/AdminDistribution/1_0/AdministrativeDistribution_Service</con:value>
    </con:property>
    <con:property>
      <con:name>AD_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:value>
    </con:property>
    <con:property>
      <con:name>AsyncMsgDB</con:name>
      <con:value>asyncmsgs</con:value>
    </con:property>
    <con:property>
      <con:name>AsyncMsgTable</con:name>
      <con:value>asyncmsgrepo</con:value>
    </con:property>
    <con:property>
      <con:name>AuditRepoDB</con:name>
      <con:value>auditrepo</con:value>
    </con:property>
    <con:property>
      <con:name>AuditRepoTable</con:name>
      <con:value>auditrepository</con:value>
    </con:property>
    <con:property>
      <con:name>BirthTime</con:name>
      <con:value>19630804</con:value>
    </con:property>
    <con:property>
      <con:name>City</con:name>
      <con:value>Melbourne</con:value>
    </con:property>
    <con:property>
      <con:name>Country</con:name>
      <con:value>US</con:value>
    </con:property>
    <con:property>
      <con:name>DateOfSignature</con:name>
      <con:value>20080520</con:value>
    </con:property>
    <con:property>
      <con:name>DBHost</con:name>
      <con:value>localhost</con:value>
    </con:property>
    <con:property>
      <con:name>DBPass</con:name>
      <con:value>nhincpass</con:value>
    </con:property>
    <con:property>
      <con:name>DBPort</con:name>
      <con:value>3306</con:value>
    </con:property>
    <con:property>
      <con:name>DBUser</con:name>
      <con:value>nhincuser</con:value>
    </con:property>
    <con:property>
      <con:name>DeferredPatientDiscoveryReqMessageID</con:name>
      <con:value>uuid:6666666666.66666.666.66</con:value>
    </con:property>
    <con:property>
      <con:name>DOB</con:name>
      <con:value>19800516</con:value>
    </con:property>
    <con:property>
      <con:name>DQDocID</con:name>
      <con:value>1.123401.55555</con:value>
    </con:property>
    <con:property>
      <con:name>DQPatientID</con:name>
      <con:value>D123401</con:value>
    </con:property>
    <con:property>
      <con:name>DQPTDocID</con:name>
      <con:value>1.123401.11111</con:value>
    </con:property>
    <con:property>
      <con:name>DQ_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DQ_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DRDocID</con:name>
      <con:value>1.123407.777777</con:value>
    </con:property>
    <con:property>
      <con:name>DRRepoID</con:name>
      <con:value>1</con:value>
    </con:property>
    <con:property>
      <con:name>DR_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentRetrieve/2_0/EntityService/EntityDocRetrieve</con:value>
    </con:property>
    <con:property>
      <con:name>DR_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:value>
    </con:property>
    <con:property>
      <con:name>DSDefReq_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DSDefReq_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DSDefResp_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DSDefResp_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DS_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DS_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DynamicDQDocID</con:name>
      <con:value>103.8.9284320.020.3590.75^1266324032288</con:value>
    </con:property>
    <con:property>
      <con:name>ExpirationDate</con:name>
      <con:value>20100520</con:value>
    </con:property>
    <con:property>
      <con:name>FamilyName</con:name>
      <con:value>Younger</con:value>
    </con:property>
    <con:property>
      <con:name>GatewayPropDir</con:name>
      <con:value></con:value>
    </con:property>
    <con:property>
      <con:name>Gender</con:name>
      <con:value>M</con:value>
    </con:property>
    <con:property>
      <con:name>GivenName</con:name>
      <con:value>Gallow</con:value>
    </con:property>
    <con:property>
      <con:name>LocalAA</con:name>
      <con:value>1.1</con:value>
    </con:property>
    <con:property>
      <con:name>LocalHCDescription</con:name>
      <con:value>InternalTest1</con:value>
    </con:property>
    <con:property>
      <con:name>LocalHCIDWithouturnoid</con:name>
      <con:value>1.1</con:value>
    </con:property>
    <con:property>
      <con:name>LocalHCIDWithurnoid</con:name>
      <con:value>urn:oid:1.1</con:value>
    </con:property>
    <con:property>
      <con:name>LocalPatientID</con:name>
      <con:value>D123401</con:value>
    </con:property>
    <con:property>
      <con:name>NotificationEndpoint</con:name>
      <con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/NotificationConsumerService/HiemNotify</con:value>
    </con:property>
    <con:property>
      <con:name>NotifySubscriptionID</con:name>
      <con:value>24085385-ef54-4aaf-b027-d5896689be24</con:value>
    </con:property>
    <con:property>
      <con:name>NotifySubscriptionManagerEndpointAddress</con:name>
      <con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value>
    </con:property>
    <con:property>
      <con:name>PatientCorrelationDB</con:name>
      <con:value>patientcorrelationdb</con:value>
    </con:property>
    <con:property>
      <con:name>PatientCorrelationTable</con:name>
      <con:value>correlatedidentifiers</con:value>
    </con:property>
    <con:property>
      <con:name>PDDefReq_EntityEndpoint</con:name>
      <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>PDDefResp_EntityEndpoint</con:name>
      <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>PD_EntityEndpoint</con:name>
      <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:value>
    </con:property>
    <con:property>
      <con:name>project.name</con:name>
      <con:value>EntityValidation</con:value>
    </con:property>
    <con:property>
      <con:name>PurposeOfDisclosure</con:name>
      <con:value>Mental</con:value>
    </con:property>
    <con:property>
      <con:name>RemoteAA</con:name>
      <con:value>2.2</con:value>
    </con:property>
    <con:property>
      <con:name>RemoteHCDescription</con:name>
      <con:value>InternalTest2</con:value>
    </con:property>
    <con:property>
      <con:name>RemoteHCID</con:name>
      <con:value>urn:oid:2.2</con:value>
    </con:property>
    <con:property>
      <con:name>RemotePatientID</con:name>
      <con:value>D123401</con:value>
    </con:property>
    <con:property>
      <con:name>SSN</con:name>
      <con:value>123456789</con:value>
    </con:property>
    <con:property>
      <con:name>State</con:name>
      <con:value>FL</con:value>
    </con:property>
    <con:property>
      <con:name>StreetAddress</con:name>
      <con:value>123 Johnson Rd</con:value>
    </con:property>
    <con:property>
      <con:name>SubjectID</con:name>
      <con:value>D123401</con:value>
    </con:property>
    <con:property>
      <con:name>SubscribePatientID</con:name>
      <con:value>D123401</con:value>
    </con:property>
    <con:property>
      <con:name>SubscriptionDB</con:name>
      <con:value>subscriptionrepository</con:value>
    </con:property>
    <con:property>
      <con:name>SubscriptionManagerEndpointAddress</con:name>
      <con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value>
    </con:property>
    <con:property>
      <con:name>SubscriptionTable</con:name>
      <con:value>subscription</con:value>
    </con:property>
    <con:property>
      <con:name>UniquePatientId</con:name>
      <con:value>1111^^^&amp;amp;1.1&amp;amp;ISO</con:value>
    </con:property>
    <con:property>
      <con:name>UnSubscriptionID</con:name>
      <con:value>6deec8e7-6e6c-4269-91c2-69cb777ab8b0</con:value>
    </con:property>
    <con:property>
      <con:name>ZipCode</con:name>
      <con:value>12345</con:value>
    </con:property>
  </con:properties>
  <con:afterLoadScript>def propertiesFilename = project.path[0..(project.path.size()-4)] + 'properties'
def propertiesFile = new File(propertiesFilename)
if (propertiesFile.exists()) {
	def props = new Properties()
	props.load(new FileInputStream(propertiesFile))
	props.each { key, value ->
	    project.setPropertyValue(key, value)
	}
}

TimeZone.setDefault(TimeZone.getTimeZone("UTC"))
def testRunListener = [
afterRun: { testRunner, runContext -> },
afterStep: { testRunner, runContext, result -> },
beforeStep: { testRunner, runContext -> },
beforeStep: { testRunner, runContext, testStep -> },
beforeRun: { testRunner, runContext -> 
use (org.codehaus.groovy.runtime.TimeCategory) {
def startDate = 5.minutes.ago
def endDate = 5.minutes.from.now
def expireDate = 30.days.from.now

def df = "yyyy-MM-dd'T'HH:mm:ss'Z'"
def dfSig = "MM/dd/yyyy' 'HH:mm:ss"

runContext.testCase.setPropertyValue("startDate", startDate.format(df))
runContext.testCase.setPropertyValue("endDate", endDate.format(df))
runContext.testCase.setPropertyValue("sigDate", startDate.format(dfSig))
runContext.testCase.setPropertyValue("expireDate", expireDate.format(df))
}
}   
] as com.eviware.soapui.model.testsuite.TestRunListener

project.testSuiteList*.testCaseList.flatten()*.addTestRunListener(testRunListener)

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.findProperty = { propertyName ->
return delegate.getProperty(propertyName) ?:
delegate.testCase.getPropertyValue(propertyName) ?:
delegate.testCase.testSuite.getPropertyValue(propertyName) ?:
delegate.testCase.testSuite.project.getPropertyValue(propertyName) ?:
com.eviware.soapui.SoapUI.globalProperties.getPropertyValue(propertyName)
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.withSql = { dbOrPropertyName, block ->
def dbName = delegate.findProperty(dbOrPropertyName) ?: dbOrPropertyName
def host = delegate.findProperty('DBHost')
def port = delegate.findProperty('DBPort')
def user = delegate.findProperty('DBUser')
def pass = delegate.findProperty('DBPass')

def connectString = "jdbc:mysql://${host}:${port}/${dbName}"
def sql = groovy.sql.Sql.newInstance(connectString, user, pass, "com.mysql.jdbc.Driver");
try {
block(sql)
} finally {
sql.close()
}
}</con:afterLoadScript>
  <con:wssContainer/>
  <con:databaseConnectionContainer/>
  <con:oAuth2ProfileContainer/>
  <con:reporting>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:parameters/>
  </con:reporting>
  <con:sensitiveInformation/>
</con:soapui-project>