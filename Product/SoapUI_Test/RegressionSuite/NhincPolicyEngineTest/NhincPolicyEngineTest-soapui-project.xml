<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project abortOnError="false" name="NhincPolicyEngineTest" resourceRoot="${projectDir}" runType="SEQUENTIAL" soapui-version="4.5.1" activeEnvironment="Default" xmlns:con="http://eviware.com/soapui/config">
	<con:settings>
		<con:setting id="com.eviware.soapui.impl.wsdl.actions.iface.tools.soapui.TestRunnerAction@values-local"><![CDATA[
			<xml-fragment xmlns:con="http://eviware.com/soapui/config">
  <con:entry key="TestSuite" value="&lt;all>"/>
  <con:entry key="Domain" value=""/>
  <con:entry key="Password" value=""/>
  <con:entry key="Coverage Report" value="false"/>
  <con:entry key="Export JUnit Results" value="false"/>
  <con:entry key="Open Report" value="false"/>
  <con:entry key="TestRunner Path" value=""/>
  <con:entry key="Tool Args" value=""/>
  <con:entry key="Export All" value="false"/>
  <con:entry key="TestCase" value="&lt;all>"/>
  <con:entry key="Print Report" value="false"/>
  <con:entry key="Host:Port" value=""/>
  <con:entry key="Username" value=""/>
  <con:entry key="WSS Password Type" value=""/>
  <con:entry key="Root Folder" value=""/>
  <con:entry key="Endpoint" value=""/>
  <con:entry key="Enable UI" value="false"/>
  <con:entry key="Save Project" value="false"/>
  <con:entry key="Add Settings" value="false"/>
</xml-fragment>]]></con:setting>
	</con:settings>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincproxydocquery}NhincProxyDocQueryBindingSoap" definition="../../target/wsdl/NhincProxyDocQuery.wsdl" name="NhincProxyDocQueryBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxyDocQuery</con:endpoint>
			<con:endpoint>http://ATHC-GFAS:9080/NhinConnect/NhincProxyDocQuery</con:endpoint>
			<con:endpoint>http://mhsnhie3.fedsconnect.org:9080/NhinConnect/NhincProxyDocQuery</con:endpoint>
			<con:endpoint>http://dvanhie3.fedsconnect.org:9080/NhinConnect/NhincProxyDocQuery</con:endpoint>
			<con:endpoint>http://dodgateway.fedsconnect.org:9080/NhinConnect/NhincProxyDocQuery</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:RespondingGateway_CrossGatewayQuery" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayQuery" inputName="RespondingGateway_CrossGatewayQueryRequest" isOneWay="false" name="RespondingGateway_CrossGatewayQuery" outputName="RespondingGateway_CrossGatewayQueryResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincproxydocretrieve}NhincProxyDocRetrieveBindingSoap" definition="../../target/wsdl/NhincProxyDocRetrieve.wsdl" name="NhincProxyDocRetrieveBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxyDocRetrieve</con:endpoint>
			<con:endpoint>http://ATHC-GFAS:9080/NhinConnect/NhincProxyDocRetrieve</con:endpoint>
			<con:endpoint>http://dvanhie3.fedsconnect.org:9080/NhinConnect/NhincProxyDocRetrieve</con:endpoint>
			<con:endpoint>http://192.168.101.162:9080/NhinConnect/NhincProxyDocRetrieve</con:endpoint>
			<con:endpoint>http://dodgateway.fedsconnect.org:9080/NhinConnect/NhincProxyDocRetrieve</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:RespondingGateway_CrossGatewayRetrieve" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayRetrieve" inputName="RespondingGateway_CrossGatewayRetrieveRequest" isOneWay="false" name="RespondingGateway_CrossGatewayRetrieve" outputName="RespondingGateway_CrossGatewayRetrieveResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	
	
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincproxynotificationconsumer}NhincProxyNotificationConsumerBindingSoap" definition="../../target/wsdl/NhincProxyNotificationConsumer.wsdl" name="NhincProxyNotificationConsumerBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxyNotificationConsumer</con:endpoint>
			<con:endpoint>http://192.168.25.157:9080/NhinConnect/NhincProxyNotificationConsumer</con:endpoint>
			<con:endpoint>http://ATHC-GFAS:8080/NhinConnect/NhincProxyNotificationConsumer</con:endpoint>
			<con:endpoint>http://DVANHIE3.fedsconnect.org:9080/NhinConnect/NhincProxyNotificationConsumer</con:endpoint>
			<con:endpoint>http://mhsnhie3.fedsconnect.org:8080/NhinConnect/NhincProxyNotificationConsumer</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:Notify" anonymous="optional" bindingOperationName="Notify" inputName="NotifyRequest" isOneWay="false" name="Notify" sendsAttachments="false" type="One-Way">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincproxysubscriptionmanagement}NhincProxyNotificationProducerBindingSoap" definition="../../target/wsdl/NhincProxySubscriptionManagement.wsdl" name="NhincProxyNotificationProducerBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:9080/NhinConnect/NhincProxyNotificationProducer</con:endpoint>
			<con:endpoint>http://192.168.25.157:8080/NhinConnect/NhincProxyNotificationProducer</con:endpoint>
			<con:endpoint>http://mhsnhie3.fedsconnect.org:9080/NhinConnect/NhincProxyNotificationProducer</con:endpoint>
			<con:endpoint>http://DVANHIE3.fedsconnect.org:9080/NhinConnect/NhincProxyNotificationProducer</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxyNotificationProducer</con:endpoint>
			<con:endpoint>http://ATHC-GFAS:9080/NhinConnect/NhincProxyNotificationProducer</con:endpoint>
			<con:endpoint>http://dvanhie3.fedsconnect.org:8080/NhinConnect/NhincProxySubscriptionManager</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxySubscriptionManager</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:Subscribe" anonymous="optional" bindingOperationName="Subscribe" inputName="SubscribeRequest" isOneWay="false" name="Subscribe" outputName="SubscribeResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincproxysubscriptionmanagement}NhincProxySubscriptionManagerBindingSoap" definition="../../target/wsdl/NhincProxySubscriptionManagement.wsdl" name="NhincProxySubscriptionManagerBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:9080/NhinConnect/NhincProxySubscriptionManager</con:endpoint>
			<con:endpoint>http://ATHC-GFAS:9080/NhinConnect/NhincProxySubscriptionManager</con:endpoint>
			<con:endpoint>http://mhsnhie3.fedsconnect.org:9080/NhinConnect/NhincProxySubscriptionManager</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxySubscriptionManager</con:endpoint>
			<con:endpoint>http://dvanhie3.fedsconnect.org:8080/NhinConnect/NhincProxySubscriptionManager</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:Unsubscribe" anonymous="optional" bindingOperationName="Unsubscribe" inputName="UnsubscribeRequest" isOneWay="false" name="Unsubscribe" outputName="UnsubscribeResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:adapternotificationconsumer}AdapterNotificationConsumerBindingSoap" definition="../../target/wsdl/AdapterNotificationConsumer.wsdl" name="AdapterNotificationConsumerBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/AdapterNotificationConsumer</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:Notify" anonymous="optional" bindingOperationName="Notify" inputName="NotifyRequest" isOneWay="false" name="Notify" outputName="NotifyResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
		<con:operation action="urn:NotifySubscribersOfDocument" anonymous="optional" bindingOperationName="NotifySubscribersOfDocument" inputName="NotifySubscribersOfDocumentRequest" isOneWay="false" name="NotifySubscribersOfDocument" outputName="NotifySubscribersOfDocumentResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
		<con:operation action="urn:NotifySubscribersOfCdcBioPackage" anonymous="optional" bindingOperationName="NotifySubscribersOfCdcBioPackage" inputName="NotifySubscribersOfCdcBioPackageRequest" isOneWay="false" name="NotifySubscribersOfCdcBioPackage" outputName="NotifySubscribersOfCdcBioPackageResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement}EntitySubscriptionManagerBindingSoap" definition="../../target/wsdl/EntitySubscriptionManagement.wsdl" name="EntitySubscriptionManagerBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://DVANHIE3.fedsconnect.org:9080/NhinConnect/EntityNotificationProducer</con:endpoint>
			<con:endpoint>http://MHSNHIE3.fedsconnect.org:9080/NhinConnect/EntityNotificationProducer</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntityNotificationProducer</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:Unsubscribe" anonymous="optional" bindingOperationName="Unsubscribe" inputName="UnsubscribeRequest" isOneWay="false" name="Unsubscribe" outputName="UnsubscribeResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:adapterpolicyengine}AdapterPolicyEngineBindingSoap" definition="../../target/wsdl/AdapterPolicyEngine.wsdl" name="AdapterPolicyEngineBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://172.16.50.47:8080/CONNECTAdapter/AdapterProxyService/AdapterPolicyEngine</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/AdapterPolicyEngine</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:CheckPolicy" anonymous="optional" bindingOperationName="CheckPolicy" inputName="CheckPolicyRequest" isOneWay="false" name="CheckPolicy" outputName="CheckPolicyResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:testSuite name="NhincPolicyEngineTest TestSuite">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="5605bf46-c41c-47b3-897f-ce4a782917ef" keepSession="false" maxResults="0" name="Document Query" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="ModifyInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

//def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
def destConfigFileLocation = context.findProperty("GatewayPropDir");
def NHINGatewayHost = context.findProperty("NHINGatewayHost");
def mockHost = context.findProperty("MockHost");
def mockPEURL = "http://" + mockHost + ":18088/mockPolicyEngine";
def InitiatingHCID = context.findProperty( "LocalHCID" );

FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", destConfigFileLocation, InitiatingHCID, "policyengineservice", mockPEURL, "LEVEL_a0", log)</script></con:config>
			</con:testStep>
			<con:testStep name="Generate patient ID for Doc Query" type="groovy">
				<con:settings/>
				<con:config>
					<script>def localAA = context.findProperty('LocalAA')
def dqPatientID = context.findProperty('DQPatientID')

context.testCase.setPropertyValue('FullPatientID', "'${dqPatientID}^^^&amp;amp;${localAA}&amp;amp;ISO'");
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Document Query" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>NhincProxyDocQueryBindingSoap</con:interface>
					<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
					<con:request name="Document Query">
						<con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-DocQuery}</con:endpoint>
						<con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="NhincPolicyEngineTest" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="true"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>${#TestCase#FullPatientID}</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerb</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetSystem>
            <urn3:homeCommunity>
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:assertion type="SOAP Response"/>
						<con:assertion disabled="true" name="URI Match" type="XPath Match">
							<con:configuration>
								<path>declare namespace ns3='urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0';
declare namespace ns1='urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0';
//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:Slot[11]/ns3:ValueList[1]/ns3:Value[1]</path>
								<content>${Test Case Properties#DQDocID}</content>
								<allowWildcards>false</allowWildcards>
								<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
							</con:configuration>
						</con:assertion>
						<con:assertion type="Schema Compliance">
							<con:configuration>
								<definition/>
							</con:configuration>
						</con:assertion>
						<con:assertion name="DocID Match" type="GroovyScriptAssertion">
							<con:configuration>
								<scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";

//def documentID = context.getProperty( "Test Case Properties", "DQDocID" );
def documentID = context.findProperty('DQDocID')
def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
assert (documentID == msgDocID);
log.info documentID + " " + msgDocID</scriptText>
							</con:configuration>
						</con:assertion>
						<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincproxydocquery/NhincProxyDocQueryPortType/RespondingGateway_CrossGatewayQueryRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Policy Engine Mock" type="mockresponse">
				<con:settings/>
				<con:config startStep="Document Query" xsi:type="con:MockResponseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>AdapterPolicyEngineBindingSoap</con:interface>
					<con:operation>CheckPolicy</con:operation>
					<con:path>/mockPolicyEngine</con:path>
					<con:port>18088</con:port>
					<con:timeout>60000</con:timeout>
					<con:response>
						<con:settings/>
						<con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:xacml:2.0:context:schema:os" xmlns:urn2="urn:oasis:names:tc:xacml:2.0:policy:schema:os">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:CheckPolicyResponse>
         <urn:response>
            <urn1:Result ResourceId="?">
               <urn1:Decision>Permit</urn1:Decision>
            </urn1:Result>
         </urn:response>
      </urn:CheckPolicyResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent>
						<con:wsaConfig mustUnderstand="NONE" version="200508"/>
					</con:response>
					<con:assertion type="XPath Match">
						<con:configuration>
							<path>declare namespace ns10='urn:oasis:names:tc:xacml:2.0:context:schema:os';
declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns18:CheckPolicyRequest[1]/ns18:request[1]/ns10:Action[1]/ns10:Attribute[1]/ns10:AttributeValue[1]</path>
							<content>DocumentQueryIn</content>
							<allowWildcards>false</allowWildcards>
							<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
						</con:configuration>
					</con:assertion>
				</con:config>
			</con:testStep>
			
			<con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-11-28T20:31:50Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-11-28T20:41:50Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>11/28/2012 20:31:50</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-12-28T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>FullPatientID</con:name>
					<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="5c8330cc-e382-4dad-9c68-716bf8595ae1" keepSession="false" maxResults="0" name="Document Retrieve" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="ModifyInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

//def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
def destConfigFileLocation = context.findProperty("GatewayPropDir");
def NHINGatewayHost = context.findProperty("NHINGatewayHost");
def mockHost = context.findProperty("MockHost");
def mockPEURL = "http://" + mockHost + ":18088/mockPolicyEngine";
def InitiatingHCID = context.findProperty( "LocalHCID" );

FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", destConfigFileLocation, InitiatingHCID, "policyengineservice", mockPEURL, "LEVEL_a0", log)</script></con:config>
			</con:testStep>
			<con:testStep name="Generate HCID for Doc Retrieve" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.testCase.setPropertyValue('CorrectedLocalHCID', "urn:oid:${context.findProperty('LocalHCID')}")
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Document Retrieve" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>NhincProxyDocRetrieveBindingSoap</con:interface>
					<con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation>
					<con:request name="Document Retrieve">
						<con:settings>
							<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@expand-mtom-attachments">true</con:setting>
						<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-DocRetrieve}</con:endpoint>
						<con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:urn1="urn:ihe:iti:xds-b:2007" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="NhincPolicyEngineTest" testCase="Document Retrieve">
      <urn:RespondingGateway_CrossGatewayRetrieveRequest>
         <urn1:RetrieveDocumentSetRequest>
            <urn1:DocumentRequest>
               <urn1:HomeCommunityId>${#TestCase#CorrectedLocalHCID}</urn1:HomeCommunityId>
               <urn1:RepositoryUniqueId>${#Project#DRRepoID}</urn1:RepositoryUniqueId>
               <urn1:DocumentUniqueId>${#Project#DRDocID}</urn1:DocumentUniqueId>
            </urn1:DocumentRequest>
         </urn1:RetrieveDocumentSetRequest>
         <urn:assertion>
            <urn2:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>AddrCity</urn2:city>
               <urn2:country>AddrCountry</urn2:country>
               <urn2:state>AddrState</urn2:state>
               <urn2:streetAddress>AddrStreet</urn2:streetAddress>
               <urn2:zipCode>AddrZip</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn2:dateOfBirth>
            <urn2:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSignature>
            <urn2:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveWitnessSignature>
            <urn2:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:description>${#Project#RemoteHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#RemoteHCID}</urn2:homeCommunityId>
               <urn2:name>${#Project#RemoteHCDescription}</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sandy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
               <urn2:fullName>Sandy S. Smith</urn2:fullName>
            </urn2:personName>
            <urn2:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5436</urn2:extension>
               <urn2:localNumber>253-6849</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Addr2City</urn2:city>
               <urn2:country>Addr2Country</urn2:country>
               <urn2:state>Addr2State</urn2:state>
               <urn2:streetAddress>Addr2Street</urn2:streetAddress>
               <urn2:zipCode>Addr2Zip</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sammy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>s</urn2:secondNameOrInitials>
               <urn2:fullName>Sammy S. Smith</urn2:fullName>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5424</urn2:extension>
               <urn2:localNumber>542-6823</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn2:SSN>
            <urn2:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000</urn2:uniquePatientId>
            <urn2:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>addrCode</urn2:code>
                  <urn2:codeSystem>addrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>addrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>addrCode</urn2:displayName>
                  <urn2:originalText>addrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Burnell</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>FL</urn2:state>
               <urn2:streetAddress>825 North</urn2:streetAddress>
               <urn2:zipCode>32184</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Scott</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S.</urn2:secondNameOrInitials>
               <urn2:fullName>Scott S. Smith</urn2:fullName>
            </urn2:witnessName>
            <urn2:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>8432</urn2:extension>
               <urn2:localNumber>985-2239</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:personName>
                  <urn2:familyName>Skagerberg</urn2:familyName>
                  <urn2:givenName>Karl</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>nameCode</urn2:code>
                     <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                     <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                     <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                     <urn2:displayName>nameCode</urn2:displayName>
                     <urn2:originalText>nameCode</urn2:originalText>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
                  <urn2:fullName>Kasrl S. Skagerberg</urn2:fullName>
               </urn2:personName>
               <urn2:userName>kskagerb</urn2:userName>
               <urn2:org>
                  <urn2:description>${#Project#RemoteHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#RemoteHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#RemoteHCDescription}</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>307969004</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Public Health</urn2:displayName>
                  <urn2:originalText>Public Health</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:code>PUBLICHEALTH</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Use or disclosure of Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:authInstant>2009-04-16T13:15:39Z</urn2:authInstant>
               <urn2:sessionIndex>987</urn2:sessionIndex>
               <urn2:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn2:authContextClassRef>
               <urn2:subjectLocalityAddress>158.147.185.168</urn2:subjectLocalityAddress>
               <urn2:subjectLocalityDNSName>cs.myharris.net</urn2:subjectLocalityDNSName>
            </urn2:samlAuthnStatement>
            <urn2:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:decision>Permit</urn2:decision>
               <urn2:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn2:resource>
               <urn2:action>TestSaml</urn2:action>
               <urn2:evidence>
                  <urn2:assertion>
                     <urn2:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn2:id>
                     <urn2:issueInstant>2009-04-16T13:10:39.093Z</urn2:issueInstant>
                     <urn2:version>2.0</urn2:version>
                     <urn2:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn2:issuerFormat>
                     <urn2:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn2:issuer>
                     <urn2:conditions>
                        <urn2:notBefore>2009-04-16T13:10:39.093Z</urn2:notBefore>
                        <urn2:notOnOrAfter>2009-12-31T12:00:00.000Z</urn2:notOnOrAfter>
                     </urn2:conditions>
                  </urn2:assertion>
               </urn2:evidence>
            </urn2:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetSystem>
            <urn2:homeCommunity>
               <urn2:description>${#Project#LocalHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#LocalHCID}</urn2:homeCommunityId>
               <urn2:name>${#Project#LocalHCDescription}</urn2:name>
            </urn2:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:RespondingGateway_CrossGatewayRetrieveRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:assertion name="DocID Match" type="XPath Match">
							<con:configuration>
								<path>declare namespace ns7='urn:ihe:iti:xds-b:2007';
//ns7:RetrieveDocumentSetResponse[1]/ns7:DocumentResponse[1]/ns7:DocumentUniqueId[1]</path>
								<content>${#Project#DRDocID}</content>
								<allowWildcards>false</allowWildcards>
								<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
							</con:configuration>
						</con:assertion>
						<con:assertion type="Schema Compliance">
							<con:configuration>
								<definition/>
							</con:configuration>
						</con:assertion>
						<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincproxydocretrieve/NhincProxyDocRetrievePortType/RespondingGateway_CrossGatewayRetrieveRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Policy Engine Mock" type="mockresponse">
				<con:settings/>
				<con:config startStep="Document Retrieve" xsi:type="con:MockResponseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>AdapterPolicyEngineBindingSoap</con:interface>
					<con:operation>CheckPolicy</con:operation>
					<con:path>/mockPolicyEngine</con:path>
					<con:port>18088</con:port>
					<con:timeout>60000</con:timeout>
					<con:response>
						<con:settings/>
						<con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:xacml:2.0:context:schema:os" xmlns:urn2="urn:oasis:names:tc:xacml:2.0:policy:schema:os">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:CheckPolicyResponse>
         <urn:response>
            <urn1:Result ResourceId="?">
               <urn1:Decision>Permit</urn1:Decision>
            </urn1:Result>
         </urn:response>
      </urn:CheckPolicyResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent>
						<con:wsaConfig mustUnderstand="NONE" version="200508"/>
					</con:response>
					<con:assertion type="XPath Match">
						<con:configuration>
							<path>declare namespace ns10='urn:oasis:names:tc:xacml:2.0:context:schema:os';
declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns18:CheckPolicyRequest[1]/ns18:request[1]/ns10:Action[1]/ns10:Attribute[1]/ns10:AttributeValue[1]</path>
							<content>DocumentRetrieveIn</content>
							<allowWildcards>false</allowWildcards>
							<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
						</con:configuration>
					</con:assertion>
				</con:config>
			</con:testStep>
			
			<con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);</con:setupScript><con:properties>
				<con:property>
					<con:name>DocumentUniqueId</con:name>
					<con:value>555555555</con:value>
				</con:property>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-11-28T20:32:34Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-11-28T20:42:34Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>11/28/2012 20:32:34</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-12-28T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>CorrectedLocalHCID</con:name>
					<con:value>urn:oid:1.1</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);</con:tearDownScript>
		</con:testCase>
		<con:testCase disabled="true" failOnError="true" failTestCaseOnErrors="true" id="9a79dfe1-b58c-45b1-9e33-d1d33e234bd3" keepSession="false" maxResults="0" name="Subscribe" searchProperties="true">
			<con:settings/>
			<con:testStep name="Intialize Configurations" type="groovy">
				<con:settings/>
				<con:config>
					<script>FileUtils.InitializeNHINCProperties(context, log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Test Case Properties" type="properties">
				<con:settings/>
				<con:config createMissingOnLoad="true" discardValuesOnSave="true" saveFirst="true" xsi:type="con:PropertiesStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:source>C:/git/Product/SoapUI_Test/RegressionSuite/NhincPolicyEngineTest-soapui-project.properties</con:source>
					<con:properties>
						<con:property>
							<con:name>LocalHCID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>LocalAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>LocalHCDescription</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RemoteHCID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RemoteAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RemoteHCDescription</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NHINGatewayConfigDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NHINAdapterConfigDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>MPIDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>LocalConfigDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-SubjectDiscovery</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Reidentification</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-DocQuery</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-DocRetrieve</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Subscribe</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Notify</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Unsubscribe</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-AuditLogQuery</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SDPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RevokePatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PseudonymAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PseudonymPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RealAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RealPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DQDocID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DQPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DRDocID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NotificationEndpoint</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscribePatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NotifySubscriptionID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NotifySubscriptionManagerEndpointAddress</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>UnsubSubscriptionID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionManagerEndpointAddress</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>AQUserID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>AQPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>startDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>endDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>sigDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>expireDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>FullPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DRRepoID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBHost</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBPort</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBUser</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBPass</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PatientCorrelationDB</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PatientCorrelationTable</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionDB</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionTable</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionEndpoint</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>EntitySubscribe</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>MockHost</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NHINGatewayHost</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
					</con:properties>
				</con:config>
			</con:testStep>
			<con:testStep name="Backup gateway.properties file" type="groovy">
				<con:settings/>
				<con:config>
					<script>import java.io.File;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def NHINGatewayConfigDir = propertyList.getPropertyValue( "NHINGatewayConfigDir" );
def GatewayPropFile = NHINGatewayConfigDir + "/gateway.properties"
def GatewayPropFileBak = GatewayPropFile + ".bak";

File myFile = new File(GatewayPropFile);
if(myFile.exists())
{
    new File(GatewayPropFileBak).withWriter 
    { 
        file -> new File(GatewayPropFile).eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
}
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="get Dates" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

sdf = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
sdf.setTimeZone(TimeZone.getTimeZone("UTC"));

sdf2 = new java.text.SimpleDateFormat("MM/dd/yyyy' 'HH:mm:ss");
sdf2.setTimeZone(TimeZone.getTimeZone("UTC"));

Calendar cal = new GregorianCalendar();
nowDate = new Date();

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, -5);
startDate = cal.getTime();
startDateStr = sdf.format(startDate);
sigDateStr = sdf2.format(startDate);

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, 5);
endDate = cal.getTime();
endDateStr = sdf.format(endDate);

cal.setTime(nowDate);
cal.add(Calendar.DATE, 30);
expireDate = cal.getTime();
expireDateStr = sdf2.format(expireDate);

groovyUtils.setPropertyValue( "Test Case Properties", "startDate", startDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "endDate", endDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "sigDate", sigDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "expireDate", expireDateStr);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="ModifyInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
def NHINGatewayHost = dataSource.getPropertyValue("NHINGatewayHost");
def mockHost = dataSource.getPropertyValue("MockHost");
def mockPEURL = "http://" + mockHost + ":18088/mockPolicyEngine";
def InitiatingHCID = dataSource.getPropertyValue( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, InitiatingHCID, "policyengineservice", mockPEURL, context, log)</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>import groovy.sql.Sql;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def host = dataSource.getPropertyValue( "DBHost" );
def port = dataSource.getPropertyValue( "DBPort" );
def user = dataSource.getPropertyValue( "DBUser" );
def pass = dataSource.getPropertyValue( "DBPass" );
def db = dataSource.getPropertyValue( "SubscriptionDB" );
def table = dataSource.getPropertyValue( "SubscriptionTable" );

void clearTable(host, port, dbName, user, password, table) {

   def sqlConnect = 'jdbc:mysql://' + host + ':' + port + '/' + dbName;
   def sqlExecute = 'delete from ' + table;
   def sql = Sql.newInstance(sqlConnect, user, password, "com.mysql.jdbc.Driver");
   def result = sql.execute(sqlExecute);
   }

clearTable(host, port, db, user, pass, table);

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="set subscribe properties" type="transfer">
				<con:settings/>
				<con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>endpointTransfer</con:name>
						<con:sourceType>Endpoint-Subscribe</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:sourcePath xsi:nil="true"/>
						<con:targetType>Endpoint</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath/>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>signatureDate</con:name>
						<con:sourceType>sigDate</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath>declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace ns10='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//ns18:SubscribeRequest[1]/ns18:assertion[1]/ns10:dateOfSignature[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>expirationDate</con:name>
						<con:sourceType>expireDate</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath>declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace ns10='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//ns18:SubscribeRequest[1]/ns18:assertion[1]/ns10:expirationDate[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>notificationEndpoint</con:name>
						<con:sourceType>NotificationEndpoint</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath>declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace ns9='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns8='http://www.w3.org/2005/08/addressing';
//ns18:SubscribeRequest[1]/ns9:Subscribe[1]/ns9:ConsumerReference[1]/ns8:Address[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>orgHCName</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath>declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace ns10='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//ns18:SubscribeRequest[1]/ns18:assertion[1]/ns10:userInfo[1]/ns10:org[1]/ns10:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>orgHCID</con:name>
						<con:sourceType>RemoteHCID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath>declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace ns10='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//ns18:SubscribeRequest[1]/ns18:assertion[1]/ns10:userInfo[1]/ns10:org[1]/ns10:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>orgHCDescription</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath>declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace ns10='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//ns18:SubscribeRequest[1]/ns18:assertion[1]/ns10:userInfo[1]/ns10:org[1]/ns10:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>transferHCID</con:name>
						<con:sourceType>LocalHCID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:SubscribeRequest[1]/urn:nhinTargetSystem[1]/urn1:homeCommunity[1]/urn1:homeCommunityId[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>transferName</con:name>
						<con:sourceType>LocalHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:SubscribeRequest[1]/urn:nhinTargetSystem[1]/urn1:homeCommunity[1]/urn1:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>transferDescription</con:name>
						<con:sourceType>LocalHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Subscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:SubscribeRequest[1]/urn:nhinTargetSystem[1]/urn1:homeCommunity[1]/urn1:description[1]</con:targetPath>
					</con:transfers>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>NhincProxyNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request name="Subscribe">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>http://172.16.50.47:8080/NhinConnect/NhincProxyNotificationProducer</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>https://172.16.50.47:8181/CONNECTNhinServicesWeb/NhinService/NotificationConsumerService/HiemNotify</wsa:Address>
            </wsnt:ConsumerReference>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">SomeTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:org>
                  <nccommon:description>Walgreens</nccommon:description>
                  <nccommon:homeCommunityId>2.2</nccommon:homeCommunityId>
                  <nccommon:name>InternalTest2</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetSystem>
            <urn1:homeCommunity>
               <urn1:description>InternalTest1</urn1:description>
               <urn1:homeCommunityId>1.1</urn1:homeCommunityId>
               <urn1:name>InternalTest1</urn1:name>
            </urn1:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:assertion type="SOAP Response"/>
						<con:assertion name="Subscription ID" type="GroovyScriptAssertion">
							<con:configuration>
								<scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
holder.namespaces["ns3"] = "http://www.w3.org/2005/08/addressing"
holder.namespaces["ns4"] = "http://docs.oasis-open.org/wsn/b-2"
holder.namespaces["ns5"] = "urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc"
assert holder["//ns4:SubscribeResponse[1]/ns4:SubscriptionReference[1]/ns3:ReferenceParameters[1]/ns5:SubscriptionId[1]"] != null

								</scriptText>
							</con:configuration>
						</con:assertion>
						<con:assertion type="Schema Compliance">
							<con:configuration>
								<definition/>
							</con:configuration>
						</con:assertion>
						<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincproxysubscriptionmanagement/NhincProxyNotificationProducerPortType/SubscribeRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Policy Engine Mock" type="mockresponse">
				<con:settings/>
				<con:config startStep="Subscribe" xsi:type="con:MockResponseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>AdapterPolicyEngineBindingSoap</con:interface>
					<con:operation>CheckPolicy</con:operation>
					<con:path>/mockPolicyEngine</con:path>
					<con:port>18088</con:port>
					<con:timeout>60000</con:timeout>
					<con:response>
						<con:settings/>
						<con:responseContent><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:xacml:2.0:context:schema:os" xmlns:urn2="urn:oasis:names:tc:xacml:2.0:policy:schema:os">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:CheckPolicyResponse>
         <urn:response>
            <urn1:Result ResourceId="?">
               <urn1:Decision>Permit</urn1:Decision>
            </urn1:Result>
         </urn:response>
      </urn:CheckPolicyResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent>
						<con:wsaConfig mustUnderstand="NONE" version="200508"/>
					</con:response>
					<con:assertion type="XPath Match">
						<con:configuration>
							<path>declare namespace ns10='urn:oasis:names:tc:xacml:2.0:context:schema:os';
declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns18:CheckPolicyRequest[1]/ns18:request[1]/ns10:Action[1]/ns10:Attribute[1]/ns10:AttributeValue[1]</path>
							<content>HIEMSubscriptionRequestIn</content>
							<allowWildcards>false</allowWildcards>
							<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
						</con:configuration>
					</con:assertion>
				</con:config>
			</con:testStep>
			<con:testStep name="Restore gateway.properties file" type="groovy">
				<con:settings/>
				<con:config>
					<script>import java.io.File;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def NHINGatewayConfigDir = propertyList.getPropertyValue( "NHINGatewayConfigDir" );
def GatewayPropFile = NHINGatewayConfigDir + "/gateway.properties"
def GatewayPropFileBak = GatewayPropFile + ".bak";

File myFile = new File(GatewayPropFileBak);
if(myFile.exists())
{
    new File(GatewayPropFile).withWriter 
    { 
        file -> new File(GatewayPropFileBak).eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
    myFile.delete();
}
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions (1)" type="groovy">
				<con:settings/>
				<con:config>
					<script>import groovy.sql.Sql;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def host = dataSource.getPropertyValue( "DBHost" );
def port = dataSource.getPropertyValue( "DBPort" );
def user = dataSource.getPropertyValue( "DBUser" );
def pass = dataSource.getPropertyValue( "DBPass" );
def db = dataSource.getPropertyValue( "SubscriptionDB" );
def table = dataSource.getPropertyValue( "SubscriptionTable" );
def unsubSubscriptionID = dataSource.getPropertyValue( "UnsubSubscriptionID" );
def startDate = dataSource.getPropertyValue( "startDate" );

int countRows(host, port, dbName, user, password, table, unsubSubscriptionID, startDate) {

   def sqlConnect = 'jdbc:mysql://' + host + ':' + port + '/' + dbName;
   def sql = Sql.newInstance(sqlConnect, user, password, "com.mysql.jdbc.Driver");
   def count = 0;
   sql.eachRow("select count(*) from " + table) { row ->
	count = row[0];
   }
   return count;
}

def count = countRows(host, port, db, user, pass, table, unsubSubscriptionID, startDate);
assert count == 1;</script>
				</con:config>
			</con:testStep>
			<con:testStep name="RestoreInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
def NHINGatewayHost = dataSource.getPropertyValue("NHINGatewayHost");
def mockHost = dataSource.getPropertyValue("MockHost");
def PEURL = "http://" + NHINGatewayHost + ":8080/CONNECTAdapter/AdapterProxyService/AdapterPolicyEngine";
def InitiatingHCID = dataSource.getPropertyValue( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, InitiatingHCID, "policyengineservice", PEURL, context, log)
					</script>
				</con:config>
			</con:testStep>
			<con:properties/>
			<con:reportParameters/>
			<con:tearDownScript>FileUtils.restoreToMasterConfiguration(context, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase disabled="true" failOnError="true" failTestCaseOnErrors="true" id="6d6c3460-7f6b-41df-bde2-2b0abc5759a8" keepSession="false" maxResults="0" name="Notify" searchProperties="true">
			<con:settings/>
			<con:testStep name="Intialize Configurations" type="groovy">
				<con:settings/>
				<con:config>
					<script>FileUtils.InitializeNHINCProperties(context, log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep disabled="true" name="Test Case Properties" type="properties">
				<con:settings/>
				<con:config createMissingOnLoad="true" discardValuesOnSave="true" saveFirst="true" xsi:type="con:PropertiesStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:source>C:/git/Product/SoapUI_Test/RegressionSuite/NhincPolicyEngineTest-soapui-project.properties</con:source>
					<con:properties>
						<con:property>
							<con:name>LocalHCID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>LocalAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>LocalHCDescription</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RemoteHCID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RemoteAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RemoteHCDescription</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NHINGatewayConfigDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>MPIDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>LocalConfigDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-SubjectDiscovery</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Reidentification</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-DocQuery</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-DocRetrieve</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Subscribe</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Notify</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Unsubscribe</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-AuditLogQuery</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SDPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RevokePatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PseudonymAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PseudonymPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RealAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RealPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DQDocID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DQPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DRDocID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NotificationEndpoint</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscribePatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NotifySubscriptionID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NotifySubscriptionManagerEndpointAddress</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>UnsubSubscriptionID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionManagerEndpointAddress</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>AQUserID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>AQPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>startDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>endDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>sigDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>expireDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DRRepoID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBHost</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBPort</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBUser</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBPass</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PatientCorrelationDB</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PatientCorrelationTable</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionDB</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionTable</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionEndpoint</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>EntitySubscribe</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>MockHost</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NHINGatewayHost</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
					</con:properties>
				</con:config>
			</con:testStep>
			<con:testStep name="get Dates" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

sdf = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
sdf.setTimeZone(TimeZone.getTimeZone("UTC"));

sdf2 = new java.text.SimpleDateFormat("MM/dd/yyyy' 'HH:mm:ss");
sdf2.setTimeZone(TimeZone.getTimeZone("UTC"));

Calendar cal = new GregorianCalendar();
nowDate = new Date();

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, -5);
startDate = cal.getTime();
startDateStr = sdf.format(startDate);
sigDateStr = sdf2.format(startDate);

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, 5);
endDate = cal.getTime();
endDateStr = sdf.format(endDate);

cal.setTime(nowDate);
cal.add(Calendar.DATE, 30);
expireDate = cal.getTime();
expireDateStr = sdf2.format(expireDate);

groovyUtils.setPropertyValue( "Test Case Properties", "startDate", startDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "endDate", endDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "sigDate", sigDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "expireDate", expireDateStr);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="ModifyInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
def NHINGatewayHost = dataSource.getPropertyValue("NHINGatewayHost");
def mockHost = dataSource.getPropertyValue("MockHost");
def mockPEURL = "http://" + mockHost + ":18088/mockPolicyEngine";
def InitiatingHCID = dataSource.getPropertyValue( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, InitiatingHCID, "policyengineservice", mockPEURL, context, log)</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>import groovy.sql.Sql;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def host = dataSource.getPropertyValue( "DBHost" );
def port = dataSource.getPropertyValue( "DBPort" );
def user = dataSource.getPropertyValue( "DBUser" );
def pass = dataSource.getPropertyValue( "DBPass" );
def db = dataSource.getPropertyValue( "SubscriptionDB" );
def table = dataSource.getPropertyValue( "SubscriptionTable" );

void clearTable(host, port, dbName, user, password, table) {

   def sqlConnect = 'jdbc:mysql://' + host + ':' + port + '/' + dbName;
   def sqlExecute = 'delete from ' + table;
   def sql = Sql.newInstance(sqlConnect, user, password, "com.mysql.jdbc.Driver");
   def result = sql.execute(sqlExecute);
   }

clearTable(host, port, db, user, pass, table);

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="get subscription ID" type="groovy">
				<con:settings/>
				<con:config>
					<script>import groovy.sql.Sql;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def host = dataSource.getPropertyValue( "DBHost" );
def port = dataSource.getPropertyValue( "DBPort" );
def user = dataSource.getPropertyValue( "DBUser" );
def pass = dataSource.getPropertyValue( "DBPass" );
def db = dataSource.getPropertyValue( "SubscriptionDB" );
def table = dataSource.getPropertyValue( "SubscriptionTable" );

String runSQL(host, port, dbName, user, password, table) {

   def sqlConnect = 'jdbc:mysql://' + host + ':' + port + '/' + dbName;
   def sqlExecute = "select Subscriptionid from " + dbName + "." + table + " where Consumer = 'gateway' and Producer = 'nhin'";
   def sql = Sql.newInstance(sqlConnect, user, password, "com.mysql.jdbc.Driver");
   def result = sql.firstRow(sqlExecute);
   return result.Subscriptionid;
   }

def subscriptionID = runSQL(host, port, db, user, pass, table);
groovyUtils.setPropertyValue( "Test Case Properties", "NotifySubscriptionID", subscriptionID);
log.info subscriptionID;</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions (>0)" type="groovy">
				<con:settings/>
				<con:config>
					<script>import groovy.sql.Sql;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def host = dataSource.getPropertyValue( "DBHost" );
def port = dataSource.getPropertyValue( "DBPort" );
def user = dataSource.getPropertyValue( "DBUser" );
def pass = dataSource.getPropertyValue( "DBPass" );
def db = dataSource.getPropertyValue( "SubscriptionDB" );
def table = dataSource.getPropertyValue( "SubscriptionTable" );
def unsubSubscriptionID = dataSource.getPropertyValue( "UnsubSubscriptionID" );
def startDate = dataSource.getPropertyValue( "startDate" );

int countRows(host, port, dbName, user, password, table, unsubSubscriptionID, startDate) {

   def sqlConnect = 'jdbc:mysql://' + host + ':' + port + '/' + dbName;
   def sql = Sql.newInstance(sqlConnect, user, password, "com.mysql.jdbc.Driver");
   def count = 0;
   sql.eachRow("select count(*) from " + table) { row ->
	count = row[0];
   }
   return count;
}

def count = countRows(host, port, db, user, pass, table, unsubSubscriptionID, startDate);
assert count > 0;</script>
				</con:config>
			</con:testStep>
			<con:testStep name="set notify properties" type="transfer">
				<con:settings/>
				<con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>endpointTransfer</con:name>
						<con:sourceType>Endpoint-Notify</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:sourcePath xsi:nil="true"/>
						<con:targetType>Endpoint</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath/>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>signatureDate</con:name>
						<con:sourceType>sigDate</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:assertion[1]/urn1:dateOfSignature[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>expirationDate</con:name>
						<con:sourceType>expireDate</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:assertion[1]/urn1:expirationDate[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>assertionHCID</con:name>
						<con:sourceType>RemoteHCID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:assertion[1]/urn1:homeCommunity[1]/urn1:homeCommunityId[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>assertionHCName</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:assertion[1]/urn1:homeCommunity[1]/urn1:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>assertionHCDescription</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:assertion[1]/urn1:homeCommunity[1]/urn1:description[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>orgHCID</con:name>
						<con:sourceType>RemoteHCID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:assertion[1]/urn1:userInfo[1]/urn1:org[1]/urn1:homeCommunityId[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>orgHCName</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:assertion[1]/urn1:userInfo[1]/urn1:org[1]/urn1:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>orgHCDescription</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:assertion[1]/urn1:userInfo[1]/urn1:org[1]/urn1:description[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>subscriptionId</con:name>
						<con:sourceType>NotifySubscriptionID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:sourcePath/>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace b='http://docs.oasis-open.org/wsn/b-2';
declare namespace wsa='http://www.w3.org/2005/08/addressing';
declare namespace nhin='http://www.hhs.gov/healthit/nhin';
//urn:NotifyRequest[1]/b:Notify[1]/b:NotificationMessage[1]/b:SubscriptionReference[1]/wsa:ReferenceParameters[1]/nhin:SubscriptionId[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>targetHCID</con:name>
						<con:sourceType>LocalHCID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:nhinTargetSystem[1]/urn1:homeCommunity[1]/urn1:homeCommunityId[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>targetName</con:name>
						<con:sourceType>LocalHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:nhinTargetSystem[1]/urn1:homeCommunity[1]/urn1:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>targetDescription</con:name>
						<con:sourceType>LocalHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Notify</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn1='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:NotifyRequest[1]/urn:nhinTargetSystem[1]/urn1:homeCommunity[1]/urn1:description[1]</con:targetPath>
					</con:transfers>
				</con:config>
			</con:testStep>
			<con:testStep name="Notify" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>NhincProxyNotificationConsumerBindingSoap</con:interface>
					<con:operation>Notify</con:operation>
					<con:request name="Notify">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>http://172.16.50.47:8080/NhinConnect/NhincProxyNotificationConsumer</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:b="http://docs.oasis-open.org/wsn/b-2" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:NotifyRequest>
         <b:Notify>
            <b:NotificationMessage>
               <b:Topic Dialect="http://doc.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="urn:nhin">nhin:SampleTopic</b:Topic>
               <b:Message>
                  <ihe:RetrieveDocumentSetRequest xmlns:ihe="urn:ihe:iti:xds-b:2007">
                     <ihe:DocumentRequest>
                        <ihe:HomeCommunityId>2.16.840.1.113883.3.198</ihe:HomeCommunityId>
                        <ihe:RepositoryUniqueId>1</ihe:RepositoryUniqueId>
                        <ihe:DocumentUniqueId>333333333</ihe:DocumentUniqueId>
                     </ihe:DocumentRequest>
                  </ihe:RetrieveDocumentSetRequest>
               </b:Message>
               <b:SubscriptionReference xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2">
                  <wsa:Address>https://mhsnhie3.fedsconnect.org:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe</wsa:Address>
                  <wsa:ReferenceParameters>
                     <nhin:SubscriptionId xmlns:nhin="http://www.hhs.gov/healthit/nhin">2dcb1a12-0bd8-44ce-93cd-345e78bbd18f</nhin:SubscriptionId>
                  </wsa:ReferenceParameters>
               </b:SubscriptionReference>
            </b:NotificationMessage>
         </b:Notify>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>InternalTest2</nccommon:description>
               <nccommon:homeCommunityId>2.2</nccommon:homeCommunityId>
               <nccommon:name>InternalTest2</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:org>
                  <nccommon:description>InternalTest2</nccommon:description>
                  <nccommon:homeCommunityId>2.2</nccommon:homeCommunityId>
                  <nccommon:name>InternalTest2</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetSystem>
            <urn1:homeCommunity>
               <urn1:description>InternalTest1</urn1:description>
               <urn1:homeCommunityId>1.1</urn1:homeCommunityId>
               <urn1:name>InternalTest1</urn1:name>
            </urn1:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:NotifyRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincproxynotificationconsumer/NhincProxyNotificationConsumerPortType/NotifyRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Policy Engine Mock" type="mockresponse">
				<con:settings/>
				<con:config startStep="Notify" xsi:type="con:MockResponseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>AdapterPolicyEngineBindingSoap</con:interface>
					<con:operation>CheckPolicy</con:operation>
					<con:path>/mockPolicyEngine</con:path>
					<con:port>18088</con:port>
					<con:timeout>60000</con:timeout>
					<con:response>
						<con:settings/>
						<con:responseContent><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:xacml:2.0:context:schema:os" xmlns:urn2="urn:oasis:names:tc:xacml:2.0:policy:schema:os">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:CheckPolicyResponse>
         <urn:response>
            <urn1:Result ResourceId="?">
               <urn1:Decision>Permit</urn1:Decision>
            </urn1:Result>
         </urn:response>
      </urn:CheckPolicyResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent>
						<con:wsaConfig mustUnderstand="NONE" version="200508"/>
					</con:response>
					<con:assertion type="XPath Match">
						<con:configuration>
							<path>declare namespace ns10='urn:oasis:names:tc:xacml:2.0:context:schema:os';
declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns18:CheckPolicyRequest[1]/ns18:request[1]/ns10:Action[1]/ns10:Attribute[1]/ns10:AttributeValue[1]</path>
							<content>HIEMNotifyIn</content>
							<allowWildcards>false</allowWildcards>
							<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
						</con:configuration>
					</con:assertion>
				</con:config>
			</con:testStep>
			<con:testStep name="RestoreInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
def NHINGatewayHost = dataSource.getPropertyValue("NHINGatewayHost");
def mockHost = dataSource.getPropertyValue("MockHost");
def PEURL = "http://" + NHINGatewayHost + ":8080/CONNECTAdapter/AdapterProxyService/AdapterPolicyEngine";
def InitiatingHCID = dataSource.getPropertyValue( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, InitiatingHCID, "policyengineservice", PEURL, context, log)
					</script>
				</con:config>
			</con:testStep>
			<con:properties/>
			<con:reportParameters/>
			<con:tearDownScript>FileUtils.restoreToMasterConfiguration(context, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase disabled="true" failOnError="true" failTestCaseOnErrors="true" id="178c59bc-a668-4c27-9844-e1c5d1c34333" keepSession="false" maxResults="0" name="Unsubscribe" searchProperties="true">
			<con:settings/>
			<con:testStep name="Intialize Configurations" type="groovy">
				<con:settings/>
				<con:config>
					<script>FileUtils.InitializeNHINCProperties(context, log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Test Case Properties" type="properties">
				<con:settings/>
				<con:config createMissingOnLoad="true" discardValuesOnSave="true" saveFirst="true" xsi:type="con:PropertiesStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:source>C:/git/Product/SoapUI_Test/RegressionSuite/NhincPolicyEngineTest-soapui-project.properties</con:source>
					<con:properties>
						<con:property>
							<con:name>LocalHCID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>LocalAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>LocalHCDescription</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RemoteHCID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RemoteAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RemoteHCDescription</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NHINGatewayConfigDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NHINAdapterConfigDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>MPIDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>LocalConfigDir</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-SubjectDiscovery</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Reidentification</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-DocQuery</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-DocRetrieve</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Subscribe</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Notify</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-Unsubscribe</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>Endpoint-AuditLogQuery</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SDPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RevokePatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PseudonymAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PseudonymPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RealAA</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>RealPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DQDocID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DQPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DRDocID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NotificationEndpoint</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscribePatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NotifySubscriptionID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NotifySubscriptionManagerEndpointAddress</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>UnsubSubscriptionID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionManagerEndpointAddress</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>AQUserID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>AQPatientID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>startDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>endDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>sigDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>expireDate</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DRRepoID</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBHost</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBPort</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBUser</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>DBPass</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PatientCorrelationDB</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>PatientCorrelationTable</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionDB</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionTable</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>SubscriptionEndpoint</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>EntitySubscribe</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>MockHost</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
						<con:property>
							<con:name>NHINGatewayHost</con:name>
							<con:value xsi:nil="true"/>
						</con:property>
					</con:properties>
				</con:config>
			</con:testStep>
			<con:testStep name="Backup gateway.properties file" type="groovy">
				<con:settings/>
				<con:config>
					<script>import java.io.File;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def NHINGatewayConfigDir = propertyList.getPropertyValue( "NHINGatewayConfigDir" );
def GatewayPropFile = NHINGatewayConfigDir + "/gateway.properties"
def GatewayPropFileBak = GatewayPropFile + ".bak";

File myFile = new File(GatewayPropFile);
if(myFile.exists())
{
    new File(GatewayPropFileBak).withWriter 
    { 
        file -> new File(GatewayPropFile).eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
}
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="get Dates" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

sdf = new java.text.SimpleDateFormat("yyyy-MM-dd' 'HH:mm:ss");

sdf2 = new java.text.SimpleDateFormat("MM/dd/yyyy' 'HH:mm:ss");
sdf2.setTimeZone(TimeZone.getTimeZone("UTC"));

Calendar cal = new GregorianCalendar();
nowDate = new Date();

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, -5);
startDate = cal.getTime();
startDateStr = sdf.format(startDate);
sigDateStr = sdf2.format(startDate);

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, 5);
endDate = cal.getTime();
endDateStr = sdf.format(endDate);

cal.setTime(nowDate);
cal.add(Calendar.DATE, 30);
expireDate = cal.getTime();
expireDateStr = sdf2.format(expireDate);

groovyUtils.setPropertyValue( "Test Case Properties", "startDate", startDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "endDate", endDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "sigDate", sigDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "expireDate", expireDateStr);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="ModifyInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
def NHINGatewayHost = dataSource.getPropertyValue("NHINGatewayHost");
def mockHost = dataSource.getPropertyValue("MockHost");
def mockPEURL = "http://" + mockHost + ":18088/mockPolicyEngine";
def InitiatingHCID = dataSource.getPropertyValue( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, InitiatingHCID, "policyengineservice", mockPEURL, context, log)</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table &amp; Add Sub" type="groovy">
				<con:settings/>
				<con:config>
					<script>import groovy.sql.Sql;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def host = dataSource.getPropertyValue( "DBHost" );
def port = dataSource.getPropertyValue( "DBPort" );
def user = dataSource.getPropertyValue( "DBUser" );
def pass = dataSource.getPropertyValue( "DBPass" );
def db = dataSource.getPropertyValue( "SubscriptionDB" );
def table = dataSource.getPropertyValue( "SubscriptionTable" );
def unsubSubscriptionID = dataSource.getPropertyValue( "UnsubSubscriptionID" );
def startDate = dataSource.getPropertyValue( "startDate" );

void clearTable(host, port, dbName, user, password, table) {

   def sqlConnect = 'jdbc:mysql://' + host + ':' + port + '/' + dbName;
   def sqlExecute = 'delete from ' + table;
   def sql = Sql.newInstance(sqlConnect, user, password, "com.mysql.jdbc.Driver");
   def result = sql.execute(sqlExecute);
   }

void runSQL(host, port, dbName, user, password, table, unsubSubscriptionID, startDate) {

   def sqlConnect = 'jdbc:mysql://' + host + ':' + port + '/' + dbName;
   def sqlExecute = 'insert into ' + dbName + '.' + table + ' (id, Subscriptionid, RootTopic, Consumer, Producer, CreationDate) values (1, "' + 
     unsubSubscriptionID + '", "SomeTopic", "nhin", "gateway", "' + startDate + '")';
   def sql = Sql.newInstance(sqlConnect, user, password, "com.mysql.jdbc.Driver");
   def result = sql.execute(sqlExecute);
   }

clearTable(host, port, db, user, pass, table);
runSQL(host, port, db, user, pass, table, unsubSubscriptionID, startDate);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions (1)" type="groovy">
				<con:settings/>
				<con:config>
					<script>import groovy.sql.Sql;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def host = dataSource.getPropertyValue( "DBHost" );
def port = dataSource.getPropertyValue( "DBPort" );
def user = dataSource.getPropertyValue( "DBUser" );
def pass = dataSource.getPropertyValue( "DBPass" );
def db = dataSource.getPropertyValue( "SubscriptionDB" );
def table = dataSource.getPropertyValue( "SubscriptionTable" );
def unsubSubscriptionID = dataSource.getPropertyValue( "UnsubSubscriptionID" );
def startDate = dataSource.getPropertyValue( "startDate" );

int countRows(host, port, dbName, user, password, table, unsubSubscriptionID, startDate) {

   def sqlConnect = 'jdbc:mysql://' + host + ':' + port + '/' + dbName;
   def sql = Sql.newInstance(sqlConnect, user, password, "com.mysql.jdbc.Driver");
   def count = 0;
   sql.eachRow("select count(*) from " + table) { row ->
	count = row[0];
   }
   return count;
}

def count = countRows(host, port, db, user, pass, table, unsubSubscriptionID, startDate);
assert count == 1;</script>
				</con:config>
			</con:testStep>
			<con:testStep name="set unsubscribe properties" type="transfer">
				<con:settings/>
				<con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>endpointTransfer</con:name>
						<con:sourceType>Endpoint-Unsubscribe</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:sourcePath xsi:nil="true"/>
						<con:targetType>Endpoint</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath/>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>subscriptionID</con:name>
						<con:sourceType>UnsubSubscriptionID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace ns5='http://www.hhs.gov/healthit/nhin';
//ns5:SubscriptionId[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>signatureDate</con:name>
						<con:sourceType>sigDate</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:assertion[1]/urn2:dateOfSignature[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>expirationDate</con:name>
						<con:sourceType>expireDate</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:assertion[1]/urn2:expirationDate[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>assertionHCID</con:name>
						<con:sourceType>RemoteHCID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:assertion[1]/urn2:homeCommunity[1]/urn2:homeCommunityId[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>assertionHCName</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:assertion[1]/urn2:homeCommunity[1]/urn2:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>assertionHCDescription</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:assertion[1]/urn2:homeCommunity[1]/urn2:description[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>orgHCID</con:name>
						<con:sourceType>RemoteHCID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:assertion[1]/urn2:userInfo[1]/urn2:org[1]/urn2:homeCommunityId[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>orgHCName</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:assertion[1]/urn2:userInfo[1]/urn2:org[1]/urn2:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers entitize="false" failOnError="true" ignoreEmpty="false" setNullOnMissingSource="true" transferChildNodes="false" transferTextContent="true" transferToAll="false" useXQuery="false">
						<con:name>orgHCDescription</con:name>
						<con:sourceType>RemoteHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:assertion[1]/urn2:userInfo[1]/urn2:org[1]/urn2:description[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>targetHCID</con:name>
						<con:sourceType>LocalHCID</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:nhinTargetSystem[1]/urn2:homeCommunity[1]/urn2:homeCommunityId[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>targetName</con:name>
						<con:sourceType>LocalHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:nhinTargetSystem[1]/urn2:homeCommunity[1]/urn2:name[1]</con:targetPath>
					</con:transfers>
					<con:transfers failOnError="true" setNullOnMissingSource="true" transferTextContent="true">
						<con:name>targetDescription</con:name>
						<con:sourceType>LocalHCDescription</con:sourceType>
						<con:sourceStep>Test Case Properties</con:sourceStep>
						<con:targetType>Request</con:targetType>
						<con:targetStep>Unsubscribe</con:targetStep>
						<con:targetPath>declare namespace urn='urn:gov:hhs:fha:nhinc:common:nhinccommonproxy';
declare namespace urn2='urn:gov:hhs:fha:nhinc:common:nhinccommon';
//urn:UnsubscribeRequest[1]/urn:nhinTargetSystem[1]/urn2:homeCommunity[1]/urn2:description[1]</con:targetPath>
					</con:transfers>
				</con:config>
			</con:testStep>
			<con:testStep name="Unsubscribe" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>NhincProxySubscriptionManagerBindingSoap</con:interface>
					<con:operation>Unsubscribe</con:operation>
					<con:request name="Unsubscribe">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>http://172.16.50.47:8080/NhinConnect/NhincProxySubscriptionManager</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:nhin="http://www.hhs.gov/healthit/nhin" xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:subscription" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header>
      <ns5:SubscriptionId xmlns="http://www.w3.org/2005/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/b-2" xmlns:ns3="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns4="http://docs.oasis-open.org/wsn/t-1" xmlns:ns5="http://www.hhs.gov/healthit/nhin">3e74139f-5271-4db1-98c0-88748fa3e4e3</ns5:SubscriptionId>
      <nhinconnect:Info xmlns:nhinconnect="urn:nhinconnect">hello world</nhinconnect:Info>
   </soapenv:Header>
   <soapenv:Body>
      <urn:UnsubscribeRequest>
         <wsnt:Unsubscribe xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2">
            <nhinconnect:Info xmlns:nhinconnect="urn:nhinconnect">just some data</nhinconnect:Info>
         </wsnt:Unsubscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>InternalTest2</nccommon:description>
               <nccommon:homeCommunityId>2.2</nccommon:homeCommunityId>
               <nccommon:name>InternalTest2</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:org>
                  <nccommon:description>InternalTest2</nccommon:description>
                  <nccommon:homeCommunityId>2.2</nccommon:homeCommunityId>
                  <nccommon:name>InternalTest2</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetSystem>
            <urn2:homeCommunity>
               <urn2:description>InternalTest1</urn2:description>
               <urn2:homeCommunityId>1.1</urn2:homeCommunityId>
               <urn2:name>InternalTest1</urn2:name>
            </urn2:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:UnsubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:wsaConfig mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Policy Engine Mock" type="mockresponse">
				<con:settings/>
				<con:config startStep="Unsubscribe" xsi:type="con:MockResponseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>AdapterPolicyEngineBindingSoap</con:interface>
					<con:operation>CheckPolicy</con:operation>
					<con:path>/mockPolicyEngine</con:path>
					<con:port>18088</con:port>
					<con:timeout>60000</con:timeout>
					<con:response>
						<con:settings/>
						<con:responseContent><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:xacml:2.0:context:schema:os" xmlns:urn2="urn:oasis:names:tc:xacml:2.0:policy:schema:os">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:CheckPolicyResponse>
         <urn:response>
            <urn1:Result ResourceId="?">
               <urn1:Decision>Permit</urn1:Decision>
            </urn1:Result>
         </urn:response>
      </urn:CheckPolicyResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent>
						<con:wsaConfig mustUnderstand="NONE" version="200508"/>
					</con:response>
					<con:assertion type="XPath Match">
						<con:configuration>
							<path>declare namespace ns10='urn:oasis:names:tc:xacml:2.0:context:schema:os';
declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns18:CheckPolicyRequest[1]/ns18:request[1]/ns10:Action[1]/ns10:Attribute[1]/ns10:AttributeValue[1]</path>
							<content>HIEMNotifyIn</content>
							<allowWildcards>false</allowWildcards>
							<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
						</con:configuration>
					</con:assertion>
				</con:config>
			</con:testStep>
			<con:testStep name="Restore gateway.properties file" type="groovy">
				<con:settings/>
				<con:config>
					<script>import java.io.File;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def NHINGatewayConfigDir = propertyList.getPropertyValue( "NHINGatewayConfigDir" );
def GatewayPropFile = NHINGatewayConfigDir + "/gateway.properties"
def GatewayPropFileBak = GatewayPropFile + ".bak";

File myFile = new File(GatewayPropFileBak);
if(myFile.exists())
{
    new File(GatewayPropFile).withWriter 
    { 
        file -> new File(GatewayPropFileBak).eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
    myFile.delete();
}
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions (0)" type="groovy">
				<con:settings/>
				<con:config>
					<script>import groovy.sql.Sql;

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def host = dataSource.getPropertyValue( "DBHost" );
def port = dataSource.getPropertyValue( "DBPort" );
def user = dataSource.getPropertyValue( "DBUser" );
def pass = dataSource.getPropertyValue( "DBPass" );
def db = dataSource.getPropertyValue( "SubscriptionDB" );
def table = dataSource.getPropertyValue( "SubscriptionTable" );
def unsubSubscriptionID = dataSource.getPropertyValue( "UnsubSubscriptionID" );
def startDate = dataSource.getPropertyValue( "startDate" );

int countRows(host, port, dbName, user, password, table, unsubSubscriptionID, startDate) {

   def sqlConnect = 'jdbc:mysql://' + host + ':' + port + '/' + dbName;
   def sql = Sql.newInstance(sqlConnect, user, password, "com.mysql.jdbc.Driver");
   def count = 0;
   sql.eachRow("select count(*) from " + table) { row ->
	count = row[0];
   }
   return count;
}

def count = countRows(host, port, db, user, pass, table, unsubSubscriptionID, startDate);
assert count == 0;</script>
				</con:config>
			</con:testStep>
			<con:testStep name="RestoreInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config>
					<script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
def NHINGatewayHost = dataSource.getPropertyValue("NHINGatewayHost");
def mockHost = dataSource.getPropertyValue("MockHost");
def PEURL = "http://" + NHINGatewayHost + ":8080/CONNECTAdapter/AdapterProxyService/AdapterPolicyEngine";
def InitiatingHCID = dataSource.getPropertyValue( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, InitiatingHCID, "policyengineservice", PEURL, context, log)
					</script>
				</con:config>
			</con:testStep>
			<con:properties/>
			<con:reportParameters/>
			<con:tearDownScript>FileUtils.restoreToMasterConfiguration(context, log);</con:tearDownScript>
		</con:testCase>
		
		<con:properties/>
		<con:setupScript/>
		<con:reportParameters/>
	</con:testSuite>
	<con:requirements/>
	<con:properties>
		<con:property>
			<con:name>Endpoint-DocQuery</con:name>
			<con:value>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/NhincProxyDocQueryUnsecured</con:value>
		</con:property>
		<con:property>
			<con:name>MockHost</con:name>
			<con:value>localhost</con:value>
		</con:property>
		<con:property>
			<con:name>LocalHCID</con:name>
			<con:value>1.1</con:value>
		</con:property>
		<con:property>
			<con:name>NHINGatewayHost</con:name>
			<con:value>localhost</con:value>
		</con:property>
		<con:property>
			<con:name>RealAA</con:name>
			<con:value>1.1.1</con:value>
		</con:property>
		<con:property>
			<con:name>DQPatientID</con:name>
			<con:value>D123401</con:value>
		</con:property>
		<con:property>
			<con:name>NHINGatewayConfigDir</con:name>
			<con:value>C:/Sun/AppServer/domains/domain1/config/nhin</con:value>
		</con:property>
		<con:property>
			<con:name>SubscribePatientID</con:name>
			<con:value>D123401</con:value>
		</con:property>
		<con:property>
			<con:name>SubscriptionDB</con:name>
			<con:value>subscriptionrepository</con:value>
		</con:property>
		<con:property>
			<con:name>RemoteHCID</con:name>
			<con:value>2.2</con:value>
		</con:property>
		<con:property>
			<con:name>RealPatientID</con:name>
			<con:value>D1234010050</con:value>
		</con:property>
		<con:property>
			<con:name>AQUserID</con:name>
			<con:value>kskagerb</con:value>
		</con:property>
		<con:property>
			<con:name>DBUser</con:name>
			<con:value>nhincuser</con:value>
		</con:property>
		<con:property>
			<con:name>DRDocID</con:name>
			<con:value>1.123401.11111</con:value>
		</con:property>
		<con:property>
			<con:name>SubscriptionTable</con:name>
			<con:value>subscription</con:value>
		</con:property>
		<con:property>
			<con:name>MPIDir</con:name>
			<con:value>C:/Sun/AppServer/domains/domain1/config</con:value>
		</con:property>
		<con:property>
			<con:name>PseudonymPatientID</con:name>
			<con:value>PSEUDO001</con:value>
		</con:property>
		<con:property>
			<con:name>SubscriptionManagerEndpointAddress</con:name>
			<con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value>
		</con:property>
		<con:property>
			<con:name>NotificationEndpoint</con:name>
			<con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/NotificationConsumerService/HiemNotify</con:value>
		</con:property>
		<con:property>
			<con:name>RemoteAA</con:name>
			<con:value>2.2</con:value>
		</con:property>
		<con:property>
			<con:name>DBPort</con:name>
			<con:value>3306</con:value>
		</con:property>
		<con:property>
			<con:name>NotifySubscriptionID</con:name>
			<con:value>-f7c1a5d:1204e50e42e:-79eb</con:value>
		</con:property>
		<con:property>
			<con:name>PseudonymAA</con:name>
			<con:value>ABC</con:value>
		</con:property>
		<con:property>
			<con:name>PatientCorrelationDB</con:name>
			<con:value>patientcorrelationdb</con:value>
		</con:property>
		<con:property>
			<con:name>RemoteHCDescription</con:name>
			<con:value>InternalTest2</con:value>
		</con:property>
		<con:property>
			<con:name>Endpoint-DocRetrieve</con:name>
			<con:value>http://localhost:8080/Gateway/DocumentRetrieve/2_0/NhincProxyDocRetrieveUnsecured</con:value>
		</con:property>
		<con:property>
			<con:name>LocalConfigDir</con:name>
			<con:value>C:/SelfTest/InternalSelfTest</con:value>
		</con:property>
		<con:property>
			<con:name>EntitySubscribe</con:name>
			<con:value>http://localhost:8080/NhinConnect/EntityNotificationProducer</con:value>
		</con:property>
		<con:property>
			<con:name>Endpoint-Unsubscribe</con:name>
			<con:value>http://localhost:8080/CONNECTAdapter/NhincProxySubscriptionManager</con:value>
		</con:property>
		<con:property>
			<con:name>LocalAA</con:name>
			<con:value>1.1</con:value>
		</con:property>
		<con:property>
			<con:name>DRRepoID</con:name>
			<con:value>1</con:value>
		</con:property>
		<con:property>
			<con:name>Endpoint-SubjectDiscovery</con:name>
			<con:value>http://localhost:8080/CONNECTAdapter/NhincProxySubjectDiscovery</con:value>
		</con:property>
		<con:property>
			<con:name>UnsubSubscriptionID</con:name>
			<con:value>3e74139f-5271-4db1-98c0-88748fa3e4e3</con:value>
		</con:property>
		<con:property>
			<con:name>DBPass</con:name>
			<con:value>nhincpass</con:value>
		</con:property>
		<con:property>
			<con:name>AQPatientID</con:name>
			<con:value>D123401</con:value>
		</con:property>
		<con:property>
			<con:name>LocalHCDescription</con:name>
			<con:value>InternalTest1</con:value>
		</con:property>
		<con:property>
			<con:name>Endpoint-Reidentification</con:name>
			<con:value>http://localhost:8080/CONNECTAdapter/NhincProxySubjectDiscovery</con:value>
		</con:property>
		<con:property>
			<con:name>PatientCorrelationTable</con:name>
			<con:value>correlatedidentifiers</con:value>
		</con:property>
		<con:property>
			<con:name>DQDocID</con:name>
			<con:value>1.123401.11111</con:value>
		</con:property>
		<con:property>
			<con:name>Endpoint-AuditLogQuery</con:name>
			<con:value>http://localhost:8080/CONNECTAdapter/NhincProxyAuditQuery</con:value>
		</con:property>
		<con:property>
			<con:name>DBHost</con:name>
			<con:value>localhost</con:value>
		</con:property>
		<con:property>
			<con:name>NotifySubscriptionManagerEndpointAddress</con:name>
			<con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value>
		</con:property>
		<con:property>
			<con:name>SubscriptionEndpoint</con:name>
			<con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/NotificationProducerService/HiemSubscription</con:value>
		</con:property>
		<con:property>
			<con:name>Endpoint-Subscribe</con:name>
			<con:value>http://localhost:8080/CONNECTAdapter/NhincProxyNotificationProducer</con:value>
		</con:property>
		<con:property>
			<con:name>Endpoint-Notify</con:name>
			<con:value>http://localhost:8080/CONNECTAdapter/NhincProxyNotificationConsumer</con:value>
		</con:property>
	<con:property><con:name>GatewayPropDIr</con:name><con:value>c:\glassfish3\glassfish\domains\domain1\config\nhin</con:value></con:property></con:properties>
	<con:afterLoadScript>def propertiesFilename = project.path[0..(project.path.size()-4)] + 'properties'
def propertiesFile = new File(propertiesFilename)
if (propertiesFile.exists()) {
	def props = new Properties()
	props.load(new FileReader(propertiesFile))
	props.each { key, value ->
	    project.setPropertyValue(key, value)
	}
}


TimeZone.setDefault(TimeZone.getTimeZone("UTC"))
def testRunListener = [
  afterRun: { testRunner, runContext -> },
  afterStep: { testRunner, runContext, result -> },
  beforeStep: { testRunner, runContext -> },
  beforeStep: { testRunner, runContext, testStep -> },
  beforeRun: { testRunner, runContext -> 
    use (org.codehaus.groovy.runtime.TimeCategory) {
      def startDate = 5.minutes.ago
      def endDate = 5.minutes.from.now
      def expireDate = 30.days.from.now

      def df = "yyyy-MM-dd'T'HH:mm:ss'Z'"
      def dfSig = "MM/dd/yyyy' 'HH:mm:ss"

      runContext.testCase.setPropertyValue("startDate", startDate.format(df))
      runContext.testCase.setPropertyValue("endDate", endDate.format(df))
      runContext.testCase.setPropertyValue("sigDate", startDate.format(dfSig))
      runContext.testCase.setPropertyValue("expireDate", expireDate.format(df))
    }
  }   
] as com.eviware.soapui.model.testsuite.TestRunListener

project.testSuiteList*.testCaseList.flatten()*.addTestRunListener(testRunListener)



com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.findProperty = { propertyName ->
    return delegate.getProperty(propertyName) ?:
                delegate.testCase.getPropertyValue(propertyName) ?:
                delegate.testCase.testSuite.getPropertyValue(propertyName) ?:
                delegate.testCase.testSuite.project.getPropertyValue(propertyName)
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.withSql = { dbOrPropertyName, block ->
  def dbName = delegate.findProperty(dbOrPropertyName) ?: dbOrPropertyName
  def host = delegate.findProperty('DBHost')
  def port = delegate.findProperty('DBPort')
  def user = delegate.findProperty('DBUser')
  def pass = delegate.findProperty('DBPass')

  def connectString = "jdbc:mysql://${host}:${port}/${dbName}"
  def sql = groovy.sql.Sql.newInstance(connectString, user, pass, "com.mysql.jdbc.Driver");
  try {
     block(sql)
  } finally {
    sql.close()
  }
}
	</con:afterLoadScript>
	<con:wssContainer/>
	<con:databaseConnectionContainer/>
	<con:reporting>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:parameters/>
	</con:reporting>

</con:soapui-project>