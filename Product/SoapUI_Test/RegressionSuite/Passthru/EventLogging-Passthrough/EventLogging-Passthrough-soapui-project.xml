<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project activeEnvironment="Default" name="EventLogging-Passthrough" resourceRoot="${projectDir}" soapui-version="5.3.0" abortOnError="false" runType="SEQUENTIAL" id="f1e5061e-e51b-49d4-99dd-230008424227" xmlns:con="http://eviware.com/soapui/config">
    <con:description>This test is designed to run in loopback mode.</con:description><con:settings/>
    <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entityadmindistribution}AdministrativeDistribution_Binding_Soap12" definition="../../../target/wsdl/EntityAdminDist_g1.wsdl" name="AdministrativeDistribution_Binding_Soap12_g1" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="a44e0143-86be-4cce-a748-026affa467f7" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:endpoint>
        </con:endpoints>
        <con:operation action="urn:oasis:names:tc:emergency:EDXL:DE:1.0:SendAlertMessage" bindingOperationName="SendAlertMessage" inputName="" isOneWay="false" name="SendAlertMessage" sendsAttachments="false" type="One-Way" id="d1b9fab4-ebd4-4973-8726-d455be14b75e">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincentityxdr}EntityXDR_Binding" definition="../../../target/wsdl/EntityXDR.wsdl" name="EntityXDR_Binding" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="15739e4f-8119-4c7f-8aa8-d7da6e4454fe" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>${#TestSuite#Endpoint-XDREntity}</con:endpoint>
            <con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionUnsecured</con:endpoint>
            <con:endpoint>http://localhost:8080/CONNECTGateway/EntityService/EntityDocSubmissionUnsecured</con:endpoint>
        </con:endpoints>
        <con:operation action="" anonymous="optional" bindingOperationName="ProvideAndRegisterDocumentSet-b" inputName="" isOneWay="false" name="ProvideAndRegisterDocumentSet-b" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="6d2122e9-6d85-41fd-a95b-2fc52958a105">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincentityxdr:async:response}EntityXDRAsyncResponse_Binding" definition="../../../target/wsdl/EntityXDRResponse.wsdl" name="EntityXDRAsyncResponse_Binding" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="03843b5a-c8f7-4107-bb07-483d9f1b5f4a" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>${#TestSuite#Endpoint-DSDeferredResp}</con:endpoint>
            <con:endpoint>http://localhost:${HttpDefaultPort}/EntityService/EntityXDRAsyncResponse</con:endpoint>
        </con:endpoints>
        <con:operation action="" anonymous="optional" bindingOperationName="ProvideAndRegisterDocumentSet-bAsyncResponse" inputName="" isOneWay="false" name="ProvideAndRegisterDocumentSet-bAsyncResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="31ef3ba1-52c9-430a-8eb4-f04885a99b64">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincentityxdr:async:request}EntityXDRAsyncRequest_Binding" definition="../../../target/wsdl/EntityXDRRequest.wsdl" name="EntityXDRAsyncRequest_Binding" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="8658fd59-56f6-4940-b327-8558b01e3ba1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>${#TestSuite#Endpoint-EntityXDRRequest}</con:endpoint>
            <con:endpoint>http://localhost:${HttpDefaultPort}/EntityService/EntityXDRAsyncRequest</con:endpoint>
            <con:endpoint>http://localhost:${HttpDefaultPort}/EntityService/EntityXDRRequest</con:endpoint>
            <con:endpoint>http://localhost:8080/CONNECTAdapter/EntityProxyService/EntityXDRRequest</con:endpoint>
        </con:endpoints>
        <con:operation action="tns:ProvideAndRegisterDocumentSet-bAsyncRequest" anonymous="optional" bindingOperationName="ProvideAndRegisterDocumentSet-bAsyncRequest" inputName="" isOneWay="false" name="ProvideAndRegisterDocumentSet-bAsyncRequest" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="56c55d7a-380e-48af-8800-cba867932d42">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitypatientdiscovery}EntityPatientDiscoveryBindingSoap" definition="../../../target/wsdl/EntityPatientDiscovery.wsdl" name="EntityPatientDiscoveryBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="f217ae1d-2dec-4b5d-9356-70e1314bcdf1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:endpoint>
            <con:endpoint>http://localhost:8080/CONNECTGateway/EntityPatientDiscovery</con:endpoint>
        </con:endpoints>
        <con:operation action="urn:gov:hhs:fha:nhinc:entitypatientdiscovery:RespondingGateway_PRPA_IN201305UV02RequestMessage" bindingOperationName="RespondingGateway_PRPA_IN201305UV02" inputName="RespondingGateway_PRPA_IN201305UV02Request" isOneWay="false" name="RespondingGateway_PRPA_IN201305UV02" outputName="RespondingGateway_PRPA_IN201306UV02Response" receivesAttachments="false" sendsAttachments="false" type="Request-Response" anonymous="optional" id="1aaa3622-310a-400e-9ca5-1cc2b219c4c0">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncreq}EntityPatientDiscoveryAsyncReqBindingSoap" definition="../../../target/wsdl/EntityPatientDiscoveryAsyncReq.wsdl" name="EntityPatientDiscoveryAsyncReqBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="56a638c0-7f8a-4edd-ab56-b848dac06894" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>${#TestSuite#Endpoint-PatientDiscoveryAsyncReq}</con:endpoint>
            <con:endpoint>http://localhost/NhinConnect/EntityPatientDiscoveryAsyncReq</con:endpoint>
        </con:endpoints>
        <con:operation action="urn:ProcessPatientDiscoveryAsyncReq" anonymous="optional" bindingOperationName="ProcessPatientDiscoveryAsyncReq" inputName="ProcessPatientDiscoveryAsyncReqAsyncRequest" isOneWay="false" name="ProcessPatientDiscoveryAsyncReq" outputName="ProcessPatientDiscoveryAsyncReqAsyncResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="240bb806-94a1-478d-afc0-e54a7a1db83f">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitydocretrieve}EntityDocRetrieveBindingSoap" definition="../../../target/wsdl/EntityDocRetrieve.wsdl" name="EntityDocRetrieveBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="666ab79c-a5a5-4a12-9b16-0ca429f0bf07" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/DocumentRetrieve/2_0/EntityService/EntityDocRetrieve</con:endpoint>
            <con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntityDocRetrieve</con:endpoint>
        </con:endpoints>
        <con:operation action="urn:gov:hhs:fha:nhinc:entitydocretrieve:RespondingGateway_CrossGatewayRetrieveRequestMessage" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayRetrieve" inputName="RespondingGateway_CrossGatewayRetrieveRequest" isOneWay="false" name="RespondingGateway_CrossGatewayRetrieve" outputName="RespondingGateway_CrossGatewayRetrieveResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="30c2c357-9684-46d3-98f5-7804f1bfca04">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncresp}EntityPatientDiscoveryAsyncRespBindingSoap" definition="../../../target/wsdl/EntityPatientDiscoveryAsyncResp.wsdl" name="EntityPatientDiscoveryAsyncRespBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="a0c6e3fd-71a7-4cfe-a1c0-f834cd89df14" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>${#TestSuite#Endpoint-PatientDiscoveryAsyncResp}</con:endpoint>
            <con:endpoint>http://localhost/NhinConnect/EntityPatientDiscoveryAsyncResp</con:endpoint>
            <con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:endpoint>
        </con:endpoints>
        <con:operation action="" bindingOperationName="ProcessPatientDiscoveryAsyncResp" inputName="ProcessPatientDiscoveryAsyncRespAsyncRequest" isOneWay="false" name="ProcessPatientDiscoveryAsyncResp" outputName="ProcessPatientDiscoveryAsyncRespAsyncResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" anonymous="optional" id="3e4c9ef6-0572-4251-ba86-d0a5ef560451">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitydocquery}EntityDocQueryBindingSoap" definition="../../../target/wsdl/EntityDocQuery.wsdl" name="EntityDocQueryBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="37a53679-33e9-42ab-97df-2928d0662f2e" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntityDocQuery</con:endpoint>
        </con:endpoints>
        <con:operation action="urn:gov:hhs:fha:nhinc:entitydocquery:RespondingGateway_CrossGatewayQueryRequest" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayQuery" inputName="RespondingGateway_CrossGatewayQueryRequest" isOneWay="false" name="RespondingGateway_CrossGatewayQuery" outputName="RespondingGateway_CrossGatewayQueryResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="76f0760c-a9df-421f-b1b5-b30b0917e89c">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdapterPatientDiscoveryBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:adapterpatientdiscovery}AdapterPatientDiscoveryBindingSoap" soapVersion="1_2" anonymous="optional" definition="../../../target/wsdl/AdapterPatientDiscovery.wsdl" id="f0e8e713-ca98-466a-b74d-99b508041004" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>https://localhost:${HttpsDefaultPort}/Adapter/PatientDiscovery/A_0/AdapterPatientDiscovery</con:endpoint>
        </con:endpoints>
        <con:operation isOneWay="false" action="urn:RespondingGateway_PRPA_IN201305UV02" name="RespondingGateway_PRPA_IN201305UV02" bindingOperationName="RespondingGateway_PRPA_IN201305UV02" type="Request-Response" outputName="RespondingGateway_PRPA_IN201306UV02Response" inputName="RespondingGateway_PRPA_IN201305UV02Request" receivesAttachments="false" sendsAttachments="false" id="4785ff9f-f519-4cbd-a378-f813d71b9997">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdministrativeDistribution_Binding_Soap12" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:entityadmindistribution}AdministrativeDistribution_Binding_Soap12" soapVersion="1_2" anonymous="optional" definition="../../../target/wsdl/EntityAdminDist.wsdl" id="49443371-d283-457f-9de2-950397b62e11" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <con:settings/>
        <con:endpoints>
            <con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/AdminDistribution/1_0/AdministrativeDistribution_Service</con:endpoint>
        </con:endpoints>
        <con:operation isOneWay="false" action="urn:oasis:names:tc:emergency:EDXL:DE:1.0:SendAlertMessage" name="SendAlertMessage" bindingOperationName="SendAlertMessage" type="One-Way" inputName="" sendsAttachments="false" id="cfa9b960-302f-4506-8054-bf8e9c447726">
            <con:settings/>
        </con:operation>
    </con:interface>
    <con:interface xsi:type="con:WsdlInterface" id="ddab6a8f-968c-4df6-bdbe-8ac2b5ce66ef" wsaVersion="NONE" name="EntityXDS_Binding" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:entityxds}EntityXDS_Binding" soapVersion="1_2" anonymous="optional" definition="../../../target/wsdl/EntityDDS.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:/Gateway/DocumentDataSubmission/1_0/EntityService/EntityDocDataSubmissionUnsecured</con:endpoint></con:endpoints><con:operation id="aa4ebc0a-9131-41d2-bac7-b680bc52b094" isOneWay="false" action="" name="RegisterDocumentSet-b" bindingOperationName="RegisterDocumentSet-b" type="Request-Response" inputName="" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call id="e7f11d71-57c9-4e9b-8210-aecd9c816941" name="Request 1"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:/Gateway/DocumentDataSubmission/1_0/EntityService/EntityDocDataSubmissionUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">\r
   <soap:Header/>\r
   <soap:Body>\r
      <urn:RespondingGateway_RegisterDocumentSetRequest>\r
         <urn:assertion>\r
            <!--Optional:-->\r
            <urn1:address>\r
               <urn1:addressType>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:addressType>\r
               <urn1:city>?</urn1:city>\r
               <urn1:country>?</urn1:country>\r
               <urn1:state>?</urn1:state>\r
               <urn1:streetAddress>?</urn1:streetAddress>\r
               <urn1:zipCode>?</urn1:zipCode>\r
            </urn1:address>\r
            <!--Optional:-->\r
            <urn1:dateOfBirth>?</urn1:dateOfBirth>\r
            <!--Optional:-->\r
            <urn1:explanationNonClaimantSignature>?</urn1:explanationNonClaimantSignature>\r
            <!--Optional:-->\r
            <urn1:haveSecondWitnessSignature>?</urn1:haveSecondWitnessSignature>\r
            <!--Optional:-->\r
            <urn1:haveSignature>?</urn1:haveSignature>\r
            <!--Optional:-->\r
            <urn1:haveWitnessSignature>?</urn1:haveWitnessSignature>\r
            <urn1:homeCommunity>\r
               <!--Optional:-->\r
               <urn1:description>?</urn1:description>\r
               <urn1:homeCommunityId>?</urn1:homeCommunityId>\r
               <!--Optional:-->\r
               <urn1:name>?</urn1:name>\r
            </urn1:homeCommunity>\r
            <!--Optional:-->\r
            <urn1:nationalProviderId>?</urn1:nationalProviderId>\r
            <!--Optional:-->\r
            <urn1:personName>\r
               <urn1:familyName>?</urn1:familyName>\r
               <urn1:givenName>?</urn1:givenName>\r
               <urn1:nameType>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:nameType>\r
               <urn1:secondNameOrInitials>?</urn1:secondNameOrInitials>\r
               <urn1:fullName>?</urn1:fullName>\r
               <urn1:prefix>?</urn1:prefix>\r
               <urn1:suffix>?</urn1:suffix>\r
            </urn1:personName>\r
            <!--Optional:-->\r
            <urn1:phoneNumber>\r
               <urn1:areaCode>?</urn1:areaCode>\r
               <urn1:countryCode>?</urn1:countryCode>\r
               <urn1:extension>?</urn1:extension>\r
               <urn1:localNumber>?</urn1:localNumber>\r
               <urn1:phoneNumberType>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:phoneNumberType>\r
            </urn1:phoneNumber>\r
            <!--Optional:-->\r
            <urn1:secondWitnessAddress>\r
               <urn1:addressType>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:addressType>\r
               <urn1:city>?</urn1:city>\r
               <urn1:country>?</urn1:country>\r
               <urn1:state>?</urn1:state>\r
               <urn1:streetAddress>?</urn1:streetAddress>\r
               <urn1:zipCode>?</urn1:zipCode>\r
            </urn1:secondWitnessAddress>\r
            <!--Optional:-->\r
            <urn1:secondWitnessName>\r
               <urn1:familyName>?</urn1:familyName>\r
               <urn1:givenName>?</urn1:givenName>\r
               <urn1:nameType>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:nameType>\r
               <urn1:secondNameOrInitials>?</urn1:secondNameOrInitials>\r
               <urn1:fullName>?</urn1:fullName>\r
               <urn1:prefix>?</urn1:prefix>\r
               <urn1:suffix>?</urn1:suffix>\r
            </urn1:secondWitnessName>\r
            <!--Optional:-->\r
            <urn1:secondWitnessPhone>\r
               <urn1:areaCode>?</urn1:areaCode>\r
               <urn1:countryCode>?</urn1:countryCode>\r
               <urn1:extension>?</urn1:extension>\r
               <urn1:localNumber>?</urn1:localNumber>\r
               <urn1:phoneNumberType>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:phoneNumberType>\r
            </urn1:secondWitnessPhone>\r
            <!--Optional:-->\r
            <urn1:SSN>?</urn1:SSN>\r
            <!--Zero or more repetitions:-->\r
            <urn1:uniquePatientId>?</urn1:uniquePatientId>\r
            <!--Optional:-->\r
            <urn1:witnessAddress>\r
               <urn1:addressType>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:addressType>\r
               <urn1:city>?</urn1:city>\r
               <urn1:country>?</urn1:country>\r
               <urn1:state>?</urn1:state>\r
               <urn1:streetAddress>?</urn1:streetAddress>\r
               <urn1:zipCode>?</urn1:zipCode>\r
            </urn1:witnessAddress>\r
            <!--Optional:-->\r
            <urn1:witnessName>\r
               <urn1:familyName>?</urn1:familyName>\r
               <urn1:givenName>?</urn1:givenName>\r
               <urn1:nameType>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:nameType>\r
               <urn1:secondNameOrInitials>?</urn1:secondNameOrInitials>\r
               <urn1:fullName>?</urn1:fullName>\r
               <urn1:prefix>?</urn1:prefix>\r
               <urn1:suffix>?</urn1:suffix>\r
            </urn1:witnessName>\r
            <!--Optional:-->\r
            <urn1:witnessPhone>\r
               <urn1:areaCode>?</urn1:areaCode>\r
               <urn1:countryCode>?</urn1:countryCode>\r
               <urn1:extension>?</urn1:extension>\r
               <urn1:localNumber>?</urn1:localNumber>\r
               <urn1:phoneNumberType>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:phoneNumberType>\r
            </urn1:witnessPhone>\r
            <urn1:userInfo>\r
               <urn1:personName>\r
                  <urn1:familyName>?</urn1:familyName>\r
                  <urn1:givenName>?</urn1:givenName>\r
                  <urn1:nameType>\r
                     <urn1:code>?</urn1:code>\r
                     <!--Optional:-->\r
                     <urn1:codeSystem>?</urn1:codeSystem>\r
                     <!--Optional:-->\r
                     <urn1:codeSystemName>?</urn1:codeSystemName>\r
                     <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                     <urn1:displayName>?</urn1:displayName>\r
                     <urn1:originalText>?</urn1:originalText>\r
                     <!--Zero or more repetitions:-->\r
                     <urn1:translation/>\r
                  </urn1:nameType>\r
                  <urn1:secondNameOrInitials>?</urn1:secondNameOrInitials>\r
                  <urn1:fullName>?</urn1:fullName>\r
                  <urn1:prefix>?</urn1:prefix>\r
                  <urn1:suffix>?</urn1:suffix>\r
               </urn1:personName>\r
               <urn1:userName>?</urn1:userName>\r
               <urn1:org>\r
                  <!--Optional:-->\r
                  <urn1:description>?</urn1:description>\r
                  <urn1:homeCommunityId>?</urn1:homeCommunityId>\r
                  <!--Optional:-->\r
                  <urn1:name>?</urn1:name>\r
               </urn1:org>\r
               <urn1:roleCoded>\r
                  <urn1:code>?</urn1:code>\r
                  <!--Optional:-->\r
                  <urn1:codeSystem>?</urn1:codeSystem>\r
                  <!--Optional:-->\r
                  <urn1:codeSystemName>?</urn1:codeSystemName>\r
                  <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
                  <urn1:displayName>?</urn1:displayName>\r
                  <urn1:originalText>?</urn1:originalText>\r
                  <!--Zero or more repetitions:-->\r
                  <urn1:translation/>\r
               </urn1:roleCoded>\r
            </urn1:userInfo>\r
            <urn1:authorized>?</urn1:authorized>\r
            <urn1:purposeOfDisclosureCoded>\r
               <urn1:code>?</urn1:code>\r
               <!--Optional:-->\r
               <urn1:codeSystem>?</urn1:codeSystem>\r
               <!--Optional:-->\r
               <urn1:codeSystemName>?</urn1:codeSystemName>\r
               <urn1:codeSystemVersion>?</urn1:codeSystemVersion>\r
               <urn1:displayName>?</urn1:displayName>\r
               <urn1:originalText>?</urn1:originalText>\r
               <!--Zero or more repetitions:-->\r
               <urn1:translation/>\r
            </urn1:purposeOfDisclosureCoded>\r
            <!--Optional:-->\r
            <urn1:acpAttribute>?</urn1:acpAttribute>\r
            <!--Optional:-->\r
            <urn1:instanceAcpAttribute>?</urn1:instanceAcpAttribute>\r
            <!--Optional:-->\r
            <urn1:samlConditions>\r
               <urn1:notBefore>?</urn1:notBefore>\r
               <urn1:notOnOrAfter>?</urn1:notOnOrAfter>\r
            </urn1:samlConditions>\r
            <!--Optional:-->\r
            <urn1:samlAuthnStatement>\r
               <urn1:authInstant>?</urn1:authInstant>\r
               <!--Optional:-->\r
               <urn1:sessionIndex>?</urn1:sessionIndex>\r
               <urn1:authContextClassRef>?</urn1:authContextClassRef>\r
               <!--Optional:-->\r
               <urn1:subjectLocalityAddress>?</urn1:subjectLocalityAddress>\r
               <!--Optional:-->\r
               <urn1:subjectLocalityDNSName>?</urn1:subjectLocalityDNSName>\r
            </urn1:samlAuthnStatement>\r
            <!--Optional:-->\r
            <urn1:samlAuthzDecisionStatement>\r
               <!--Optional:-->\r
               <urn1:decision>?</urn1:decision>\r
               <!--Optional:-->\r
               <urn1:resource>?</urn1:resource>\r
               <!--Optional:-->\r
               <urn1:action>?</urn1:action>\r
               <!--Optional:-->\r
               <urn1:evidence>\r
                  <!--Optional:-->\r
                  <urn1:assertion>\r
                     <!--Optional:-->\r
                     <urn1:id>?</urn1:id>\r
                     <!--Optional:-->\r
                     <urn1:issueInstant>?</urn1:issueInstant>\r
                     <!--Optional:-->\r
                     <urn1:version>?</urn1:version>\r
                     <!--Optional:-->\r
                     <urn1:issuer>?</urn1:issuer>\r
                     <!--Optional:-->\r
                     <urn1:issuerFormat>?</urn1:issuerFormat>\r
                     <!--Optional:-->\r
                     <urn1:subject>?</urn1:subject>\r
                     <!--Optional:-->\r
                     <urn1:conditions>\r
                        <!--Optional:-->\r
                        <urn1:notBefore>?</urn1:notBefore>\r
                        <!--Optional:-->\r
                        <urn1:notOnOrAfter>?</urn1:notOnOrAfter>\r
                     </urn1:conditions>\r
                     <!--Zero or more repetitions:-->\r
                     <urn1:accessConsentPolicy>?</urn1:accessConsentPolicy>\r
                     <!--Zero or more repetitions:-->\r
                     <urn1:instanceAccessConsentPolicy>?</urn1:instanceAccessConsentPolicy>\r
                  </urn1:assertion>\r
               </urn1:evidence>\r
            </urn1:samlAuthzDecisionStatement>\r
            <!--Optional:-->\r
            <urn1:samlSignature>\r
               <!--Optional:-->\r
               <urn1:keyInfo>\r
                  <!--Optional:-->\r
                  <urn1:rsaKeyValueModulus>cid:43887842834</urn1:rsaKeyValueModulus>\r
                  <!--Optional:-->\r
                  <urn1:rsaKeyValueExponent>cid:513581959752</urn1:rsaKeyValueExponent>\r
               </urn1:keyInfo>\r
               <!--Optional:-->\r
               <urn1:signatureValue>cid:100036495097</urn1:signatureValue>\r
            </urn1:samlSignature>\r
            <!--Optional:-->\r
            <urn1:samlIssuer>\r
               <!--Optional:-->\r
               <urn1:issuer>?</urn1:issuer>\r
               <!--Optional:-->\r
               <urn1:issuerFormat>?</urn1:issuerFormat>\r
            </urn1:samlIssuer>\r
            <!--Zero or more repetitions:-->\r
            <urn1:samlSubjectConfirmations>\r
               <urn1:method>?</urn1:method>\r
               <!--Optional:-->\r
               <urn1:subjectCondition>\r
                  <urn1:notBefore>?</urn1:notBefore>\r
                  <urn1:notOnOrAfter>?</urn1:notOnOrAfter>\r
               </urn1:subjectCondition>\r
               <!--Optional:-->\r
               <urn1:recipient>?</urn1:recipient>\r
               <!--Optional:-->\r
               <urn1:inResponseTo>?</urn1:inResponseTo>\r
               <!--Optional:-->\r
               <urn1:address>?</urn1:address>\r
            </urn1:samlSubjectConfirmations>\r
            <!--Optional:-->\r
            <urn1:messageId>?</urn1:messageId>\r
            <!--Zero or more repetitions:-->\r
            <urn1:relatesToList>?</urn1:relatesToList>\r
            <!--Optional:-->\r
            <urn1:implementsSpecVersion>?</urn1:implementsSpecVersion>\r
            <!--Optional:-->\r
            <urn1:transactionTimeout>-1</urn1:transactionTimeout>\r
            <!--Optional:-->\r
            <urn1:keepAlive>?</urn1:keepAlive>\r
            <!--Zero or more repetitions:-->\r
            <urn1:CONNECTCustomHttpHeaders>\r
               <urn1:headerName>?</urn1:headerName>\r
               <urn1:headerValue>?</urn1:headerValue>\r
            </urn1:CONNECTCustomHttpHeaders>\r
         </urn:assertion>\r
         <!--Optional:-->\r
         <urn:nhinTargetCommunities>\r
            <!--1 or more repetitions:-->\r
            <urn1:nhinTargetCommunity>\r
               <urn1:homeCommunity>\r
                  <!--Optional:-->\r
                  <urn1:description>?</urn1:description>\r
                  <urn1:homeCommunityId>?</urn1:homeCommunityId>\r
                  <!--Optional:-->\r
                  <urn1:name>?</urn1:name>\r
               </urn1:homeCommunity>\r
               <!--Optional:-->\r
               <urn1:list>?</urn1:list>\r
               <!--Optional:-->\r
               <urn1:region>?</urn1:region>\r
            </urn1:nhinTargetCommunity>\r
            <!--Optional:-->\r
            <urn1:useSpecVersion>?</urn1:useSpecVersion>\r
            <!--Optional:-->\r
            <urn1:exchangeName>?</urn1:exchangeName>\r
         </urn:nhinTargetCommunities>\r
         <urn:RegisterDocumentSetRequest>\r
            <urn2:SubmitObjectsRequest id="?" comment="?">\r
               <!--Optional:-->\r
               <urn3:RequestSlotList>\r
                  <!--Zero or more repetitions:-->\r
                  <urn4:Slot name="?" slotType="?">\r
                     <urn4:ValueList>\r
                        <urn4:Value>?</urn4:Value>\r
                     </urn4:ValueList>\r
                  </urn4:Slot>\r
               </urn3:RequestSlotList>\r
               <urn4:RegistryObjectList>\r
                  <!--Zero or more repetitions:-->\r
                  <urn4:Identifiable id="?" home="?">\r
                     <!--Zero or more repetitions:-->\r
                     <urn4:Slot name="?" slotType="?">\r
                        <urn4:ValueList>\r
                           <urn4:Value>?</urn4:Value>\r
                        </urn4:ValueList>\r
                     </urn4:Slot>\r
                  </urn4:Identifiable>\r
               </urn4:RegistryObjectList>\r
            </urn2:SubmitObjectsRequest>\r
         </urn:RegisterDocumentSetRequest>\r
         <!--Optional:-->\r
         <urn:url>\r
            <urn1:url>?</urn1:url>\r
            <urn1:id>?</urn1:id>\r
         </urn:url>\r
      </urn:RespondingGateway_RegisterDocumentSetRequest>\r
   </soap:Body>\r
</soap:Envelope>]]></con:request><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig mustUnderstand="NONE" version="200508" action="{urn:gov:hhs:fha:nhinc:entityxds}RegisterDocumentSet-b"/></con:call></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" id="96bdf1fd-722c-46a6-9fbf-1f6ec1a832ac" wsaVersion="NONE" name="EntityPatientLocationQueryBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:entitypatientlocationquery}EntityPatientLocationQueryBindingSoap" soapVersion="1_2" anonymous="optional" definition="../../../target/wsdl/EntityPatientLocationQuery.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:/Gateway/PatientLocationQuery/1_0/EntityPatientLocationQuery</con:endpoint></con:endpoints><con:operation id="eda86cad-4cfb-4ca1-9842-e54ba18c1f8c" isOneWay="false" action="urn:gov:hhs:fha:nhinc:entitypatientlocationquery:RespondingGateway_PatientLocationQueryRequestMessage" name="RespondingGateway_PatientLocationQuery" bindingOperationName="RespondingGateway_PatientLocationQuery" type="Request-Response" outputName="RespondingGateway_PatientLocationQueryResponse" inputName="RespondingGateway_PatientLocationQueryRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call id="3072e87c-e476-4277-a5d2-367e910e2c38" name="Request 1"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientLocationQuery</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:ihe:iti:xcpd:2009" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">\r
   <soap:Header/>\r
   <soap:Body>\r
      <urn:RespondingGateway_PatientLocationQueryRequest>\r
         <urn1:PatientLocationQueryRequest>\r
            <urn1:RequestedPatientId nullFlavor="?" root="?" extension="?" assigningAuthorityName="?" displayable="?"/>\r
         </urn1:PatientLocationQueryRequest>\r
         <urn:assertion>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTH</urn1:code>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PatientLocationQueryRequest>\r
   </soap:Body>\r
</soap:Envelope>]]></con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:entitypatientlocationquery:RespondingGateway_PatientLocationQueryRequestMessage"/><con:wsrmConfig version="1.2"/></con:call></con:operation></con:interface><con:testSuite name="g1" id="744759b8-4e7d-4e83-a9c9-58ac306ccd25">
        <con:settings/>
        <con:runType>SEQUENTIAL</con:runType>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission Deferred Req" searchProperties="true" id="7e685188-254a-4e21-9f18-98674d0f4a82">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="e08a168f-cd02-49a2-9fec-cdb10d744442">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>

            <con:testStep name="Doc Submission Deferred Req" type="request" id="f61740b1-c12f-44bc-bdcd-d60c65dff06f">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityXDRAsyncRequest_Binding</con:interface>
                    <con:operation>ProvideAndRegisterDocumentSet-bAsyncRequest</con:operation>
                    <con:request incomingWss="" name="Doc Submission Deferred Req" outgoingWss="" useWsAddressing="true" wssPasswordType="" id="79f31451-9203-4acd-a527-1385d1abe47c">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-EntityXDRRequest}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g1" testCase="Document Submission Deferred Req">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->

               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList>

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="7251e78b-8ac9-4be1-a9f3-71a0c6b9f057"/>
                        <con:assertion type="SOAP Fault Assertion" id="a24f42d5-95d7-4afd-a76f-3f350afef77f"/>
                        <con:assertion name="Match content of [@status]" type="XPath Match" id="ed2ecd4c-a496-45ff-9be7-1caa22e97a05">
                            <con:configuration>
                                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
                                    //ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:RequestAccepted</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Schema Compliance" type="Schema Compliance" id="ac36d35f-fe13-4f48-89b2-197d1f1ad697">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincentityxdr:async:request:ProvideAndRegisterDocumentSet-bAsyncRequest_RequestMessage" generateMessageId="true" mustUnderstand="NONE" version="200508" addDefaultAction="false"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="73b3a2cd-8764-4ea4-b739-077ca79f23c5">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="07f553fe-1450-4225-bad3-d17c656a036c">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Document Submission Deferred Request"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "2.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
context.setGatewayStandard(false);
log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("docsubmission.inboundDocSubmissionRequest",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:21:55Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:31:55Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:21:55</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission Deferred Resp" searchProperties="true" id="28f122a1-cdca-487c-ba68-f9d985f97826">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="99d27f67-e14a-44ac-835f-a319a9ef436f">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Doc Submission Deferred Resp" type="request" id="26ed37cf-470e-4daf-98af-0a2d5e5081ed">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityXDRAsyncResponse_Binding</con:interface>
                    <con:operation>ProvideAndRegisterDocumentSet-bAsyncResponse</con:operation>
                    <con:request name="Doc Submission Deferred Resp" id="5e3d691c-065c-4445-bf66-169e29328008">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-DSDeferredResp}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body>
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
               <urn1:prefix>Ms.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>?addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>SkagerBerg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                     <!--Zero or more repetitions:-->
                     <urn1:translation/>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Karl S. Skagerberg</urn1:fullName>
                  <urn1:prefix>?</urn1:prefix>
                  <urn1:suffix>?</urn1:suffix>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <!--Optional:-->
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy notes</urn1:originalText>
               <!--Zero or more repetitions:-->
               <urn1:translation/>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <!--Optional:-->
                     <urn1:version>2.0</urn1:version>
                     <!--Optional:-->
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <!--Optional:-->
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <!--Optional:-->
                     <urn1:conditions>
                        <!--Optional:-->
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <!--Optional:-->
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <!--Zero or more repetitions:-->
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <!--Zero or more repetitions:-->
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:721645965035</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:146207300753</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:783710993742</urn1:signatureValue>
            </urn1:samlSignature>
            <!--Optional:-->
            <urn1:samlIssuer>
               <!--Optional:-->
               <urn1:issuer>?</urn1:issuer>
               <!--Optional:-->
               <urn1:issuerFormat>?</urn1:issuerFormat>
            </urn1:samlIssuer>
            <!--Optional:-->
            <urn1:messageId>?</urn1:messageId>
            <!--1 or more repetitions:-->
            <urn1:relatesToList>uuid:088a26e8-6b03-4bf8-84f1-737dc94be2e0</urn1:relatesToList>
         </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn:RegistryResponse status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" requestId="?"><!--Optional:-->
            <urn2:ResponseSlotList>
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
            </urn2:ResponseSlotList>
            <!--Optional:-->
            <urn2:RegistryErrorList highestSeverity="?">
               <!--1 or more repetitions:-->
               <urn2:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn2:RegistryError>
            </urn2:RegistryErrorList>
         </urn:RegistryResponse>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="f638ae5b-2fe4-4ed6-9bf0-5b886217764c"/>
                        <con:assertion type="Schema Compliance" id="8abe9901-aa6f-4f8c-bbd1-e0075b1d3f04">
                            <con:configuration/>
                        </con:assertion>
                        <con:assertion type="SOAP Fault Assertion" id="925cc8a1-3cc7-4ced-92f1-7be3bbf0cdfc"/>
                        <con:assertion type="XPath Match" id="1d6cd49f-2a21-4141-a9fd-80c6ae190421">
                            <con:configuration>
                                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
                                    //ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:ResponseAccepted</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="24d4268a-7a53-4ff3-ad6d-6ea909aa3d44">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="098e2318-32c2-4068-a845-fd9c3e8bc011">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Document Submission Deferred Response"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "2.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("docsubmission.inboundDocSubmissionResponse",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:21:57Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:31:57Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:21:57</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission" searchProperties="true" id="bfb21e63-366d-4679-9fe6-33293702838f">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="39ec05cd-548a-407f-b09e-ac260463e228">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Doc Submission" type="request" id="5d83f211-a20a-4790-8b74-3bb6ffa828ae">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityXDR_Binding</con:interface>
                    <con:operation>ProvideAndRegisterDocumentSet-b</con:operation>
                    <con:request incomingWss="" name="Doc Submission" outgoingWss="" wssPasswordType="" id="8a0d3b3d-fcbd-48a9-ace6-e0d6197100b1">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-XDREntity}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g1" testCase="Document Submission">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->

               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList>

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="8db887b8-bcf9-459a-bd6a-e7de5ba53b62"/>
                        <con:assertion type="SOAP Fault Assertion" id="6d21b2e5-9af8-4ea1-afc7-0116df6b2646"/>
                        <con:assertion type="XPath Match" id="d4428290-295e-47f2-8d34-4203c3f193b2">
                            <con:configuration>
                                <path>declare namespace ns11='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
                                    //ns11:RegistryResponse[1]/@status</path>
                                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Schema Compliance" type="Schema Compliance" id="3af85a12-d0f9-45ca-82fb-68dee5d46cf3">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig action="{urn:gov:hhs:fha:nhinc:nhincentityxdr}ProvideAndRegisterDocumentSet-b" mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="890d6bc1-5458-4015-b33c-37287218727c">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="16ad7767-45ac-4b2b-98be-49b4ff234f8e">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Document Submission"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "2.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("docsubmission.inboundDocSubmission",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:22:01Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:32:01Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:22:01</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery Deferred Req" searchProperties="true" id="722d7a11-28b2-47ff-93a2-1393fc42abb3">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="482d9bdf-6aca-4454-bdf6-6f446a408ab5">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Patient Discovery Deferred Req" type="request" id="1cca8d8d-820c-4cf9-a59d-82faeee02d39">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityPatientDiscoveryAsyncReqBindingSoap</con:interface>
                    <con:operation>ProcessPatientDiscoveryAsyncReq</con:operation>
                    <con:request name="Patient Discovery Deferred Req" useWsAddressing="true" id="f0d2228b-bb54-49c7-be1e-8822767c6da8">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-PatientDiscoveryAsyncReq}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g1" testCase="Patient Discovery Deferred Req">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#RemoteHCID}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#LocalPatientID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <!--Optional:-->
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <!--Optional:-->
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="92e54d24-0aee-4f72-8440-8d59b4790935"/>
                        <con:assertion type="SOAP Fault Assertion" id="ab51c3f7-2356-466a-902b-f54c91e2d376"/>
                        <con:assertion name="Verify Receiver" type="XPath Match" id="16d80c7b-efae-46ed-b0c5-f1dc832e905b">
                            <con:configuration>
                                <path>declare namespace ns3='urn:hl7-org:v3';
                                    //ns3:MCCI_IN000002UV01[1]/ns3:receiver[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                                <content>1.1</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Verify Sender" type="XPath Match" id="28b4bb98-8484-45ee-8dda-35828563ae29">
                            <con:configuration>
                                <path>declare namespace ns3='urn:hl7-org:v3';
                                    //ns3:MCCI_IN000002UV01[1]/ns3:sender[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                                <content>2.2</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Verify Message" type="XPath Match" id="37fc8e63-c625-48a4-af57-9b5ffb4c10cf">
                            <con:configuration>
                                <path>declare namespace ns3='urn:hl7-org:v3';
                                    //ns3:MCCI_IN000002UV01[1]/ns3:acknowledgement[1]/ns3:acknowledgementDetail[1]/ns3:text[1]/text()</path>
                                <content>Success</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Verify RelatesTo" type="XPath Match" id="e8be4607-db47-4dc6-9af7-42dd922fc8e0">
                            <con:configuration>
                                <path>declare namespace ns1='http://www.w3.org/2005/08/addressing';
                                    //ns1:RelatesTo[1]/text()</path>
                                <content>uuid:6666666666.66666.666.66</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Schema Compliance" type="Schema Compliance" id="5b67e214-a260-4438-aba2-eef083d17fe8">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncreq:ProcessPatientDiscoveryAsyncReqAsyncRequest" addDefaultTo="true" messageID="uuid:6666666666.66666.666.66" mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="82b05050-fd17-43c8-8e46-c20fdd439b57">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="4c1aa08b-66a7-46cd-b8e6-ee5e17d0d462">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Patient Discovery Deferred Request"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("patientDiscovery.inboundPatientDiscoveryRequest",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:22:03Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:32:03Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:22:03</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery Deferred Resp" searchProperties="true" id="1bb2218d-381d-4724-8ba6-a019f2532778">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="9a989a91-b197-48c6-a49d-5976631cb8b4">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Patient Discovery Deferred Resp" type="request" id="c87bed2a-a708-4bba-a0a3-9d35163b6e6a">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityPatientDiscoveryAsyncRespBindingSoap</con:interface>
                    <con:operation>ProcessPatientDiscoveryAsyncResp</con:operation>
                    <con:request name="Patient Discovery Deferred Resp" id="2dc5f54b-7ab0-46b3-baaa-2fdaae57d8b3">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-PatientDiscoveryAsyncResp}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header xmlns:add="SoapUI_Test/ValidationSuite/2-EndToEndSelfTest-soapui-project.xml">
      <add:Action>urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncresp:ProcessPatientDiscoveryAsyncRespAsyncRequest</add:Action>
      <add:MessageID>uuid:12bcfc1e-f422-4d1d-af99-ff83d050313e</add:MessageID>
      <add:RelatesTo>uuid:6666666666.66666.666.66</add:RelatesTo>
      <add:To>${#TestSuite#Endpoint-PatientDiscoveryAsyncResp}</add:To>
   </soap:Header>
   <soap:Body testSuite="Passthrough_g1" testCase="Patient Discovery Deferred Resp">
      <urn:RespondingGateway_PRPA_IN201306UV02Request>
         <urn:PRPA_IN201306UV02 ITSVersion="XML_1.0">
            <urn:id root="2.2" extension="-5a3e95b1:11d1fa33d45:-8e45"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <!--1 or more repetitions:-->
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="1.1"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="1.1"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:code codeSystem="2.16.840.1.113883.1.6" code="PRPA_TE201306UV"/>
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="2.2"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:subject typeCode="SUBJ">
                  <urn:registrationEvent classCode="REG" moodCode="EVN">
                     <urn:id nullFlavor="NA"/>
                     <urn:statusCode code="active"/>
                     <urn:subject1 typeCode="SBJ">
                        <urn:patient classCode="PAT">
                           <urn:id extension="D123402" root="2.2"/>
                           <urn:statusCode code="SD"/>
                           <urn:patientPerson>
                              <urn:name>
                                 <urn:family partType="FAM">Younger</urn:family>
                                 <urn:given partType="GIV">Gallow</urn:given>
                              </urn:name>
                              <urn:administrativeGenderCode code="M"/>
                              <urn:birthTime value="19630804"/>
                              <urn:addr>
                                 <urn:city>LEESBURG</urn:city>
                                 <urn:state>VA</urn:state>
                                 <urn:postalCode>20176</urn:postalCode>
                              </urn:addr>
                           </urn:patientPerson>
                           <urn:providerOrganization determinerCode="" classCode="">
                              <urn:id root="2.2"/>
                              <urn:contactParty xsi:nil="true" classCode="CON" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                           </urn:providerOrganization>
                        </urn:patient>
                     </urn:subject1>
                     <urn:custodian typeCode="">
                        <urn:assignedEntity classCode="">
                           <urn:id root="2.2"/>
                        </urn:assignedEntity>
                     </urn:custodian>
                  </urn:registrationEvent>
               </urn:subject>
               <urn:queryAck>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:queryResponseCode code="OK"/>
                  <urn:resultTotalQuantity value="1"/>
                  <urn:resultCurrentQuantity value="1"/>
                  <urn:resultRemainingQuantity value="0"/>
               </urn:queryAck>
               <urn:queryByParameter>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="M"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="19630804"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectId>
                        <urn:value extension="D123401" root="1.1"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">Younger</urn:family>
                           <urn:given partType="GIV">Gallow</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectName>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201306UV02>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>         
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201306UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="eed519f0-01f8-4d39-aa81-e522e369a857"/>
                        <con:assertion type="SOAP Fault Assertion" id="80e78b0d-f11c-4c65-95c3-f2bf5aa240d3"/>
                        <con:assertion name="Match content of [typeCode/@code]" type="XPath Match" id="3a479bb1-03ad-4410-bbdb-7b79632a1e66">
                            <con:configuration>
                                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:typeCode[1]/@code</path>
                                <content>CA</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Match content of [acknowledgementDetail/text/text()]" type="XPath Match" id="3134a382-0b08-45b6-b38b-d811e71e9b38">
                            <con:configuration>
                                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:acknowledgementDetail[1]/ns2:text/text()</path>
                                <content>Success</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Schema Compliance" type="Schema Compliance" id="d796bb45-4237-4cbf-9bfc-365cb3f18c82">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="da45de08-1712-4b18-8e81-45dac209b349">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="4a066820-04ee-4c73-b2b0-900016578c06">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Patient Discovery Deferred Response"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("patientDiscovery.inboundPatientDiscoveryResponse",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>                
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:22:06Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:32:06Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:22:06</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery" searchProperties="true" id="43a0b161-55f5-4e2a-b24a-d4596ee3627b">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="c0ec3911-2af4-4f33-965e-59bd2b8fe031">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Set Up PassThru" id="ecb81493-dcfd-49d2-89b4-ca04c18408f0">
                <con:settings/>
                <con:config>
                    <script>log.info "Setting Patient Discovery Adapter to unsecured";
                        def dir = context.findProperty('GatewayPropDir');
                        nhinc.FileUtils.backupFile(dir, "PatientDiscoveryProxyConfig.xml", log);
                        def alias = 'adapterpatientdiscovery'
                        def aliasName= 'adapterpatientdiscoverywssecured';
                        def replaceAlias = 'adapterpatientdiscoverywsunsecured';

                        nhinc.FileUtils.updateSpringConfig(dir, "PatientDiscoveryProxyConfig.xml",
                        alias, aliasName, replaceAlias, log);

                        log.info "Modifying internalExchangeInfo for adapterpatientdiscovery mock."

                        nhinc.FileUtils.createOrUpdateConnection("internalExchangeInfo.xml", dir, "1.1",
                        "adapterpatientdiscovery", "http://localhost:1720/MockPDAdapter", "2.0",
                        log);</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Patient Discovery" type="request" id="ead26b96-593a-44bc-9aa0-36d93ed3d60b">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityPatientDiscoveryBindingSoap</con:interface>
                    <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
                    <con:request name="Patient Discovery" id="efd2caa8-3c36-440c-9c99-7954b0506f53">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-PatientDiscovery}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g1" testCase="Patient Discovery">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#LocalHCID}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#SubjectID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>${#Project#City}</urn1:city>
               <urn1:country>${#Project#Country}</urn1:country>
               <urn1:state>${#Project#State}</urn1:state>
               <urn1:streetAddress>${#Project#StreetAddress}</urn1:streetAddress>
               <urn1:zipCode>${#Project#ZipCode}</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>${#Project#DOB}</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>${#Project#FamilyName}</urn1:familyName>
               <urn1:givenName>${#Project#GivenName}</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>${#Project#SSN}</urn1:SSN>
            <urn1:uniquePatientId>${#Project#UniquePatientId}</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTH</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
               <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="fe9a8cb4-0dc3-4aa4-ac00-dbba911b5206"/>
                        <con:assertion disabled="true" type="Schema Compliance" id="eb8fe9cd-5ef7-4284-9f78-59a84e877b75">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion type="SOAP Fault Assertion" id="31bcd5f4-36aa-4e06-b74f-5ef19e8bea36"/>
                        <con:assertion name="Check for existance of [ns3:controlActProcess]" type="XPath Match" id="30adea58-a570-4f66-bdab-2c5417d8a1b7">
                            <con:configuration>
                                <path>declare namespace ns3='urn:hl7-org:v3';
                                    exists( //ns3:PRPA_IN201306UV02/ns3:controlActProcess)</path>
                                <content>true</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Given Name XPath Match" type="XPath Match" id="00654260-250b-4969-906f-1e45b37a715e">
                            <con:configuration>
                                <path>declare namespace ns1='urn:hl7-org:v3';
                                    //ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:given[1]</path>
                                <content>${#Project#GivenName}</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Family Name XPath Match" type="XPath Match" id="5f23bb5f-d4bd-4091-aa62-6494598843cc">
                            <con:configuration>
                                <path>declare namespace ns1='urn:hl7-org:v3';
                                    //ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:family[1]</path>
                                <content>${#Project#FamilyName}</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="mockresponse" name="Mock Response" id="c476cc59-0958-4c23-836b-446a22fac189">
                <con:settings/>
                <con:config xsi:type="con:MockResponseStep" startStep="Patient Discovery" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>AdapterPatientDiscoveryBindingSoap</con:interface>
                    <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
                    <con:path>/MockPDAdapter</con:path>
                    <con:port>1720</con:port>
                    <con:response id="b385b456-eb46-40c6-bc56-fd5b60b90850">
                        <con:settings/>
                        <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3">
   <soap:Header/>
   <soap:Body>
   <PRPA_IN201306UV02 xmlns="urn:hl7-org:v3" xmlns:ns2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns3="http://www.w3.org/2005/08/addressing" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:patientcorrelationfacade" ITSVersion="XML_1.0">
   <id root="1.1" extension="13318247:13b4e0b839b:-7ff4"/>
   <creationTime value="20121129212833"/>
   <interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
   <processingCode code="P"/>
   <processingModeCode code="T"/>
   <acceptAckCode code="NE"/>
   <receiver typeCode="RCV">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="1.2.345.678.999"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="1.1"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </receiver>
   <sender typeCode="SND">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="2.2"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="2.2"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </sender>
   <acknowledgement>
   	<typeId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
   	<typeCode code="AA"/><targetMessage xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   </acknowledgement>
   <controlActProcess classCode="CACT" moodCode="EVN">
   	<code code="PRPA_TE201306UV" codeSystem="2.16.840.1.113883.1.6"/>
   	<subject typeCode="SUBJ">
   		<registrationEvent classCode="REG" moodCode="EVN">
   			<id nullFlavor="NA"/>
   			<statusCode code="active"/>
   				<subject1 typeCode="SBJ">
   					<patient classCode="PAT">
   						<id root="1.1" extension="D123401"/>
   						<statusCode code="SD"/>
   						<patientPerson classCode="PSN" determinerCode="INSTANCE">
   							<name>
   								<family partType="FAM">Younger</family>
   								<given partType="GIV">Gallow</given>
   							</name>
   							<telecom value="tel:+1-888-555-1234"/>
   							<administrativeGenderCode code="M"/>
   							<birthTime value="19630804"/>
   							<addr><city>LEESBURG</city><state>VA</state><postalCode>20176</postalCode></addr>
   							<asOtherIDs classCode="SD">
   								<id root="2.16.840.1.113883.4.1" extension="999123401"/>
   								<scopingOrganization classCode="ORG" determinerCode="INSTANCE">
   									<id root="2.16.840.1.113883.4.1"/>
   								</scopingOrganization>
   							</asOtherIDs>
   						</patientPerson>
   						<providerOrganization classCode="ORG" determinerCode="INSTANCE">
   							<id root="1.1"/>
   							<contactParty xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   							</providerOrganization>
   							<subjectOf1>
   								<queryMatchObservation classCode="CASE" moodCode="EVN">
   									<code code="IHE_PDQ"/>
   									<value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="INT" value="100"/>
   								</queryMatchObservation>
   							</subjectOf1>
   						</patient>
   					</subject1>
   					<custodian typeCode="CST">
   						<assignedEntity classCode="ASSIGNED">
   							<id root="1.1"/>
   							<code code="NotHealthDataLocator" codeSystem="1.3.6.1.4.1.19376.1.2.27.2"/>
   						</assignedEntity>
   					</custodian>
   				</registrationEvent>
   			</subject>
   			<queryAck>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<queryResponseCode code="OK"/>
   			</queryAck>
   			<queryByParameter>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<statusCode code="new"/>
   				<responseModalityCode code="R"/>
   				<responsePriorityCode code="I"/>
   				<parameterList>
   					<livingSubjectAdministrativeGender>
   						<value code="M"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectAdministrativeGender>
   					<livingSubjectBirthTime>
   						<value value="19630804"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectBirthTime>
   					<livingSubjectId>
   						<value root="1.1" extension="1111"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectId>
   					<livingSubjectName>
   						<value>
   							<family partType="FAM">Younger</family>
   							<given partType="GIV">Gallow</given>
                        		</value>
                        		<semanticsText representation="TXT"/>
                        	</livingSubjectName>
                     </parameterList>
                 </queryByParameter>
             </controlActProcess>
     </PRPA_IN201306UV02>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                    </con:response>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="9e3838cb-3c76-46a5-9b85-1bb1ac74e589">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="e3dd9923-1302-4d2b-96e1-769bcec392c5">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Patient Discovery"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("patientDiscovery.inboundPatientDiscovery",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:22:09Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:32:09Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:22:09</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Query" searchProperties="true" id="8271858b-0d6d-4d2f-81e5-d8591b2274ae">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="2b54275c-fe05-4bfb-a9fe-8373e2bb9f7b">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="3bffbde9-fefd-4c5a-8520-db5b08bd018e">
                <con:settings/>
                <con:config>
                    <script>context.withSql('PatientCorrelationDB') { sql ->
                        def table = context.findProperty('PatientCorrelationTable')

                        sql.execute('delete from ' + table)

                        def localAA = context.findProperty( "LocalAA" )
                        def localPatientID = context.findProperty("LocalPatientID")
                        def remoteAA = context.findProperty( "RemoteAA" )
                        def remotePatientID = context.findProperty("RemotePatientID")
                        def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " +
                        "values (1, ?, ?, ?, ?)"
                        sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="a61d5537-f792-4691-9a9a-c36e8811a395">
                <con:settings/>
                <con:config>
                    <script>context.withSql('AAMappingDB') { sql ->
                        def table = context.findProperty('AAMappingTable')

                        sql.execute('delete from ' + table)

                        def remoteAA = context.findProperty( "RemoteAA" )
                        def remoteHCID = context.findProperty("RemoteHCID")
                        def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " +
                        "values (1, ?, ?)"
                        sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Document Query" type="request" id="8aed927b-9def-4c46-ac97-b6670de79f8a">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityDocQueryBindingSoap</con:interface>
                    <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
                    <con:request name="Document Query" id="166c1757-e481-4af0-aab3-a3ef579fddb1">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-DocQuery}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
         <urn2:Slot name="$XDSDocumentEntryClassCode">
            <urn2:ValueList>
                    <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
         <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="e07ebf36-d307-4d8a-9bf7-e6bb6114b7ff"/>
                        <con:assertion type="Schema Compliance" id="895469cb-7222-4288-9d90-5e4824d1e5a8">
                            <con:configuration/>
                        </con:assertion>
                        <con:assertion type="SOAP Fault Assertion" id="2b5590d2-a6f8-4c7c-b4ee-312463b27a50"/>
                        <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="c7ee9097-ad9e-42f5-9b92-307e9cd04f2f">
                            <con:configuration>
                                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
                                    def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
                                    holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
                                    holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";

                                    def documentID = context.findProperty('DQDocID')
                                    def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
                                    assert (documentID == msgDocID)</scriptText>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="208dc9f9-0ce7-4a67-a0f8-81c361705474">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="79d22fb5-68b0-4e91-8398-4509f804ad3c">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Document Query"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "3.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("docquery.30.inboundDocQuery",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:22:12Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:32:12Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:22:12</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Retrieve" searchProperties="true" id="aaab3ed0-71f1-4f72-83f0-cc840ec185cd">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="93a1ec25-187d-4fe1-83e6-6b977753af74">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Document Retrieve" type="request" id="b807c29d-ab98-4e9a-be64-486fe32411df">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityDocRetrieveBindingSoap</con:interface>
                    <con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation>
                    <con:request incomingWss="" name="Document Retrieve" outgoingWss="" wssPasswordType="" id="ea9d832b-4829-4018-b3f2-c0c8bd39a696">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@expand-mtom-attachments">true</con:setting>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-DocRetrieve}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:ihe:iti:xds-b:2007" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g1" testCase="Document Retrieve">
      <urn:RespondingGateway_CrossGatewayRetrieveRequest>
         <urn1:RetrieveDocumentSetRequest>
            <urn1:DocumentRequest>
               <urn1:HomeCommunityId>urn:oid:${#Project#RemoteHCID}</urn1:HomeCommunityId>
               <urn1:RepositoryUniqueId>${#Project#DRRepoID}</urn1:RepositoryUniqueId>
               <urn1:DocumentUniqueId>${#Project#DRDocID}</urn1:DocumentUniqueId>
            </urn1:DocumentRequest>
         </urn1:RetrieveDocumentSetRequest>
         <urn:assertion>
            <urn2:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>AddrCity</urn2:city>
               <urn2:country>AddrCountry</urn2:country>
               <urn2:state>AddrState</urn2:state>
               <urn2:streetAddress>AddrStreet</urn2:streetAddress>
               <urn2:zipCode>AddrZip</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn2:dateOfBirth>
            <urn2:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSignature>
            <urn2:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveWitnessSignature>
            <urn2:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:description>${#Project#LocalHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#LocalHCID}</urn2:homeCommunityId>
               <urn2:name>${#Project#LocalHCDescription}</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sandy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
               <urn2:fullName>Sandy S. Smith</urn2:fullName>
            </urn2:personName>
            <urn2:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5436</urn2:extension>
               <urn2:localNumber>253-6849</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Addr2City</urn2:city>
               <urn2:country>Addr2Country</urn2:country>
               <urn2:state>Addr2State</urn2:state>
               <urn2:streetAddress>Addr2Street</urn2:streetAddress>
               <urn2:zipCode>Addr2Zip</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sammy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>s</urn2:secondNameOrInitials>
               <urn2:fullName>Sammy S. Smith</urn2:fullName>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5424</urn2:extension>
               <urn2:localNumber>542-6823</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn2:SSN>
            <urn2:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn2:uniquePatientId>
            <urn2:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>addrCode</urn2:code>
                  <urn2:codeSystem>addrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>addrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>addrCode</urn2:displayName>
                  <urn2:originalText>addrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Burnell</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>FL</urn2:state>
               <urn2:streetAddress>825 North</urn2:streetAddress>
               <urn2:zipCode>32184</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Scott</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S.</urn2:secondNameOrInitials>
               <urn2:fullName>Scott S. Smith</urn2:fullName>
            </urn2:witnessName>
            <urn2:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>8432</urn2:extension>
               <urn2:localNumber>985-2239</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:personName>
                  <urn2:familyName>Skagerberg</urn2:familyName>
                  <urn2:givenName>Karl</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>nameCode</urn2:code>
                     <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                     <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                     <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                     <urn2:displayName>nameCode</urn2:displayName>
                     <urn2:originalText>nameCode</urn2:originalText>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
                  <urn2:fullName>Kasrl S. Skagerberg</urn2:fullName>
               </urn2:personName>
               <urn2:userName>kskagerb</urn2:userName>
               <urn2:org>
                  <urn2:description>${#Project#LocalHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#LocalHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#LocalHCDescription}</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>307969004</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Public Health</urn2:displayName>
                  <urn2:originalText>Public Health</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:code>PUBLICHEALTH</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Use or disclosure of Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:authInstant>2009-04-16T13:15:39Z</urn2:authInstant>
               <urn2:sessionIndex>987</urn2:sessionIndex>
               <urn2:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn2:authContextClassRef>
               <urn2:subjectLocalityAddress>1.1.1.1</urn2:subjectLocalityAddress>
               <urn2:subjectLocalityDNSName>connectopensource.org</urn2:subjectLocalityDNSName>
            </urn2:samlAuthnStatement>
            <urn2:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:decision>Permit</urn2:decision>
               <urn2:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn2:resource>
               <urn2:action>TestSaml</urn2:action>
               <urn2:evidence>
                  <urn2:assertion>
                     <urn2:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn2:id>
                     <urn2:issueInstant>2009-04-16T13:10:39.093Z</urn2:issueInstant>
                     <urn2:version>2.0</urn2:version>
                     <urn2:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn2:issuerFormat>
                     <urn2:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn2:issuer>
                     <urn2:conditions>
                        <urn2:notBefore>2009-04-16T13:10:39.093Z</urn2:notBefore>
                        <urn2:notOnOrAfter>2009-12-31T12:00:00.000Z</urn2:notOnOrAfter>
                     </urn2:conditions>
                     <urn2:accessConsentPolicy>urn:oid:1.2.3.4</urn2:accessConsentPolicy>
                     <urn2:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn2:instanceAccessConsentPolicy>
                  </urn2:assertion>
               </urn2:evidence>
            </urn2:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn2:nhinTargetCommunity>
               <urn2:homeCommunity>
                  <urn2:description>${#Project#RemoteHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#RemoteHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#RemoteHCDescription}</urn2:name>
               </urn2:homeCommunity>
            </urn2:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayRetrieveRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="20e15abc-f1db-4f2d-b132-04dad6a5d216"/>
                        <con:assertion type="SOAP Fault Assertion" id="3dc23609-dec1-48d0-ab32-bed291986ed2"/>
                        <con:assertion type="Schema Compliance" disabled="true" id="132dd449-079d-4d77-93cc-b83d8204bacf">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Doc Repository ID" type="XPath Match" id="33e28a66-f0ed-45e2-a07a-323df66fdf88">
                            <con:configuration>
                                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
                                    //ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:RepositoryUniqueId[1]</path>
                                <content>${#Project#DRRepoID}</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Doc ID" type="XPath Match" id="67311517-3b5d-44b7-9e66-694b51b2eb35">
                            <con:configuration>
                                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
                                    //ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:DocumentUniqueId[1]</path>
                                <content>${#Project#DRDocID}</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Document Data" type="GroovyScriptAssertion" id="40356897-df6f-456c-9573-c546cba0cb0b">
                            <con:configuration>
                                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
                                    def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
                                    holder.namespaces["ns"]="urn:ihe:iti:xds-b:2007"
                                    def docData = holder["//ns:RetrieveDocumentSetResponse[1]/ns:DocumentResponse[1]/ns:Document[1]"]
                                    log.info docData.toString()
                                    assert (docData.size() != 0)</scriptText>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitydocretrieve/EntityDocRetrievePortType/RespondingGateway_CrossGatewayRetrieveRequest" mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="9b5a4326-d552-447a-afdb-7934509edd0c">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="8b535650-dca9-4d8f-8971-ff55e9f1ea16">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Retrieve Document"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "3.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docretrieve.30.inbound",context);
context.setGatewayStandard(isStandardMode);log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:22:15Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:32:15Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:22:15</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Admin Distribution" searchProperties="true" id="5783cde4-97f8-4dfb-bdda-ea9d97aee5d1">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="a9bc42cc-ba0f-4b7e-9499-bbbe21153122">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Admin Distribution" type="request" id="ff87a3c4-061f-4c3b-af06-ee16f3d14102">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>AdministrativeDistribution_Binding_Soap12_g1</con:interface>
                    <con:operation>SendAlertMessage</con:operation>
                    <con:request name="Admin Distribution" id="3208de83-8127-4a54-b4d7-81b57918c52f">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-EntityAdminDist}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:emergency:EDXL:DE:1.0">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g1" testCase="Admin Distribution">
      <urn:RespondingGateway_SendAlertMessage>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253987546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>${#TestCase#UserId}</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>80584001</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Psychiatrist</urn1:displayName>
                  <urn1:originalText>Psychiatrist</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PSYCHOTHERAPY</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-09-01T13:00:00.000Z</urn1:authInstant>
               <urn1:sessionIndex>mySessionIndex</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>mySubjectLocalityAddress</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>mySubjectLocalityDns</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>myAuthzDecisionStatementResource</urn1:resource>
               <urn1:action>myAuthzDecisionStatementAction</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>AuthzDecisionStatementEvidenceAssertionId</urn1:id>
                     <urn1:issueInstant>2009-09-02T14:00:00.000Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuer>CN=Mr Saml User,OU=SU,O=Mr SAML Org,L=Chantilly,ST=VA,C=US</urn1:issuer>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>urn:oid:1.2.3.4</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:243113487404</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:159355901562</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:383675305350</urn1:signatureValue>
            </urn1:samlSignature>
            </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
               <urn1:list>?</urn1:list>
               <urn1:region>?</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn2:EDXLDistribution>
            <urn2:distributionID>633990682441061250</urn2:distributionID>
            <urn2:senderID>actor@2.16.840.1.113883.3.166</urn2:senderID>
            <urn2:dateTimeSent>2010-08-14T12:18:13.512375-08:00</urn2:dateTimeSent>
            <urn2:distributionStatus>Actual</urn2:distributionStatus>
            <urn2:distributionType>Update</urn2:distributionType>
            <urn2:combinedConfidentiality>Public</urn2:combinedConfidentiality>
            <!--Optional:-->
            <urn2:language>?</urn2:language>
            <!--Zero or more repetitions:-->
            <urn2:senderRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:senderRole>
            <!--Zero or more repetitions:-->
            <urn2:recipientRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:recipientRole>
            <!--Zero or more repetitions:-->
            <urn2:keyword>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:keyword>
            <!--Zero or more repetitions:-->
            <urn2:distributionReference>?</urn2:distributionReference>
            <!--Zero or more repetitions:-->
            <urn2:explicitAddress>
               <urn2:explicitAddressScheme>modified_IHEIntendedRecipient</urn2:explicitAddressScheme>
               <!--1 or more repetitions:-->
               <urn2:explicitAddressValue>^^^^^^^^^2.16.840.1.113883.3.166|0000000001</urn2:explicitAddressValue>
            </urn2:explicitAddress>
            <!--Zero or more repetitions:-->
            <urn2:targetArea>
               <!--Zero or more repetitions:-->
               <urn2:circle>?</urn2:circle>
               <!--Zero or more repetitions:-->
               <urn2:polygon>?</urn2:polygon>
               <!--Zero or more repetitions:-->
               <urn2:country>?</urn2:country>
               <!--Zero or more repetitions:-->
               <urn2:subdivision>?</urn2:subdivision>
               <!--Zero or more repetitions:-->
               <urn2:locCodeUN>?</urn2:locCodeUN>
            </urn2:targetArea>
            <!--Zero or more repetitions:-->
            <urn2:contentObject>
               <!--Optional:-->
               <urn2:contentDescription>PH Alert Message</urn2:contentDescription>
               <!--Zero or more repetitions:-->
               <urn2:contentKeyword>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:contentKeyword>
               <!--Optional:-->
               <urn2:incidentID>TEST</urn2:incidentID>
               <!--Optional:-->
               <urn2:incidentDescription>This is a test message</urn2:incidentDescription>
               <!--Zero or more repetitions:-->
               <urn2:originatorRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:originatorRole>
               <!--Zero or more repetitions:-->
               <urn2:consumerRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:consumerRole>
               <!--Optional:-->
               <urn2:confidentiality>Public</urn2:confidentiality>
               <!--You have a CHOICE of the next 2 items at this level-->
		<urn2:nonXMLContent>
                  <urn2:mimeType>application/pdf</urn2:mimeType>
                  <!--Optional:-->
                  <urn2:size>19</urn2:size>
                  <!--Optional:-->
                  <urn2:digest>?</urn2:digest>
                  <!--Optional:-->
                  <urn2:uri>?</urn2:uri>
                  <!--Optional:-->
                  <urn2:contentData>LDLIHAPIISDALKDF902383K1182K4J49DFNF3KR0482HJ1029F393</urn2:contentData>
               </urn2:nonXMLContent>
               <!--You may enter ANY elements at this point-->
            </urn2:contentObject>
         </urn2:EDXLDistribution>
      </urn:RespondingGateway_SendAlertMessage>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="Valid HTTP Status Codes" name="Valid HTTP Status Codes" id="d78c4c71-675e-4e63-9686-c80ac9ae4fe0">
                            <con:configuration>
                                <codes>202</codes>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep name="Delay" type="delay" id="dfd5195e-0989-4248-86dc-af28eb0b378e">
                <con:settings/>
                <con:config><delay>15000</delay></con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="0710ead2-4643-491d-aed3-da7b97dc02dd">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="cbd8f55e-e0d5-49c5-8d9b-e339e60e3cbb">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Admin Distribution"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("admindist.inboundAdminDist",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:22:18Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:32:18Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:22:18</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
        </con:testCase>
        <con:testCase id="afa07c91-a57a-4d44-bee2-b77e3b0a5ee8" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Data Submission" searchProperties="true"><con:settings/><con:testStep type="groovy" name="Clear Event Logs" id="85963319-206d-43b7-a47a-e6ba2141760e">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep><con:testStep type="request" name="Document Data Submission" id="5f37d47f-6bfe-4291-912c-0b7f7d1ada1b"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EntityXDS_Binding</con:interface><con:operation>RegisterDocumentSet-b</con:operation><con:request name="Document Data Submission" id="4e55f44c-99ef-43be-8f1b-56336846d52c"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/Gateway/DocumentDataSubmission/1_0/EntityService/EntityDocDataSubmissionUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
    <soap:Header/>
    <soap:Body testSuite="Entity_g1" testCase="Document Data Submission">
      <urn:RespondingGateway_RegisterDocumentSetRequest>
        <urn:assertion>
          <urn1:messageId>${#Project#messageID}</urn1:messageId>
          <urn1:address>
            <urn1:addressType>
              <urn1:code>AddrCode</urn1:code>
              <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
              <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>AddrCode</urn1:displayName>
              <urn1:originalText>AddrCode</urn1:originalText>
            </urn1:addressType>
            <urn1:city>AddrCity</urn1:city>
            <urn1:country>AddrCountry</urn1:country>
            <urn1:state>AddrState</urn1:state>
            <urn1:streetAddress>AddrStreet</urn1:streetAddress>
            <urn1:zipCode>AddrZip</urn1:zipCode>
          </urn1:address>
          <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
          <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
          <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
          <urn1:haveSignature>false</urn1:haveSignature>
          <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
          <urn1:homeCommunity>
            <urn1:description>${#Project#LocalHCDescription}</urn1:description>
            <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
            <urn1:name>${#Project#LocalHCDescription}</urn1:name>
          </urn1:homeCommunity>
          <urn1:personName>
            <urn1:familyName>Smith</urn1:familyName>
            <urn1:givenName>Sandy</urn1:givenName>
            <urn1:nameType>
              <urn1:code>nameCode</urn1:code>
              <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
              <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>nameCode</urn1:displayName>
              <urn1:originalText>nameCode</urn1:originalText>
            </urn1:nameType>
            <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
            <urn1:fullName>Sandy S. Smith</urn1:fullName>
          </urn1:personName>
          <urn1:phoneNumber>
            <urn1:areaCode>321</urn1:areaCode>
            <urn1:countryCode>1</urn1:countryCode>
            <urn1:extension>5436</urn1:extension>
            <urn1:localNumber>253-6849</urn1:localNumber>
            <urn1:phoneNumberType>
              <urn1:code>phoneCode</urn1:code>
              <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
              <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>phoneCode</urn1:displayName>
              <urn1:originalText>phoneCode</urn1:originalText>
            </urn1:phoneNumberType>
          </urn1:phoneNumber>
          <urn1:secondWitnessAddress>
            <urn1:addressType>
              <urn1:code>AddrCode</urn1:code>
              <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
              <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>AddrCode</urn1:displayName>
              <urn1:originalText>AddrCode</urn1:originalText>
            </urn1:addressType>
            <urn1:city>Addr2City</urn1:city>
            <urn1:country>Addr2Country</urn1:country>
            <urn1:state>Addr2State</urn1:state>
            <urn1:streetAddress>Addr2Street</urn1:streetAddress>
            <urn1:zipCode>Addr2Zip</urn1:zipCode>
          </urn1:secondWitnessAddress>
          <urn1:secondWitnessName>
            <urn1:familyName>Smith</urn1:familyName>
            <urn1:givenName>Sammy</urn1:givenName>
            <urn1:nameType>
              <urn1:code>nameCode</urn1:code>
              <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
              <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>nameCode</urn1:displayName>
              <urn1:originalText>nameCode</urn1:originalText>
            </urn1:nameType>
            <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
            <urn1:fullName>Sammy S. Smith</urn1:fullName>
          </urn1:secondWitnessName>
          <urn1:secondWitnessPhone>
            <urn1:areaCode>321</urn1:areaCode>
            <urn1:countryCode>1</urn1:countryCode>
            <urn1:extension>5424</urn1:extension>
            <urn1:localNumber>542-6823</urn1:localNumber>
            <urn1:phoneNumberType>
              <urn1:code>phoneCode</urn1:code>
              <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
              <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>phoneCode</urn1:displayName>
              <urn1:originalText>phoneCode</urn1:originalText>
            </urn1:phoneNumberType>
          </urn1:secondWitnessPhone>
          <urn1:SSN>253-98-7546</urn1:SSN>
          <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
          <urn1:witnessAddress>
            <urn1:addressType>
              <urn1:code>addrCode</urn1:code>
              <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
              <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>addrCode</urn1:displayName>
              <urn1:originalText>addrCode</urn1:originalText>
            </urn1:addressType>
            <urn1:city>Burnell</urn1:city>
            <urn1:country>USA</urn1:country>
            <urn1:state>FL</urn1:state>
            <urn1:streetAddress>825 North</urn1:streetAddress>
            <urn1:zipCode>32184</urn1:zipCode>
          </urn1:witnessAddress>
          <urn1:witnessName>
            <urn1:familyName>Smith</urn1:familyName>
            <urn1:givenName>Scott</urn1:givenName>
            <urn1:nameType>
              <urn1:code>nameCode</urn1:code>
              <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
              <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>nameCode</urn1:displayName>
              <urn1:originalText>nameCode</urn1:originalText>
            </urn1:nameType>
            <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
            <urn1:fullName>Scott S. Smith</urn1:fullName>
          </urn1:witnessName>
          <urn1:witnessPhone>
            <urn1:areaCode>321</urn1:areaCode>
            <urn1:countryCode>1</urn1:countryCode>
            <urn1:extension>8432</urn1:extension>
            <urn1:localNumber>985-2239</urn1:localNumber>
            <urn1:phoneNumberType>
              <urn1:code>phoneCode</urn1:code>
              <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
              <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>phoneCode</urn1:displayName>
              <urn1:originalText>phoneCode</urn1:originalText>
            </urn1:phoneNumberType>
          </urn1:witnessPhone>
          <urn1:userInfo>
            <urn1:personName>
              <urn1:familyName>Skagerberg</urn1:familyName>
              <urn1:givenName>Karl</urn1:givenName>
              <urn1:nameType>
                <urn1:code>nameCode</urn1:code>
                <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                <urn1:displayName>nameCode</urn1:displayName>
                <urn1:originalText>nameCode</urn1:originalText>
              </urn1:nameType>
              <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
              <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
            </urn1:personName>
            <urn1:userName>kskagerb</urn1:userName>
            <urn1:org>
              <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
              <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
              <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
            </urn1:org>
            <urn1:roleCoded>
              <urn1:code>307969004</urn1:code>
              <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
              <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
              <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
              <urn1:displayName>Public Health</urn1:displayName>
              <urn1:originalText>Public Health</urn1:originalText>
            </urn1:roleCoded>
          </urn1:userInfo>
          <urn1:authorized>true</urn1:authorized>
          <urn1:purposeOfDisclosureCoded>
            <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
            <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
            <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
            <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
            <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
            <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
          </urn1:purposeOfDisclosureCoded>
          <urn1:samlAuthnStatement>
            <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
            <urn1:sessionIndex>987</urn1:sessionIndex>
            <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
            <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
            <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
          </urn1:samlAuthnStatement>
          <urn1:samlAuthzDecisionStatement>
            <urn1:decision>Permit</urn1:decision>
            <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
            <urn1:action>TestSaml</urn1:action>
            <urn1:evidence>
              <urn1:assertion>
                <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                <urn1:version>2.0</urn1:version>
                <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                <urn1:conditions>
                  <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                  <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                </urn1:conditions>
                <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
              </urn1:assertion>
            </urn1:evidence>
          </urn1:samlAuthzDecisionStatement>
        </urn:assertion>
        <urn:nhinTargetCommunities>
          <urn1:nhinTargetCommunity>
            <urn1:homeCommunity>
              <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
              <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
              <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
            </urn1:homeCommunity>
          </urn1:nhinTargetCommunity>
        </urn:nhinTargetCommunities>
        <urn:RegisterDocumentSetRequest>
          <urn2:SubmitObjectsRequest id="123" comment="comment">
            <!--Optional:-->
            <urn4:RegistryObjectList>
              <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                <urn4:Slot name="creationTime">
                  <urn4:ValueList>
                    <urn4:Value>20051224</urn4:Value>
                  </urn4:ValueList>
                </urn4:Slot>
                <urn4:Slot name="languageCode">
                  <urn4:ValueList>
                    <urn4:Value>en-us</urn4:Value>
                  </urn4:ValueList>
                </urn4:Slot>
                <urn4:Slot name="serviceStartTime">
                  <urn4:ValueList>
                    <urn4:Value>200412230800</urn4:Value>
                  </urn4:ValueList>
                </urn4:Slot>
                <urn4:Slot name="serviceStopTime">
                  <urn4:ValueList>
                    <urn4:Value>200412230801</urn4:Value>
                  </urn4:ValueList>
                </urn4:Slot>
                <urn4:Slot name="sourcePatientId">
                  <urn4:ValueList>
                    <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                  </urn4:ValueList>
                </urn4:Slot>
                <urn4:Slot name="sourcePatientInfo">
                  <urn4:ValueList>
                    <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                    <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                    <urn4:Value>PID-7|19560527</urn4:Value>
                    <urn4:Value>PID-8|M</urn4:Value>
                    <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                  </urn4:ValueList>
                </urn4:Slot>
                <urn4:Name>
                  <urn4:LocalizedString value="Physical"/>
                </urn4:Name>
                <urn4:Description/>
                <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                  <urn4:Slot name="authorPerson">
                    <urn4:ValueList>
                      <urn4:Value>Gerald Smitty</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Slot name="authorInstitution">
                    <urn4:ValueList>
                      <urn4:Value>Cleveland Clinic</urn4:Value>
                      <urn4:Value>Parma Community</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Slot name="authorRole">
                    <urn4:ValueList>
                      <urn4:Value>Attending</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Slot name="authorSpecialty">
                    <urn4:ValueList>
                      <urn4:Value>Orthopedic</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                </urn4:Classification>
                <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                  <urn4:Slot name="codingScheme">
                    <urn4:ValueList>
                      <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Name>
                    <urn4:LocalizedString value="History and Physical"/>
                  </urn4:Name>
                </urn4:Classification>
                <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                  <urn4:Slot name="codingScheme">
                    <urn4:ValueList>
                      <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Name>
                    <urn4:LocalizedString value="Clinical-Staff"/>
                  </urn4:Name>
                </urn4:Classification>
                <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                  <urn4:Slot name="codingScheme">
                    <urn4:ValueList>
                      <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Name>
                    <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                  </urn4:Name>
                </urn4:Classification>
                <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                  <urn4:Slot name="codingScheme">
                    <urn4:ValueList>
                      <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Name>
                    <urn4:LocalizedString value="Outpatient"/>
                  </urn4:Name>
                </urn4:Classification>
                <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                  <urn4:Slot name="codingScheme">
                    <urn4:ValueList>
                      <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Name>
                    <urn4:LocalizedString value="General Medicine"/>
                  </urn4:Name>
                </urn4:Classification>
                <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                  <urn4:Slot name="codingScheme">
                    <urn4:ValueList>
                      <urn4:Value>LOINC</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Name>
                    <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                  </urn4:Name>
                </urn4:Classification>
                <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                  <urn4:Name>
                    <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                  </urn4:Name>
                </urn4:ExternalIdentifier>
                <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.2.3.4.5.6.78901.2345.6.7890.12">
                  <urn4:Name>
                    <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </urn4:Name>
                </urn4:ExternalIdentifier>
              </urn4:ExtrinsicObject>
              <urn4:RegistryPackage id="SubmissionSet01">
                <urn4:Slot name="submissionTime">
                  <urn4:ValueList>
                    <urn4:Value>20041225235050</urn4:Value>
                  </urn4:ValueList>
                </urn4:Slot>
                <urn4:Name>
                  <urn4:LocalizedString value="Physical"/>
                </urn4:Name>
                <urn4:Description>
                  <urn4:LocalizedString value="Annual physical"/>
                </urn4:Description>
                <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                  <urn4:Slot name="authorPerson">
                    <urn4:ValueList>
                      <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Slot name="authorInstitution">
                    <urn4:ValueList>
                      <urn4:Value>Cleveland Clinic</urn4:Value>
                      <urn4:Value>Berea Community</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Slot name="authorRole">
                    <urn4:ValueList>
                      <urn4:Value>Purn4ary Surgon</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Slot name="authorSpecialty">
                    <urn4:ValueList>
                      <urn4:Value>Orthopedic</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                </urn4:Classification>
                <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                  <urn4:Slot name="codingScheme">
                    <urn4:ValueList>
                      <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                    </urn4:ValueList>
                  </urn4:Slot>
                  <urn4:Name>
                    <urn4:LocalizedString value="History and Physical"/>
                  </urn4:Name>
                </urn4:Classification>
                <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.2.3.4.5.6.78901.2345.6.7890.12">
                  <urn4:Name>
                    <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                  </urn4:Name>
                </urn4:ExternalIdentifier>
                <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                  <urn4:Name>
                    <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                  </urn4:Name>
                </urn4:ExternalIdentifier>
                <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                  <urn4:Name>
                    <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                  </urn4:Name>
                </urn4:ExternalIdentifier>
              </urn4:RegistryPackage>
              <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
              <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                <urn4:Slot name="SubmissionSetStatus">
                  <urn4:ValueList>
                    <urn4:Value>Original</urn4:Value>
                  </urn4:ValueList>
                </urn4:Slot>
              </urn4:Association>
            </urn4:RegistryObjectList>
          </urn2:SubmitObjectsRequest>         
        </urn:RegisterDocumentSetRequest>
      </urn:RespondingGateway_RegisterDocumentSetRequest>
    </soap:Body>
</soap:Envelope>]]></con:request><con:assertion type="SOAP Response" id="97e9021d-1313-430c-8571-4658a4d177ba"/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="Verify Event Logs" id="1f64847e-8178-4cdc-a186-7ca3134f7561">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep><con:testStep type="groovy" name="Verify Elements in Event Log" id="418181c6-e445-4006-afaa-7192ef57d195">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Document Data Submission"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep><con:properties/></con:testCase><con:testCase id="abf448a5-c0a6-42eb-84c3-e0b08d1a9819" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Location Query" searchProperties="true"><con:settings/><con:testStep type="groovy" name="Clear Event Logs" id="b7639e1d-adbc-4f3b-ab60-8b72c676ab98">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep><con:testStep type="request" name="Patient Location Query" id="99b7a9fb-50cb-479e-ac92-866c622fccd6"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EntityPatientLocationQueryBindingSoap</con:interface><con:operation>RespondingGateway_PatientLocationQuery</con:operation><con:request name="Patient Location Query" id="c6ddb16f-e527-4d8a-8575-b24c291df857"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientLocationQuery</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn2="urn:ihe:iti:xcpd:2009" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body>
      <urn:RespondingGateway_PatientLocationQueryRequest>
         <urn2:PatientLocationQueryRequest>
            <urn2:RequestedPatientId root="${#Project#LocalAA}" extension="${#Project#PLQRequestPatientId}" />
         </urn2:PatientLocationQueryRequest>
         <urn:assertion>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTH</urn1:code>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PatientLocationQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion" id="9ef901b6-3d34-4e66-b483-d2b10008e6d6" name="Not SOAP Fault"/><con:assertion type="SOAP Response" id="20dc9b73-2174-4430-a2fb-1ed8b6a144e6"/><con:assertion type="XPath Match" id="29f542bd-6425-4e0d-9429-c5911d723d36" name="XPath Match - count(PatientLocationResponse)"><con:configuration><path>declare namespace ns1='urn:ihe:iti:xcpd:2009'; declare namespace ns3="urn:gov:hhs:fha:nhinc:common:nhinccommonentity";

count(//ns3:RespondingGateway_PatientLocationQueryResponse/ns1:PatientLocationQueryResponse/ns1:PatientLocationResponse)</path><content>2</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="Verify Event Logs" id="879e109c-1fbe-4f8b-97ee-36942205f374">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep><con:testStep type="groovy" name="Verify Elements in Event Log" id="89254dc2-8272-49ba-a715-1bdb573c1e7f">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
       def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Patient Location Query"')
       assert resultset.size !=0
       resultset.each { item ->
                        validateElements(item)
       }
}

public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG1ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);</con:setupScript><con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);</con:tearDownScript><con:properties/></con:testCase><con:properties>
            <con:property>
                <con:name>Endpoint-DocRetrieve</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-DSDeferredResp</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-EntityAdminDist</con:name>
                <con:value>http://localhost:8080/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-EntityXDRRequest</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-XDREntity</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionUnsecured</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-DocQuery</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-PatientDiscovery</con:name>
                <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-PatientDiscoveryAsyncReq</con:name>
                <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-PatientDiscoveryAsyncResp</con:name>
                <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:value>
            </con:property>
        </con:properties>
        <con:setupScript/>
        <con:tearDownScript/>
        <con:reportParameters/>
    </con:testSuite>
    <con:testSuite name="g0" id="ca96017d-46bb-4ac0-90a9-556f99b0ad5c">
        <con:settings/>
        <con:runType>SEQUENTIAL</con:runType>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission Deferred Req" searchProperties="true" id="94e4f365-297e-4c77-aba9-1de42c5decb5">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="512b1e5a-04cc-40e4-88dd-8433f66a1118">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Doc Submission Deferred Req" type="request" id="9d7c4379-a972-4be1-b1a1-def0ba9c65ee">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityXDRAsyncRequest_Binding</con:interface>
                    <con:operation>ProvideAndRegisterDocumentSet-bAsyncRequest</con:operation>
                    <con:request incomingWss="" name="Doc Submission Deferred Req" outgoingWss="" useWsAddressing="true" wssPasswordType="" id="4679ecb1-5226-455f-a98f-75fa19d2c4f5">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-EntityXDRRequest}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g0" testCase="Document Submission Deferred Request">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->

               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList>

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="f12da52f-b0d6-41af-944a-c1c726301825"/>
                        <con:assertion type="SOAP Fault Assertion" id="c6d4a54f-c4a0-477f-9473-0e78aa410409"/>
                        <con:assertion name="Match content of [@status]" type="XPath Match" id="5dc68e26-d010-4d72-8491-7afa409e6a8f">
                            <con:configuration>
                                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
                                    //ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:RequestAccepted</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Schema Compliance" type="Schema Compliance" id="0ee37314-b95d-4498-8bfd-e45c2a5121b1">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion type="Schema Compliance" id="6e485f18-a73b-48a6-90e9-08515ea040ae">
                            <con:configuration/>
                        </con:assertion>
                        <con:credentials>
                            <con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincentityxdr:async:request:ProvideAndRegisterDocumentSet-bAsyncRequest_RequestMessage" generateMessageId="true" mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="3afbbd82-5962-4c35-8119-114095bbf3d0">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="6981d26d-8099-42e0-9e8f-41b4983fe03f">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
    def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Document Submission Deferred Request"')
    assert resultset.size !=0
          resultset.each { item ->
          validateElements(item)
    }
}
public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.1"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG0ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("docsubmission.inboundDocSubmissionRequest",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:28:30Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:38:30Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:28:30</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission Deferred Resp" searchProperties="true" id="fffd46f0-f42b-442d-a5f4-3c91df14ea93">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="a9c97447-dfb3-4462-b812-a68a2c02f20f">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Doc Submission Deferred Resp" type="request" id="6ec18f68-3b83-403a-a93a-cd4528be236e">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityXDRAsyncResponse_Binding</con:interface>
                    <con:operation>ProvideAndRegisterDocumentSet-bAsyncResponse</con:operation>
                    <con:request name="Doc Submission Deferred Resp" id="c6bc3994-e136-41bc-8800-9be8297526d5">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-DSDeferredResp}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g0" testCase="Document Submission Deferred Resp">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
               <urn1:prefix>Ms.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>?addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
               <urn1:prefix>Mr.</urn1:prefix>
               <urn1:suffix>?</urn1:suffix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>SkagerBerg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                     <!--Zero or more repetitions:-->
                     <urn1:translation/>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Karl S. Skagerberg</urn1:fullName>
                  <urn1:prefix>?</urn1:prefix>
                  <urn1:suffix>?</urn1:suffix>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <!--Optional:-->
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy notes</urn1:originalText>
               <!--Zero or more repetitions:-->
               <urn1:translation/>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <!--Optional:-->
                     <urn1:version>2.0</urn1:version>
                     <!--Optional:-->
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <!--Optional:-->
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <!--Optional:-->
                     <urn1:conditions>
                        <!--Optional:-->
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <!--Optional:-->
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <!--Zero or more repetitions:-->
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <!--Zero or more repetitions:-->
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:721645965035</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:146207300753</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:783710993742</urn1:signatureValue>
            </urn1:samlSignature>
            <!--Optional:-->
            <urn1:samlIssuer>
               <!--Optional:-->
               <urn1:issuer>?</urn1:issuer>
               <!--Optional:-->
               <urn1:issuerFormat>?</urn1:issuerFormat>
            </urn1:samlIssuer>
            <!--Optional:-->
            <urn1:messageId>?</urn1:messageId>
            <!--1 or more repetitions:-->
            <urn1:relatesToList>uuid:088a26e8-6b03-4bf8-84f1-737dc94be2e0</urn1:relatesToList>
         </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn:RegistryResponse status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" requestId="?"><!--Optional:-->
            <urn2:ResponseSlotList>
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
            </urn2:ResponseSlotList>
            <!--Optional:-->
            <urn2:RegistryErrorList highestSeverity="?">
               <!--1 or more repetitions:-->
               <urn2:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn2:RegistryError>
            </urn2:RegistryErrorList>
         </urn:RegistryResponse>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetResponseRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="b1ab5d1e-4a94-4c7e-a4cc-fa961e25298b"/>
                        <con:assertion type="Schema Compliance" id="ab0f21fd-0115-4e9f-af0b-d754400ae820">
                            <con:configuration/>
                        </con:assertion>
                        <con:assertion type="SOAP Fault Assertion" id="1e644cdf-be28-4071-aa4d-c693c08c9806"/>
                        <con:assertion type="XPath Match" id="aa8a403a-224e-4afa-b2c5-752b043b6f29">
                            <con:configuration>
                                <path>declare namespace ns10='http://www.hhs.gov/healthit/nhin';
                                    //ns10:XDRAcknowledgement[1]/ns10:message[1]/@status</path>
                                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:ResponseAccepted</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="65201083-b667-446f-8607-bc3d032e1dfe">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="3e5a1573-bd86-4e24-99ee-d12cdc49fee1">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
    def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Document Submission Deferred Response"')
    assert resultset.size !=0
          resultset.each { item ->
          validateElements(item)
    }
}
public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.1"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG0ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("docsubmission.inboundDocSubmissionResponse",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:28:32Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:38:32Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:28:32</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Submission" searchProperties="true" id="fb0a6077-5978-4615-ae36-a77a19ceef7d">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="c03f287a-93d0-477b-8674-e25902faa408">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Doc Submission" type="request" id="3a1a7eae-6461-4221-94ef-8b19bb707a0d">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityXDR_Binding</con:interface>
                    <con:operation>ProvideAndRegisterDocumentSet-b</con:operation>
                    <con:request incomingWss="" name="Doc Submission" outgoingWss="" wssPasswordType="" id="215b0a0d-e330-4ced-8bd6-1787d83fa8e8">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-XDREntity}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn5="urn:ihe:iti:xds-b:2007">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g0" testCase="Document Submission">
      <urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253-98-7546</urn1:SSN>
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>kskagerb</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>

         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>

         <urn:ProvideAndRegisterDocumentSetRequest>
            <urn2:SubmitObjectsRequest id="123" comment="comme">
               <!--Optional:-->

               <urn4:RegistryObjectList>
                  <urn4:ExtrinsicObject id="Document01" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1">
                     <urn4:Slot name="creationTime">
                        <urn4:ValueList>
                           <urn4:Value>20051224</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="languageCode">
                        <urn4:ValueList>
                           <urn4:Value>en-us</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStartTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230800</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="serviceStopTime">
                        <urn4:ValueList>
                           <urn4:Value>200412230801</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientId">
                        <urn4:ValueList>
                           <urn4:Value>ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Slot name="sourcePatientInfo">
                        <urn4:ValueList>
                           <urn4:Value>PID-3|ST-1000^^^&amp;1.3.6.1.4.1.21367.2003.3.9&amp;ISO</urn4:Value>
                           <urn4:Value>PID-5|Doe^John^^^</urn4:Value>
                           <urn4:Value>PID-7|19560527</urn4:Value>
                           <urn4:Value>PID-8|M</urn4:Value>
                           <urn4:Value>PID-11|100 Main St^^Metropolis^Il^44130^USA</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description/>
                     <urn4:Classification id="cl01" classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="Document01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Gerald Smitty</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Parma Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Attending</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl02" classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="Document01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon classCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl03" classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="Document01" nodeRepresentation="1.3.6.1.4.1.21367.2006.7.101">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon confidentialityCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Clinical-Staff"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl04" classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="Document01" nodeRepresentation="CDAR2/IHE 1.0">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon formatCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="CDAR2/IHE 1.0"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl05" classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="Document01" nodeRepresentation="Outpatient">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon healthcareFacilityTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl06" classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="Document01" nodeRepresentation="General Medicine">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon practiceSettingCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="General Medicine"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:Classification id="cl07" classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="Document01" nodeRepresentation="34108-1">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>LOINC</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="Outpatient Evaluation And Management"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei01" registryObject="Document01" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei02" registryObject="Document01" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" value="1.3.6.1.4.1.21367.2005.3.9999.32">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSDocumentEntry.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:ExtrinsicObject>
                  <urn4:RegistryPackage id="SubmissionSet01">
                     <urn4:Slot name="submissionTime">
                        <urn4:ValueList>
                           <urn4:Value>20041225235050</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                     <urn4:Name>
                        <urn4:LocalizedString value="Physical"/>
                     </urn4:Name>
                     <urn4:Description>
                        <urn4:LocalizedString value="Annual physical"/>
                     </urn4:Description>
                     <urn4:Classification id="cl08" classificationScheme="urn:uuid:a7058bb9-b4e4-4307-ba5b-e3f0ab85e12d" classifiedObject="SubmissionSet01">
                        <urn4:Slot name="authorPerson">
                           <urn4:ValueList>
                              <urn4:Value>Sherry Dopplemeyer</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorInstitution">
                           <urn4:ValueList>
                              <urn4:Value>Cleveland Clinic</urn4:Value>
                              <urn4:Value>Berea Community</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorRole">
                           <urn4:ValueList>
                              <urn4:Value>Purn4ary Surgon</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Slot name="authorSpecialty">
                           <urn4:ValueList>
                              <urn4:Value>Orthopedic</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                     </urn4:Classification>
                     <urn4:Classification id="cl09" classificationScheme="urn:uuid:aa543740-bdda-424e-8c96-df4873be8500" classifiedObject="SubmissionSet01" nodeRepresentation="History and Physical">
                        <urn4:Slot name="codingScheme">
                           <urn4:ValueList>
                              <urn4:Value>Connect-a-thon contentTypeCodes</urn4:Value>
                           </urn4:ValueList>
                        </urn4:Slot>
                        <urn4:Name>
                           <urn4:LocalizedString value="History and Physical"/>
                        </urn4:Name>
                     </urn4:Classification>
                     <urn4:ExternalIdentifier id="ei03" registryObject="SubmissionSet01" identificationScheme="urn:uuid:96fdda7c-d067-4183-912e-bf5ee74998a8" value="1.3.6.1.4.1.21367.2005.3.9999.33">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.uniqueId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei04" registryObject="SubmissionSet01" identificationScheme="urn:uuid:554ac39e-e3fe-47fe-b233-965d2a147832" value="3670984664">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.sourceId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                     <urn4:ExternalIdentifier id="ei05" registryObject="SubmissionSet01" identificationScheme="urn:uuid:6b5aea1a-874d-4603-a4bc-96a0a7b38446" value="SELF-5^^^&amp;1.3.6.1.4.1.21367.2005.3.7&amp;ISO">
                        <urn4:Name>
                           <urn4:LocalizedString value="XDSSubmissionSet.patientId"/>
                        </urn4:Name>
                     </urn4:ExternalIdentifier>
                  </urn4:RegistryPackage>
                  <urn4:Classification id="cl10" classifiedObject="SubmissionSet01" classificationNode="urn:uuid:a54d6aa5-d40d-43f9-88c5-b4633d873bdd"/>
                  <urn4:Association id="as01" associationType="HasMember" sourceObject="SubmissionSet01" targetObject="Document01">
                     <urn4:Slot name="SubmissionSetStatus">
                        <urn4:ValueList>
                           <urn4:Value>Original</urn4:Value>
                        </urn4:ValueList>
                     </urn4:Slot>
                  </urn4:Association>
               </urn4:RegistryObjectList>

            </urn2:SubmitObjectsRequest>
            <!--1 or more repetitions:-->
            <urn5:Document id="Document01">UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi</urn5:Document>
         </urn:ProvideAndRegisterDocumentSetRequest>
      </urn:RespondingGateway_ProvideAndRegisterDocumentSetRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="debc881a-6992-426a-ba7e-7b36a8c10629"/>
                        <con:assertion type="SOAP Fault Assertion" id="553ad87c-2621-47e5-911b-e30668b1b1c7"/>
                        <con:assertion type="XPath Match" id="e4f69f2a-dc31-4df0-a1c6-6d2f21f21742">
                            <con:configuration>
                                <path>declare namespace ns11='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
                                    //ns11:RegistryResponse[1]/@status</path>
                                <content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Schema Compliance" type="Schema Compliance" id="59ac641d-a9d7-4c13-9716-af9e38e3f223">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig action="{urn:gov:hhs:fha:nhinc:nhincentityxdr}ProvideAndRegisterDocumentSet-b" mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="cc3136c3-eff1-4e3a-beb6-4b7930057c2a">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="9e5b0534-6f1f-4a82-b99f-c8af33ab22b5">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
    def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Document Submission"')
    assert resultset.size !=0
          resultset.each { item ->
          validateElements(item)
    }
}
public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.1"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG0ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("docsubmission.inboundDocSubmission",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:28:35Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:38:35Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:28:35</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery Deferred Req" searchProperties="true" id="2d01ba9b-8e2f-4495-9afb-0df274e6ff49">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="4eb2bff7-3154-4521-989e-50124c3f63e7">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Patient Discovery Deferred Req" type="request" id="363b00be-7cf6-4a38-857b-4da7774294d4">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityPatientDiscoveryAsyncReqBindingSoap</con:interface>
                    <con:operation>ProcessPatientDiscoveryAsyncReq</con:operation>
                    <con:request name="Patient Discovery Deferred Req" useWsAddressing="true" id="799a39bd-5475-44d9-b80d-b08eedd1ac5e">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-PatientDiscoveryAsyncReq}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g0" testCase="Patient Discovery Deferred Req">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#RemoteHCID}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#LocalPatientID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <!--Optional:-->
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <!--Optional:-->
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="2d999aeb-1bbd-4f65-af00-979104850be6"/>
                        <con:assertion type="SOAP Fault Assertion" id="ab82fe4c-7362-4fc5-9df6-328a9144e6bc"/>
                        <con:assertion name="Verify Receiver" type="XPath Match" id="2417c7b2-b291-4671-a71b-6ad56ab26cbd">
                            <con:configuration>
                                <path>declare namespace ns3='urn:hl7-org:v3';
                                    //ns3:MCCI_IN000002UV01[1]/ns3:receiver[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                                <content>1.1</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Verify Sender" type="XPath Match" id="b7af9b12-6c2f-448f-ab75-1729e0aafe57">
                            <con:configuration>
                                <path>declare namespace ns3='urn:hl7-org:v3';
                                    //ns3:MCCI_IN000002UV01[1]/ns3:sender[1]/ns3:device[1]/ns3:asAgent[1]/ns3:representedOrganization[1]/ns3:id[1]/@root</path>
                                <content>2.2</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Verify Message" type="XPath Match" id="07f6348e-8dc3-4abc-8c42-d20ee0a722b8">
                            <con:configuration>
                                <path>declare namespace ns3='urn:hl7-org:v3';
                                    //ns3:MCCI_IN000002UV01[1]/ns3:acknowledgement[1]/ns3:acknowledgementDetail[1]/ns3:text[1]/text()</path>
                                <content>Success</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Verify RelatesTo" type="XPath Match" id="e9511b88-96e5-4be1-868c-c1de5ffa8671">
                            <con:configuration>
                                <path>declare namespace ns1='http://www.w3.org/2005/08/addressing';
                                    //ns1:RelatesTo[1]/text()</path>
                                <content>uuid:6666666666.66666.666.66</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Schema Compliance" type="Schema Compliance" id="da6e2d99-2bb3-4887-b809-f354db9737a6">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncreq:ProcessPatientDiscoveryAsyncReqAsyncRequest" addDefaultTo="true" messageID="uuid:6666666666.66666.666.66" mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="6cc42c07-3812-4527-bd93-323e8fd8d700">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="d1464308-da1e-4039-a038-50c58c77e9d2">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
    def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Patient Discovery Deferred Request"')
    assert resultset.size !=0
          resultset.each { item ->
          validateElements(item)
    }
}
public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG0ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("patientDiscovery.inboundPatientDiscoveryRequest",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>                
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:28:37Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:38:37Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:28:37</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery Deferred Resp" searchProperties="true" id="62a59f14-2e37-40a3-90c8-4afd3041d32d">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="a85cef4f-1a5e-450b-bc89-5beab1f14948">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Patient Discovery Deferred Resp" type="request" id="e89eee9d-eb04-48de-8775-a913d55b43cf">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityPatientDiscoveryAsyncRespBindingSoap</con:interface>
                    <con:operation>ProcessPatientDiscoveryAsyncResp</con:operation>
                    <con:request name="Patient Discovery Deferred Resp" id="0cbda828-f2ec-4b22-b75a-8cd90d3c3efe">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-PatientDiscoveryAsyncResp}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header xmlns:add="SoapUI_Test/ValidationSuite/2-EndToEndSelfTest-soapui-project.xml">
      <add:Action>urn:gov:hhs:fha:nhinc:entitypatientdiscoveryasyncresp:ProcessPatientDiscoveryAsyncRespAsyncRequest</add:Action>
      <add:MessageID>uuid:12bcfc1e-f422-4d1d-af99-ff83d050313e</add:MessageID>
      <add:RelatesTo>uuid:6666666666.66666.666.66</add:RelatesTo>
      <add:To>${#TestSuite#Endpoint-PatientDiscoveryAsyncResp}</add:To>
   </soap:Header>
   <soap:Body testSuite="Passthrough_g0" testCase="Patient Discovery Deferred Resp">
      <urn:RespondingGateway_PRPA_IN201306UV02Request>
         <urn:PRPA_IN201306UV02 ITSVersion="XML_1.0">
            <urn:id root="2.2" extension="-5a3e95b1:11d1fa33d45:-8e45"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <!--1 or more repetitions:-->
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="1.1"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="1.1"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:code codeSystem="2.16.840.1.113883.1.6" code="PRPA_TE201306UV"/>
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="2.2"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:subject typeCode="SUBJ">
                  <urn:registrationEvent classCode="REG" moodCode="EVN">
                     <urn:id nullFlavor="NA"/>
                     <urn:statusCode code="active"/>
                     <urn:subject1 typeCode="SBJ">
                        <urn:patient classCode="PAT">
                           <urn:id extension="D123402" root="2.2"/>
                           <urn:statusCode code="SD"/>
                           <urn:patientPerson>
                              <urn:name>
                                 <urn:family partType="FAM">Younger</urn:family>
                                 <urn:given partType="GIV">Gallow</urn:given>
                              </urn:name>
                              <urn:administrativeGenderCode code="M"/>
                              <urn:birthTime value="19630804"/>
                              <urn:addr>
                                 <urn:city>LEESBURG</urn:city>
                                 <urn:state>VA</urn:state>
                                 <urn:postalCode>20176</urn:postalCode>
                              </urn:addr>
                           </urn:patientPerson>
                           <urn:providerOrganization determinerCode="" classCode="">
                              <urn:id root="2.2"/>
                              <urn:contactParty xsi:nil="true" classCode="CON" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                           </urn:providerOrganization>
                        </urn:patient>
                     </urn:subject1>
                     <urn:custodian typeCode="">
                        <urn:assignedEntity classCode="">
                           <urn:id root="2.2"/>
                        </urn:assignedEntity>
                     </urn:custodian>
                  </urn:registrationEvent>
               </urn:subject>
               <urn:queryAck>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:queryResponseCode code="OK"/>
                  <urn:resultTotalQuantity value="1"/>
                  <urn:resultCurrentQuantity value="1"/>
                  <urn:resultRemainingQuantity value="0"/>
               </urn:queryAck>
               <urn:queryByParameter>
                  <urn:queryId extension="-abd3453dcd24wkkks545" root="2.2"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="M"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="19630804"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectId>
                        <urn:value extension="D123401" root="1.1"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">Younger</urn:family>
                           <urn:given partType="GIV">Gallow</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectName>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201306UV02>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>LEESBURG</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>20176</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>19990627</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>Test HCID1</urn1:description>
               <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
               <urn1:name>HCID1</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>YOUNGER</urn1:familyName>
               <urn1:givenName>GALLOW</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>123456789</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>D123401^^^&amp;amp;2.16.840.1.113883.3.337&amp;amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>Test HCID1</urn1:description>
                  <urn1:homeCommunityId>2.16.840.1.113883.3.337</urn1:homeCommunityId>
                  <urn1:name>HCID1</urn1:name>
               </urn1:org>
               <!--Optional:-->
               <urn1:roleCoded>
                  <urn1:code>Code</urn1:code>
                  <urn1:codeSystem>CodeSystem</urn1:codeSystem>
                  <urn1:codeSystemName>CodeSystemName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>codeSystemVersion</urn1:codeSystemVersion>
                  <urn1:displayName>displayName</urn1:displayName>
                  <urn1:originalText>originalText</urn1:originalText>
                  <!--Zero or more repetitions:-->
                  <urn1:translation/>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTHKIERAN</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>            
            <urn1:authorized>authorized</urn1:authorized>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:1157111506023</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:136268302631</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:880867232879</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201306UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="40f0df09-3a23-4149-a4ef-6b4eb76d607c"/>
                        <con:assertion type="SOAP Fault Assertion" id="b6a1b02a-8e02-47e8-a7b2-a39953abd610"/>
                        <con:assertion name="Match content of [typeCode/@code]" type="XPath Match" id="722c0ef9-8950-4fb6-b741-9346ea14d17a">
                            <con:configuration>
                                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:typeCode[1]/@code</path>
                                <content>CA</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Match content of [acknowledgementDetail/text/text()]" type="XPath Match" id="6067d001-f4db-4ca5-a73e-b97077223a8c">
                            <con:configuration>
                                <path>declare namespace ns2='urn:hl7-org:v3';//ns2:MCCI_IN000002UV01[1]/ns2:acknowledgement[1]/ns2:acknowledgementDetail[1]/ns2:text/text()</path>
                                <content>Success</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Schema Compliance" type="Schema Compliance" id="199051b9-1468-4104-ac2b-9b27a390afc8">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="b83580d1-e302-4351-9921-f47c08d30e9e">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="6d5b8e6e-ffe4-479a-bb59-c0354c05ee4a">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
    def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Patient Discovery Deferred Response"')
    assert resultset.size !=0
          resultset.each { item ->
          validateElements(item)
    }
}
public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG0ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("patientDiscovery.inboundPatientDiscoveryResponse",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:38:39Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:28:39</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:28:39Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Patient Discovery" searchProperties="true" id="8fef28ff-31bd-4a48-a428-0fa0fe894187">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="009045fe-1e61-4c6f-add7-4c75a2552927">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Set Up PassThru" id="fd70bd51-8246-4181-b2ad-de93751f219f">
                <con:settings/>
                <con:config>
                    <script>log.info "Setting Patient Discovery Adapter to unsecured";
                        def dir = context.findProperty('GatewayPropDir');
                        nhinc.FileUtils.backupFile(dir, "PatientDiscoveryProxyConfig.xml", log);
                        def alias = 'adapterpatientdiscovery'
                        def aliasName= 'adapterpatientdiscoverywssecured';
                        def replaceAlias = 'adapterpatientdiscoverywsunsecured';

                        nhinc.FileUtils.updateSpringConfig(dir, "PatientDiscoveryProxyConfig.xml",
                        alias, aliasName, replaceAlias, log);

                        log.info "Modifying internalExchangeInfo for adapterpatientdiscovery mock."

                        nhinc.FileUtils.createOrUpdateConnection("internalExchangeInfo.xml", dir, "1.1",
                        "adapterpatientdiscovery", "http://localhost:1720/MockPDAdapter", "2.0",
                        log);</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Patient Discovery" type="request" id="b3a8789a-9d81-449f-8e1e-dc234ccdd68f">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityPatientDiscoveryBindingSoap</con:interface>
                    <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
                    <con:request name="Patient Discovery" id="e7365ef6-896d-47fd-9fe5-a8c4902dfc73">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-PatientDiscovery}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g1" testCase="Patient Discovery">
      <urn:RespondingGateway_PRPA_IN201305UV02Request>
         <urn:PRPA_IN201305UV02 ITSVersion="XML_1.0">
            <urn:id root="1.1" extension="-5a3e95b1:11d1fa33d45:-7f9b"/>
            <urn:creationTime value="20091116084800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#RemoteHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device classCode="DEV" determinerCode="INSTANCE">
                  <urn:id root="1.2.345.678.999"/>
                  <urn:asAgent classCode="AGNT">
                     <urn:representedOrganization classCode="ORG" determinerCode="INSTANCE">
                        <urn:id root="${#Project#LocalHCID}"/>
                     </urn:representedOrganization>
                  </urn:asAgent>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess classCode="CACT" moodCode="EVN">
               <urn:authorOrPerformer typeCode="AUT">
                  <urn:assignedDevice>
                     <urn:id root="${#Project#LocalAA}"/>
                  </urn:assignedDevice>
               </urn:authorOrPerformer>
               <urn:queryByParameter>
                  <urn:queryId root="${#Project#LocalHCID}" extension="-abd3453dcd24wkkks545"/>
                  <urn:statusCode code="new"/>
                  <urn:responseModalityCode code="R"/>
                  <urn:responsePriorityCode code="I"/>
                  <urn:parameterList>
                     <urn:livingSubjectAdministrativeGender>
                        <urn:value code="${#Project#Gender}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.administrativeGender</urn:semanticsText>
                     </urn:livingSubjectAdministrativeGender>
                     <urn:livingSubjectBirthTime>
                        <urn:value value="${#Project#BirthTime}"/>
                        <urn:semanticsText representation="TXT">LivingSubject.birthTime</urn:semanticsText>
                     </urn:livingSubjectBirthTime>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">${#Project#FamilyName}</urn:family>
                           <urn:given partType="GIV">${#Project#GivenName}</urn:given>
                        </urn:value>
                        <urn:semanticsText representation="TXT">LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                     <urn:livingSubjectId>
                        <urn:value root="${#Project#LocalAA}" extension="${#Project#SubjectID}"/>
                        <urn:semanticsText representation="TXT"/>
                     </urn:livingSubjectId>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV02>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>${#Project#City}</urn1:city>
               <urn1:country>${#Project#Country}</urn1:country>
               <urn1:state>${#Project#State}</urn1:state>
               <urn1:streetAddress>${#Project#StreetAddress}</urn1:streetAddress>
               <urn1:zipCode>${#Project#ZipCode}</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>${#Project#DOB}</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>NEEDED</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>true</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>true</urn1:haveSignature>
            <urn1:haveWitnessSignature>true</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>${#Project#FamilyName}</urn1:familyName>
               <urn1:givenName>${#Project#GivenName}</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>FJ</urn1:secondNameOrInitials>
               <urn1:fullName>Joe Smith</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1234</urn1:extension>
               <urn1:localNumber>3456789</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Melbourne</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>123 Johnson Rd</urn1:streetAddress>
               <urn1:zipCode>12345</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Hughes</urn1:familyName>
               <urn1:givenName>Howie</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>HH</urn1:secondNameOrInitials>
               <urn1:fullName>Howie Hughes</urn1:fullName>
               <urn1:prefix>Dr</urn1:prefix>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>123</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>1546</urn1:extension>
               <urn1:localNumber>4567892</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>W</urn1:code>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>${#Project#SSN}</urn1:SSN>
            <urn1:uniquePatientId>${#Project#UniquePatientId}</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>W</urn1:code>
               </urn1:addressType>
               <urn1:city>Frankfort</urn1:city>
               <urn1:country>US</urn1:country>
               <urn1:state>MN</urn1:state>
               <urn1:streetAddress>432 Jackson St</urn1:streetAddress>
               <urn1:zipCode>65498</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Ugble</urn1:familyName>
               <urn1:givenName>Gary</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>G</urn1:code>
               </urn1:nameType>
               <urn1:secondNameOrInitials>GU</urn1:secondNameOrInitials>
               <urn1:fullName>Gary Ugble</urn1:fullName>
               <urn1:prefix>Mr</urn1:prefix>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>987</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>6549</urn1:extension>
               <urn1:localNumber>2222222</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>H</urn1:code>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Anderson</urn1:familyName>
                  <urn1:givenName>Wilma</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>G</urn1:code>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>WA</urn1:secondNameOrInitials>
                  <urn1:fullName>Wilma Anderson</urn1:fullName>
                  <urn1:prefix>Mrs</urn1:prefix>
               </urn1:personName>
               <urn1:userName>wanderson</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>307969004</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Public Health</urn1:displayName>
                  <urn1:originalText>Public Health</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PUBLICHEALTH</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Use or disclosure of Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-04-16T13:15:39Z</urn1:authInstant>
               <urn1:sessionIndex>987</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>1.1.1.1</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>connectopensource.org</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn1:resource>
               <urn1:action>TestSaml</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn1:id>
                     <urn1:issueInstant>2009-04-16T13:10:39.093Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn1:issuer>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>Claim-Ref-1234</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>Claim-Instance-1</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
               <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_PRPA_IN201305UV02Request>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="f152ed00-4d4d-43be-82fe-f2d7acc869a3"/>
                        <con:assertion disabled="true" type="Schema Compliance" id="35318bab-0369-4d52-9374-9441217ba646">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion type="SOAP Fault Assertion" id="ec71897f-82be-4ea2-95ef-7180c7cb32dd"/>
                        <con:assertion name="Check for existance of [ns3:controlActProcess]" type="XPath Match" id="2bad31af-b842-45c7-857b-29aaf9ffce58">
                            <con:configuration>
                                <path>declare namespace ns3='urn:hl7-org:v3';
                                    exists( //ns3:PRPA_IN201306UV02/ns3:controlActProcess)</path>
                                <content>true</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Given Name XPath Match" type="XPath Match" id="0ee720d5-19a3-4e5d-98a6-d01039985b25">
                            <con:configuration>
                                <path>declare namespace ns1='urn:hl7-org:v3';
                                    //ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:given[1]</path>
                                <content>${#Project#GivenName}</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Family Name XPath Match" type="XPath Match" id="b685afc8-5c9c-4806-ac5f-34ac769dcf2a">
                            <con:configuration>
                                <path>declare namespace ns1='urn:hl7-org:v3';
                                    //ns1:PRPA_IN201306UV02[1]/ns1:controlActProcess[1]/ns1:subject[1]/ns1:registrationEvent[1]/ns1:subject1[1]/ns1:patient[1]/ns1:patientPerson[1]/ns1:name[1]/ns1:family[1]</path>
                                <content>${#Project#FamilyName}</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="mockresponse" name="Mock Response" id="17188ba3-7746-489e-a275-cfbacef8eb87">
                <con:settings/>
                <con:config xsi:type="con:MockResponseStep" startStep="Patient Discovery" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>AdapterPatientDiscoveryBindingSoap</con:interface>
                    <con:operation>RespondingGateway_PRPA_IN201305UV02</con:operation>
                    <con:path>/MockPDAdapter</con:path>
                    <con:port>1720</con:port>
                    <con:response id="4f94d081-ca99-407a-8faf-8ad57aaacce1">
                        <con:settings/>
                        <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:hl7-org:v3">
   <soap:Header/>
   <soap:Body>
   <PRPA_IN201306UV02 xmlns="urn:hl7-org:v3" xmlns:ns2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns3="http://www.w3.org/2005/08/addressing" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:patientcorrelationfacade" ITSVersion="XML_1.0">
   <id root="1.1" extension="13318247:13b4e0b839b:-7ff4"/>
   <creationTime value="20121129212833"/>
   <interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201306UV02"/>
   <processingCode code="P"/>
   <processingModeCode code="T"/>
   <acceptAckCode code="NE"/>
   <receiver typeCode="RCV">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="1.2.345.678.999"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="1.1"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </receiver>
   <sender typeCode="SND">
   	<device classCode="DEV" determinerCode="INSTANCE">
   		<id root="2.2"/>
   		<asAgent classCode="AGNT">
   			<representedOrganization classCode="ORG" determinerCode="INSTANCE">
   				<id root="2.2"/>
   			</representedOrganization>
   		</asAgent>
   	</device>
   </sender>
   <acknowledgement>
   	<typeId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV02"/>
   	<typeCode code="AA"/><targetMessage xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   </acknowledgement>
   <controlActProcess classCode="CACT" moodCode="EVN">
   	<code code="PRPA_TE201306UV" codeSystem="2.16.840.1.113883.1.6"/>
   	<subject typeCode="SUBJ">
   		<registrationEvent classCode="REG" moodCode="EVN">
   			<id nullFlavor="NA"/>
   			<statusCode code="active"/>
   				<subject1 typeCode="SBJ">
   					<patient classCode="PAT">
   						<id root="1.1" extension="D123401"/>
   						<statusCode code="SD"/>
   						<patientPerson classCode="PSN" determinerCode="INSTANCE">
   							<name>
   								<family partType="FAM">Younger</family>
   								<given partType="GIV">Gallow</given>
   							</name>
   							<telecom value="tel:+1-888-555-1234"/>
   							<administrativeGenderCode code="M"/>
   							<birthTime value="19630804"/>
   							<addr><city>LEESBURG</city><state>VA</state><postalCode>20176</postalCode></addr>
   							<asOtherIDs classCode="SD">
   								<id root="2.16.840.1.113883.4.1" extension="999123401"/>
   								<scopingOrganization classCode="ORG" determinerCode="INSTANCE">
   									<id root="2.16.840.1.113883.4.1"/>
   								</scopingOrganization>
   							</asOtherIDs>
   						</patientPerson>
   						<providerOrganization classCode="ORG" determinerCode="INSTANCE">
   							<id root="1.1"/>
   							<contactParty xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
   							</providerOrganization>
   							<subjectOf1>
   								<queryMatchObservation classCode="CASE" moodCode="EVN">
   									<code code="IHE_PDQ"/>
   									<value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="INT" value="100"/>
   								</queryMatchObservation>
   							</subjectOf1>
   						</patient>
   					</subject1>
   					<custodian typeCode="CST">
   						<assignedEntity classCode="ASSIGNED">
   							<id root="1.1"/>
   							<code code="NotHealthDataLocator" codeSystem="1.3.6.1.4.1.19376.1.2.27.2"/>
   						</assignedEntity>
   					</custodian>
   				</registrationEvent>
   			</subject>
   			<queryAck>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<queryResponseCode code="OK"/>
   			</queryAck>
   			<queryByParameter>
   				<queryId root="1.1" extension="-abd3453dcd24wkkks545"/>
   				<statusCode code="new"/>
   				<responseModalityCode code="R"/>
   				<responsePriorityCode code="I"/>
   				<parameterList>
   					<livingSubjectAdministrativeGender>
   						<value code="M"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectAdministrativeGender>
   					<livingSubjectBirthTime>
   						<value value="19630804"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectBirthTime>
   					<livingSubjectId>
   						<value root="1.1" extension="1111"/>
   						<semanticsText representation="TXT"/>
   					</livingSubjectId>
   					<livingSubjectName>
   						<value>
   							<family partType="FAM">Younger</family>
   							<given partType="GIV">Gallow</given>
                        		</value>
                        		<semanticsText representation="TXT"/>
                        	</livingSubjectName>
                     </parameterList>
                 </queryByParameter>
             </controlActProcess>
     </PRPA_IN201306UV02>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                    </con:response>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="c8800e11-a7bf-4ab6-87ca-5c2cb521f0d4">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="a17e266b-a702-441d-bcfb-c928cf0b9fac">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
    def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Patient Discovery"')
    assert resultset.size !=0
          resultset.each { item ->
          validateElements(item)
    }
}
public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "1.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG0ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("patientDiscovery.inboundPatientDiscovery",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:28:42Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:38:42Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:28:42</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Query" searchProperties="true" id="9ef7d334-39f5-4693-a2ce-bc5609f8a972">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="e505d964-895b-4584-aaed-e24943513ef9">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="e028e954-012e-47fd-ae26-37de3f2240dc">
                <con:settings/>
                <con:config>
                    <script>context.withSql('PatientCorrelationDB') { sql ->
                        def table = context.findProperty('PatientCorrelationTable')

                        sql.execute('delete from ' + table)

                        def localAA = context.findProperty( "LocalAA" )
                        def localPatientID = context.findProperty("LocalPatientID")
                        def remoteAA = context.findProperty( "RemoteAA" )
                        def remotePatientID = context.findProperty("RemotePatientID")
                        def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " +
                        "values (1, ?, ?, ?, ?)"
                        sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="2e840792-98e4-4952-a8bf-10d0ae4b2cfd">
                <con:settings/>
                <con:config>
                    <script>context.withSql('AAMappingDB') { sql ->
                        def table = context.findProperty('AAMappingTable')

                        sql.execute('delete from ' + table)

                        def remoteAA = context.findProperty( "RemoteAA" )
                        def remoteHCID = context.findProperty("RemoteHCID")
                        def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " +
                        "values (1, ?, ?)"
                        sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Document Query" type="request" id="762bb1db-3187-4dcc-92a6-064eade559e2">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityDocQueryBindingSoap</con:interface>
                    <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
                    <con:request name="Document Query" id="8bd5d6ae-5c7a-40b1-a411-f468be3ba1cc">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-DocQuery}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g0" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
         <urn2:Slot name="$XDSDocumentEntryClassCode">
            <urn2:ValueList>
                    <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
         <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="7cbe54e3-37b7-4580-a446-d0ecf20a7b92"/>
                        <con:assertion type="Schema Compliance" id="1b3fe631-2f1c-4b65-926a-bca817aa4127">
                            <con:configuration/>
                        </con:assertion>
                        <con:assertion type="SOAP Fault Assertion" id="1ed0f721-d173-4914-93b2-201cba145631"/>
                        <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="3446fcfb-7f0f-4327-a8ad-f4462ccf1580">
                            <con:configuration>
                                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
                                    def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
                                    holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
                                    holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";

                                    def documentID = context.findProperty('DQDocID')
                                    def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
                                    assert (documentID == msgDocID)</scriptText>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="d2c96518-29d9-43e5-9d42-b36afed55608">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="3f4d3376-4c6e-4b77-8cd7-47ef24a073f3">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
    def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Document Query"')
    assert resultset.size !=0
          resultset.each { item ->
          validateElements(item)
    }
}
public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "2.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG0ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("docquery.20.inboundDocQuery",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:23:51Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:33:51Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:23:51</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Document Retrieve" searchProperties="true" id="057be88f-5e6a-47ef-96d8-6ffdef5db6a6">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="de29df7e-a332-4200-ba30-d55593500fdf">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Document Retrieve" type="request" id="0b5b9706-2f7f-444e-a562-48c2d072fa55">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>EntityDocRetrieveBindingSoap</con:interface>
                    <con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation>
                    <con:request incomingWss="" name="Document Retrieve" outgoingWss="" wssPasswordType="" id="6ed094fe-64b5-42d6-b727-9dd7fa87159d">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@expand-mtom-attachments">true</con:setting>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-DocRetrieve}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:ihe:iti:xds-b:2007" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g0" testCase="Document Retrieve">
      <urn:RespondingGateway_CrossGatewayRetrieveRequest>
         <urn1:RetrieveDocumentSetRequest>
            <urn1:DocumentRequest>
               <urn1:HomeCommunityId>urn:oid:${#Project#RemoteHCID}</urn1:HomeCommunityId>
               <urn1:RepositoryUniqueId>${#Project#DRRepoID}</urn1:RepositoryUniqueId>
               <urn1:DocumentUniqueId>${#Project#DRDocID}</urn1:DocumentUniqueId>
            </urn1:DocumentRequest>
         </urn1:RetrieveDocumentSetRequest>
         <urn:assertion>
            <urn2:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>AddrCity</urn2:city>
               <urn2:country>AddrCountry</urn2:country>
               <urn2:state>AddrState</urn2:state>
               <urn2:streetAddress>AddrStreet</urn2:streetAddress>
               <urn2:zipCode>AddrZip</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn2:dateOfBirth>
            <urn2:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveSignature>
            <urn2:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn2:haveWitnessSignature>
            <urn2:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:description>${#Project#LocalHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#LocalHCID}</urn2:homeCommunityId>
               <urn2:name>${#Project#LocalHCDescription}</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sandy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
               <urn2:fullName>Sandy S. Smith</urn2:fullName>
            </urn2:personName>
            <urn2:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5436</urn2:extension>
               <urn2:localNumber>253-6849</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>AddrCode</urn2:code>
                  <urn2:codeSystem>AddrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>AddrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>AddrCode</urn2:displayName>
                  <urn2:originalText>AddrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Addr2City</urn2:city>
               <urn2:country>Addr2Country</urn2:country>
               <urn2:state>Addr2State</urn2:state>
               <urn2:streetAddress>Addr2Street</urn2:streetAddress>
               <urn2:zipCode>Addr2Zip</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Sammy</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>s</urn2:secondNameOrInitials>
               <urn2:fullName>Sammy S. Smith</urn2:fullName>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>5424</urn2:extension>
               <urn2:localNumber>542-6823</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn2:SSN>
            <urn2:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn2:uniquePatientId>
            <urn2:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:addressType>
                  <urn2:code>addrCode</urn2:code>
                  <urn2:codeSystem>addrCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>addrCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>addrCode</urn2:displayName>
                  <urn2:originalText>addrCode</urn2:originalText>
               </urn2:addressType>
               <urn2:city>Burnell</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>FL</urn2:state>
               <urn2:streetAddress>825 North</urn2:streetAddress>
               <urn2:zipCode>32184</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:familyName>Smith</urn2:familyName>
               <urn2:givenName>Scott</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>nameCode</urn2:code>
                  <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>nameCode</urn2:displayName>
                  <urn2:originalText>nameCode</urn2:originalText>
               </urn2:nameType>
               <urn2:secondNameOrInitials>S.</urn2:secondNameOrInitials>
               <urn2:fullName>Scott S. Smith</urn2:fullName>
            </urn2:witnessName>
            <urn2:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:areaCode>321</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>8432</urn2:extension>
               <urn2:localNumber>985-2239</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>phoneCode</urn2:code>
                  <urn2:codeSystem>phoneCodeSyst</urn2:codeSystem>
                  <urn2:codeSystemName>phoneCodeSystName</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>phoneCode</urn2:displayName>
                  <urn2:originalText>phoneCode</urn2:originalText>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:personName>
                  <urn2:familyName>Skagerberg</urn2:familyName>
                  <urn2:givenName>Karl</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>nameCode</urn2:code>
                     <urn2:codeSystem>nameCodeSyst</urn2:codeSystem>
                     <urn2:codeSystemName>nameCodeSystName</urn2:codeSystemName>
                     <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                     <urn2:displayName>nameCode</urn2:displayName>
                     <urn2:originalText>nameCode</urn2:originalText>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>S</urn2:secondNameOrInitials>
                  <urn2:fullName>Kasrl S. Skagerberg</urn2:fullName>
               </urn2:personName>
               <urn2:userName>kskagerb</urn2:userName>
               <urn2:org>
                  <urn2:description>${#Project#LocalHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#LocalHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#LocalHCDescription}</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>307969004</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Public Health</urn2:displayName>
                  <urn2:originalText>Public Health</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:code>PUBLICHEALTH</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Use or disclosure of Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:authInstant>2009-04-16T13:15:39Z</urn2:authInstant>
               <urn2:sessionIndex>987</urn2:sessionIndex>
               <urn2:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn2:authContextClassRef>
               <urn2:subjectLocalityAddress>1.1.1.1</urn2:subjectLocalityAddress>
               <urn2:subjectLocalityDNSName>connectopensource.org</urn2:subjectLocalityDNSName>
            </urn2:samlAuthnStatement>
            <urn2:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn2:decision>Permit</urn2:decision>
               <urn2:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn2:resource>
               <urn2:action>TestSaml</urn2:action>
               <urn2:evidence>
                  <urn2:assertion>
                     <urn2:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn2:id>
                     <urn2:issueInstant>2009-04-16T13:10:39.093Z</urn2:issueInstant>
                     <urn2:version>2.0</urn2:version>
                     <urn2:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn2:issuerFormat>
                     <urn2:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn2:issuer>
                     <urn2:conditions>
                        <urn2:notBefore>2009-04-16T13:10:39.093Z</urn2:notBefore>
                        <urn2:notOnOrAfter>2009-12-31T12:00:00.000Z</urn2:notOnOrAfter>
                     </urn2:conditions>
                     <urn2:accessConsentPolicy>urn:oid:1.2.3.4</urn2:accessConsentPolicy>
                     <urn2:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn2:instanceAccessConsentPolicy>
                  </urn2:assertion>
               </urn2:evidence>
            </urn2:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn2:nhinTargetCommunity>
               <urn2:homeCommunity>
                  <urn2:description>${#Project#RemoteHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#RemoteHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#RemoteHCDescription}</urn2:name>
               </urn2:homeCommunity>
            </urn2:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayRetrieveRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:assertion type="SOAP Response" id="a8536112-060f-4b56-b5a6-76663c26c983"/>
                        <con:assertion type="SOAP Fault Assertion" id="43eaa1db-8d87-4a27-a830-8893a9f60aec"/>
                        <con:assertion type="Schema Compliance" disabled="true" id="3bdc4076-37af-48ab-9b2c-2d70255a7dca">
                            <con:configuration>
                                <definition/>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Doc Repository ID" type="XPath Match" id="981b2f01-6548-4be2-a891-dcf15fda850a">
                            <con:configuration>
                                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
                                    //ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:RepositoryUniqueId[1]</path>
                                <content>${#Project#DRRepoID}</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Doc ID" type="XPath Match" id="fba27d6d-6820-402f-9efd-f212b8ba3526">
                            <con:configuration>
                                <path>declare namespace ns5='urn:ihe:iti:xds-b:2007';
                                    //ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:DocumentUniqueId[1]</path>
                                <content>${#Project#DRDocID}</content>
                                <allowWildcards>false</allowWildcards>
                                <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
                            </con:configuration>
                        </con:assertion>
                        <con:assertion name="Document Data" type="GroovyScriptAssertion" id="1f356417-3604-49b9-9b10-2c32b2668f40">
                            <con:configuration>
                                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
                                    def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
                                    holder.namespaces["ns"]="urn:ihe:iti:xds-b:2007"
                                    def docData = holder["//ns:RetrieveDocumentSetResponse[1]/ns:DocumentResponse[1]/ns:Document[1]"]
                                    log.info docData.toString()
                                    assert (docData.size() != 0)</scriptText>
                            </con:configuration>
                        </con:assertion>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitydocretrieve/EntityDocRetrievePortType/RespondingGateway_CrossGatewayRetrieveRequest" mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="c99d11cd-9944-4413-963c-257ed957a8c8">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Element in Event Log" id="f3533a7b-ecbc-487e-bc38-1455c96726f1">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
    def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Retrieve Document"')
    assert resultset.size !=0
          resultset.each { item ->
          validateElements(item)
    }
}
public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
	validateVersion(name, parsedObject)
}

public validateVersion(String name, Object jsonObj) {
	def expectedVersion = "2.0"
	 if(name.indexOf("DELEGATION_TO_ADAPTER") > 0){
		expectedVersion = "LEVEL_a0"
	 }
	
	assert jsonObj.version == expectedVersion
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG0ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("docretrieve.20.inbound",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:23:54Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:33:54Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:23:54</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Admin Distribution" searchProperties="true" id="30b2d3bb-0976-4d6a-b7f1-3d6b31875764">
            <con:settings/>
            <con:testStep type="groovy" name="Clear Event Logs" id="dc47c3c1-16c7-4bb0-b6a8-1a934542f63d">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') { sql ->
                        sql.execute('delete from ' + context.findProperty('EventLoggingTable'))
                        }</script>
                </con:config>
            </con:testStep>
            <con:testStep name="Admin Distribution" type="request" id="10d4161e-723d-4e33-b5e5-ae5f953a8bd5">
                <con:settings/>
                <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <con:interface>AdministrativeDistribution_Binding_Soap12</con:interface>
                    <con:operation>SendAlertMessage</con:operation>
                    <con:request name="Admin Distribution" id="bf93dd6e-9c2a-4636-8ff3-39473c12e9c1">
                        <con:settings>
                            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
                        </con:settings>
                        <con:encoding>UTF-8</con:encoding>
                        <con:endpoint>${#TestSuite#Endpoint-EntityAdminDist}</con:endpoint>
                        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:urn2="urn:oasis:names:tc:emergency:EDXL:DE:1.0">
   <soap:Header/>
   <soap:Body testSuite="Passthrough_g0" testCase="Admin Distribution">
      <urn:RespondingGateway_SendAlertMessage>
         <urn:assertion>
            <urn1:address>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>AddrCity</urn1:city>
               <urn1:country>AddrCountry</urn1:country>
               <urn1:state>AddrState</urn1:state>
               <urn1:streetAddress>AddrStreet</urn1:streetAddress>
               <urn1:zipCode>AddrZip</urn1:zipCode>
            </urn1:address>
            <urn1:dateOfBirth>06/04/1959 05:21:00</urn1:dateOfBirth>
            <urn1:explanationNonClaimantSignature>Electronic</urn1:explanationNonClaimantSignature>
            <urn1:haveSecondWitnessSignature>false</urn1:haveSecondWitnessSignature>
            <urn1:haveSignature>false</urn1:haveSignature>
            <urn1:haveWitnessSignature>false</urn1:haveWitnessSignature>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
            <urn1:personName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sandy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
               <urn1:fullName>Sandy S. Smith</urn1:fullName>
            </urn1:personName>
            <urn1:phoneNumber>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5436</urn1:extension>
               <urn1:localNumber>253-6849</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:phoneNumber>
            <urn1:secondWitnessAddress>
               <urn1:addressType>
                  <urn1:code>AddrCode</urn1:code>
                  <urn1:codeSystem>AddrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>AddrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>AddrCode</urn1:displayName>
                  <urn1:originalText>AddrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Addr2City</urn1:city>
               <urn1:country>Addr2Country</urn1:country>
               <urn1:state>Addr2State</urn1:state>
               <urn1:streetAddress>Addr2Street</urn1:streetAddress>
               <urn1:zipCode>Addr2Zip</urn1:zipCode>
            </urn1:secondWitnessAddress>
            <urn1:secondWitnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Sammy</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>s</urn1:secondNameOrInitials>
               <urn1:fullName>Sammy S. Smith</urn1:fullName>
            </urn1:secondWitnessName>
            <urn1:secondWitnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>5424</urn1:extension>
               <urn1:localNumber>542-6823</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:secondWitnessPhone>
            <urn1:SSN>253987546</urn1:SSN>
            <!--1 or more repetitions:-->
            <urn1:uniquePatientId>500000000^^^&amp;1.1&amp;ISO</urn1:uniquePatientId>
            <urn1:witnessAddress>
               <urn1:addressType>
                  <urn1:code>addrCode</urn1:code>
                  <urn1:codeSystem>addrCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>addrCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>addrCode</urn1:displayName>
                  <urn1:originalText>addrCode</urn1:originalText>
               </urn1:addressType>
               <urn1:city>Burnell</urn1:city>
               <urn1:country>USA</urn1:country>
               <urn1:state>FL</urn1:state>
               <urn1:streetAddress>825 North</urn1:streetAddress>
               <urn1:zipCode>32184</urn1:zipCode>
            </urn1:witnessAddress>
            <urn1:witnessName>
               <urn1:familyName>Smith</urn1:familyName>
               <urn1:givenName>Scott</urn1:givenName>
               <urn1:nameType>
                  <urn1:code>nameCode</urn1:code>
                  <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>nameCode</urn1:displayName>
                  <urn1:originalText>nameCode</urn1:originalText>
               </urn1:nameType>
               <urn1:secondNameOrInitials>S.</urn1:secondNameOrInitials>
               <urn1:fullName>Scott S. Smith</urn1:fullName>
            </urn1:witnessName>
            <urn1:witnessPhone>
               <urn1:areaCode>321</urn1:areaCode>
               <urn1:countryCode>1</urn1:countryCode>
               <urn1:extension>8432</urn1:extension>
               <urn1:localNumber>985-2239</urn1:localNumber>
               <urn1:phoneNumberType>
                  <urn1:code>phoneCode</urn1:code>
                  <urn1:codeSystem>phoneCodeSyst</urn1:codeSystem>
                  <urn1:codeSystemName>phoneCodeSystName</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>phoneCode</urn1:displayName>
                  <urn1:originalText>phoneCode</urn1:originalText>
               </urn1:phoneNumberType>
            </urn1:witnessPhone>
            <urn1:userInfo>
               <urn1:personName>
                  <urn1:familyName>Skagerberg</urn1:familyName>
                  <urn1:givenName>Karl</urn1:givenName>
                  <urn1:nameType>
                     <urn1:code>nameCode</urn1:code>
                     <urn1:codeSystem>nameCodeSyst</urn1:codeSystem>
                     <urn1:codeSystemName>nameCodeSystName</urn1:codeSystemName>
                     <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                     <urn1:displayName>nameCode</urn1:displayName>
                     <urn1:originalText>nameCode</urn1:originalText>
                  </urn1:nameType>
                  <urn1:secondNameOrInitials>S</urn1:secondNameOrInitials>
                  <urn1:fullName>Kasrl S. Skagerberg</urn1:fullName>
               </urn1:personName>
               <urn1:userName>${#TestCase#UserId}</urn1:userName>
               <urn1:org>
                  <urn1:description>${#Project#LocalHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#LocalHCDescription}</urn1:name>
               </urn1:org>
               <urn1:roleCoded>
                  <urn1:code>80584001</urn1:code>
                  <urn1:codeSystem>2.16.840.1.113883.6.96</urn1:codeSystem>
                  <urn1:codeSystemName>SNOMED_CT</urn1:codeSystemName>
                  <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
                  <urn1:displayName>Psychiatrist</urn1:displayName>
                  <urn1:originalText>Psychiatrist</urn1:originalText>
               </urn1:roleCoded>
            </urn1:userInfo>
            <urn1:authorized>true</urn1:authorized>
            <urn1:purposeOfDisclosureCoded>
               <urn1:code>PSYCHOTHERAPY</urn1:code>
               <urn1:codeSystem>2.16.840.1.113883.3.18.7.1</urn1:codeSystem>
               <urn1:codeSystemName>nhin-purpose</urn1:codeSystemName>
               <urn1:codeSystemVersion>1.0</urn1:codeSystemVersion>
               <urn1:displayName>Use or disclosure of Psychotherapy Notes</urn1:displayName>
               <urn1:originalText>Psychotherapy Notes</urn1:originalText>
            </urn1:purposeOfDisclosureCoded>
            <urn1:samlAuthnStatement>
               <urn1:authInstant>2009-09-01T13:00:00.000Z</urn1:authInstant>
               <urn1:sessionIndex>mySessionIndex</urn1:sessionIndex>
               <urn1:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn1:authContextClassRef>
               <urn1:subjectLocalityAddress>mySubjectLocalityAddress</urn1:subjectLocalityAddress>
               <urn1:subjectLocalityDNSName>mySubjectLocalityDns</urn1:subjectLocalityDNSName>
            </urn1:samlAuthnStatement>
            <urn1:samlAuthzDecisionStatement>
               <urn1:decision>Permit</urn1:decision>
               <urn1:resource>myAuthzDecisionStatementResource</urn1:resource>
               <urn1:action>myAuthzDecisionStatementAction</urn1:action>
               <urn1:evidence>
                  <urn1:assertion>
                     <urn1:id>AuthzDecisionStatementEvidenceAssertionId</urn1:id>
                     <urn1:issueInstant>2009-09-02T14:00:00.000Z</urn1:issueInstant>
                     <urn1:version>2.0</urn1:version>
                     <urn1:issuer>CN=Mr Saml User,OU=SU,O=Mr SAML Org,L=Chantilly,ST=VA,C=US</urn1:issuer>
                     <urn1:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn1:issuerFormat>
                     <urn1:conditions>
                        <urn1:notBefore>2009-04-16T13:10:39.093Z</urn1:notBefore>
                        <urn1:notOnOrAfter>2009-12-31T12:00:00.000Z</urn1:notOnOrAfter>
                     </urn1:conditions>
                     <urn1:accessConsentPolicy>urn:oid:1.2.3.4</urn1:accessConsentPolicy>
                     <urn1:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn1:instanceAccessConsentPolicy>
                  </urn1:assertion>
               </urn1:evidence>
            </urn1:samlAuthzDecisionStatement>
            <urn1:samlSignature>
               <!--Optional:-->
               <urn1:keyInfo>
                  <!--Optional:-->
                  <urn1:rsaKeyValueModulus>cid:921853060605</urn1:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn1:rsaKeyValueExponent>cid:507157468547</urn1:rsaKeyValueExponent>
               </urn1:keyInfo>
               <!--Optional:-->
               <urn1:signatureValue>cid:175264679488</urn1:signatureValue>
            </urn1:samlSignature>
         </urn:assertion>
         <!--Optional:-->
         <urn:nhinTargetCommunities>
            <!--1 or more repetitions:-->
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
               <urn1:list>?</urn1:list>
               <urn1:region>?</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
         <urn2:EDXLDistribution>
            <urn2:distributionID>633990682441061250</urn2:distributionID>
            <urn2:senderID>actor@2.16.840.1.113883.3.166</urn2:senderID>
            <urn2:dateTimeSent>2010-08-14T12:18:13.512375-08:00</urn2:dateTimeSent>
            <urn2:distributionStatus>Actual</urn2:distributionStatus>
            <urn2:distributionType>Update</urn2:distributionType>
            <urn2:combinedConfidentiality>Public</urn2:combinedConfidentiality>
            <!--Optional:-->
            <urn2:language>?</urn2:language>
            <!--Zero or more repetitions:-->
            <urn2:senderRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:senderRole>
            <!--Zero or more repetitions:-->
            <urn2:recipientRole>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:recipientRole>
            <!--Zero or more repetitions:-->
            <urn2:keyword>
               <urn2:valueListUrn>?</urn2:valueListUrn>
               <!--1 or more repetitions:-->
               <urn2:value>?</urn2:value>
            </urn2:keyword>
            <!--Zero or more repetitions:-->
            <urn2:distributionReference>?</urn2:distributionReference>
            <!--Zero or more repetitions:-->
            <urn2:explicitAddress>
               <urn2:explicitAddressScheme>modified_IHEIntendedRecipient</urn2:explicitAddressScheme>
               <!--1 or more repetitions:-->
               <urn2:explicitAddressValue>^^^^^^^^^2.16.840.1.113883.3.166|0000000001</urn2:explicitAddressValue>
            </urn2:explicitAddress>
            <!--Zero or more repetitions:-->
            <urn2:targetArea>
               <!--Zero or more repetitions:-->
               <urn2:circle>?</urn2:circle>
               <!--Zero or more repetitions:-->
               <urn2:polygon>?</urn2:polygon>
               <!--Zero or more repetitions:-->
               <urn2:country>?</urn2:country>
               <!--Zero or more repetitions:-->
               <urn2:subdivision>?</urn2:subdivision>
               <!--Zero or more repetitions:-->
               <urn2:locCodeUN>?</urn2:locCodeUN>
            </urn2:targetArea>
            <!--Zero or more repetitions:-->
            <urn2:contentObject>
               <!--Optional:-->
               <urn2:contentDescription>PH Alert Message</urn2:contentDescription>
               <!--Zero or more repetitions:-->
               <urn2:contentKeyword>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:contentKeyword>
               <!--Optional:-->
               <urn2:incidentID>TEST</urn2:incidentID>
               <!--Optional:-->
               <urn2:incidentDescription>This is a test message</urn2:incidentDescription>
               <!--Zero or more repetitions:-->
               <urn2:originatorRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:originatorRole>
               <!--Zero or more repetitions:-->
               <urn2:consumerRole>
                  <urn2:valueListUrn>?</urn2:valueListUrn>
                  <!--1 or more repetitions:-->
                  <urn2:value>?</urn2:value>
               </urn2:consumerRole>
               <!--Optional:-->
               <urn2:confidentiality>Public</urn2:confidentiality>
               <!--You have a CHOICE of the next 2 items at this level-->
    <urn2:nonXMLContent>
                  <urn2:mimeType>application/pdf</urn2:mimeType>
                  <!--Optional:-->
                  <urn2:size>19</urn2:size>
                  <!--Optional:-->
                  <urn2:digest>?</urn2:digest>
                  <!--Optional:-->
                  <urn2:uri>?</urn2:uri>
                  <!--Optional:-->
                  <urn2:contentData>LDLIHAPIISDALKDF902383K1182K4J49DFNF3KR0482HJ1029F393</urn2:contentData>
               </urn2:nonXMLContent>
               <!--You may enter ANY elements at this point-->
            </urn2:contentObject>
         </urn2:EDXLDistribution>
      </urn:RespondingGateway_SendAlertMessage>
   </soap:Body>
</soap:Envelope>]]></con:request>
                        <con:credentials>
                            <con:authType>Global HTTP Settings</con:authType>
                        </con:credentials>
                        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
                        <con:jmsPropertyConfig/>
                        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
                        <con:wsrmConfig version="1.2"/>
                    </con:request>
                </con:config>
            </con:testStep>
            <con:testStep name="Delay" type="delay" id="0d86eec9-0c4f-4ac6-9c6e-dfde36579aa2">
                <con:settings/>
                <con:config>
                    <delay>30000</delay>
                </con:config>
            </con:testStep>
            <con:testStep type="groovy" name="Verify Event Logs" id="feb60781-fbae-4a85-9d1d-0fa4126c03bb">
                <con:settings/>
                <con:config>
                    <script>context.withSql('eventdb') {sql ->
                        assert 8 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable'))[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_DELEGATION_TO_ADAPTER"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_OUTBOUND_MESSAGE"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="BEGIN_INVOCATION_TO_NWHIN"')[0]
                        assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('EventLoggingTable') + ' where name="END_INVOCATION_TO_NWHIN"')[0]
                        }</script>
                </con:config>
            </con:testStep>
            
            <con:testStep type="groovy" name="Verify Elements in Event Log" id="bd64ac7f-4ca6-4718-a3fb-62089c700e6d">
                <con:settings/>
                <con:config><script>import groovy.json.*

context.withSql('eventdb') {sql ->
    def resultset =sql.rows('select * from ' + context.findProperty('EventLoggingTable') + ' where serviceType="Admin Distribution"')
    assert resultset.size !=0
          resultset.each { item ->
          validateElements(item)
    }
}
public validateElements(Object dbRecord){
	def description = dbRecord.getProperty("description")
	def messageId = dbRecord.getProperty("messageId")
	def initiatingHcid = dbRecord.getProperty("initiatingHcid")
	def name = dbRecord.getProperty("name")
	def parsedObject = parseJsonString(description)
	def respondingHcids = dbRecord.getProperty("respondingHcids");
	
	validateMessageId(name, messageId, parsedObject)
	validateInitiatingHCID(initiatingHcid, parsedObject)
	validateResponsdingHCIDs(respondingHcids, parsedObject)
}

public validateMessageId(String name, String messageId, Object parsedObject){
     if(!name.equals("BEGIN_OUTBOUND_MESSAGE")){
     	assert messageId != null
     	assert messageId == parsedObject.message_id
     }
}

public validateInitiatingHCID(String initiatingHcid, Object parsedObject){
	assert initiatingHcid !=null
	assert initiatingHcid == parsedObject.initiating_hcid
}

public validateResponsdingHCIDs(String respondingHcids, Object parsedObject){
	def hcids="";
	assert respondingHcids !=null
	assert parsedObject.responding_hcids !=null
	log.info "respondingHcids: "+respondingHcids
	hcids=parsedObject.responding_hcids.join(',')
	log.info "hcids: "+ hcids
	assert respondingHcids == hcids
}

def parseJsonString(String description){
	def slurper = new JsonSlurper()
	def json_string = description.replaceFirst("description=","\"description\":")
	return slurper.parseText(json_string);
}</script></con:config>
            </con:testStep>
            <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);
nhinc.FileUtils.setG0ConnectionInfo(context.expand(context.testCase.testSuite.project.resourceRoot), context.findProperty('GatewayPropDir'), log);
                context.setGatewayStandard(false);
                log.info ("Setting the gateway to Passthrough");</con:setupScript>
            <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
                def isStandardMode = context.checkGatewayMode("admindist.inboundAdminDist",context);
                context.setGatewayStandard(isStandardMode);
                log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
            <con:properties>
                <con:property>
                    <con:name>startDate</con:name>
                    <con:value>2016-07-01T16:24:03Z</con:value>
                </con:property>
                <con:property>
                    <con:name>endDate</con:name>
                    <con:value>2016-07-01T16:34:03Z</con:value>
                </con:property>
                <con:property>
                    <con:name>sigDate</con:name>
                    <con:value>07/01/2016 16:24:03</con:value>
                </con:property>
                <con:property>
                    <con:name>expireDate</con:name>
                    <con:value>2016-07-31T00:00:00Z</con:value>
                </con:property>
            </con:properties>
            <con:reportParameters/>
        </con:testCase>
        <con:properties>
            <con:property>
                <con:name>Endpoint-DocQuery</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-DocRetrieve</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentRetrieve/2_0/EntityService/EntityDocRetrieve</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-DSDeferredResp</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-EntityAdminDist</con:name>
                <con:value>http://localhost:8080/Gateway/AdminDistribution/1_0/AdministrativeDistribution_Service</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-EntityXDRRequest</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:value>
            </con:property>

            <con:property>
                <con:name>Endpoint-PatientDiscovery</con:name>
                <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-PatientDiscoveryAsyncReq</con:name>
                <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-PatientDiscoveryAsyncResp</con:name>
                <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:value>
            </con:property>
            <con:property>
                <con:name>Endpoint-XDREntity</con:name>
                <con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionUnsecured</con:value>
            </con:property>
        </con:properties>
        <con:setupScript/>
        <con:tearDownScript/>
        <con:reportParameters/>
    </con:testSuite>
    <con:properties>
        <con:property>
            <con:name>AAMappingDB</con:name>
            <con:value>assigningauthoritydb</con:value>
        </con:property>
        <con:property>
            <con:name>AAMappingTable</con:name>
            <con:value>aa_to_home_community_mapping</con:value>
        </con:property>
        <con:property>
            <con:name>BirthTime</con:name>
            <con:value>19630804</con:value>
        </con:property>
        <con:property>
            <con:name>City</con:name>
            <con:value>Melbourne</con:value>
        </con:property>
        <con:property>
            <con:name>Country</con:name>
            <con:value>US</con:value>
        </con:property>
        <con:property>
            <con:name>DBHost</con:name>
            <con:value>localhost</con:value>
        </con:property>
        <con:property>
            <con:name>DBPass</con:name>
            <con:value>nhincpass</con:value>
        </con:property>
        <con:property>
            <con:name>DBPort</con:name>
            <con:value>3306</con:value>
        </con:property>
        <con:property>
            <con:name>DBUser</con:name>
            <con:value>nhincuser</con:value>
        </con:property>
        <con:property>
            <con:name>DOB</con:name>
            <con:value>19800516</con:value>
        </con:property>
        <con:property>
            <con:name>DQDocID</con:name>
            <con:value>1.123401.11111</con:value>
        </con:property>
        <con:property>
            <con:name>DQPatientID</con:name>
            <con:value>D123401</con:value>
        </con:property>
        <con:property>
            <con:name>DRDocID</con:name>
            <con:value>1.123407.777777</con:value>
        </con:property>
        <con:property>
            <con:name>DRRepoID</con:name>
            <con:value>1</con:value>
        </con:property>
        <con:property>
            <con:name>EventLoggingTable</con:name>
            <con:value>event</con:value>
        </con:property>
        <con:property>
            <con:name>FamilyName</con:name>
            <con:value>Younger</con:value>
        </con:property>
        <con:property>
            <con:name>GatewayPropDir</con:name>
            <con:value/>
        </con:property>
        <con:property>
            <con:name>Gender</con:name>
            <con:value>M</con:value>
        </con:property>
        <con:property>
            <con:name>GivenName</con:name>
            <con:value>Gallow</con:value>
        </con:property>
        <con:property>
            <con:name>LocalAA</con:name>
            <con:value>1.1</con:value>
        </con:property>
        <con:property>
            <con:name>LocalHCDescription</con:name>
            <con:value>InternalTest1</con:value>
        </con:property>
        <con:property>
            <con:name>LocalHCID</con:name>
            <con:value>1.1</con:value>
        </con:property>
        <con:property>
            <con:name>LocalPatientID</con:name>
            <con:value>D123401</con:value>
        </con:property>
        <con:property>
            <con:name>PatientCorrelationDB</con:name>
            <con:value>patientcorrelationdb</con:value>
        </con:property>
        <con:property>
            <con:name>PatientCorrelationTable</con:name>
            <con:value>correlatedidentifiers</con:value>
        </con:property>
        <con:property>
            <con:name>RemoteAA</con:name>
            <con:value>2.2</con:value>
        </con:property>
        <con:property>
            <con:name>RemoteHCDescription</con:name>
            <con:value>InternalTest2</con:value>
        </con:property>
        <con:property>
            <con:name>RemoteHCID</con:name>
            <con:value>2.2</con:value>
        </con:property>
        <con:property>
            <con:name>RemotePatientID</con:name>
            <con:value>D123401</con:value>
        </con:property>
        <con:property>
            <con:name>SSN</con:name>
            <con:value>123456789</con:value>
        </con:property>
        <con:property>
            <con:name>State</con:name>
            <con:value>FL</con:value>
        </con:property>
        <con:property>
            <con:name>StreetAddress</con:name>
            <con:value>123 Johnson Rd</con:value>
        </con:property>
        <con:property>
            <con:name>SubjectID</con:name>
            <con:value>1111</con:value>
        </con:property>
        <con:property>
            <con:name>UniquePatientId</con:name>
            <con:value>1111^^^&amp;amp;1.1&amp;amp;ISO</con:value>
        </con:property>
        <con:property>
            <con:name>ZipCode</con:name>
            <con:value>12345</con:value>
        </con:property>
        <con:property>
            <con:name>ASUsername</con:name>
            <con:value>admin</con:value>
        </con:property>
        <con:property>
            <con:name>ASPassword</con:name>
            <con:value>adminadmin</con:value>
        </con:property>
        <con:property>
            <con:name>JMXHost</con:name>
            <con:value>localhost</con:value>
        </con:property>
        <con:property>
            <con:name>JMXPort</con:name>
            <con:value>9990</con:value>
        </con:property>
    <con:property><con:name>PLQRequestPatientId</con:name><con:value>38273N244</con:value></con:property></con:properties>
    <con:afterLoadScript>def propertiesFilename = project.path[0..(project.path.size()-4)] + 'properties'
        def propertiesFile = new File(propertiesFilename)
        if (propertiesFile.exists()) {
        def props = new Properties()
        props.load(new FileInputStream(propertiesFile))
        props.each { key, value ->
        project.setPropertyValue(key, value)
        }
        }

        TimeZone.setDefault(TimeZone.getTimeZone("UTC"))
        def testRunListener = [
        afterRun: { testRunner, runContext -> },
        afterStep: { testRunner, runContext, result -> },
        beforeStep: { testRunner, runContext -> },
        beforeStep: { testRunner, runContext, testStep -> },
        beforeRun: { testRunner, runContext ->
        use (org.codehaus.groovy.runtime.TimeCategory) {
        def startDate = 5.minutes.ago
        def endDate = 5.minutes.from.now
        def expireDate = 30.days.from.now

        def df = "yyyy-MM-dd'T'HH:mm:ss'Z'"
        def dfSig = "MM/dd/yyyy' 'HH:mm:ss"

        runContext.testCase.setPropertyValue("startDate", startDate.format(df))
        runContext.testCase.setPropertyValue("endDate", endDate.format(df))
        runContext.testCase.setPropertyValue("sigDate", startDate.format(dfSig))
        runContext.testCase.setPropertyValue("expireDate", expireDate.format(df))
        }
        }
        ] as com.eviware.soapui.model.testsuite.TestRunListener

        project.testSuiteList*.testCaseList.flatten()*.addTestRunListener(testRunListener)



        com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.findProperty = { propertyName ->
        return delegate.getProperty(propertyName) ?:
        delegate.testCase.getPropertyValue(propertyName) ?:
        delegate.testCase.testSuite.getPropertyValue(propertyName) ?:
        delegate.testCase.testSuite.project.getPropertyValue(propertyName) ?:
        com.eviware.soapui.SoapUI.globalProperties.getPropertyValue(propertyName)
        }

        com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.withSql = { dbOrPropertyName, block ->
        def dbName = delegate.findProperty(dbOrPropertyName) ?: dbOrPropertyName
        def host = delegate.findProperty('DBHost')
        def port = delegate.findProperty('DBPort')
        def user = delegate.findProperty('DBUser')
        def pass = delegate.findProperty('DBPass')

        def connectString = "jdbc:mysql://${host}:${port}/${dbName}"
        def sql = groovy.sql.Sql.newInstance(connectString, user, pass, "com.mysql.jdbc.Driver");
        try {
        block(sql)
        } finally {
        sql.close()
        }
        }

        import javax.management.remote.JMXConnectorFactory as JmxFactory
        import javax.management.remote.JMXServiceURL as JmxUrl
        import javax.management.remote.*;

        com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.getConfiguration = { ->
        def username = delegate.findProperty("ASUsername");
        def password = delegate.findProperty("ASPassword");
        def jmxHost = delegate.findProperty("JMXHost");
        def jmxPort = delegate.findProperty("JMXPort");

        // use jmx to set passthru mode
        def env = [
        (JMXConnector.CREDENTIALS): (String[])[username, password]
        ]
        def serverUrl = 'service:jmx:http-remoting-jmx://'+jmxHost+ ':' + jmxPort;
        def server = JmxFactory.connect(new JmxUrl(serverUrl), env).MBeanServerConnection
        def config = new GroovyMBean(server, 'org.connectopensource.mbeans:type=Configuration');
        return config;
        }
        com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.setGatewayStandard = { standard ->
        def username = delegate.findProperty("ASUsername");
        def password = delegate.findProperty("ASPassword");
        def jmxHost = delegate.findProperty("JMXHost");
        def jmxPort = delegate.findProperty("JMXPort");
        // use jmx to set passthru mode
        def env = [
        (JMXConnector.CREDENTIALS): (String[])[username, password]
        ];
        def serverUrl = 'service:jmx:http-remoting-jmx://'+jmxHost+ ':' + jmxPort;
        def server = JmxFactory.connect(new JmxUrl(serverUrl), env);
        def config = new GroovyMBean(server.MBeanServerConnection, 'org.connectopensource.mbeans:type=Configuration');
        //set the Gateway to Standard Mode
        if (standard){
        config.setStandardMode();
        }
        else{
        config.setPassthruMode();
        }
        server.close();
        return true;
        }

        com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.isStandard = { serviceName, direction ->
        def username = delegate.findProperty("ASUsername");
        def password = delegate.findProperty("ASPassword");
        def jmxHost = delegate.findProperty("JMXHost");
        def jmxPort = delegate.findProperty("JMXPort");
        // use jmx to set passthru mode
        def env = [
        (JMXConnector.CREDENTIALS): (String[])[username, password]
        ];
        def serverUrl = 'service:jmx:http-remoting-jmx://'+jmxHost+ ':' + jmxPort;

        def server = JmxFactory.connect(new JmxUrl(serverUrl), env);
        def config = new GroovyMBean(server.MBeanServerConnection, 'org.connectopensource.mbeans:type=Configuration');
        //set the Gateway to Standard Mode
        def isStandard = config.isStandard(serviceName, direction);
        server.close();
        return isStandard;
        }

        com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.setGatewayStandard = { standard, serviceName, direction ->
        def username = delegate.findProperty("ASUsername");
        def password = delegate.findProperty("ASPassword");
        def jmxHost = delegate.findProperty("JMXHost");
        def jmxPort = delegate.findProperty("JMXPort");
        // use jmx to set passthru mode
        def env = [
        (JMXConnector.CREDENTIALS): (String[])[username, password]
        ];
        def serverUrl = 'service:jmx:http-remoting-jmx://'+jmxHost+ ':' + jmxPort;
        def server = JmxFactory.connect(new JmxUrl(serverUrl), env);
        def config = new GroovyMBean(server.MBeanServerConnection, 'org.connectopensource.mbeans:type=Configuration');
        //set the Gateway to Standard Mode
        if (standard){
        config.setStandardMode(serviceName, direction);
        }
        else{
        config.setPassthruMode(serviceName, direction);
        }
        server.close();
        return true;
        }
        /*
        Return true if gateway.properties have standard mode set up
        */
        com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.checkGatewayMode = {passthruProp, context ->
        log.info "calling checkGatewayMode for ${passthruProp}";
        def dir = context.findProperty('GatewayPropDir');
        def file = "gateway.properties";
        log.info "PassthruPro ${passthruProp} ";
        def passthruValue = nhinc.FileUtils.readProperty(dir, file, passthruProp, log);
        log.info "Passthrough property value = ${passthruValue} for key ${passthruProp}";
        if(passthruValue == null){
        return true;
        }else{
        return false;
        }
        }</con:afterLoadScript>
    <con:wssContainer/>
    <con:oAuth2ProfileContainer/>
    <con:oAuth1ProfileContainer/><con:sensitiveInformation/>
</con:soapui-project>