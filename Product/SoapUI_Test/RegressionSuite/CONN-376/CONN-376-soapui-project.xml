<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project abortOnError="false" name="CONN-376" resourceRoot="${projectDir}" runType="SEQUENTIAL" soapui-version="4.5.1" activeEnvironment="Default" xmlns:con="http://eviware.com/soapui/config">
	<con:settings/>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitydocquery}EntityDocQueryBindingSoap" definition="${projectDir}/../target/wsdl/EntityDocQuery.wsdl" name="EntityDocQueryBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>

		<con:endpoints>
		<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint></con:endpoints>
		<con:operation action="urn:gov:hhs:fha:nhinc:entitydocquery:RespondingGateway_CrossGatewayQueryRequest" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayQuery" inputName="RespondingGateway_CrossGatewayQueryRequest" isOneWay="false" name="RespondingGateway_CrossGatewayQuery" outputName="RespondingGateway_CrossGatewayQueryResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>

	

	
	
	
	
	
	
	
	

	

	


	
	<con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdapterDocQueryBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:adapterdocquery}AdapterDocQueryBindingSoap" soapVersion="1_2" anonymous="optional" definition="${projectDir}/../target/wsdl/AdapterDocQuery.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:${HttpDefaultPort}/Adapter/DocumentQuery/A_0/AdapterDocQueryUnsecured</con:endpoint></con:endpoints><con:operation isOneWay="false" action="urn:RespondingGateway_CrossGatewayQuery" name="RespondingGateway_CrossGatewayQuery" bindingOperationName="RespondingGateway_CrossGatewayQuery" type="Request-Response" outputName="RespondingGateway_CrossGatewayQueryResponse" inputName="RespondingGateway_CrossGatewayQueryRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call name="Request 1"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://GFE-ONC-WDEV28:1720/MockDQAdapter</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn4="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body>
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest id="?" comment="?" federated="false" federation="?" startIndex="0" maxResults="-1">
            <!--Optional:-->
            <urn2:RequestSlotList>
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
            </urn2:RequestSlotList>
            <urn1:ResponseOption returnType="RegistryObject" returnComposedObjects="false"/>
            <urn3:AdhocQuery id="?" home="?" lid="?" objectType="?" status="?">
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
               <!--Optional:-->
               <urn3:Name>
                  <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
               </urn3:Name>
               <!--Optional:-->
               <urn3:Description>
                  <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
               </urn3:Description>
               <!--Optional:-->
               <urn3:VersionInfo versionName="1.1" comment="?"/>
               <!--Zero or more repetitions:-->
               <urn3:Classification id="?" home="?" lid="?" objectType="?" status="?" classificationScheme="?" classifiedObject="?" classificationNode="?" nodeRepresentation="?">
                  <!--Zero or more repetitions:-->
                  <urn3:Slot name="?" slotType="?">
                     <urn3:ValueList>
                        <urn3:Value>?</urn3:Value>
                     </urn3:ValueList>
                  </urn3:Slot>
                  <!--Optional:-->
                  <urn3:Name>
                     <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                  </urn3:Name>
                  <!--Optional:-->
                  <urn3:Description>
                     <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                  </urn3:Description>
                  <!--Optional:-->
                  <urn3:VersionInfo versionName="1.1" comment="?"/>
                  <!--Zero or more repetitions:-->
                  <urn3:Classification/>
                  <!--Zero or more repetitions:-->
                  <urn3:ExternalIdentifier id="?" home="?" lid="?" objectType="?" status="?" registryObject="?" identificationScheme="?" value="?">
                     <!--Zero or more repetitions:-->
                     <urn3:Slot name="?" slotType="?">
                        <urn3:ValueList>
                           <urn3:Value>?</urn3:Value>
                        </urn3:ValueList>
                     </urn3:Slot>
                     <!--Optional:-->
                     <urn3:Name>
                        <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                     </urn3:Name>
                     <!--Optional:-->
                     <urn3:Description>
                        <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                     </urn3:Description>
                     <!--Optional:-->
                     <urn3:VersionInfo versionName="1.1" comment="?"/>
                     <!--Zero or more repetitions:-->
                     <urn3:Classification/>
                     <!--Zero or more repetitions:-->
                     <urn3:ExternalIdentifier/>
                  </urn3:ExternalIdentifier>
               </urn3:Classification>
               <!--Zero or more repetitions:-->
               <urn3:ExternalIdentifier id="?" home="?" lid="?" objectType="?" status="?" registryObject="?" identificationScheme="?" value="?">
                  <!--Zero or more repetitions:-->
                  <urn3:Slot name="?" slotType="?">
                     <urn3:ValueList>
                        <urn3:Value>?</urn3:Value>
                     </urn3:ValueList>
                  </urn3:Slot>
                  <!--Optional:-->
                  <urn3:Name>
                     <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                  </urn3:Name>
                  <!--Optional:-->
                  <urn3:Description>
                     <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                  </urn3:Description>
                  <!--Optional:-->
                  <urn3:VersionInfo versionName="1.1" comment="?"/>
                  <!--Zero or more repetitions:-->
                  <urn3:Classification id="?" home="?" lid="?" objectType="?" status="?" classificationScheme="?" classifiedObject="?" classificationNode="?" nodeRepresentation="?">
                     <!--Zero or more repetitions:-->
                     <urn3:Slot name="?" slotType="?">
                        <urn3:ValueList>
                           <urn3:Value>?</urn3:Value>
                        </urn3:ValueList>
                     </urn3:Slot>
                     <!--Optional:-->
                     <urn3:Name>
                        <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                     </urn3:Name>
                     <!--Optional:-->
                     <urn3:Description>
                        <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                     </urn3:Description>
                     <!--Optional:-->
                     <urn3:VersionInfo versionName="1.1" comment="?"/>
                     <!--Zero or more repetitions:-->
                     <urn3:Classification/>
                     <!--Zero or more repetitions:-->
                     <urn3:ExternalIdentifier/>
                  </urn3:Classification>
                  <!--Zero or more repetitions:-->
                  <urn3:ExternalIdentifier/>
               </urn3:ExternalIdentifier>
               <!--Optional:-->
               <urn3:QueryExpression queryLanguage="?">
                  e
                  <!--You may enter ANY elements at this point-->
                  gero
               </urn3:QueryExpression>
            </urn3:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn4:address>
               <urn4:addressType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:addressType>
               <urn4:city>?</urn4:city>
               <urn4:country>?</urn4:country>
               <urn4:state>?</urn4:state>
               <urn4:streetAddress>?</urn4:streetAddress>
               <urn4:zipCode>?</urn4:zipCode>
            </urn4:address>
            <urn4:dateOfBirth>?</urn4:dateOfBirth>
            <urn4:explanationNonClaimantSignature>?</urn4:explanationNonClaimantSignature>
            <urn4:haveSecondWitnessSignature>?</urn4:haveSecondWitnessSignature>
            <urn4:haveSignature>?</urn4:haveSignature>
            <urn4:haveWitnessSignature>?</urn4:haveWitnessSignature>
            <urn4:homeCommunity>
               <urn4:description>?</urn4:description>
               <urn4:homeCommunityId>?</urn4:homeCommunityId>
               <urn4:name>?</urn4:name>
            </urn4:homeCommunity>
            <urn4:personName>
               <urn4:familyName>?</urn4:familyName>
               <urn4:givenName>?</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:nameType>
               <urn4:secondNameOrInitials>?</urn4:secondNameOrInitials>
               <urn4:fullName>?</urn4:fullName>
               <urn4:prefix>?</urn4:prefix>
               <urn4:suffix>?</urn4:suffix>
            </urn4:personName>
            <urn4:phoneNumber>
               <urn4:areaCode>?</urn4:areaCode>
               <urn4:countryCode>?</urn4:countryCode>
               <urn4:extension>?</urn4:extension>
               <urn4:localNumber>?</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:phoneNumberType>
            </urn4:phoneNumber>
            <urn4:secondWitnessAddress>
               <urn4:addressType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:addressType>
               <urn4:city>?</urn4:city>
               <urn4:country>?</urn4:country>
               <urn4:state>?</urn4:state>
               <urn4:streetAddress>?</urn4:streetAddress>
               <urn4:zipCode>?</urn4:zipCode>
            </urn4:secondWitnessAddress>
            <urn4:secondWitnessName>
               <urn4:familyName>?</urn4:familyName>
               <urn4:givenName>?</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:nameType>
               <urn4:secondNameOrInitials>?</urn4:secondNameOrInitials>
               <urn4:fullName>?</urn4:fullName>
               <urn4:prefix>?</urn4:prefix>
               <urn4:suffix>?</urn4:suffix>
            </urn4:secondWitnessName>
            <urn4:secondWitnessPhone>
               <urn4:areaCode>?</urn4:areaCode>
               <urn4:countryCode>?</urn4:countryCode>
               <urn4:extension>?</urn4:extension>
               <urn4:localNumber>?</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:phoneNumberType>
            </urn4:secondWitnessPhone>
            <urn4:SSN>?</urn4:SSN>
            <!--1 or more repetitions:-->
            <urn4:uniquePatientId>?</urn4:uniquePatientId>
            <urn4:witnessAddress>
               <urn4:addressType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:addressType>
               <urn4:city>?</urn4:city>
               <urn4:country>?</urn4:country>
               <urn4:state>?</urn4:state>
               <urn4:streetAddress>?</urn4:streetAddress>
               <urn4:zipCode>?</urn4:zipCode>
            </urn4:witnessAddress>
            <urn4:witnessName>
               <urn4:familyName>?</urn4:familyName>
               <urn4:givenName>?</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:nameType>
               <urn4:secondNameOrInitials>?</urn4:secondNameOrInitials>
               <urn4:fullName>?</urn4:fullName>
               <urn4:prefix>?</urn4:prefix>
               <urn4:suffix>?</urn4:suffix>
            </urn4:witnessName>
            <urn4:witnessPhone>
               <urn4:areaCode>?</urn4:areaCode>
               <urn4:countryCode>?</urn4:countryCode>
               <urn4:extension>?</urn4:extension>
               <urn4:localNumber>?</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:phoneNumberType>
            </urn4:witnessPhone>
            <urn4:userInfo>
               <urn4:personName>
                  <urn4:familyName>?</urn4:familyName>
                  <urn4:givenName>?</urn4:givenName>
                  <urn4:nameType>
                     <urn4:code>?</urn4:code>
                     <urn4:codeSystem>?</urn4:codeSystem>
                     <urn4:codeSystemName>?</urn4:codeSystemName>
                     <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                     <urn4:displayName>?</urn4:displayName>
                     <urn4:originalText>?</urn4:originalText>
                     <!--Zero or more repetitions:-->
                     <urn4:translation/>
                  </urn4:nameType>
                  <urn4:secondNameOrInitials>?</urn4:secondNameOrInitials>
                  <urn4:fullName>?</urn4:fullName>
                  <urn4:prefix>?</urn4:prefix>
                  <urn4:suffix>?</urn4:suffix>
               </urn4:personName>
               <urn4:userName>?</urn4:userName>
               <urn4:org>
                  <urn4:description>?</urn4:description>
                  <urn4:homeCommunityId>?</urn4:homeCommunityId>
                  <urn4:name>?</urn4:name>
               </urn4:org>
               <!--Optional:-->
               <urn4:roleCoded>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:roleCoded>
            </urn4:userInfo>
            <urn4:authorized>?</urn4:authorized>
            <!--Optional:-->
            <urn4:purposeOfDisclosureCoded>
               <urn4:code>?</urn4:code>
               <urn4:codeSystem>?</urn4:codeSystem>
               <urn4:codeSystemName>?</urn4:codeSystemName>
               <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
               <urn4:displayName>?</urn4:displayName>
               <urn4:originalText>?</urn4:originalText>
               <!--Zero or more repetitions:-->
               <urn4:translation/>
            </urn4:purposeOfDisclosureCoded>
            <!--Optional:-->
            <urn4:samlAuthnStatement>
               <!--Optional:-->
               <urn4:authInstant>?</urn4:authInstant>
               <!--Optional:-->
               <urn4:sessionIndex>?</urn4:sessionIndex>
               <!--Optional:-->
               <urn4:authContextClassRef>?</urn4:authContextClassRef>
               <!--Optional:-->
               <urn4:subjectLocalityAddress>?</urn4:subjectLocalityAddress>
               <!--Optional:-->
               <urn4:subjectLocalityDNSName>?</urn4:subjectLocalityDNSName>
            </urn4:samlAuthnStatement>
            <!--Optional:-->
            <urn4:samlAuthzDecisionStatement>
               <!--Optional:-->
               <urn4:decision>?</urn4:decision>
               <!--Optional:-->
               <urn4:resource>?</urn4:resource>
               <!--Optional:-->
               <urn4:action>?</urn4:action>
               <!--Optional:-->
               <urn4:evidence>
                  <!--Optional:-->
                  <urn4:assertion>
                     <!--Optional:-->
                     <urn4:id>?</urn4:id>
                     <!--Optional:-->
                     <urn4:issueInstant>?</urn4:issueInstant>
                     <!--Optional:-->
                     <urn4:version>?</urn4:version>
                     <!--Optional:-->
                     <urn4:issuer>?</urn4:issuer>
                     <!--Optional:-->
                     <urn4:issuerFormat>?</urn4:issuerFormat>
                     <!--Optional:-->
                     <urn4:conditions>
                        <!--Optional:-->
                        <urn4:notBefore>?</urn4:notBefore>
                        <!--Optional:-->
                        <urn4:notOnOrAfter>?</urn4:notOnOrAfter>
                     </urn4:conditions>
                     <!--Zero or more repetitions:-->
                     <urn4:accessConsentPolicy>?</urn4:accessConsentPolicy>
                     <!--Zero or more repetitions:-->
                     <urn4:instanceAccessConsentPolicy>?</urn4:instanceAccessConsentPolicy>
                  </urn4:assertion>
               </urn4:evidence>
            </urn4:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn4:samlSignature>
               <!--Optional:-->
               <urn4:keyInfo>
                  <!--Optional:-->
                  <urn4:rsaKeyValueModulus>cid:995680764177</urn4:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn4:rsaKeyValueExponent>cid:1214967159425</urn4:rsaKeyValueExponent>
               </urn4:keyInfo>
               <!--Optional:-->
               <urn4:signatureValue>cid:1097555285042</urn4:signatureValue>
            </urn4:samlSignature>
            <!--Optional:-->
            <urn4:samlIssuer>
               <!--Optional:-->
               <urn4:issuer>?</urn4:issuer>
               <!--Optional:-->
               <urn4:issuerFormat>?</urn4:issuerFormat>
            </urn4:samlIssuer>
            <!--Optional:-->
            <urn4:messageId>?</urn4:messageId>
            <!--1 or more repetitions:-->
            <urn4:relatesToList>?</urn4:relatesToList>
         </urn:assertion>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:adapterdocquery/AdapterDocQueryPortType/RespondingGateway_CrossGatewayQueryRequest"/><con:wsrmConfig version="1.2"/></con:call></con:operation></con:interface>

<con:testSuite name="Scenario 1">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		



















<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="9a0f1d9f-ac55-4dac-ac10-8dde445665d6">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "2.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario1.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario1.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>2.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g1.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g1.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:22Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:22Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:22</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase>





<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 2" searchProperties="true" id="6703d14f-b465-4cb0-8ff3-d9602449f2cd">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "3.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario1.case2";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario1.case2">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>3.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g1.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g1.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:24Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:24Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:24</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase><con:properties/>
<con:setupScript/>
<con:tearDownScript/>
<con:reportParameters/>
</con:testSuite><con:testSuite name="Scenario 2">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		



















<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="a2e2df8a-1634-4044-9669-7ba857b5996e">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "2.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario2.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario2.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>2.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g1.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:26Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:26Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:26</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase>





<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 2" searchProperties="true" id="1844dec6-f120-4b0f-b5d5-9462c173fbca">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "2.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario2.case2";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario2.case2">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>3.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g1.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:29Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:29Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:29</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase><con:properties/>
<con:setupScript/>
<con:tearDownScript/>
<con:reportParameters/>
</con:testSuite><con:testSuite name="Scenario 3">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		



















<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="f1209adc-874c-4d94-8df4-a7f49642386f">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "3.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario3.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario3.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>2.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g1.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:31Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:31Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:31</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase>





<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 2" searchProperties="true" id="6fc6fc10-fbcc-4305-8611-73182173983b">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "3.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario3.case2";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario3.case2">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>3.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g1.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:33Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:33Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:33</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase><con:properties/>
<con:setupScript/>
<con:tearDownScript/>
<con:reportParameters/>
</con:testSuite><con:testSuite name="Scenario 4">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		



















<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="0a91d312-53a3-4593-86ae-0903b92ed661">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "2.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario4.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario4.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>2.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g0.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:35Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:35Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:35</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase>





<con:properties/>
<con:setupScript/>
<con:tearDownScript/>
<con:reportParameters/>
</con:testSuite><con:testSuite name="Scenario 5">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		



















<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="643e7aba-ea1d-440a-b72e-0dc891d93204">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "3.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario5.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario5.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>2.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g0.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:37Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:37Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:37</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase>





<con:properties/>
<con:setupScript/>
<con:tearDownScript/>
<con:reportParameters/>
</con:testSuite><con:testSuite name="Scenario 6">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		



















<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="e4854b07-0218-4e7a-89fe-797445aab2b7">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "3.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario6.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario6.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>3.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g1only.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:39Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:39Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:39</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase>





<con:properties/>
<con:setupScript/>
<con:tearDownScript/>
<con:reportParameters/>
</con:testSuite><con:testSuite name="Scenario 7">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		



















<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="f951829c-b100-46a9-9e0f-d9379d2b6119">
	<con:settings/>

	
<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config><script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "2.0",
	log);</script></con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
</con:config>
</con:testStep>


<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
</con:config>
</con:testStep><con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	
	<con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	<con:assertion type="Schema Compliance">
		<con:configuration/>
	</con:assertion>
	<con:assertion type="SOAP Fault Assertion"/>
	<con:assertion name="DocID Match" type="GroovyScriptAssertion">
		<con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario7.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText></con:configuration>
	</con:assertion>
	<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep><con:testStep type="mockresponse" name="Mock Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocQueryBindingSoap</con:interface><con:operation>RespondingGateway_CrossGatewayQuery</con:operation><con:path>/MockDQAdapter</con:path><con:port>1720</con:port><con:response><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario7.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match"><con:configuration><path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path><content>3.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion></con:config></con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "uddiConnectionInfo_g1only.xml", context.findProperty('GatewayPropDir'), "uddiConnectionInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalConnectionInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalConnectionInfo.xml", log);</con:setupScript>
<con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);
if(context.findProperty("PassThruOn").toBoolean()){
	nhinc.FileUtils.restoreFile(dir, "PolicyEngineProxyConfig.xml", log);
}</con:tearDownScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2013-06-10T17:41:41Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2013-06-10T17:51:41Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>06/10/2013 17:41:41</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2013-07-10T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
<con:property><con:name>PassThruOn</con:name><con:value>false</con:value></con:property></con:properties>
<con:reportParameters/>
</con:testCase>





<con:properties/>
<con:setupScript/>
<con:tearDownScript/>
<con:reportParameters/>
</con:testSuite><con:mockService port="8080" path="/" host="GFE-ONC-WDEV28" name="MockService 1"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.mock.WsdlMockService@require-soap-action">false</con:setting></con:settings><con:mockOperation name="RespondingGateway_CrossGatewayQuery" interface="AdapterDocQueryBindingSoap" operation="RespondingGateway_CrossGatewayQuery"><con:settings/><con:dispatchStyle>SEQUENCE</con:dispatchStyle><con:defaultResponse>Response 1</con:defaultResponse><con:response name="Response 1" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body>
      <urn:AdhocQueryResponse status="?" requestId="?" startIndex="0" totalResultCount="?">
         <!--Optional:-->
         <urn1:ResponseSlotList>
            <!--Zero or more repetitions:-->
            <urn2:Slot name="?" slotType="?">
               <urn2:ValueList>
                  <urn2:Value>?</urn2:Value>
               </urn2:ValueList>
            </urn2:Slot>
         </urn1:ResponseSlotList>
         <!--Optional:-->
         <urn1:RegistryErrorList highestSeverity="?">
            <!--1 or more repetitions:-->
            <urn1:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn1:RegistryError>
         </urn1:RegistryErrorList>
         <urn2:RegistryObjectList>
            <!--Zero or more repetitions:-->
            <urn2:Identifiable id="?" home="?">
               <!--Zero or more repetitions:-->
               <urn2:Slot name="?" slotType="?">
                  <urn2:ValueList>
                     <urn2:Value>?</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:Identifiable>
         </urn2:RegistryObjectList>
      </urn:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:adapterdocquery/AdapterDocQueryPortType/RespondingGateway_CrossGatewayQueryResponse"/></con:response><con:response name="Response 2" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body>
      <urn:AdhocQueryResponse status="?" requestId="?" startIndex="0" totalResultCount="?">
         <!--Optional:-->
         <urn1:ResponseSlotList>
            <!--Zero or more repetitions:-->
            <urn2:Slot name="?" slotType="?">
               <urn2:ValueList>
                  <urn2:Value>?</urn2:Value>
               </urn2:ValueList>
            </urn2:Slot>
         </urn1:ResponseSlotList>
         <!--Optional:-->
         <urn1:RegistryErrorList highestSeverity="?">
            <!--1 or more repetitions:-->
            <urn1:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn1:RegistryError>
         </urn1:RegistryErrorList>
         <urn2:RegistryObjectList>
            <!--Zero or more repetitions:-->
            <urn2:Identifiable id="?" home="?">
               <!--Zero or more repetitions:-->
               <urn2:Slot name="?" slotType="?">
                  <urn2:ValueList>
                     <urn2:Value>?</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:Identifiable>
         </urn2:RegistryObjectList>
      </urn:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:adapterdocquery/AdapterDocQueryPortType/RespondingGateway_CrossGatewayQueryResponse"/></con:response><con:dispatchConfig/></con:mockOperation><con:properties/></con:mockService><con:requirements/>
<con:properties>







	
	
	<con:property><con:name>AAMappingDB</con:name><con:value>assigningauthoritydb</con:value></con:property>









	<con:property><con:name>AAMappingTable</con:name><con:value>aa_to_home_community_mapping</con:value></con:property>
	
	
	
	








	<con:property><con:name>AsyncMsgDB</con:name><con:value>asyncmsgs</con:value></con:property><con:property><con:name>AsyncMsgTable</con:name><con:value>asyncmsgrepo</con:value></con:property><con:property><con:name>AuditRepoDB</con:name><con:value>auditrepo</con:value></con:property><con:property><con:name>AuditRepoTable</con:name><con:value>auditrepository</con:value></con:property>
	
	
	
	<con:property><con:name>BirthTime</con:name><con:value>19630804</con:value></con:property><con:property><con:name>City</con:name><con:value>Melbourne</con:value></con:property><con:property><con:name>Country</con:name><con:value>US</con:value></con:property><con:property><con:name>DateOfSignature</con:name><con:value>20080520</con:value></con:property>
	
	
	<con:property><con:name>DBHost</con:name><con:value>localhost</con:value></con:property>
	<con:property><con:name>DBPass</con:name><con:value>nhincpass</con:value></con:property><con:property><con:name>DBPort</con:name><con:value>3306</con:value></con:property><con:property><con:name>DBUser</con:name><con:value>nhincuser</con:value></con:property><con:property><con:name>DeferredPatientDiscoveryReqMessageID</con:name><con:value>uuid:6666666666.66666.666.66</con:value></con:property>
	
	
	






	<con:property><con:name>DOB</con:name><con:value>19800516</con:value></con:property>
	<con:property><con:name>DQDocID</con:name><con:value>1.123401.55555</con:value></con:property>


	
	
	






	
	
	
	
	
	


















	
	
	
	
	
	<con:property><con:name>DQPatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>DQPTDocID</con:name><con:value>1.123401.11111</con:value></con:property><con:property><con:name>DRDocID</con:name><con:value>1.123407.777777</con:value></con:property><con:property><con:name>DRRepoID</con:name><con:value>1</con:value></con:property>
	
	
	
	
	
	<con:property><con:name>DynamicDQDocID</con:name><con:value>103.8.9284320.020.3590.75^1266324032288</con:value></con:property><con:property><con:name>ExpirationDate</con:name><con:value>20100520</con:value></con:property><con:property><con:name>FamilyName</con:name><con:value>Younger</con:value></con:property><con:property><con:name>GatewayPropDir</con:name><con:value/></con:property><con:property><con:name>Gender</con:name><con:value>M</con:value></con:property><con:property><con:name>GivenName</con:name><con:value>Gallow</con:value></con:property><con:property><con:name>LocalAA</con:name><con:value>1.1</con:value></con:property><con:property><con:name>LocalHCDescription</con:name><con:value>InternalTest1</con:value></con:property><con:property><con:name>LocalHCID</con:name><con:value>1.1</con:value></con:property><con:property><con:name>LocalPatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>NotificationEndpoint</con:name><con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/NotificationConsumerService/HiemNotify</con:value></con:property>


	
	




	
	
	
	
	
	





	
	
	
	
	<con:property><con:name>NotifySubscriptionID</con:name><con:value>24085385-ef54-4aaf-b027-d5896689be24</con:value></con:property>
	<con:property><con:name>NotifySubscriptionManagerEndpointAddress</con:name><con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value></con:property>
	
	
	
	<con:property><con:name>PatientCorrelationDB</con:name><con:value>patientcorrelationdb</con:value></con:property><con:property><con:name>PatientCorrelationTable</con:name><con:value>correlatedidentifiers</con:value></con:property>
	
	<con:property><con:name>project.name</con:name><con:value>EntityValidation</con:value></con:property><con:property><con:name>PurposeOfDisclosure</con:name><con:value>Mental</con:value></con:property><con:property><con:name>RemoteAA</con:name><con:value>2.2</con:value></con:property><con:property><con:name>RemoteHCDescription</con:name><con:value>InternalTest2</con:value></con:property><con:property><con:name>RemoteHCID</con:name><con:value>2.2</con:value></con:property>
<con:property><con:name>RemotePatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>SSN</con:name><con:value>123456789</con:value></con:property><con:property><con:name>State</con:name><con:value>FL</con:value></con:property><con:property><con:name>StreetAddress</con:name><con:value>123 Johnson Rd</con:value></con:property><con:property><con:name>SubjectID</con:name><con:value>1111</con:value></con:property><con:property><con:name>SubscribePatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>SubscriptionDB</con:name><con:value>subscriptionrepository</con:value></con:property><con:property><con:name>SubscriptionManagerEndpointAddress</con:name><con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value></con:property><con:property><con:name>SubscriptionTable</con:name><con:value>subscription</con:value></con:property><con:property><con:name>UniquePatientId</con:name><con:value>1111^^^&amp;amp;1.1&amp;amp;ISO</con:value></con:property><con:property><con:name>UnSubscriptionID</con:name><con:value>6deec8e7-6e6c-4269-91c2-69cb777ab8b0</con:value></con:property><con:property><con:name>ZipCode</con:name><con:value>12345</con:value></con:property><con:property><con:name>DQ_EntityEndpoint_g1</con:name><con:value>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:value></con:property><con:property><con:name>DQ_EntityEndpoint_g0</con:name><con:value>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:value></con:property><con:property><con:name>DS_EntityEndpoint_g1</con:name><con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionUnsecured</con:value></con:property><con:property><con:name>DS_EntityEndpoint_g0</con:name><con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionUnsecured</con:value></con:property><con:property><con:name>DSDefResp_EntityEndpoint_g1</con:name><con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:value></con:property><con:property><con:name>DSDefResp_EntityEndpoint_g0</con:name><con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:value></con:property><con:property><con:name>PDDefReq_EntityEndpoint</con:name><con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:value></con:property><con:property><con:name>DR_EntityEndpoint_g1</con:name><con:value>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:value></con:property><con:property><con:name>DR_EntityEndpoint_g0</con:name><con:value>http://localhost:8080/Gateway/DocumentRetrieve/2_0/EntityService/EntityDocRetrieve</con:value></con:property><con:property><con:name>PDDefResp_EntityEndpoint</con:name><con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:value></con:property><con:property><con:name>PD_EntityEndpoint</con:name><con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:value></con:property><con:property><con:name>AD_EntityEndpoint_g1</con:name><con:value>http://localhost:8080/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:value></con:property><con:property><con:name>DSDefReq_EntityEndpoint_g1</con:name><con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:value></con:property><con:property><con:name>AD_EntityEndpoint_g0</con:name><con:value>http://localhost:8080/Gateway/AdminDistribution/1_0/AdministrativeDistribution_Service</con:value></con:property><con:property><con:name>DSDefReq_EntityEndpoint_g0</con:name><con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:value></con:property></con:properties>
<con:afterLoadScript>def propertiesFilename = project.path[0..(project.path.size()-4)] + 'properties'
def propertiesFile = new File(propertiesFilename)
if (propertiesFile.exists()) {
	def props = new Properties()
	props.load(new FileInputStream(propertiesFile))
	props.each { key, value ->
	    project.setPropertyValue(key, value)
	}
}

TimeZone.setDefault(TimeZone.getTimeZone("UTC"))
def testRunListener = [
afterRun: { testRunner, runContext -> },
afterStep: { testRunner, runContext, result -> },
beforeStep: { testRunner, runContext -> },
beforeStep: { testRunner, runContext, testStep -> },
beforeRun: { testRunner, runContext -> 
use (org.codehaus.groovy.runtime.TimeCategory) {
def startDate = 5.minutes.ago
def endDate = 5.minutes.from.now
def expireDate = 30.days.from.now

def df = "yyyy-MM-dd'T'HH:mm:ss'Z'"
def dfSig = "MM/dd/yyyy' 'HH:mm:ss"

runContext.testCase.setPropertyValue("startDate", startDate.format(df))
runContext.testCase.setPropertyValue("endDate", endDate.format(df))
runContext.testCase.setPropertyValue("sigDate", startDate.format(dfSig))
runContext.testCase.setPropertyValue("expireDate", expireDate.format(df))
}
}   
] as com.eviware.soapui.model.testsuite.TestRunListener

project.testSuiteList*.testCaseList.flatten()*.addTestRunListener(testRunListener)



com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.findProperty = { propertyName ->
return delegate.getProperty(propertyName) ?:
delegate.testCase.getPropertyValue(propertyName) ?:
delegate.testCase.testSuite.getPropertyValue(propertyName) ?:
delegate.testCase.testSuite.project.getPropertyValue(propertyName)
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.withSql = { dbOrPropertyName, block ->
def dbName = delegate.findProperty(dbOrPropertyName) ?: dbOrPropertyName
def host = delegate.findProperty('DBHost')
def port = delegate.findProperty('DBPort')
def user = delegate.findProperty('DBUser')
def pass = delegate.findProperty('DBPass')

def connectString = "jdbc:mysql://${host}:${port}/${dbName}"
def sql = groovy.sql.Sql.newInstance(connectString, user, pass, "com.mysql.jdbc.Driver");
try {
block(sql)
} finally {
sql.close()
}
}</con:afterLoadScript>
<con:wssContainer/>
<con:databaseConnectionContainer/>
<con:reporting>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:xmlTemplates/>
	<con:parameters/>
</con:reporting>
<con:sensitiveInformation/></con:soapui-project>