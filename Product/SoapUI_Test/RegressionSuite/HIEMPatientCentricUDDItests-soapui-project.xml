<?xml version="1.0" encoding="UTF-8" standalone="no"?><con:soapui-project xmlns:con="http://eviware.com/soapui/config" abortOnError="false" name="HIEMPatientCentricUDDItests" resourceRoot="" runType="SEQUENTIAL" soapui-version="3.6">
	<con:settings/>
	
	<con:interface xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:nhincsubscription}NotificationProducerBinding" definition="WSDL path not set.  #NhincSubscription.wsdl" name="NotificationProducerBinding" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincNotificationProducer</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:Subscribe" anonymous="optional" bindingOperationName="Subscribe" inputName="SubscribeRequest" isOneWay="false" name="Subscribe" outputName="SubscribeResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement}EntityNotificationProducerBindingSoap" definition="WSDL path not set.  #EntitySubscriptionManagement.wsdl" name="EntityNotificationProducerBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntityNotificationProducer</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:Subscribe" anonymous="optional" bindingOperationName="Subscribe" inputName="SubscribeRequest" isOneWay="false" name="Subscribe" outputName="SubscribeResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
		<con:operation action="urn:SubscribeCdcBioPackage" anonymous="optional" bindingOperationName="SubscribeCdcBioPackage" inputName="SubscribeCdcBioPackageRequest" isOneWay="false" name="SubscribeCdcBioPackage" outputName="SubscribeCdcBioPackageResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
		<con:operation action="urn:SubscribeDocument" anonymous="optional" bindingOperationName="SubscribeDocument" inputName="SubscribeDocumentRequest" isOneWay="false" name="SubscribeDocument" outputName="SubscribeDocumentResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:hiemsubscriptionrepositoryutil}HiemSubscriptionRepositoryUtilPortTypeBinding" definition="WSDL path not set.  #HiemSubscriptionRepositoryUtil.wsdl" name="HiemSubscriptionRepositoryUtilPortTypeBinding" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:8080/HiemSubscriptionRepositoryUtilService/HiemSubscriptionRepositoryUtilService</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/Nhinc/HiemSubscriptionRepositoryUtilService</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:EmptySubscriptionRepository" anonymous="optional" bindingOperationName="EmptySubscriptionRepository" inputName="EmptySubscriptionRepositoryRequest" isOneWay="false" name="EmptySubscriptionRepository" outputName="EmptySubscriptionRepositoryResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
			<con:call name="Request 1">
				<con:settings/>
				<con:encoding>UTF-8</con:encoding>
				<con:endpoint>http://localhost:${HttpDefaultPort}/Nhinc/HiemSubscriptionRepositoryUtilService</con:endpoint>
				<con:request><![CDATA[
					<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:gov:hhs:fha:nhinc:common:hiemsubscriptionrepositoryutil">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:EmptySubscriptionRepositoryRequest/>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
				<con:wsaConfig action="urn:gov:hhs:fha:nhinc:hiemsubscriptionrepositoryutil/HiemSubscriptionRepositoryUtilPortType/EmptySubscriptionRepositoryRequest" mustUnderstand="NONE" version="200508"/>
			</con:call>
		</con:operation>
		<con:operation action="urn:GetSubscriptionCount" anonymous="optional" bindingOperationName="GetSubscriptionCount" inputName="GetSubscriptionCountRequest" isOneWay="false" name="GetSubscriptionCount" outputName="GetSubscriptionCountResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
			<con:call name="Request 1">
				<con:settings/>
				<con:encoding>UTF-8</con:encoding>
				<con:endpoint>http://localhost:${HttpDefaultPort}/Nhinc/HiemSubscriptionRepositoryUtilService</con:endpoint>
				<con:request><![CDATA[
					<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:gov:hhs:fha:nhinc:common:hiemsubscriptionrepositoryutil">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:GetSubscriptionCountRequest/>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
				<con:wsaConfig action="urn:gov:hhs:fha:nhinc:hiemsubscriptionrepositoryutil/HiemSubscriptionRepositoryUtilPortType/GetSubscriptionCountRequest" mustUnderstand="NONE" version="200508"/>
			</con:call>
		</con:operation>
	</con:interface>
	<con:testSuite name="HIEMPatientCentricUDDItests TestSuite">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="d712ffa0-6d43-4bc8-bf6a-3f0d7c22ceb3" keepSession="false" maxResults="0" name="Empty Target XML - No Patient Correlations" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="Empty Target XML - No Patient Correlations">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:15Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:15Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:15</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="a6682bba-2714-435e-9a4b-3ab04664138c" keepSession="false" maxResults="0" name="Empty Target XML - Correlation for HCID not in UDDI file" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID not in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def remoteAA = context.findProperty( "testHCID" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
}
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="Empty Target XML - Correlation for HCID not in UDDI file">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:15Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:15Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:15</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="5c9c361b-283e-45d0-a53e-07d424168fab" keepSession="false" maxResults="0" name="Empty Target XML - Correlation for HCID in UDDI file" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID  in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiVA1 = context.findProperty( "hcid1" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiVA1, remotePatientID])
}
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('AAMappingDB') { sql -&gt; 
  def table = context.findProperty('AAMappingTable')

  sql.execute('delete from ' + table)

  def remoteAA = context.findProperty( "RemoteAA" )
  def remoteHCID = context.findProperty("RemoteHCID")
  def hcid1 = context.findProperty("hcid1")
  def hcid2 = context.findProperty("hcid2")
  def hcid3 = context.findProperty("hcid3")
  def hcid4 = context.findProperty("hcid4")
  def testhcid = context.findProperty("testHCID")
  def aa1 = context.findProperty("aa1")
  def aa2 = context.findProperty("aa2")
  def aa3 = context.findProperty("aa3")
  def aa4 = context.findProperty("aa4")
  def testaa = context.findProperty("testAA")

  def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
                   "values (1, ?, ?)"
  sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
  sql.executeUpdate(insertSql, [aa1, hcid1])
  sql.executeUpdate(insertSql, [aa2, hcid2])
  sql.executeUpdate(insertSql, [aa3, hcid3])
  sql.executeUpdate(insertSql, [aa4, hcid4])
  sql.executeUpdate(insertSql, [testaa, testhcid])

}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/&gt;</con:setting></con:settings>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="Empty Target XML - Correlation for HCID in UDDI file">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 3 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:16Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:16Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:16</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="5a617d9f-df9d-4ebc-b16f-b31b02926243" keepSession="false" maxResults="0" name="HCID Happy Path - No Patient Correlations" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="HCID Happy Path - No Patient Correlations">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
        <urn:nhinTargetCommunities>
           <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc1description}</urn1:description>
                  <urn1:homeCommunityId>4.4</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc1description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
 
          <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc2description}</urn1:description>
                  <urn1:homeCommunityId>5.5</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc2description}</urn1:name>
               </urn1:homeCommunity>
 
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:18Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:18Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:18</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="c8158913-7bba-43bc-bfa2-cf703530a7ee" keepSession="false" maxResults="0" name="HCID Happy Path  - Correlation for HCID in UDDI file/target XML" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiVA1 = context.findProperty( "hcid1" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiVA1, remotePatientID])
}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('AAMappingDB') { sql -&gt; 
  def table = context.findProperty('AAMappingTable')

  sql.execute('delete from ' + table)

  def remoteAA = context.findProperty( "RemoteAA" )
  def remoteHCID = context.findProperty("RemoteHCID")
  def hcid1 = context.findProperty("hcid1")
  def hcid2 = context.findProperty("hcid2")
  def hcid3 = context.findProperty("hcid3")
  def hcid4 = context.findProperty("hcid4")
  def testhcid = context.findProperty("testHCID")
  def aa1 = context.findProperty("aa1")
  def aa2 = context.findProperty("aa2")
  def aa3 = context.findProperty("aa3")
  def aa4 = context.findProperty("aa4")
  def testaa = context.findProperty("testAA")

  def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
                   "values (1, ?, ?)"
  sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
  sql.executeUpdate(insertSql, [aa1, hcid1])
  sql.executeUpdate(insertSql, [aa2, hcid2])
  sql.executeUpdate(insertSql, [aa3, hcid3])
  sql.executeUpdate(insertSql, [aa4, hcid4])
  sql.executeUpdate(insertSql, [testaa, testhcid])

}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="HCID Happy Path  - Correlation for HCID in UDDI file/target XML">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
        <urn:nhinTargetCommunities>
           <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc1description}</urn1:description>
                  <urn1:homeCommunityId>4.4</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc1description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
 
          <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc2description}</urn1:description>
                  <urn1:homeCommunityId>5.5</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc2description}</urn1:name>
               </urn1:homeCommunity>
 
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 3 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:19Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:19Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:19</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="f93eabc7-7e20-4424-b5a1-9a0c54ad53df" keepSession="false" maxResults="0" name="HCID Happy Path  - Correlation for HCID NOT in UDDI file/target XML" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def remoteAA = context.findProperty( "testHCID" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
}
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="HCID Happy Path  - Correlation for HCID NOT in UDDI file/target XML">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
        <urn:nhinTargetCommunities>
           <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc1description}</urn1:description>
                  <urn1:homeCommunityId>4.4</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc1description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
 
          <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc2description}</urn1:description>
                  <urn1:homeCommunityId>5.5</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc2description}</urn1:name>
               </urn1:homeCommunity>
 
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:20Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:20Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:20</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="e2686ef1-8640-4736-9976-f4150f2c5bee" keepSession="false" maxResults="0" name="HCID Happy Path  - Correlation for Both HCID  in UDDI file/target XML" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiVA1 = context.findProperty( "hcid1" )
   def uddiVA3 = context.findProperty( "hcid3" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (?, ?, ?, ?, ?)"

sql.executeUpdate(insertSql, [1, localAA, localPatientID, uddiVA1, remotePatientID])
sql.executeUpdate(insertSql, [2, localAA, localPatientID, uddiVA3, remotePatientID])
}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('AAMappingDB') { sql -&gt; 
  def table = context.findProperty('AAMappingTable')

  sql.execute('delete from ' + table)

  def remoteAA = context.findProperty( "RemoteAA" )
  def remoteHCID = context.findProperty("RemoteHCID")
  def hcid1 = context.findProperty("hcid1")
  def hcid2 = context.findProperty("hcid2")
  def hcid3 = context.findProperty("hcid3")
  def hcid4 = context.findProperty("hcid4")
  def testhcid = context.findProperty("testHCID")
  def aa1 = context.findProperty("aa1")
  def aa2 = context.findProperty("aa2")
  def aa3 = context.findProperty("aa3")
  def aa4 = context.findProperty("aa4")
  def testaa = context.findProperty("testAA")

  def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
                   "values (1, ?, ?)"
  sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
  sql.executeUpdate(insertSql, [aa1, hcid1])
  sql.executeUpdate(insertSql, [aa2, hcid2])
  sql.executeUpdate(insertSql, [aa3, hcid3])
  sql.executeUpdate(insertSql, [aa4, hcid4])
  sql.executeUpdate(insertSql, [testaa, testhcid])

}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="HCID Happy Path  - Correlation for Both HCID  in UDDI file/target XML">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
        <urn:nhinTargetCommunities>
           <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc1description}</urn1:description>
                  <urn1:homeCommunityId>4.4</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc1description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
 
          <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc2description}</urn1:description>
                  <urn1:homeCommunityId>6.6</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc2description}</urn1:name>
               </urn1:homeCommunity>
 
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 5 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:21Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:21Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:21</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="0198825d-307a-4d45-82df-24d412398c51" keepSession="false" maxResults="0" name="HCID Happy Path  - Expired Correlation for HCID  in UDDI file/target XML" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiVA1 = context.findProperty( "hcid1" )
   def uddiVA3 = context.findProperty( "hcid3" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId, CorrelationExpirationDate) " + 
                   "values (?, ?, ?, ?, ?, ?)"

sql.executeUpdate(insertSql, [1, localAA, localPatientID, uddiVA1, remotePatientID,'2010-01-01 00:00:00'])

}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="HCID Happy Path  - Expired Correlation for HCID  in UDDI file/target XML">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
        <urn:nhinTargetCommunities>
           <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc1description}</urn1:description>
                  <urn1:homeCommunityId>4.4</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc1description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:23Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:23Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:23</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="ef60b359-bbfd-4193-adc9-f506cd45fcbc" keepSession="false" maxResults="0" name="HCID Alt Path  - No Patient Correlations" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="HCID Alt Path  - No Patient Correlations">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
        <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#testHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#testHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#testHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:24Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:24Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:24</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="f9133342-a857-4c2d-9ee9-f08b51f60bf6" keepSession="false" maxResults="0" name="HCID Alt Path  - Correlation for HCID in taget XML and not in ICI" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def remoteAA = context.findProperty( "testHCID" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="HCID Alt Path  - Correlation for HCID in taget XML and not in ICI">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
        <urn:nhinTargetCommunities>
           <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc1description}</urn1:description>
                  <urn1:homeCommunityId>4.4</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc1description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
 
          <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc2description}</urn1:description>
                  <urn1:homeCommunityId>5.5</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc2description}</urn1:name>
               </urn1:homeCommunity>
 
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:25Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:25Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:25</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="78ddebe6-fceb-4a3e-941e-a7cf2c93f179" keepSession="false" maxResults="0" name="State Happy Path  - No Patient Correlations" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="State Happy Path  - No Patient Correlations">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region1}</urn1:region>
            </urn1:nhinTargetCommunity>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region2}</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:25Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:25Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:25</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="e198e4b6-959f-4807-966c-9c9ae2ec44d4" keepSession="false" maxResults="0" name="State Happy Path  - Correlation for HCID not in the UDDI/target XML" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID not in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def remoteAA = context.findProperty( "testHCID" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="State Happy Path  - Correlation for HCID not in the UDDI/target XML">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region1}</urn1:region>
            </urn1:nhinTargetCommunity>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region2}</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:26Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:26Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:26</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="65f4d098-3820-4293-9ae8-9b5941a7fb70" keepSession="false" maxResults="0" name="State Happy Path  - Correlation for HCID in the UDDI/target XML" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID  in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiVA1 = context.findProperty( "hcid1" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiVA1, remotePatientID])
}


context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiFL1 = context.findProperty( "hcid3" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (2, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiFL1, remotePatientID])
}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('AAMappingDB') { sql -&gt; 
  def table = context.findProperty('AAMappingTable')

  sql.execute('delete from ' + table)

  def remoteAA = context.findProperty( "RemoteAA" )
  def remoteHCID = context.findProperty("RemoteHCID")
  def hcid1 = context.findProperty("hcid1")
  def hcid2 = context.findProperty("hcid2")
  def hcid3 = context.findProperty("hcid3")
  def hcid4 = context.findProperty("hcid4")
  def testhcid = context.findProperty("testHCID")
  def aa1 = context.findProperty("aa1")
  def aa2 = context.findProperty("aa2")
  def aa3 = context.findProperty("aa3")
  def aa4 = context.findProperty("aa4")
  def testaa = context.findProperty("testAA")

  def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
                   "values (1, ?, ?)"
  sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
  sql.executeUpdate(insertSql, [aa1, hcid1])
  sql.executeUpdate(insertSql, [aa2, hcid2])
  sql.executeUpdate(insertSql, [aa3, hcid3])
  sql.executeUpdate(insertSql, [aa4, hcid4])
  sql.executeUpdate(insertSql, [testaa, testhcid])

}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="State Happy Path  - Correlation for HCID in the UDDI/target XML">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region1}</urn1:region>
            </urn1:nhinTargetCommunity>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region2}</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 5 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Restore Configurations" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
FileUtils.InitializeNHINCProperties(context, log);
					</script></con:config>
			</con:testStep>
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:27Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:27Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:27</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="0df214b5-62d3-48e0-a6ab-81c685f8b2fc" keepSession="false" maxResults="0" name="State Alt Path  - No Patient Correlations" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="State Alt Path  - No Patient Correlations">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc3description}</urn1:description>
                  <urn1:homeCommunityId>${#Project#hcid3}</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc3description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>US-VA</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Restore Configurations" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
FileUtils.InitializeNHINCProperties(context, log);
					</script></con:config>
			</con:testStep>
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:30Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:30Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:30</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="d0663696-5b27-48b8-a7da-cb8b028f786c" keepSession="false" maxResults="0" name="State Alt Path  - Correlation for HCID not in the UDDI/target XML" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID not in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def remoteAA = context.findProperty( "testHCID" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="State Alt Path  - Correlation for HCID not in the UDDI/target XML">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc3description}</urn1:description>
                  <urn1:homeCommunityId>${#Project#hcid3}</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc3description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region1}</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:30Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:30Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:30</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="5e8813b1-6730-4b83-8498-f5260de367ba" keepSession="false" maxResults="0" name="State Alt Path  - Correlation for HCID in the UDDI/target XML" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID  in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiVA1 = context.findProperty( "hcid1" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiVA1, remotePatientID])
}


context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiFL1 = context.findProperty( "hcid3" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (2, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiFL1, remotePatientID])
}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('AAMappingDB') { sql -&gt; 
  def table = context.findProperty('AAMappingTable')

  sql.execute('delete from ' + table)

  def remoteAA = context.findProperty( "RemoteAA" )
  def remoteHCID = context.findProperty("RemoteHCID")
  def hcid1 = context.findProperty("hcid1")
  def hcid2 = context.findProperty("hcid2")
  def hcid3 = context.findProperty("hcid3")
  def hcid4 = context.findProperty("hcid4")
  def testhcid = context.findProperty("testHCID")
  def aa1 = context.findProperty("aa1")
  def aa2 = context.findProperty("aa2")
  def aa3 = context.findProperty("aa3")
  def aa4 = context.findProperty("aa4")
  def testaa = context.findProperty("testAA")

  def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
                   "values (1, ?, ?)"
  sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
  sql.executeUpdate(insertSql, [aa1, hcid1])
  sql.executeUpdate(insertSql, [aa2, hcid2])
  sql.executeUpdate(insertSql, [aa3, hcid3])
  sql.executeUpdate(insertSql, [aa4, hcid4])
  sql.executeUpdate(insertSql, [testaa, testhcid])

}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="State Alt Path  - Correlation for HCID in the UDDI/target XML">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc3description}</urn1:description>
                  <urn1:homeCommunityId>${#Project#hcid3}</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc13description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>US-GA</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 3 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:31Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:31Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:31</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="9f96e371-f1d0-458a-9ba0-be970cb6b0dc" keepSession="false" maxResults="0" name="State Alt Path  - Region and associated HCID in target XML results in 1 response" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID  in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiFL1 = context.findProperty( "hcid4" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiFL1, remotePatientID])
}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('AAMappingDB') { sql -&gt; 
  def table = context.findProperty('AAMappingTable')

  sql.execute('delete from ' + table)

  def remoteAA = context.findProperty( "RemoteAA" )
  def remoteHCID = context.findProperty("RemoteHCID")
  def hcid1 = context.findProperty("hcid1")
  def hcid2 = context.findProperty("hcid2")
  def hcid3 = context.findProperty("hcid3")
  def hcid4 = context.findProperty("hcid4")
  def testhcid = context.findProperty("testHCID")
  def aa1 = context.findProperty("aa1")
  def aa2 = context.findProperty("aa2")
  def aa3 = context.findProperty("aa3")
  def aa4 = context.findProperty("aa4")
  def testaa = context.findProperty("testAA")

  def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
                   "values (1, ?, ?)"
  sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
  sql.executeUpdate(insertSql, [aa1, hcid1])
  sql.executeUpdate(insertSql, [aa2, hcid2])
  sql.executeUpdate(insertSql, [aa3, hcid3])
  sql.executeUpdate(insertSql, [aa4, hcid4])
  sql.executeUpdate(insertSql, [testaa, testhcid])

}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="State Alt Path  - Region and associated HCID in target XML results in 1 response">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#hc4description}</urn1:description>
                  <urn1:homeCommunityId>${#Project#hcid4}</urn1:homeCommunityId>
                  <urn1:name>${#Project#hc4description}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region3}</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 3 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:33Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:33Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:33</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="a63abed0-7d6b-4a3b-a2c3-3f564fe69e18" keepSession="false" maxResults="0" name="State Alt Path  - Multiple regions and correlations" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "HIEM-uddiConnectionInfo.xml";
def destDir = System.env['NHINC_PROPERTIES_DIR'];
def destFile = "uddiConnectionInfo.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="Copy hiemTopicConnection" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def testCase = testRunner.getTestCase()
def testSuite = testCase.getTestSuite()
def project = testSuite.getProject()
def projectPropFullFile = project.getPath()
def projectPropPath = groovyUtils.projectPath

def sourceDir = projectPropPath;
def sourceFile = "hiemConfiguration.xml";
//def destDir = context.findProperty( "NHINGatewayConfigDir" );
def destDir = System.env['NHINC_PROPERTIES_DIR'];
//def destDir = context.expand( '${#Env#NHINC_PROPERTIES_DIR}' );;
def destFile = "hiemTopicConfiguration.xml";

log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);






					</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy-&gt;UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);
					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Add Correlation for HCID  in the UDDI" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiVA1 = context.findProperty( "hcid1" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiVA1, remotePatientID])
}

context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiGA1 = context.findProperty( "hcid4" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (2, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiGA1, remotePatientID])
}

context.withSql('PatientCorrelationDB') { sql -&gt; 
  def table = context.findProperty('PatientCorrelationTable')

  def localAA = context.findProperty( "LocalAA" )	
  def localPatientID = context.findProperty("LocalPatientID")
  def uddiFL1 = context.findProperty( "hcid3" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (3, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, uddiFL1, remotePatientID])
}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('AAMappingDB') { sql -&gt; 
  def table = context.findProperty('AAMappingTable')

  sql.execute('delete from ' + table)

  def remoteAA = context.findProperty( "RemoteAA" )
  def remoteHCID = context.findProperty("RemoteHCID")
  def hcid1 = context.findProperty("hcid1")
  def hcid2 = context.findProperty("hcid2")
  def hcid3 = context.findProperty("hcid3")
  def hcid4 = context.findProperty("hcid4")
  def testhcid = context.findProperty("testHCID")
  def aa1 = context.findProperty("aa1")
  def aa2 = context.findProperty("aa2")
  def aa3 = context.findProperty("aa3")
  def aa4 = context.findProperty("aa4")
  def testaa = context.findProperty("testAA")

  def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
                   "values (1, ?, ?)"
  sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
  sql.executeUpdate(insertSql, [aa1, hcid1])
  sql.executeUpdate(insertSql, [aa2, hcid2])
  sql.executeUpdate(insertSql, [aa3, hcid3])
  sql.executeUpdate(insertSql, [aa4, hcid4])
  sql.executeUpdate(insertSql, [testaa, testhcid])

}</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="con:RequestStep">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings/>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[
							<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEM-PatientCentric-UDDItests" testCase="State Alt Path  - Multiple regions and correlations">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
          <wsnt:AdhocQuery id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d" xmlns:wsnt="urn:oasis:names:tc:ebxml-regrep:xsd:wsnt:3.0">
               <wsnt:Slot name="$XDSDocumentEntryPatientId">
                  <wsnt:ValueList>
                     <wsnt:Value>D123401^^^&amp;1.1&amp;ISO</wsnt:Value>
                  </wsnt:ValueList>
               </wsnt:Slot>
            </wsnt:AdhocQuery>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">PatientCentricTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
        <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region1}</urn1:region>
            </urn1:nhinTargetCommunity>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region2}</urn1:region>
            </urn1:nhinTargetCommunity>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description/>
                  <urn1:homeCommunityId/>
                  <urn1:name/>
               </urn1:homeCommunity>
               <urn1:list/>
               <urn1:region>${#Project#Region3}</urn1:region>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -&gt; 
  assert 7 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-08-24T23:25:34Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-08-24T23:35:34Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>08/24/2012 23:25:34</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2012-09-23T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>date</con:name>
					<con:value>09/23/2012 00:00:00</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

void MoveFile(File sourceFile, File destinationFile, log){
 
 if(sourceFile.exists())
   {
    def reader = sourceFile.newReader();
    destinationFile.withWriter 
    { writer -&gt;       
     writer &lt;&lt; reader;   
    }   
    reader.close();
   } 
   else {
      log.info("unable to find source file " + sourceFile);
   }   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
   if(file.exists()) {    
      log.info("deleting file " + file);
      file.delete(); 
   } else {
      log.info("file not found, skipping delete for " + file);
   }
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
		</con:testCase>
		<con:properties/>
		<con:setupScript/>
		<con:reportParameters/>
	</con:testSuite>
	<con:requirements/>
	<con:properties>
		
		<con:property><con:name>aa1</con:name><con:value>4.4</con:value></con:property><con:property><con:name>aa2</con:name><con:value>5.5</con:value></con:property>
		<con:property><con:name>aa3</con:name><con:value>6.6</con:value></con:property>
		
		<con:property><con:name>aa4</con:name><con:value>7.7</con:value></con:property><con:property><con:name>AAMappingDB</con:name><con:value>assigningauthoritydb</con:value></con:property><con:property><con:name>AAMappingTable</con:name><con:value>aa_to_home_community_mapping</con:value></con:property><con:property><con:name>DBHost</con:name><con:value>localhost</con:value></con:property><con:property><con:name>DBPass</con:name><con:value>nhincpass</con:value></con:property>
		<con:property><con:name>DBPort</con:name><con:value>3306</con:value></con:property>
		
		
		
		
		
		
		<con:property><con:name>DBUser</con:name><con:value>nhincuser</con:value></con:property><con:property><con:name>Endpoint-Notify</con:name><con:value>http://localhost:8080/Gateway/HIEM/2_0/EntityNotificationConsumer</con:value></con:property>
		
		<con:property><con:name>Endpoint-Subscribe</con:name><con:value>http://localhost:8080/Gateway/HIEM/2_0/EntityNotificationProducer</con:value></con:property><con:property><con:name>Endpoint-Unsubscribe</con:name><con:value>http://localhost:8080/Gateway/HIEM/2_0/EntitySubscriptionManager</con:value></con:property><con:property><con:name>hc1description</con:name><con:value>Test1</con:value></con:property>
		<con:property><con:name>hc2description</con:name><con:value>Test2</con:value></con:property>
		
		
		<con:property><con:name>hc3description</con:name><con:value>Test3</con:value></con:property><con:property><con:name>hc4description</con:name><con:value>Test4</con:value></con:property><con:property><con:name>hcid1</con:name><con:value>4.4</con:value></con:property><con:property><con:name>hcid2</con:name><con:value>5.5</con:value></con:property><con:property><con:name>hcid3</con:name><con:value>6.6</con:value></con:property><con:property><con:name>hcid4</con:name><con:value>7.7</con:value></con:property><con:property><con:name>LocalAA</con:name><con:value>1.1</con:value></con:property>
		
		
		
		<con:property><con:name>LocalHCDescription</con:name><con:value>InternalTest1</con:value></con:property><con:property><con:name>LocalHCID</con:name><con:value>1.1</con:value></con:property>
		
		
		
		
		
		<con:property><con:name>LocalPatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>MockHost</con:name><con:value>localhost</con:value></con:property><con:property><con:name>MPIDir</con:name><con:value>C:/Sun/AppServer/domains/domain1/config</con:value></con:property><con:property><con:name>NHINGatewayConfigDir</con:name><con:value>C:/Sun/AppServer/domains/domain1/config/nhin</con:value></con:property>
		
		
		<con:property><con:name>NHINGatewayHost</con:name><con:value>localhost</con:value></con:property><con:property><con:name>NotificationEndpoint</con:name><con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/NotificationConsumerService/HiemNotify</con:value></con:property>
		
		<con:property><con:name>NotifySubscriptionID</con:name><con:value>-f7c1a5d:1204e50e42e:-79eb</con:value></con:property><con:property><con:name>NotifySubscriptionManagerEndpointAddress</con:name><con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value></con:property>
		
		
		
		<con:property><con:name>PatientCorrelationDB</con:name><con:value>patientcorrelationdb</con:value></con:property><con:property><con:name>PatientCorrelationTable</con:name><con:value>correlatedidentifiers</con:value></con:property><con:property><con:name>Region1</con:name><con:value>US-VA</con:value></con:property><con:property><con:name>Region2</con:name><con:value>US-FL</con:value></con:property>
		
		<con:property><con:name>Region3</con:name><con:value>US-GA</con:value></con:property>
		<con:property><con:name>Region4</con:name><con:value>US-MA</con:value></con:property><con:property><con:name>RemoteAA</con:name><con:value>2.2</con:value></con:property>
		
		<con:property><con:name>RemoteHCDescription</con:name><con:value>InternalTest2</con:value></con:property>
		
		
		<con:property><con:name>RemoteHCID</con:name><con:value>2.2</con:value></con:property><con:property><con:name>RemotePatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>SubscribePatientID</con:name><con:value>D123401</con:value></con:property>
		
		
		<con:property><con:name>SubscriptionDB</con:name><con:value>subscriptionrepository</con:value></con:property><con:property><con:name>SubscriptionEndpoint</con:name><con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/NotificationProducerService/HiemSubscription</con:value></con:property><con:property><con:name>SubscriptionManagerEndpointAddress</con:name><con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value></con:property><con:property><con:name>SubscriptionTable</con:name><con:value>subscription</con:value></con:property><con:property><con:name>testAA</con:name><con:value>8.8</con:value></con:property>
		
		
	<con:property><con:name>testHCDescription</con:name><con:value>Test HCID</con:value></con:property><con:property><con:name>testHCID</con:name><con:value>8.8</con:value></con:property><con:property><con:name>UnsubSubscriptionID</con:name><con:value>3e74139f-5271-4db1-98c0-88748fa3e4e3</con:value></con:property></con:properties>
	<con:afterLoadScript>def propertiesFile = new File(new File(project.path).parent, 'HIEMPatientCentricUDDItests-soapui-project.properties')
if (propertiesFile.exists()) {
	def props = new Properties()
	props.load(new FileReader(propertiesFile))
	props.each { key, value -&gt;
	    project.setPropertyValue(key, value)
	}
}


TimeZone.setDefault(TimeZone.getTimeZone("UTC"))
def testRunListener = [
  afterRun: { testRunner, runContext -&gt; },
  afterStep: { testRunner, runContext, result -&gt; },
  beforeStep: { testRunner, runContext -&gt; },
  beforeStep: { testRunner, runContext, testStep -&gt; },
  beforeRun: { testRunner, runContext -&gt; 
    use (org.codehaus.groovy.runtime.TimeCategory) {
      def startDate = 5.minutes.ago
      def endDate = 5.minutes.from.now
      def expireDate = 30.days.from.now
      def date = new Date()

      def df = "yyyy-MM-dd'T'HH:mm:ss'Z'"
      def dfSig = "MM/dd/yyyy' 'HH:mm:ss"

      runContext.testCase.setPropertyValue("startDate", startDate.format(df))
      runContext.testCase.setPropertyValue("endDate", endDate.format(df))
      runContext.testCase.setPropertyValue("sigDate", startDate.format(dfSig))
      runContext.testCase.setPropertyValue("expireDate", expireDate.format(df))
      runContext.testCase.setPropertyValue("date", expireDate.format(dfSig))
    }
  }   
] as com.eviware.soapui.model.testsuite.TestRunListener

project.testSuiteList*.testCaseList.flatten()*.addTestRunListener(testRunListener)



com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.findProperty = { propertyName -&gt;
    return delegate.getProperty(propertyName) ?:
                delegate.testCase.getPropertyValue(propertyName) ?:
                delegate.testCase.testSuite.getPropertyValue(propertyName) ?:
                delegate.testCase.testSuite.project.getPropertyValue(propertyName)
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.withSql = { dbOrPropertyName, block -&gt;
  def dbName = delegate.findProperty(dbOrPropertyName) ?: dbOrPropertyName
  def host = delegate.findProperty('DBHost')
  def port = delegate.findProperty('DBPort')
  def user = delegate.findProperty('DBUser')
  def pass = delegate.findProperty('DBPass')

  def connectString = "jdbc:mysql://${host}:${port}/${dbName}"
  def sql = groovy.sql.Sql.newInstance(connectString, user, pass, "com.mysql.jdbc.Driver");
  try {
     block(sql)
  } finally {
    sql.close()
  }
}</con:afterLoadScript>
	<con:wssContainer/>
	<con:databaseConnectionContainer/>
	<con:reporting>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:parameters/>
	</con:reporting>
	<con:eventHandlers name="TestSuiteRunListener.beforeTestCase" type="TestSuiteRunListener.beforeTestCase">
		<con:script>FileUtils.backupConfiguration(context, log);</con:script>
	</con:eventHandlers>
	<con:eventHandlers name="TestSuiteRunListener.afterTestCase" type="TestSuiteRunListener.afterTestCase">
		<con:script>FileUtils.restoreConfiguration(context, log)</con:script>
	</con:eventHandlers>
</con:soapui-project>