<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project abortOnError="false" name="DocQueryFanoutTestTarget" resourceRoot="" runType="SEQUENTIAL" soapui-version="3.5.1" xmlns:con="http://eviware.com/soapui/config">
	<con:settings/>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitydocquery}EntityDocQueryBindingSoap" definition="WSDL path not set.  #EntityDocQuery.wsdl" name="EntityDocQueryBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		<con:endpoints>
			<con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
		</con:endpoints>
		<con:operation action="urn:RespondingGateway_CrossGatewayQuery" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayQuery" inputName="RespondingGateway_CrossGatewayQueryRequest" isOneWay="false" name="RespondingGateway_CrossGatewayQuery" outputName="RespondingGateway_CrossGatewayQueryResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:testSuite name="DQ_UDDI_Target TestSuite">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="4e679453-a1a1-4bdf-9e0b-beb70425b7a7" keepSession="false" maxResults="0" name="Target with no DQ Service but 3 Correlations" searchProperties="true">
			<con:settings/>

			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
						def testCase = testRunner.getTestCase()
						def testSuite = testCase.getTestSuite()
						def project = testSuite.getProject()
						def projectPropFullFile = project.getPath()
						def projectPropPath = groovyUtils.projectPath

						def sourceDir = projectPropPath;
						def sourceFile = "UDDIcopy-uddiConnectionInfo.xml";
						//def destDir = context.findProperty( "NHINGatewayConfigDir" );
						def destDir = System.env['NHINC_PROPERTIES_DIR'];
						def destFile = "uddiConnectionInfo.xml";

						log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

						FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
						def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

						void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

						log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
						File file = new File(directory,filename);
						Properties properties = new Properties();
						FileInputStream frPropFile = new FileInputStream(file);
						properties.load(frPropFile);
						properties.setProperty(propertyKey, propertyValue);
						FileOutputStream fwPropFile = new FileOutputStream(file);
						properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
					properties = null;
					}

					UpdateProperty(destConfigFileLocation,"gateway.properties","documentQueryQuerySelf","false",context,log);</script>
			</con:config>
		</con:testStep>
		<con:testStep name="Generate patient ID for Doc Query" type="groovy">
			<con:settings/>
			<con:config>
				<script>def localAA = context.findProperty('LocalAA')
					def dqPatientID = context.findProperty('DQPatientID')

					context.testCase.setPropertyValue('FullPatientID', "'${dqPatientID}^^^&amp;amp;${localAA}&amp;amp;ISO'");</script>
			</con:config>
		</con:testStep>
		<con:testStep name="Clear Correlation Table" type="groovy">
			<con:settings/>
			<con:config>
				<script>context.withSql('PatientCorrelationDB') { sql -> 
				def table = context.findProperty('PatientCorrelationTable')

				sql.execute('delete from ' + table)
				}</script>
		</con:config>
	</con:testStep>
	<con:testStep name="Add Correlation for HCID not in the UDDI" type="groovy">
		<con:settings/>
		<con:config>
			<script>context.withSql('PatientCorrelationDB') { sql -> 
			def table = context.findProperty('PatientCorrelationTable')

			def localAA = context.findProperty( "LocalAA" )	
			def localPatientID = context.findProperty("LocalPatientID")
			def remoteAA1 = context.findProperty( "UDDIhcid1" )
			def remoteAA2 = context.findProperty( "UDDIhcid3" )
			def remoteAA3 = context.findProperty( "UDDIhcid4" )
			def remotePatientID = context.findProperty("RemotePatientID")
			def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
			"values (?, ?, ?, ?, ?)"
			sql.executeUpdate(insertSql, [1, localAA, localPatientID, remoteAA1, remotePatientID])
			sql.executeUpdate(insertSql, [2, localAA, localPatientID, remoteAA2, remotePatientID])
			sql.executeUpdate(insertSql, [3, localAA, localPatientID, remoteAA3, remotePatientID])


			}</script>
	</con:config>
</con:testStep>
<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def hcid1 = context.findProperty("UDDIhcid1")
		def hcid2 = context.findProperty("UDDIhcid2")
		def hcid3 = context.findProperty("UDDIhcid3")
		def hcid4 = context.findProperty("UDDIhcid4")
		def testhcid = context.findProperty("testHCID")
		def aa1 = context.findProperty("UDDIaa1")
		def aa2 = context.findProperty("UDDIaa2")
		def aa3 = context.findProperty("UDDIaa3")
		def aa4 = context.findProperty("UDDIaa4")
		def testaa = context.findProperty("testAA")

		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		//sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		sql.executeUpdate(insertSql, [aa1, hcid1])
		//sql.executeUpdate(insertSql, [aa2, hcid2])
		sql.executeUpdate(insertSql, [aa3, hcid3])
		sql.executeUpdate(insertSql, [aa4, hcid4])
		//sql.executeUpdate(insertSql, [testaa, testhcid])

		}</script>
</con:config>
</con:testStep>
<con:testStep name="Add Service in UDDI for HCIDs" type="groovy">
	<con:settings/>
	<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

			def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];
			def NHINGatewayHost = context.findProperty("NHINGatewayHost");
			def mockHost = context.findProperty("mockHost");
			def dQURL = "https://localhost:8181/Gateway/DocumentQuery/2_0/NhinService/RespondingGateway_Query_Service/DocQuery";
			def remoteHCID2 = context.findProperty( "UDDIhcid3" );
			def remoteHCID3 = context.findProperty( "UDDIhcid4" );

			FileUtils.CreateOrUpdateConnection("uddiConnectionInfo.xml", destConfigFileLocation, remoteHCID2, "QueryForDocuments", dQURL, "2.0", context, log)
			FileUtils.CreateOrUpdateConnection("uddiConnectionInfo.xml", destConfigFileLocation, remoteHCID3, "QueryForDocuments", dQURL, "2.0", context, log)</script></con:config>
</con:testStep>
<con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	<con:endpoint>${#Project#Endpoint-DocQuery}</con:endpoint>
	<con:request><![CDATA[
		<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body projectName="DocQueryTestsForUDDI" testCase="HCID Happy Path - Correlation for HCID not in UDDI file/target XML">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="RegistryObject" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:2.16.840.1.113883.3.200" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>${#TestCase#FullPatientID}</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:dateOfSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</urn3:dateOfSignature>
            <urn3:expirationDate xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expireDate}</urn3:expirationDate>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:purposeOfDisclosure xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</urn3:purposeOfDisclosure>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerb</urn3:userName>
               <urn3:role>Pharmacy</urn3:role>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:claimFormRef>Ref-Clm-123</urn3:claimFormRef>
            <urn3:claimFormRaw>YWVvbGlhbQ==</urn3:claimFormRaw>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#UDDIhc1description}</urn3:description>
                  <urn3:homeCommunityId>${#Project#UDDIhcid1}</urn3:homeCommunityId>
                  <urn3:name>${#Project#UDDIhc1description}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	
	<con:assertion type="SOAP Fault Assertion"/>
	
	
	
	
	<con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns12"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0";
	

				def assertErrorNum = 1
				def numErrors = holder["count(//ns1:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError)"];
				log.info("Number of Errors: " + numErrors);
				assert (numErrors.toInteger() == assertErrorNum.toInteger())</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns12"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0";
	

				def assertError = "No URLs found for targeted DocQueryRequest for homecommunity:4.4"
				def error = holder["//ns1:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError/@codeContext"];
				log.info("Number of Errors: " + error);
				assert (assertError.equals(error));</scriptText></con:configuration></con:assertion><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep>

<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

	File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
	File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

	File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
	File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

	void MoveFile(File sourceFile, File destinationFile, log){

	if(sourceFile.exists())
	{
	def reader = sourceFile.newReader();
	destinationFile.withWriter 
	{ writer ->       
writer &lt;&lt; reader;   
}   
reader.close();
} 
else {
log.info("unable to find source file " + sourceFile);
}   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2012-08-23T20:22:26Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2012-08-23T20:32:26Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>08/23/2012 20:22:26</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2012-09-22T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
</con:properties>
<con:reportParameters/>
<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

	def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

	File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
	File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

	File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
	File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

	void MoveFile(File sourceFile, File destinationFile, log){

	if(sourceFile.exists())
	{
	def reader = sourceFile.newReader();
	destinationFile.withWriter 
	{ writer ->       
writer &lt;&lt; reader;   
}   
reader.close();
} 
else {
log.info("unable to find source file " + sourceFile);
}   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
if(file.exists()) {    
log.info("deleting file " + file);
file.delete(); 
} else {
log.info("file not found, skipping delete for " + file);
}
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
</con:testCase>
<con:testCase failOnError="true" failTestCaseOnErrors="true" id="9324f41a-5d01-4528-9520-206957d72ffc" keepSession="false" maxResults="0" name="2 Targets (1 with no DQ Service) but 3 Correlations" searchProperties="true">
	<con:settings/>

	<con:testStep name="Copy uddiConnectionInfo" type="groovy">
		<con:settings/>
		<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
				def testCase = testRunner.getTestCase()
				def testSuite = testCase.getTestSuite()
				def project = testSuite.getProject()
				def projectPropFullFile = project.getPath()
				def projectPropPath = groovyUtils.projectPath

				def sourceDir = projectPropPath;
				def sourceFile = "UDDIcopy-uddiConnectionInfo.xml";
				//def destDir = context.findProperty( "NHINGatewayConfigDir" );
				def destDir = System.env['NHINC_PROPERTIES_DIR'];
				def destFile = "uddiConnectionInfo.xml";

				log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

				FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
	</con:testStep>
	<con:testStep name="update config" type="groovy">
		<con:settings/>
		<con:config>
			<script>//def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
				def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

				void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

				log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
				File file = new File(directory,filename);
				Properties properties = new Properties();
				FileInputStream frPropFile = new FileInputStream(file);
				properties.load(frPropFile);
				properties.setProperty(propertyKey, propertyValue);
				FileOutputStream fwPropFile = new FileOutputStream(file);
				properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
			properties = null;
			}

			UpdateProperty(destConfigFileLocation,"gateway.properties","documentQueryQuerySelf","false",context,log);</script>
	</con:config>
</con:testStep>
<con:testStep name="Generate patient ID for Doc Query" type="groovy">
	<con:settings/>
	<con:config>
		<script>def localAA = context.findProperty('LocalAA')
			def dqPatientID = context.findProperty('DQPatientID')

			context.testCase.setPropertyValue('FullPatientID', "'${dqPatientID}^^^&amp;amp;${localAA}&amp;amp;ISO'");</script>
	</con:config>
</con:testStep>
<con:testStep name="Clear Correlation Table" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)
		}</script>
</con:config>
</con:testStep>
<con:testStep name="Add Correlation for HCID not in the UDDI" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		def localAA = context.findProperty( "LocalAA" )	
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA1 = context.findProperty( "UDDIhcid1" )
		def remoteAA2 = context.findProperty( "UDDIhcid3" )
		def remoteAA3 = context.findProperty( "UDDIhcid4" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (?, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [1, localAA, localPatientID, remoteAA1, remotePatientID])
		sql.executeUpdate(insertSql, [2, localAA, localPatientID, remoteAA2, remotePatientID])
		sql.executeUpdate(insertSql, [3, localAA, localPatientID, remoteAA3, remotePatientID])


		}</script>
</con:config>
</con:testStep>
<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def hcid1 = context.findProperty("UDDIhcid1")
		def hcid2 = context.findProperty("UDDIhcid2")
		def hcid3 = context.findProperty("UDDIhcid3")
		def hcid4 = context.findProperty("UDDIhcid4")
		def testhcid = context.findProperty("testHCID")
		def aa1 = context.findProperty("UDDIaa1")
		def aa2 = context.findProperty("UDDIaa2")
		def aa3 = context.findProperty("UDDIaa3")
		def aa4 = context.findProperty("UDDIaa4")
		def testaa = context.findProperty("testAA")

		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		//sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		sql.executeUpdate(insertSql, [aa1, hcid1])
		//sql.executeUpdate(insertSql, [aa2, hcid2])
		sql.executeUpdate(insertSql, [aa3, hcid3])
		sql.executeUpdate(insertSql, [aa4, hcid4])
		//sql.executeUpdate(insertSql, [testaa, testhcid])

		}</script>
</con:config>
</con:testStep>
<con:testStep name="Add Service in UDDI for HCIDs" type="groovy">
	<con:settings/>
	<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

			def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];
			def NHINGatewayHost = context.findProperty("NHINGatewayHost");
			def mockHost = context.findProperty("mockHost");
			def dQURL = "https://localhost:8181/Gateway/DocumentQuery/2_0/NhinService/RespondingGateway_Query_Service/DocQuery";
			def remoteHCID2 = context.findProperty( "UDDIhcid3" );
			def remoteHCID3 = context.findProperty( "UDDIhcid4" );

			FileUtils.CreateOrUpdateConnection("uddiConnectionInfo.xml", destConfigFileLocation, remoteHCID2, "QueryForDocuments", dQURL, "2.0", context, log)
			FileUtils.CreateOrUpdateConnection("uddiConnectionInfo.xml", destConfigFileLocation, remoteHCID3, "QueryForDocuments", dQURL, "2.0", context, log)</script></con:config>
</con:testStep>
<con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	<con:endpoint>${#Project#Endpoint-DocQuery}</con:endpoint>
	<con:request><![CDATA[
		<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body projectName="DocQueryTestsForUDDI" testCase="HCID Happy Path - Correlation for HCID not in UDDI file/target XML">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="RegistryObject" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:2.16.840.1.113883.3.200" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>${#TestCase#FullPatientID}</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:dateOfSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</urn3:dateOfSignature>
            <urn3:expirationDate xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expireDate}</urn3:expirationDate>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:purposeOfDisclosure xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</urn3:purposeOfDisclosure>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerb</urn3:userName>
               <urn3:role>Pharmacy</urn3:role>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:claimFormRef>Ref-Clm-123</urn3:claimFormRef>
            <urn3:claimFormRaw>YWVvbGlhbQ==</urn3:claimFormRaw>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#UDDIhc1description}</urn3:description>
                  <urn3:homeCommunityId>${#Project#UDDIhcid1}</urn3:homeCommunityId>
                  <urn3:name>${#Project#UDDIhc1description}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
		<urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#UDDIhc1description}</urn3:description>
                  <urn3:homeCommunityId>${#Project#UDDIhcid3}</urn3:homeCommunityId>
                  <urn3:name>${#Project#UDDIhc1description}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	
	<con:assertion type="SOAP Fault Assertion"/>
	
	
	
	
	<con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";

				def assertDocNum = 1
				def numDocs = holder["count(//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject)"];
				log.info("Number of Docs: " + numDocs);
				assert (numDocs.toInteger() == assertDocNum.toInteger())</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns12"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0";
	

				def assertErrorNum = 1
				def numErrors = holder["count(//ns1:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError)"];
				log.info("Number of Errors: " + numErrors);
				assert (numErrors.toInteger() == assertErrorNum.toInteger())</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns12"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0";
	

				def assertError = "No URLs found for targeted DocQueryRequest for homecommunity:4.4"
				def error = holder["//ns1:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError/@codeContext"];
				log.info("Number of Errors: " + error);
				assert (assertError.equals(error));</scriptText></con:configuration></con:assertion><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep>

<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

	File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
	File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

	File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
	File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

	void MoveFile(File sourceFile, File destinationFile, log){

	if(sourceFile.exists())
	{
	def reader = sourceFile.newReader();
	destinationFile.withWriter 
	{ writer ->       
writer &lt;&lt; reader;   
}   
reader.close();
} 
else {
log.info("unable to find source file " + sourceFile);
}   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2012-08-23T20:24:40Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2012-08-23T20:34:40Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>08/23/2012 20:24:40</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2012-09-22T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
</con:properties>
<con:reportParameters/>
<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

	def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

	File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
	File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

	File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
	File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

	void MoveFile(File sourceFile, File destinationFile, log){

	if(sourceFile.exists())
	{
	def reader = sourceFile.newReader();
	destinationFile.withWriter 
	{ writer ->       
writer &lt;&lt; reader;   
}   
reader.close();
} 
else {
log.info("unable to find source file " + sourceFile);
}   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
if(file.exists()) {    
log.info("deleting file " + file);
file.delete(); 
} else {
log.info("file not found, skipping delete for " + file);
}
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
</con:testCase>
<con:testCase failOnError="true" failTestCaseOnErrors="true" id="70151a65-365f-46fa-a1f8-f2d08e3fd5e3" keepSession="false" maxResults="0" name="Target with no DQ Service and No Correlations" searchProperties="true">
			<con:settings/>

			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
						def testCase = testRunner.getTestCase()
						def testSuite = testCase.getTestSuite()
						def project = testSuite.getProject()
						def projectPropFullFile = project.getPath()
						def projectPropPath = groovyUtils.projectPath

						def sourceDir = projectPropPath;
						def sourceFile = "UDDIcopy-uddiConnectionInfo.xml";
						//def destDir = context.findProperty( "NHINGatewayConfigDir" );
						def destDir = System.env['NHINC_PROPERTIES_DIR'];
						def destFile = "uddiConnectionInfo.xml";

						log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

						FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
						def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

						void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

						log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
						File file = new File(directory,filename);
						Properties properties = new Properties();
						FileInputStream frPropFile = new FileInputStream(file);
						properties.load(frPropFile);
						properties.setProperty(propertyKey, propertyValue);
						FileOutputStream fwPropFile = new FileOutputStream(file);
						properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
					properties = null;
					}

					UpdateProperty(destConfigFileLocation,"gateway.properties","documentQueryQuerySelf","false",context,log);</script>
			</con:config>
		</con:testStep>
		<con:testStep name="Generate patient ID for Doc Query" type="groovy">
			<con:settings/>
			<con:config>
				<script>def localAA = context.findProperty('LocalAA')
					def dqPatientID = context.findProperty('DQPatientID')

					context.testCase.setPropertyValue('FullPatientID', "'${dqPatientID}^^^&amp;amp;${localAA}&amp;amp;ISO'");</script>
			</con:config>
		</con:testStep>
		<con:testStep name="Clear Correlation Table" type="groovy">
			<con:settings/>
			<con:config>
				<script>context.withSql('PatientCorrelationDB') { sql -> 
				def table = context.findProperty('PatientCorrelationTable')

				sql.execute('delete from ' + table)
				}</script>
		</con:config>
	</con:testStep>
	
<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def hcid1 = context.findProperty("UDDIhcid1")
		def hcid2 = context.findProperty("UDDIhcid2")
		def hcid3 = context.findProperty("UDDIhcid3")
		def hcid4 = context.findProperty("UDDIhcid4")
		def testhcid = context.findProperty("testHCID")
		def aa1 = context.findProperty("UDDIaa1")
		def aa2 = context.findProperty("UDDIaa2")
		def aa3 = context.findProperty("UDDIaa3")
		def aa4 = context.findProperty("UDDIaa4")
		def testaa = context.findProperty("testAA")

		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		//sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		sql.executeUpdate(insertSql, [aa1, hcid1])
		//sql.executeUpdate(insertSql, [aa2, hcid2])
		sql.executeUpdate(insertSql, [aa3, hcid3])
		sql.executeUpdate(insertSql, [aa4, hcid4])
		//sql.executeUpdate(insertSql, [testaa, testhcid])

		}</script>
</con:config>
</con:testStep>

<con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	<con:endpoint>${#Project#Endpoint-DocQuery}</con:endpoint>
	<con:request><![CDATA[
		<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body projectName="DocQueryTestsForUDDI" testCase="HCID Happy Path - Correlation for HCID not in UDDI file/target XML">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="RegistryObject" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:2.16.840.1.113883.3.200" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>${#TestCase#FullPatientID}</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:dateOfSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</urn3:dateOfSignature>
            <urn3:expirationDate xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expireDate}</urn3:expirationDate>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:purposeOfDisclosure xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</urn3:purposeOfDisclosure>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerb</urn3:userName>
               <urn3:role>Pharmacy</urn3:role>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:claimFormRef>Ref-Clm-123</urn3:claimFormRef>
            <urn3:claimFormRaw>YWVvbGlhbQ==</urn3:claimFormRaw>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#UDDIhc1description}</urn3:description>
                  <urn3:homeCommunityId>${#Project#UDDIhcid1}</urn3:homeCommunityId>
                  <urn3:name>${#Project#UDDIhc1description}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	
	<con:assertion type="SOAP Fault Assertion"/>
	
	
	
	
	<con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns12"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0";
	

				def assertErrorNum = 1
				def numErrors = holder["count(//ns1:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError)"];
				log.info("Number of Errors: " + numErrors);
				assert (numErrors.toInteger() == assertErrorNum.toInteger())</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns12"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0";
	

				def assertError = "No patient correlations found."
				def error = holder["//ns1:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError/@codeContext"];
				log.info("Error: " + error);
				assert (assertError.equals(error));</scriptText></con:configuration></con:assertion><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep>

<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

	File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
	File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

	File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
	File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

	void MoveFile(File sourceFile, File destinationFile, log){

	if(sourceFile.exists())
	{
	def reader = sourceFile.newReader();
	destinationFile.withWriter 
	{ writer ->       
writer &lt;&lt; reader;   
}   
reader.close();
} 
else {
log.info("unable to find source file " + sourceFile);
}   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2012-08-23T20:26:17Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2012-08-23T20:36:17Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>08/23/2012 20:26:17</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2012-09-22T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
</con:properties>
<con:reportParameters/>
<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

	def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

	File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
	File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

	File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
	File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

	void MoveFile(File sourceFile, File destinationFile, log){

	if(sourceFile.exists())
	{
	def reader = sourceFile.newReader();
	destinationFile.withWriter 
	{ writer ->       
writer &lt;&lt; reader;   
}   
reader.close();
} 
else {
log.info("unable to find source file " + sourceFile);
}   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
if(file.exists()) {    
log.info("deleting file " + file);
file.delete(); 
} else {
log.info("file not found, skipping delete for " + file);
}
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
</con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" id="048c641d-b668-4521-b0a1-e518d4ed86e6" keepSession="false" maxResults="0" name="Target with no DQ Service with 1 Matching Correlation" searchProperties="true">
			<con:settings/>

			<con:testStep name="Copy uddiConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
						def testCase = testRunner.getTestCase()
						def testSuite = testCase.getTestSuite()
						def project = testSuite.getProject()
						def projectPropFullFile = project.getPath()
						def projectPropPath = groovyUtils.projectPath

						def sourceDir = projectPropPath;
						def sourceFile = "UDDIcopy-uddiConnectionInfo.xml";
						//def destDir = context.findProperty( "NHINGatewayConfigDir" );
						def destDir = System.env['NHINC_PROPERTIES_DIR'];
						def destFile = "uddiConnectionInfo.xml";

						log.info(sourceDir +'; ' + sourceFile  +'; ' + destDir +'; ' + destFile );

						FileUtils.MoveFile(sourceDir, sourceFile, destDir, destFile, context, log);</script></con:config>
			</con:testStep>
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config>
					<script>//def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
						def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

						void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

						log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
						File file = new File(directory,filename);
						Properties properties = new Properties();
						FileInputStream frPropFile = new FileInputStream(file);
						properties.load(frPropFile);
						properties.setProperty(propertyKey, propertyValue);
						FileOutputStream fwPropFile = new FileOutputStream(file);
						properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
					properties = null;
					}

					UpdateProperty(destConfigFileLocation,"gateway.properties","documentQueryQuerySelf","false",context,log);</script>
			</con:config>
		</con:testStep>
		<con:testStep name="Generate patient ID for Doc Query" type="groovy">
			<con:settings/>
			<con:config>
				<script>def localAA = context.findProperty('LocalAA')
					def dqPatientID = context.findProperty('DQPatientID')

					context.testCase.setPropertyValue('FullPatientID', "'${dqPatientID}^^^&amp;amp;${localAA}&amp;amp;ISO'");</script>
			</con:config>
		</con:testStep>
		<con:testStep name="Clear Correlation Table" type="groovy">
			<con:settings/>
			<con:config>
				<script>context.withSql('PatientCorrelationDB') { sql -> 
				def table = context.findProperty('PatientCorrelationTable')

				sql.execute('delete from ' + table)
				}</script>
		</con:config>
	</con:testStep>
	<con:testStep name="Add Correlation for HCID not in the UDDI" type="groovy">
		<con:settings/>
		<con:config><script>context.withSql('PatientCorrelationDB') { sql -> 
			def table = context.findProperty('PatientCorrelationTable')

			def localAA = context.findProperty( "LocalAA" )	
			def localPatientID = context.findProperty("LocalPatientID")
			def remoteAA1 = context.findProperty( "UDDIhcid1" )
			def remotePatientID = context.findProperty("RemotePatientID")
			def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
			"values (?, ?, ?, ?, ?)"
			sql.executeUpdate(insertSql, [1, localAA, localPatientID, remoteAA1, remotePatientID])

			}</script></con:config>
</con:testStep>
<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
	<con:settings/>
	<con:config>
		<script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def hcid1 = context.findProperty("UDDIhcid1")
		def hcid2 = context.findProperty("UDDIhcid2")
		def hcid3 = context.findProperty("UDDIhcid3")
		def hcid4 = context.findProperty("UDDIhcid4")
		def testhcid = context.findProperty("testHCID")
		def aa1 = context.findProperty("UDDIaa1")
		def aa2 = context.findProperty("UDDIaa2")
		def aa3 = context.findProperty("UDDIaa3")
		def aa4 = context.findProperty("UDDIaa4")
		def testaa = context.findProperty("testAA")

		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		//sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		sql.executeUpdate(insertSql, [aa1, hcid1])
		//sql.executeUpdate(insertSql, [aa2, hcid2])
		sql.executeUpdate(insertSql, [aa3, hcid3])
		sql.executeUpdate(insertSql, [aa4, hcid4])
		//sql.executeUpdate(insertSql, [testaa, testhcid])

		}</script>
</con:config>
</con:testStep>
<con:testStep name="Add Service in UDDI for HCIDs" type="groovy">
	<con:settings/>
	<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

			def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];
			def NHINGatewayHost = context.findProperty("NHINGatewayHost");
			def mockHost = context.findProperty("mockHost");
			def dQURL = "https://localhost:8181/Gateway/DocumentQuery/2_0/NhinService/RespondingGateway_Query_Service/DocQuery";
			def remoteHCID2 = context.findProperty( "UDDIhcid3" );
			def remoteHCID3 = context.findProperty( "UDDIhcid4" );

			FileUtils.CreateOrUpdateConnection("uddiConnectionInfo.xml", destConfigFileLocation, remoteHCID2, "QueryForDocuments", dQURL, "2.0", context, log)
			FileUtils.CreateOrUpdateConnection("uddiConnectionInfo.xml", destConfigFileLocation, remoteHCID3, "QueryForDocuments", dQURL, "2.0", context, log)</script></con:config>
</con:testStep>
<con:testStep name="Document Query" type="request">
	<con:settings/>
	<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:interface>EntityDocQueryBindingSoap</con:interface>
		<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
		<con:request name="Document Query">
			<con:settings>
				<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
	</con:settings>
	<con:encoding>UTF-8</con:encoding>
	<con:endpoint>${#Project#Endpoint-DocQuery}</con:endpoint>
	<con:request><![CDATA[
		<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body projectName="DocQueryTestsForUDDI" testCase="HCID Happy Path - Correlation for HCID not in UDDI file/target XML">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="RegistryObject" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:2.16.840.1.113883.3.200" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>${#TestCase#FullPatientID}</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:dateOfSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</urn3:dateOfSignature>
            <urn3:expirationDate xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expireDate}</urn3:expirationDate>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:purposeOfDisclosure xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</urn3:purposeOfDisclosure>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerb</urn3:userName>
               <urn3:role>Pharmacy</urn3:role>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:claimFormRef>Ref-Clm-123</urn3:claimFormRef>
            <urn3:claimFormRaw>YWVvbGlhbQ==</urn3:claimFormRaw>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>158.147.185.168</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>cs.myharris.net</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#UDDIhc1description}</urn3:description>
                  <urn3:homeCommunityId>${#Project#UDDIhcid1}</urn3:homeCommunityId>
                  <urn3:name>${#Project#UDDIhc1description}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
	<con:assertion type="SOAP Response"/>
	
	<con:assertion type="SOAP Fault Assertion"/>
	
	
	
	
	<con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns12"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0";
	

				def assertErrorNum = 1
				def numErrors = holder["count(//ns1:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError)"];
				log.info("Number of Errors: " + numErrors);
				assert (numErrors.toInteger() == assertErrorNum.toInteger())</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns12"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0";
	

				def assertError = "No URLs found for targeted DocQueryRequest for homecommunity:4.4"
				def error = holder["//ns1:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError/@codeContext"];
				log.info("Error: " + error);
				assert (assertError.equals(error));</scriptText></con:configuration></con:assertion><con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
	<con:jmsPropertyConfig/>
	<con:wsaConfig mustUnderstand="NONE" version="200508"/>
	<con:wsrmConfig version="1.2"/>
</con:request>
</con:config>
</con:testStep>

<con:setupScript>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

	File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
	File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

	File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
	File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

	void MoveFile(File sourceFile, File destinationFile, log){

	if(sourceFile.exists())
	{
	def reader = sourceFile.newReader();
	destinationFile.withWriter 
	{ writer ->       
writer &lt;&lt; reader;   
}   
reader.close();
} 
else {
log.info("unable to find source file " + sourceFile);
}   
}

MoveFile(sourceInternalFile, backupInternalFile, log);
MoveFile(sourceUddiFile, backupUddiFile, log);</con:setupScript>
<con:properties>
	<con:property>
		<con:name>startDate</con:name>
		<con:value>2012-08-23T20:27:01Z</con:value>
	</con:property>
	<con:property>
		<con:name>endDate</con:name>
		<con:value>2012-08-23T20:37:01Z</con:value>
	</con:property>
	<con:property>
		<con:name>sigDate</con:name>
		<con:value>08/23/2012 20:27:01</con:value>
	</con:property>
	<con:property>
		<con:name>expireDate</con:name>
		<con:value>2012-09-22T00:00:00Z</con:value>
	</con:property>
	<con:property>
		<con:name>FullPatientID</con:name>
		<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
	</con:property>
</con:properties>
<con:reportParameters/>
<con:tearDownScript>import nhinc.FileUtils;
FileUtils.restoreToMasterConfiguration(context, log);

	def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

	File sourceInternalFile = new File(destConfigFileLocation, "internalConnectionInfo.xml");
	File backupInternalFile = new File(destConfigFileLocation, "internalConnectionInfo_BACKUP.xml");

	File sourceUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo.xml");
	File backupUddiFile = new File(destConfigFileLocation, "uddiConnectionInfo_BACKUP.xml");

	void MoveFile(File sourceFile, File destinationFile, log){

	if(sourceFile.exists())
	{
	def reader = sourceFile.newReader();
	destinationFile.withWriter 
	{ writer ->       
writer &lt;&lt; reader;   
}   
reader.close();
} 
else {
log.info("unable to find source file " + sourceFile);
}   
}

MoveFile(backupInternalFile, sourceInternalFile, log);
MoveFile(backupUddiFile, sourceUddiFile, log);

void DeleteFile(File file, log) {  
if(file.exists()) {    
log.info("deleting file " + file);
file.delete(); 
} else {
log.info("file not found, skipping delete for " + file);
}
}

DeleteFile(backupInternalFile, log);
DeleteFile(backupUddiFile, log);</con:tearDownScript>
</con:testCase><con:properties/>
</con:testSuite>
<con:properties>
	<con:property>
		<con:name>LocalHCID</con:name>
		<con:value>1.1</con:value>
	</con:property>
	<con:property>
		<con:name>LocalAA</con:name>
		<con:value>1.1</con:value>
	</con:property>
	<con:property>
		<con:name>LocalHCDescription</con:name>
		<con:value>InternalTest1</con:value>
	</con:property>
	<con:property>
		<con:name>LocalPatientID</con:name>
		<con:value>D123401</con:value>
	</con:property>
	<con:property>
		<con:name>RemoteHCID</con:name>
		<con:value>2.2</con:value>
	</con:property>
	<con:property>
		<con:name>RemoteAA</con:name>
		<con:value>2.2</con:value>
	</con:property>
	<con:property>
		<con:name>RemoteHCDescription</con:name>
		<con:value>InternalTest2</con:value>
	</con:property>
	<con:property>
		<con:name>RemotePatientID</con:name>
		<con:value>D123401</con:value>
	</con:property>
	<con:property>
		<con:name>Endpoint-DocQuery</con:name>
		<con:value>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:value>
	</con:property>
	<con:property>
		<con:name>DBHost</con:name>
		<con:value>localhost</con:value>
	</con:property>
	<con:property>
		<con:name>DBPort</con:name>
		<con:value>3306</con:value>
	</con:property>
	<con:property>
		<con:name>DBUser</con:name>
		<con:value>nhincuser</con:value>
	</con:property>
	<con:property>
		<con:name>DBPass</con:name>
		<con:value>nhincpass</con:value>
	</con:property>
	<con:property>
		<con:name>AAMappingDB</con:name>
		<con:value>assigningauthoritydb</con:value>
	</con:property>
	<con:property>
		<con:name>AAMappingTable</con:name>
		<con:value>aa_to_home_community_mapping</con:value>
	</con:property>
	<con:property>
		<con:name>PatientCorrelationDB</con:name>
		<con:value>patientcorrelationdb</con:value>
	</con:property>
	<con:property>
		<con:name>PatientCorrelationTable</con:name>
		<con:value>correlatedidentifiers</con:value>
	</con:property>
	<con:property>
		<con:name>NHINGatewayHost</con:name>
		<con:value>localhost</con:value>
	</con:property>
	<con:property>
		<con:name>MockHost</con:name>
		<con:value>localhost</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIhcid1</con:name>
		<con:value>4.4</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIhc1description</con:name>
		<con:value>UDDI Test1</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIhcid2</con:name>
		<con:value>5.5</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIhc2description</con:name>
		<con:value>UDDI Test2</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIhcid3</con:name>
		<con:value>6.6</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIdc3description</con:name>
		<con:value>UDDI Test3</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIhcid4</con:name>
		<con:value>7.7</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIhc4description</con:name>
		<con:value>UDDI Test4</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIaa4</con:name>
		<con:value>7.7</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIaa3</con:name>
		<con:value>6.6</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIaa2</con:name>
		<con:value>5.5</con:value>
	</con:property>
	<con:property>
		<con:name>UDDIaa1</con:name>
		<con:value>4.4</con:value>
	</con:property>
	<con:property>
		<con:name>testHCID</con:name>
		<con:value>8.8</con:value>
	</con:property>
	<con:property>
		<con:name>testHCDescription</con:name>
		<con:value>Test HCID</con:value>
	</con:property>
	<con:property>
		<con:name>testAA</con:name>
		<con:value>8.8</con:value>
	</con:property>
	<con:property>
		<con:name>Region1</con:name>
		<con:value>US-VA</con:value>
	</con:property>
	<con:property>
		<con:name>Region2</con:name>
		<con:value>US-FL</con:value>
	</con:property>
	<con:property>
		<con:name>Region3</con:name>
		<con:value>US-GA</con:value>
	</con:property>
	<con:property>
		<con:name>Region4</con:name>
		<con:value>US-MA</con:value>
	</con:property>
	<con:property>
		<con:name>DQDocID</con:name>
		<con:value>1.123401.11111</con:value>
	</con:property>
	<con:property>
		<con:name>DQPatientID</con:name>
		<con:value>D123401</con:value>
	</con:property>
</con:properties>
<con:afterLoadScript>def propertiesFile = new File(new File(project.path).parent, 'DocQueryTestsForUDDI-soapui-project.properties')
	if (propertiesFile.exists()) {
	def props = new Properties()
	props.load(new FileReader(propertiesFile))
	props.each { key, value ->
project.setPropertyValue(key, value)
}
}


TimeZone.setDefault(TimeZone.getTimeZone("UTC"))
def testRunListener = [
afterRun: { testRunner, runContext -> },
afterStep: { testRunner, runContext, result -> },
beforeStep: { testRunner, runContext -> },
beforeStep: { testRunner, runContext, testStep -> },
beforeRun: { testRunner, runContext -> 
use (org.codehaus.groovy.runtime.TimeCategory) {
def startDate = 5.minutes.ago
def endDate = 5.minutes.from.now
def expireDate = 30.days.from.now

def df = "yyyy-MM-dd'T'HH:mm:ss'Z'"
def dfSig = "MM/dd/yyyy' 'HH:mm:ss"

runContext.testCase.setPropertyValue("startDate", startDate.format(df))
runContext.testCase.setPropertyValue("endDate", endDate.format(df))
runContext.testCase.setPropertyValue("sigDate", startDate.format(dfSig))
runContext.testCase.setPropertyValue("expireDate", expireDate.format(df))
}
}   
] as com.eviware.soapui.model.testsuite.TestRunListener

project.testSuiteList*.testCaseList.flatten()*.addTestRunListener(testRunListener)



com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.findProperty = { propertyName ->
return delegate.getProperty(propertyName) ?:
delegate.testCase.getPropertyValue(propertyName) ?:
delegate.testCase.testSuite.getPropertyValue(propertyName) ?:
delegate.testCase.testSuite.project.getPropertyValue(propertyName)
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.withSql = { dbOrPropertyName, block ->
def dbName = delegate.findProperty(dbOrPropertyName) ?: dbOrPropertyName
def host = delegate.findProperty('DBHost')
def port = delegate.findProperty('DBPort')
def user = delegate.findProperty('DBUser')
def pass = delegate.findProperty('DBPass')

def connectString = "jdbc:mysql://${host}:${port}/${dbName}"
def sql = groovy.sql.Sql.newInstance(connectString, user, pass, "com.mysql.jdbc.Driver");
try {
block(sql)
} finally {
sql.close()
}
}</con:afterLoadScript>
<con:wssContainer/>
</con:soapui-project>