<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project abortOnError="false" name="EntityPolicyEngineTest" resourceRoot="${projectDir}" runType="SEQUENTIAL" soapui-version="4.5.1" activeEnvironment="Default" xmlns:con="http://eviware.com/soapui/config">
	<con:settings/>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitydocquery}EntityDocQueryBindingSoap" definition="../../target/wsdl/EntityDocQuery.wsdl" name="EntityDocQueryBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntityDocQuery</con:endpoint>
			<con:endpoint>http://ATHC-GFAS:9080/NhinConnect/EntityDocQuery</con:endpoint>
			<con:endpoint>http://172.16.50.54:9080/NhinConnect/EntityDocQuery</con:endpoint>
			<con:endpoint>http://172.16.50.82:9080/NhinConnect/EntityDocQuery</con:endpoint>
			<con:endpoint>http://DVANHIE3.fedsconnect.org:9080/NhinConnect/EntityDocQuery</con:endpoint>
		<con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint></con:endpoints>
		<con:operation action="urn:gov:hhs:fha:nhinc:entitydocquery:RespondingGateway_CrossGatewayQueryRequest" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayQuery" inputName="RespondingGateway_CrossGatewayQueryRequest" isOneWay="false" name="RespondingGateway_CrossGatewayQuery" outputName="RespondingGateway_CrossGatewayQueryResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitydocretrieve}EntityDocRetrieveBindingSoap" definition="../../target/wsdl/EntityDocRetrieve.wsdl" name="EntityDocRetrieveBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			
			
		<con:endpoint>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:endpoint><con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/DocumentRetrieve/2_0/EntityService/EntityDocRetrieve</con:endpoint></con:endpoints>
		<con:operation action="urn:gov:hhs:fha:nhinc:entitydocretrieve:RespondingGateway_CrossGatewayRetrieveRequestMessage" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayRetrieve" inputName="RespondingGateway_CrossGatewayRetrieveRequest" isOneWay="false" name="RespondingGateway_CrossGatewayRetrieve" outputName="RespondingGateway_CrossGatewayRetrieveResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement}EntitySubscriptionManagerBindingSoap" definition="../../target/wsdl/EntitySubscriptionManagement.wsdl" name="EntitySubscriptionManagerBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://dvanhie3.fedsconnect.org:9080/NhinConnect/EntitySubscriptionManager</con:endpoint>
			<con:endpoint>http://MHSNHIE3.fedsconnect.org:9080/NhinConnect/EntitySubscriptionManager</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntitySubscriptionManager</con:endpoint>
			<con:endpoint>http://192.168.25.157:8080/EntitySubscriptionManager/EntityUnsubscribeService</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntityNotificationProducer</con:endpoint>
		<con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/HIEM/2_0/EntitySubscriptionManager</con:endpoint></con:endpoints>
		<con:operation action="urn:Unsubscribe" anonymous="optional" bindingOperationName="Unsubscribe" inputName="UnsubscribeRequest" isOneWay="false" name="Unsubscribe" outputName="UnsubscribeResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement}EntityNotificationProducerBindingSoap" definition="../../target/wsdl/EntitySubscriptionManagement.wsdl" name="EntityNotificationProducerBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://DVANHIE3.fedsconnect.org:9080/NhinConnect/EntityNotificationProducer</con:endpoint>
			<con:endpoint>http://MHSNHIE3.fedsconnect.org:9080/NhinConnect/EntityNotificationProducer</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntityNotificationProducer</con:endpoint>
		<con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/HIEM/2_0/EntityNotificationProducer</con:endpoint></con:endpoints>
		<con:operation action="urn:SubscribeCdcBioPackage" anonymous="optional" bindingOperationName="SubscribeCdcBioPackage" inputName="SubscribeCdcBioPackageRequest" isOneWay="false" name="SubscribeCdcBioPackage" outputName="SubscribeCdcBioPackageResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
		<con:operation action="urn:SubscribeDocument" anonymous="optional" bindingOperationName="SubscribeDocument" inputName="SubscribeDocumentRequest" isOneWay="false" name="SubscribeDocument" outputName="SubscribeDocumentResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
		<con:operation action="urn:Subscribe" anonymous="optional" bindingOperationName="Subscribe" inputName="SubscribeRequest" isOneWay="false" name="Subscribe" outputName="SubscribeResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitynotificationconsumer}EntityNotificationConsumerBindingSoap" definition="../../target/wsdl/EntityNotificationConsumer.wsdl" name="EntityNotificationConsumerBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://DVANHIE3.fedsconnect.org:9080/NhinConnect/EntityNotificationConsumer</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntityNotificationConsumer</con:endpoint>
		<con:endpoint>http://localhost:${HttpDefaultPort}/Gateway/HIEM/2_0/EntityNotificationConsumer</con:endpoint></con:endpoints>
		<con:operation action="urn:NotifySubscribersOfCdcBioPackage" anonymous="optional" bindingOperationName="NotifySubscribersOfCdcBioPackage" inputName="NotifySubscribersOfCdcBioPackageRequest" isOneWay="false" name="NotifySubscribersOfCdcBioPackage" outputName="NotifySubscribersOfCdcBioPackageResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
		<con:operation action="urn:NotifySubscribersOfDocument" anonymous="optional" bindingOperationName="NotifySubscribersOfDocument" inputName="NotifySubscribersOfDocumentRequest" isOneWay="false" name="NotifySubscribersOfDocument" outputName="NotifySubscribersOfDocumentResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
		<con:operation action="urn:Notify" anonymous="optional" bindingOperationName="Notify" inputName="NotifyRequest" isOneWay="false" name="Notify" outputName="NotifyResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:adapterpolicyengine}AdapterPolicyEngineBindingSoap" definition="../../target/wsdl/AdapterPolicyEngine.wsdl" name="AdapterPolicyEngineBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<con:settings/>
		
		<con:endpoints>
			<con:endpoint>http://172.16.50.47:8080/CONNECTAdapter/AdapterProxyService/AdapterPolicyEngine</con:endpoint>
			<con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/AdapterPolicyEngine</con:endpoint>
		<con:endpoint>http://localhost:${HttpDefaultPort}/CONNECTAdapter/AdapterProxyService/AdapterPolicyEngine</con:endpoint></con:endpoints>
		<con:operation action="urn:CheckPolicy" anonymous="optional" bindingOperationName="CheckPolicy" inputName="CheckPolicyRequest" isOneWay="false" name="CheckPolicy" outputName="CheckPolicyResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response">
			<con:settings/>
		</con:operation>
	</con:interface>
	<con:testSuite name="EntityPolicyEngineTest TestSuite">
		<con:settings/>
		<con:runType>SEQUENTIAL</con:runType>
		
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="a9707ab4-3b2c-484c-a302-24ab8377c2a4" keepSession="false" maxResults="0" name="Document Query" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="ModifyInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def destConfigFileLocation = context.findProperty("GatewayPropDir");
def NHINGatewayHost = context.findProperty("NHINGatewayHost");
def mockHost = context.findProperty("MockHost");
def mockPEURL = "http://" + mockHost + ":18088/mockPolicyEngine";
def InitiatingHCID = context.findProperty( "LocalHCID" );

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", destConfigFileLocation, InitiatingHCID, "policyengineservice", mockPEURL, "LEVEL_a0", log)</script></con:config>
			</con:testStep>
			<con:testStep name="Generate patient ID for Doc Query" type="groovy">
				<con:settings/>
				<con:config>
					<script>def localAA = context.findProperty('LocalAA')
def dqPatientID = context.findProperty('DQPatientID')

context.testCase.setPropertyValue('FullPatientID', "'${dqPatientID}^^^&amp;amp;${localAA}&amp;amp;ISO'");</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('PatientCorrelationDB') { sql -> 
  def table = context.findProperty('PatientCorrelationTable')

  sql.execute('delete from ' + table)

  def localAA = context.findProperty( "LocalAA" )
  def localPatientID = context.findProperty("LocalPatientID")
  def remoteAA = context.findProperty( "RemoteAA" )
  def remotePatientID = context.findProperty("RemotePatientID")
  def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
                   "values (1, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
}



					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('AAMappingDB') { sql -> 
  def table = context.findProperty('AAMappingTable')

  sql.execute('delete from ' + table)

  def remoteAA = context.findProperty( "RemoteAA" )
  def remoteHCID = context.findProperty("RemoteHCID")
  def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
                   "values (1, ?, ?)"
  sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
}



					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Document Query" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>EntityDocQueryBindingSoap</con:interface>
					<con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
					<con:request name="Document Query">
						<con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-DocQuery}</con:endpoint>
						<con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body projectName="EntityPolicyEngineTest" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="RegistryObject" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:2.16.840.1.113883.3.200" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>${#TestCase#FullPatientID}</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:address>
               <urn3:addressType>
                  <urn3:code>W</urn3:code>
                  <urn3:codeSystem>30</urn3:codeSystem>
                  <urn3:codeSystemName>address</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>White</urn3:displayName>
                  <urn3:originalText>W</urn3:originalText>
               </urn3:addressType>
               <urn3:city>BUFFALO</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>NY</urn3:state>
               <urn3:streetAddress>12345 EAST COAST WAY</urn3:streetAddress>
               <urn3:zipCode>01010</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth>19800516</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature>NEEDED</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature>true</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature>true</urn3:haveSignature>
            <urn3:haveWitnessSignature>true</urn3:haveWitnessSignature>
            <urn3:homeCommunity>
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName>
               <urn3:familyName>JONES</urn3:familyName>
               <urn3:givenName>FRED</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>G</urn3:code>
                  <urn3:codeSystem>30</urn3:codeSystem>
                  <urn3:codeSystemName>nameType</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>G</urn3:displayName>
                  <urn3:originalText>G</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>ANDREW</urn3:secondNameOrInitials>
            </urn3:personName>
            <urn3:phoneNumber>
               <urn3:areaCode>703</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>1212</urn3:extension>
               <urn3:localNumber>555</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>W</urn3:code>
                  <urn3:codeSystem>50</urn3:codeSystem>
                  <urn3:codeSystemName>phoneNumberType</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Work</urn3:displayName>
                  <urn3:originalText>W</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress>
               <urn3:addressType>
                  <urn3:code>W</urn3:code>
                  <urn3:codeSystem>30</urn3:codeSystem>
                  <urn3:codeSystemName>address</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>White</urn3:displayName>
                  <urn3:originalText>W</urn3:originalText>
               </urn3:addressType>
               <urn3:city>ALBANY</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>NY</urn3:state>
               <urn3:streetAddress>4 TROY STREET</urn3:streetAddress>
               <urn3:zipCode>01033</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName>
               <urn3:familyName>JONES</urn3:familyName>
               <urn3:givenName>JAMES</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>G</urn3:code>
                  <urn3:codeSystem>30</urn3:codeSystem>
                  <urn3:codeSystemName>nameType</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>G</urn3:displayName>
                  <urn3:originalText>G</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>KENNETH</urn3:secondNameOrInitials>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone>
               <urn3:areaCode>301</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>555</urn3:extension>
               <urn3:localNumber>0001</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>W</urn3:code>
                  <urn3:codeSystem>30</urn3:codeSystem>
                  <urn3:codeSystemName>phoneNumberType</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Work</urn3:displayName>
                  <urn3:originalText>W</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN>123456789</urn3:SSN>
            <urn3:uniquePatientId>D123402</urn3:uniquePatientId>
            <urn3:witnessAddress>
               <urn3:addressType>
                  <urn3:code>H</urn3:code>
                  <urn3:codeSystem>30</urn3:codeSystem>
                  <urn3:codeSystemName>address</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Home</urn3:displayName>
                  <urn3:originalText>H</urn3:originalText>
               </urn3:addressType>
               <urn3:city>HARTFORD</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>CT</urn3:state>
               <urn3:streetAddress>10410 MAIN ST.</urn3:streetAddress>
               <urn3:zipCode>05032</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName>
               <urn3:familyName>COREY</urn3:familyName>
               <urn3:givenName>AMANDA</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>H</urn3:code>
                  <urn3:codeSystem>30</urn3:codeSystem>
                  <urn3:codeSystemName>nameType</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>H</urn3:displayName>
                  <urn3:originalText>H</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>EVE</urn3:secondNameOrInitials>
            </urn3:witnessName>
            <urn3:witnessPhone>
               <urn3:areaCode>202</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>555</urn3:extension>
               <urn3:localNumber>1010</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>H</urn3:code>
                  <urn3:codeSystem>30</urn3:codeSystem>
                  <urn3:codeSystemName>nameType</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>H</urn3:displayName>
                  <urn3:originalText>H</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo>
               <urn3:personName>
                  <urn3:familyName>FRANKLIN</urn3:familyName>
                  <urn3:givenName>MARK</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>P</urn3:code>
                     <urn3:codeSystem>30</urn3:codeSystem>
                     <urn3:codeSystemName>nameType</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>P</urn3:displayName>
                     <urn3:originalText>P</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>ALAN</urn3:secondNameOrInitials>
               </urn3:personName>
               <urn3:userName>mfranklin</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized>true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded>
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <!--urn3:claimFormRef>Ref-Clm-123</urn3:claimFormRef-->
            <!--urn3:claimFormRaw>YWVvbGlhbQ==</urn3:claimFormRaw-->
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						
						<con:assertion type="SOAP Fault Assertion"/>
						<con:assertion type="XPath Match"><con:configuration><path>declare namespace ns13='urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0';


//ns13:AdhocQueryResponse[1]/@status</path><content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Failure</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match"><con:configuration><path>declare namespace ns12='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
declare namespace ns13='urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0';

//ns13:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError[position()&lt;3]/@codeContext</path><content>Policy check failed.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match"><con:configuration><path>declare namespace ns12='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
declare namespace ns13='urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0';

//ns13:AdhocQueryResponse[1]/ns12:RegistryErrorList[1]/ns12:RegistryError[position()&lt;3]/@codeContext</path><content>Policy check failed.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Policy Engine Mock" type="mockresponse">
				<con:settings/>
				<con:config startStep="Document Query" xsi:type="con:MockResponseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>AdapterPolicyEngineBindingSoap</con:interface>
					<con:operation>CheckPolicy</con:operation>
					<con:path>/mockPolicyEngine</con:path>
					<con:port>18088</con:port>
					<con:timeout>60000</con:timeout>
					<con:response>
						<con:settings/>
						<con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:xacml:2.0:context:schema:os" xmlns:urn2="urn:oasis:names:tc:xacml:2.0:policy:schema:os">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:CheckPolicyResponse>
         <urn:response>
            <urn1:Result ResourceId="?">
               <urn1:Decision>Deny</urn1:Decision>
            </urn1:Result>
         </urn:response>
      </urn:CheckPolicyResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent>
						<con:wsaConfig mustUnderstand="NONE" version="200508"/>
					</con:response>
					<con:assertion type="XPath Match">
						<con:configuration>
							<path>declare namespace ns10='urn:oasis:names:tc:xacml:2.0:context:schema:os';
declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns18:CheckPolicyRequest[1]/ns18:request[1]/ns10:Action[1]/ns10:Attribute[1]/ns10:AttributeValue[1]</path>
							<content>DocumentQueryOut</content>
							<allowWildcards>false</allowWildcards>
							<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
						</con:configuration>
					</con:assertion>
				</con:config>
			</con:testStep>
			
			<con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2013-02-04T00:42:16Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2013-02-04T00:52:16Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>02/04/2013 00:42:16</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2013-03-06T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>FullPatientID</con:name>
					<con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="3a630f37-d9fc-4fd2-bc44-bc0b04246222" keepSession="false" maxResults="0" name="Document Retrieve" searchProperties="true">
			<con:settings/>
			
			<con:testStep name="ModifyInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def destConfigFileLocation = context.findProperty("GatewayPropDir");
def NHINGatewayHost = context.findProperty("NHINGatewayHost");
def mockHost = context.findProperty("MockHost");
def mockPEURL = "http://" + mockHost + ":18088/mockPolicyEngine1";
def InitiatingHCID = context.findProperty( "LocalHCID" );

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", destConfigFileLocation, InitiatingHCID, "policyengineservice", mockPEURL, "LEVEL_a0", log)</script></con:config>
			</con:testStep>
			<con:testStep name="Generate HCID for Doc Retrieve" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.testCase.setPropertyValue('correctedRemoteHCID', "urn:oid:${context.findProperty('RemoteHCID')}")</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Document Retrieve" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>EntityDocRetrieveBindingSoap</con:interface>
					<con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation>
					<con:request incomingWss="" name="Document Retrieve" outgoingWss="" wssPasswordType="">
						<con:settings>
							<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@expand-mtom-attachments">true</con:setting>
						<con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:endpoint>
						<con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:ihe:iti:xds-b:2007" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body projectName="EntityPolicyEngineTest" testCase="Document Retrieve">
      <urn:RespondingGateway_CrossGatewayRetrieveRequest>
         <urn1:RetrieveDocumentSetRequest>
            <urn1:DocumentRequest>
               <urn1:HomeCommunityId>${#TestCase#correctedRemoteHCID}</urn1:HomeCommunityId>
               <urn1:RepositoryUniqueId>${#Project#DRRepoID}</urn1:RepositoryUniqueId>
               <urn1:DocumentUniqueId>${#Project#DRDocID}</urn1:DocumentUniqueId>
            </urn1:DocumentRequest>
         </urn1:RetrieveDocumentSetRequest>
         <urn:assertion>
            <urn2:address>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>BUFFALO</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>12345 EAST COAST WAY</urn2:streetAddress>
               <urn2:zipCode>01010</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth>19800516</urn2:dateOfBirth>
            <urn2:explanationNonClaimantSignature>NEEDED</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature>true</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature>true</urn2:haveSignature>
            <urn2:haveWitnessSignature>true</urn2:haveWitnessSignature>
            <urn2:homeCommunity>
               <urn2:description>${#Project#LocalHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#LocalHCID}</urn2:homeCommunityId>
               <urn2:name>${#Project#LocalHCDescription}</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>FRED</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>ANDREW</urn2:secondNameOrInitials>
            </urn2:personName>
            <urn2:phoneNumber>
               <urn2:areaCode>703</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>1212</urn2:extension>
               <urn2:localNumber>555</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:secondWitnessAddress>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>ALBANY</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>4 TROY STREET</urn2:streetAddress>
               <urn2:zipCode>01033</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>JAMES</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>KENNETH</urn2:secondNameOrInitials>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone>
               <urn2:areaCode>301</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>0001</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN>123456789</urn2:SSN>
            <urn2:uniquePatientId>500000000</urn2:uniquePatientId>
            <urn2:witnessAddress>
               <urn2:addressType>
                  <urn2:code>H</urn2:code>
               </urn2:addressType>
               <urn2:city>HARTFORD</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>CT</urn2:state>
               <urn2:streetAddress>10410 MAIN ST.</urn2:streetAddress>
               <urn2:zipCode>05032</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName>
               <urn2:familyName>COREY</urn2:familyName>
               <urn2:givenName>AMANDA</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>H</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>EVE</urn2:secondNameOrInitials>
            </urn2:witnessName>
            <urn2:witnessPhone>
               <urn2:areaCode>202</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>1010</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>H</urn2:code>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo>
               <urn2:personName>
                  <urn2:familyName>FRANKLIN</urn2:familyName>
                  <urn2:givenName>MARK</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>P</urn2:code>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>ALAN</urn2:secondNameOrInitials>
               </urn2:personName>
               <urn2:userName>UID=mfranklin</urn2:userName>
               <urn2:org>
                  <urn2:description>${#Project#LocalHCDescription}</urn2:description>
                  <urn2:homeCommunityId>${#Project#LocalHCID}</urn2:homeCommunityId>
                  <urn2:name>${#Project#LocalHCDescription}</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>80584001</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Psychiatrist</urn2:displayName>
                  <urn2:originalText>Psychiatrist</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized>true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded>
               <urn2:code>PSYCHOTHERAPY</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <!--urn2:claimFormRef>Ref-Clm-123</urn2:claimFormRef-->
            <!--urn2:claimFormRaw>YWVvbGlhbQ==</urn2:claimFormRaw-->
         </urn:assertion>
         <!--urn:nhinTargetSystem>
            <urn2:homeCommunity>
               <urn2:description>${#Project#RemoteHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#RemoteHCID}</urn2:homeCommunityId>
               <urn2:name>${#Project#RemoteHCDescription}</urn2:name>
            </urn2:homeCommunity>
         </urn:nhinTargetSystem-->
      </urn:RespondingGateway_CrossGatewayRetrieveRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:assertion type="XPath Match"><con:configuration><path>declare namespace ns4='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';

//ns4:RegistryResponse[1]/@status</path><content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Failure</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match"><con:configuration><path>declare namespace ns4='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';

//ns4:RegistryResponse[1]/ns4:RegistryErrorList[1]/ns4:RegistryError[1]/@codeContext</path><content>RetrieveDocuments failed policy check.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitydocretrieve/EntityDocRetrievePortType/RespondingGateway_CrossGatewayRetrieveRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Policy Engine Mock" type="mockresponse">
				<con:settings/>
				<con:config startStep="Document Retrieve" xsi:type="con:MockResponseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>AdapterPolicyEngineBindingSoap</con:interface>
					<con:operation>CheckPolicy</con:operation>
					<con:path>/mockPolicyEngine</con:path>
					<con:port>18088</con:port>
					<con:timeout>60000</con:timeout>
					<con:response>
						<con:settings/>
						<con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:xacml:2.0:context:schema:os" xmlns:urn2="urn:oasis:names:tc:xacml:2.0:policy:schema:os">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:CheckPolicyResponse>
         <urn:response>
            <urn1:Result ResourceId="?">
               <urn1:Decision>Deny</urn1:Decision>
            </urn1:Result>
         </urn:response>
      </urn:CheckPolicyResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent>
						<con:wsaConfig mustUnderstand="NONE" version="200508"/>
					</con:response>
					<con:assertion type="XPath Match">
						<con:configuration>
							<path>declare namespace ns10='urn:oasis:names:tc:xacml:2.0:context:schema:os';
declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns18:CheckPolicyRequest[1]/ns18:request[1]/ns10:Action[1]/ns10:Attribute[1]/ns10:AttributeValue[1]</path>
							<content>DocumentRetrieveOut</content>
							<allowWildcards>false</allowWildcards>
							<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
						</con:configuration>
					</con:assertion>
				</con:config>
			</con:testStep>
			
			<con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2013-02-04T00:42:17Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2013-02-04T00:52:17Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>02/04/2013 00:42:17</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2013-03-06T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>correctedRemoteHCID</con:name>
					<con:value>urn:oid:2.2</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="f04a8efa-cd45-4c46-b877-2dda728935fc" keepSession="false" maxResults="0" name="Subscribe" searchProperties="true" disabled="true">
			<con:settings/>
			
			
			<con:testStep name="update config" type="groovy">
				<con:settings/>
				<con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

//def destConfigFileLocation = dataSource.getPropertyValue("NHINGatewayConfigDir");
def destConfigFileLocation = context.findProperty("GatewayPropDir");

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {

   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

nhinc.FileUtils.updateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",log);
nhinc.FileUtils.updateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",log);
nhinc.FileUtils.updateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",log);
					</script></con:config>
			</con:testStep>
			<con:testStep name="ModifyInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def destConfigFileLocation = context.findProperty("GatewayPropDir");
def NHINGatewayHost = context.findProperty("NHINGatewayHost");
def mockHost = context.findProperty("MockHost");
def mockPEURL = "http://" + mockHost + ":18088/mockPolicyEngine1";
def InitiatingHCID = context.findProperty( "LocalHCID" );

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", destConfigFileLocation, InitiatingHCID, "policyengineservice", mockPEURL, "LEVEL_a0", log)</script></con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config><script>context.withSql('SubscriptionDB') { sql -> 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}


					</script></con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="EntityPolicyEngineTest" testCase="Subscribe">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">SomeTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
            <nccommon:address>
               <nccommon:addressType>
                  <nccommon:code>W</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>address</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>White</nccommon:displayName>
                  <nccommon:originalText>W</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>BUFFALO</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>NY</nccommon:state>
               <nccommon:streetAddress>12345 EAST COAST WAY</nccommon:streetAddress>
               <nccommon:zipCode>01010</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth>19800516</nccommon:dateOfBirth>
            <nccommon:explanationNonClaimantSignature>NEEDED</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature>true</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature>true</nccommon:haveSignature>
            <nccommon:haveWitnessSignature>true</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity>
               <nccommon:description>Federal - VA</nccommon:description>
               <nccommon:homeCommunityId>2.16.840.1.113883.3.200</nccommon:homeCommunityId>
               <nccommon:name>Federal - VA</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName>
               <nccommon:familyName>JONES</nccommon:familyName>
               <nccommon:givenName>FRED</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>G</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>G</nccommon:displayName>
                  <nccommon:originalText>G</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>ANDREW</nccommon:secondNameOrInitials>
            </nccommon:personName>
            <nccommon:phoneNumber>
               <nccommon:areaCode>703</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>1212</nccommon:extension>
               <nccommon:localNumber>555</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>W</nccommon:code>
                  <nccommon:codeSystem>50</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneNumberType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Work</nccommon:displayName>
                  <nccommon:originalText>W</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:secondWitnessAddress>
               <nccommon:addressType>
                  <nccommon:code>W</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>address</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>White</nccommon:displayName>
                  <nccommon:originalText>W</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>ALBANY</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>NY</nccommon:state>
               <nccommon:streetAddress>4 TROY STREET</nccommon:streetAddress>
               <nccommon:zipCode>01033</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName>
               <nccommon:familyName>JONES</nccommon:familyName>
               <nccommon:givenName>JAMES</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>G</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>G</nccommon:displayName>
                  <nccommon:originalText>G</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>KENNETH</nccommon:secondNameOrInitials>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone>
               <nccommon:areaCode>301</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>555</nccommon:extension>
               <nccommon:localNumber>0001</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>W</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneNumberType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Work</nccommon:displayName>
                  <nccommon:originalText>W</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN>123456789</nccommon:SSN>
            <nccommon:uniquePatientId>D1234011</nccommon:uniquePatientId>
            <nccommon:witnessAddress>
               <nccommon:addressType>
                  <nccommon:code>H</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>address</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Home</nccommon:displayName>
                  <nccommon:originalText>H</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>HARTFORD</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>CT</nccommon:state>
               <nccommon:streetAddress>10410 MAIN ST.</nccommon:streetAddress>
               <nccommon:zipCode>05032</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName>
               <nccommon:familyName>COREY</nccommon:familyName>
               <nccommon:givenName>AMANDA</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>H</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>H</nccommon:displayName>
                  <nccommon:originalText>H</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>EVE</nccommon:secondNameOrInitials>
            </nccommon:witnessName>
            <nccommon:witnessPhone>
               <nccommon:areaCode>202</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>555</nccommon:extension>
               <nccommon:localNumber>1010</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>H</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>H</nccommon:displayName>
                  <nccommon:originalText>H</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo>
               <nccommon:personName>
                  <nccommon:familyName>FRANKLIN</nccommon:familyName>
                  <nccommon:givenName>MARK</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>P</nccommon:code>
                     <nccommon:codeSystem>30</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>P</nccommon:displayName>
                     <nccommon:originalText>P</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>ALAN</nccommon:secondNameOrInitials>
               </nccommon:personName>
               <nccommon:userName>mfranklin</nccommon:userName>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized>true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded>
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <!--nccommon:claimFormRef>Ref-Clm-123</nccommon:claimFormRef-->
            <!--nccommon:claimFormRaw>YWVvbGlhbQ==</nccommon:claimFormRaw-->
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			<con:testStep name="Policy Engine Mock" type="mockresponse">
				<con:settings/>
				<con:config startStep="Subscribe" xsi:type="con:MockResponseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>AdapterPolicyEngineBindingSoap</con:interface>
					<con:operation>CheckPolicy</con:operation>
					<con:path>/mockPolicyEngine</con:path>
					<con:port>18088</con:port>
					<con:timeout>60000</con:timeout>
					<con:response>
						<con:settings/>
						<con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:xacml:2.0:context:schema:os" xmlns:urn2="urn:oasis:names:tc:xacml:2.0:policy:schema:os">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:CheckPolicyResponse>
         <urn:response>
            <urn1:Result ResourceId="?">
               <urn1:Decision>Deny</urn1:Decision>
            </urn1:Result>
         </urn:response>
      </urn:CheckPolicyResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent>
						<con:wsaConfig mustUnderstand="NONE" version="200508"/>
					</con:response>
					<con:assertion type="XPath Match">
						<con:configuration>
							<path>declare namespace ns10='urn:oasis:names:tc:xacml:2.0:context:schema:os';
declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns18:CheckPolicyRequest[1]/ns18:request[1]/ns10:Action[1]/ns10:Attribute[1]/ns10:AttributeValue[1]</path>
							<content>HIEMSubscriptionRequestOut</content>
							<allowWildcards>false</allowWildcards>
							<ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
						</con:configuration>
					</con:assertion>
				</con:config>
			</con:testStep>
			
			<con:testStep name="Count Subscriptions (1)" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -> 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
					</script>
				</con:config>
			</con:testStep>
			
			<con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-12-13T02:26:16Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-12-13T02:36:16Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>12/13/2012 02:26:16</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2013-01-12T00:00:00Z</con:value>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);</con:tearDownScript>
		</con:testCase>
		<con:testCase failOnError="true" failTestCaseOnErrors="true" id="5497726f-c0ef-44f6-9646-2455ea2515cf" keepSession="false" maxResults="0" name="Notify" searchProperties="true" disabled="true">
			<con:settings/>
			
			<con:testStep name="ModifyInterrnalConnectionInfo" type="groovy">
				<con:settings/>
				<con:config><script>import nhinc.FileUtils;
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def destConfigFileLocation = context.findProperty("GatewayPropDir");
def NHINGatewayHost = context.findProperty("NHINGatewayHost");
def mockHost = context.findProperty("MockHost");
def mockPEURL = "http://" + mockHost + ":18088/mockPolicyEngine1";
def InitiatingHCID = context.findProperty( "LocalHCID" );

nhinc.FileUtils.createOrUpdateConnection("internalConnectionInfo.xml", destConfigFileLocation, InitiatingHCID, "policyengineservice", mockPEURL, "LEVEL_a0", log)</script></con:config>
			</con:testStep>
			<con:testStep name="Clear Subscription Table" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -> 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

					</script>
				</con:config>
			</con:testStep>
			<con:testStep name="Subscribe" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>EntityNotificationProducerBindingSoap</con:interface>
					<con:operation>Subscribe</con:operation>
					<con:request incomingWss="" name="Subscribe" outgoingWss="" wssPasswordType="">
						<con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Subscribe}</con:endpoint>
						<con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="EntityPolicyEngineTest" testCase="Notify">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">SomeTopic</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
            <nccommon:address>
               <nccommon:addressType>
                  <nccommon:code>W</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>address</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>White</nccommon:displayName>
                  <nccommon:originalText>W</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>BUFFALO</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>NY</nccommon:state>
               <nccommon:streetAddress>12345 EAST COAST WAY</nccommon:streetAddress>
               <nccommon:zipCode>01010</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth>19800516</nccommon:dateOfBirth>
            <nccommon:explanationNonClaimantSignature>NEEDED</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature>true</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature>true</nccommon:haveSignature>
            <nccommon:haveWitnessSignature>true</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity>
               <nccommon:description>Federal - VA</nccommon:description>
               <nccommon:homeCommunityId>2.16.840.1.113883.3.200</nccommon:homeCommunityId>
               <nccommon:name>Federal - VA</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName>
               <nccommon:familyName>JONES</nccommon:familyName>
               <nccommon:givenName>FRED</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>G</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>G</nccommon:displayName>
                  <nccommon:originalText>G</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>ANDREW</nccommon:secondNameOrInitials>
            </nccommon:personName>
            <nccommon:phoneNumber>
               <nccommon:areaCode>703</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>1212</nccommon:extension>
               <nccommon:localNumber>555</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>W</nccommon:code>
                  <nccommon:codeSystem>50</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneNumberType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Work</nccommon:displayName>
                  <nccommon:originalText>W</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:secondWitnessAddress>
               <nccommon:addressType>
                  <nccommon:code>W</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>address</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>White</nccommon:displayName>
                  <nccommon:originalText>W</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>ALBANY</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>NY</nccommon:state>
               <nccommon:streetAddress>4 TROY STREET</nccommon:streetAddress>
               <nccommon:zipCode>01033</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName>
               <nccommon:familyName>JONES</nccommon:familyName>
               <nccommon:givenName>JAMES</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>G</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>G</nccommon:displayName>
                  <nccommon:originalText>G</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>KENNETH</nccommon:secondNameOrInitials>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone>
               <nccommon:areaCode>301</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>555</nccommon:extension>
               <nccommon:localNumber>0001</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>W</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneNumberType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Work</nccommon:displayName>
                  <nccommon:originalText>W</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN>123456789</nccommon:SSN>
            <nccommon:uniquePatientId>D1234011</nccommon:uniquePatientId>
            <nccommon:witnessAddress>
               <nccommon:addressType>
                  <nccommon:code>H</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>address</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Home</nccommon:displayName>
                  <nccommon:originalText>H</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>HARTFORD</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>CT</nccommon:state>
               <nccommon:streetAddress>10410 MAIN ST.</nccommon:streetAddress>
               <nccommon:zipCode>05032</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName>
               <nccommon:familyName>COREY</nccommon:familyName>
               <nccommon:givenName>AMANDA</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>H</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>H</nccommon:displayName>
                  <nccommon:originalText>H</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>EVE</nccommon:secondNameOrInitials>
            </nccommon:witnessName>
            <nccommon:witnessPhone>
               <nccommon:areaCode>202</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>555</nccommon:extension>
               <nccommon:localNumber>1010</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>H</nccommon:code>
                  <nccommon:codeSystem>30</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>H</nccommon:displayName>
                  <nccommon:originalText>H</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo>
               <nccommon:personName>
                  <nccommon:familyName>FRANKLIN</nccommon:familyName>
                  <nccommon:givenName>MARK</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>P</nccommon:code>
                     <nccommon:codeSystem>30</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameType</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>P</nccommon:displayName>
                     <nccommon:originalText>P</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>ALAN</nccommon:secondNameOrInitials>
               </nccommon:personName>
               <nccommon:userName>mfranklin</nccommon:userName>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized>true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded>
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <!--nccommon:claimFormRef>Ref-Clm-123</nccommon:claimFormRef-->
            <!--nccommon:claimFormRaw>YWVvbGlhbQ==</nccommon:claimFormRaw-->
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest" mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep>
			
			<con:testStep name="Policy Engine Mock" type="mockresponse">
				<con:settings/>
				<con:config startStep="Subscribe" xsi:type="con:MockResponseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>AdapterPolicyEngineBindingSoap</con:interface>
					<con:operation>CheckPolicy</con:operation>
					<con:path>/mockPolicyEngine1</con:path>
					<con:port>18088</con:port>
					<con:timeout>60000</con:timeout>
					<con:response>
						<con:settings><con:setting id="com.eviware.soapui.impl.wsdl.mock.WsdlMockResponse@disable-multipart-attachments">false</con:setting><con:setting id="com.eviware.soapui.impl.wsdl.mock.WsdlMockResponse@encode_attachments">false</con:setting></con:settings>
						<con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:xacml:2.0:context:schema:os" xmlns:urn2="urn:oasis:names:tc:xacml:2.0:policy:schema:os">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:CheckPolicyResponse>
         <urn:response>
            <urn1:Result ResourceId="?">
               <urn1:Decision>Permit</urn1:Decision>
            </urn1:Result>
         </urn:response>
      </urn:CheckPolicyResponse>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent>
						<con:wsaConfig mustUnderstand="NONE" version="200508"/>
					</con:response>
					<con:assertion type="XPath Match">
						<con:configuration><path>declare namespace ns10='urn:oasis:names:tc:xacml:2.0:context:schema:os';
declare namespace ns18='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns18:CheckPolicyRequest[1]/ns18:request[1]/ns10:Action[1]/ns10:Attribute[1]/ns10:AttributeValue[1]</path><content>HIEMSubscriptionRequestOut</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration>
					</con:assertion>
				</con:config>
			</con:testStep>
			<con:testStep name="get subscription ID" type="groovy">
				<con:settings/>
				<con:config><script>def subscriptionID = context.withSql('SubscriptionDB') {sql ->
   def query = 'select subscriptionid from ' + context.findProperty('SubscriptionTable') + ' where Consumer = "nhin" and Producer = "gateway"';
   log.info "QUERY: " + query;
  sql.firstRow('select subscriptionid from ' + context.findProperty('SubscriptionTable') + ' where Consumer = "nhin" and Producer = "gateway"').'subscriptionid'
}

context.testCase.setPropertyValue("NotifySubscriptionID", subscriptionID);
log.info "SubscriptionID: " + subscriptionID;				</script></con:config>
			</con:testStep>
			<con:testStep name="Count Subscriptions (>0)" type="groovy">
				<con:settings/>
				<con:config>
					<script>context.withSql('SubscriptionDB') { sql -> 
  assert 0 &lt; sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script>
				</con:config>
			</con:testStep>
			
			<con:testStep name="Notify" type="request">
				<con:settings/>
				<con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<con:interface>EntityNotificationConsumerBindingSoap</con:interface>
					<con:operation>Notify</con:operation>
					<con:request name="Notify">
						<con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
						<con:encoding>UTF-8</con:encoding>
						<con:endpoint>${#Project#Endpoint-Notify}</con:endpoint>
						<con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:b="http://docs.oasis-open.org/wsn/b-2" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ihe="urn:ihe:iti:xds-b:2007" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soapenv:Header/>
   <soapenv:Body projectName="EntityPolicyEngineTest" testCase="Notify">
      <urn:NotifyRequest>
         <b:Notify>
            <b:NotificationMessage>
               <b:SubscriptionReference xmlns:wsnt="http://docs.oasis-open.orgs/wsn/b-2">
                  <wsa:Address>${#Project#NotifySubscriptionManagerEndpointAddress}</wsa:Address>
                  <wsa:ReferenceParameters>
                     <nhin:SubscriptionId xmlns:nhin="http://www.hhs.gov/healthit/nhin">${#TestCase#NotifySubscriptionID}</nhin:SubscriptionId>
                  </wsa:ReferenceParameters>
               </b:SubscriptionReference>
               <b:Message>
                  <ihe:RetrieveDocumentSetRequest>
                     <ihe:DocumentRequest>
                        <ihe:HomeCommunityId>2.16.840.1.113883.3.200</ihe:HomeCommunityId>
                        <ihe:RepositoryUniqueId>1</ihe:RepositoryUniqueId>
                        <ihe:DocumentUniqueId>500000000-XNHIN-CONSENT</ihe:DocumentUniqueId>
                     </ihe:DocumentRequest>
                  </ihe:RetrieveDocumentSetRequest>
               </b:Message>
            </b:NotificationMessage>
         </b:Notify>
         <urn:Assertion>
            <urn4:address>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>AddrCity</urn4:city>
               <urn4:country>AddrCountry</urn4:country>
               <urn4:state>AddrState</urn4:state>
               <urn4:streetAddress>AddrStreet</urn4:streetAddress>
               <urn4:zipCode>AddrZip</urn4:zipCode>
            </urn4:address>
            <urn4:dateOfBirth>06/04/1959 05:21:00</urn4:dateOfBirth>
            <urn4:explanationNonClaimantSignature>Electronic</urn4:explanationNonClaimantSignature>
            <urn4:haveSecondWitnessSignature>false</urn4:haveSecondWitnessSignature>
            <urn4:haveSignature>false</urn4:haveSignature>
            <urn4:haveWitnessSignature>false</urn4:haveWitnessSignature>
            <urn4:homeCommunity>
               <urn4:description>${#Project#LocalHCDescription}</urn4:description>
               <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
               <urn4:name>${#Project#LocalHCDescription}</urn4:name>
            </urn4:homeCommunity>
            <urn4:personName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sandy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
               <urn4:fullName>Sandy S. Smith</urn4:fullName>
            </urn4:personName>
            <urn4:phoneNumber>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5436</urn4:extension>
               <urn4:localNumber>253-6849</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:phoneNumber>
            <urn4:secondWitnessAddress>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Addr2City</urn4:city>
               <urn4:country>Addr2Country</urn4:country>
               <urn4:state>Addr2State</urn4:state>
               <urn4:streetAddress>Addr2Street</urn4:streetAddress>
               <urn4:zipCode>Addr2Zip</urn4:zipCode>
            </urn4:secondWitnessAddress>
            <urn4:secondWitnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sammy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>s</urn4:secondNameOrInitials>
               <urn4:fullName>Sammy S. Smith</urn4:fullName>
            </urn4:secondWitnessName>
            <urn4:secondWitnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5424</urn4:extension>
               <urn4:localNumber>542-6823</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:secondWitnessPhone>
            <urn4:SSN>253-98-7546</urn4:SSN>
            <urn4:uniquePatientId>500000000</urn4:uniquePatientId>
            <urn4:witnessAddress>
               <urn4:addressType>
                  <urn4:code>addrCode</urn4:code>
                  <urn4:codeSystem>addrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>addrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>addrCode</urn4:displayName>
                  <urn4:originalText>addrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Burnell</urn4:city>
               <urn4:country>USA</urn4:country>
               <urn4:state>FL</urn4:state>
               <urn4:streetAddress>825 North</urn4:streetAddress>
               <urn4:zipCode>32184</urn4:zipCode>
            </urn4:witnessAddress>
            <urn4:witnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Scott</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S.</urn4:secondNameOrInitials>
               <urn4:fullName>Scott S. Smith</urn4:fullName>
            </urn4:witnessName>
            <urn4:witnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>8432</urn4:extension>
               <urn4:localNumber>985-2239</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:witnessPhone>
            <urn4:userInfo>
               <urn4:personName>
                  <urn4:familyName>Skagerberg</urn4:familyName>
                  <urn4:givenName>Karl</urn4:givenName>
                  <urn4:nameType>
                     <urn4:code>nameCode</urn4:code>
                     <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                     <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                     <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                     <urn4:displayName>nameCode</urn4:displayName>
                     <urn4:originalText>nameCode</urn4:originalText>
                  </urn4:nameType>
                  <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
                  <urn4:fullName>Kasrl S. Skagerberg</urn4:fullName>
               </urn4:personName>
               <urn4:userName>kskagerb</urn4:userName>
               <urn4:org>
                  <urn4:description>${#Project#LocalHCDescription}</urn4:description>
                  <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
                  <urn4:name>${#Project#LocalHCDescription}</urn4:name>
               </urn4:org>
               <urn4:roleCoded>
                  <urn4:code>307969004</urn4:code>
                  <urn4:codeSystem>2.16.840.1.113883.6.96</urn4:codeSystem>
                  <urn4:codeSystemName>SNOMED_CT</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>Public Health</urn4:displayName>
                  <urn4:originalText>Public Health</urn4:originalText>
               </urn4:roleCoded>
            </urn4:userInfo>
            <urn4:authorized>true</urn4:authorized>
            <urn4:purposeOfDisclosureCoded>
               <urn4:code>PUBLICHEALTH</urn4:code>
               <urn4:codeSystem>2.16.840.1.113883.3.18.7.1</urn4:codeSystem>
               <urn4:codeSystemName>nhin-purpose</urn4:codeSystemName>
               <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
               <urn4:displayName>Use or disclosure of Psychotherapy Notes</urn4:displayName>
               <urn4:originalText>Use or disclosure of Psychotherapy Notes</urn4:originalText>
            </urn4:purposeOfDisclosureCoded>
            <urn4:samlAuthnStatement>
               <urn4:authInstant>2009-04-16T13:15:39Z</urn4:authInstant>
               <urn4:sessionIndex>987</urn4:sessionIndex>
               <urn4:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn4:authContextClassRef>
               <urn4:subjectLocalityAddress>158.147.185.168</urn4:subjectLocalityAddress>
               <urn4:subjectLocalityDNSName>cs.myharris.net</urn4:subjectLocalityDNSName>
            </urn4:samlAuthnStatement>
            <urn4:samlAuthzDecisionStatement>
               <urn4:decision>Permit</urn4:decision>
               <urn4:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn4:resource>
               <urn4:action>TestSaml</urn4:action>
               <urn4:evidence>
                  <urn4:assertion>
                     <urn4:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn4:id>
                     <urn4:issueInstant>2009-04-16T13:10:39.093Z</urn4:issueInstant>
                     <urn4:version>2.0</urn4:version>
                     <urn4:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn4:issuerFormat>
                     <urn4:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn4:issuer>
                     <urn4:conditions>
                        <urn4:notBefore>2009-04-16T13:10:39.093Z</urn4:notBefore>
                        <urn4:notOnOrAfter>2009-12-31T12:00:00.000Z</urn4:notOnOrAfter>
                     </urn4:conditions>
                  </urn4:assertion>
               </urn4:evidence>
            </urn4:samlAuthzDecisionStatement>
         </urn:Assertion>
      </urn:NotifyRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
						<con:assertion type="SOAP Response"/>
						<con:assertion disabled="true" type="Schema Compliance">
							<con:configuration/>
						</con:assertion>
						<con:assertion type="SOAP Fault Assertion"/>
						<con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/>
						<con:wsrmConfig version="1.2"/>
					</con:request>
				</con:config>
			</con:testStep><con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty("GatewayPropDir"), log);</con:setupScript><con:properties>
				<con:property>
					<con:name>startDate</con:name>
					<con:value>2012-12-13T02:25:35Z</con:value>
				</con:property>
				<con:property>
					<con:name>endDate</con:name>
					<con:value>2012-12-13T02:35:35Z</con:value>
				</con:property>
				<con:property>
					<con:name>sigDate</con:name>
					<con:value>12/13/2012 02:25:35</con:value>
				</con:property>
				<con:property>
					<con:name>expireDate</con:name>
					<con:value>2013-01-12T00:00:00Z</con:value>
				</con:property>
				<con:property>
					<con:name>NotifySubscriptionID</con:name>
					<con:value/>
				</con:property>
			</con:properties>
			<con:reportParameters/>
			<con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);</con:tearDownScript>
		</con:testCase>
		
		
		<con:properties/>
		<con:reportParameters/>
	</con:testSuite>
	<con:requirements/>
	<con:properties>
		<con:property><con:name>AAMappingDB</con:name><con:value>assigningauthoritydb</con:value></con:property><con:property><con:name>AAMappingTable</con:name><con:value>aa_to_home_community_mapping</con:value></con:property><con:property><con:name>AQPatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>AQUserID</con:name><con:value>mfranklin</con:value></con:property>
		
		
		
		
		
		
		
		
		<con:property><con:name>AuditDB</con:name><con:value>auditrepo</con:value></con:property><con:property><con:name>AuditTable</con:name><con:value>auditrepository</con:value></con:property><con:property><con:name>DBHost</con:name><con:value>localhost</con:value></con:property>
		
		
		<con:property><con:name>DBPass</con:name><con:value>nhincpass</con:value></con:property><con:property><con:name>DBPort</con:name><con:value>3306</con:value></con:property><con:property><con:name>DBUser</con:name><con:value>nhincuser</con:value></con:property>
		
		
		
		<con:property><con:name>DQDocID</con:name><con:value>333333333</con:value></con:property><con:property><con:name>DQPatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>DRDocID</con:name><con:value>555555555</con:value></con:property>
		<con:property><con:name>DRRepoID</con:name><con:value>1</con:value></con:property><con:property><con:name>Endpoint-AuditLogQuery</con:name><con:value>http://localhost:8080/CONNECTAdapter/EntityAuditQuery</con:value></con:property><con:property><con:name>Endpoint-DocQuery</con:name><con:value>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:value></con:property>
		
		<con:property><con:name>Endpoint-DocRetrieve</con:name><con:value>http://localhost:8080/Gateway/DocumentRetrieve/2_0/EntityService/EntityDocRetrieve</con:value></con:property><con:property><con:name>Endpoint-Notify</con:name><con:value>http://localhost:8080/Gateway/HIEM/2_0/EntityNotificationConsumer</con:value></con:property><con:property><con:name>Endpoint-Reidentification</con:name><con:value>http://localhost:8080/CONNECTAdapter/EntitySubjectDiscovery</con:value></con:property>
		<con:property><con:name>Endpoint-SubjectDiscovery</con:name><con:value>http://localhost:8080/CONNECTAdapter/EntitySubjectDiscovery</con:value></con:property><con:property><con:name>Endpoint-Subscribe</con:name><con:value>http://localhost:8080/Gateway/HIEM/2_0/EntityNotificationProducer</con:value></con:property><con:property><con:name>Endpoint-Unsubscribe</con:name><con:value>http://localhost:8080/Gateway/HIEM/2_0/EntitySubscriptionManager</con:value></con:property>
		
		
		
		
		
		<con:property><con:name>GatewayPropDir</con:name><con:value>c:\glassfish3\glassfish\domains\domain1\config\nhin</con:value></con:property><con:property><con:name>LocalAA</con:name><con:value>1.1</con:value></con:property><con:property><con:name>LocalConfigDir</con:name><con:value>C:/SelfTest/EndToEndSelfTest</con:value></con:property>
		
		
		
		<con:property><con:name>LocalHCDescription</con:name><con:value>InternalTest1</con:value></con:property><con:property><con:name>LocalHCID</con:name><con:value>1.1</con:value></con:property><con:property><con:name>LocalPatientID</con:name><con:value>D123401</con:value></con:property>
		<con:property><con:name>MockHost</con:name><con:value>localhost</con:value></con:property><con:property><con:name>MPIDir</con:name><con:value>C:/Sun/AppServer/domains/domain1/config</con:value></con:property><con:property><con:name>NHINGatewayConfigDir</con:name><con:value>C:/Sun/AppServer/domains/domain1/config/nhin</con:value></con:property>
		
		
		
		
		
		<con:property><con:name>NHINGatewayHost</con:name><con:value>localhost</con:value></con:property><con:property><con:name>NotificationEndpoint</con:name><con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/NotificationConsumerService/HiemNotify</con:value></con:property><con:property><con:name>NotifySubscriptionID</con:name><con:value>-f7c1a5d:1204e50e42e:-79eb</con:value></con:property><con:property><con:name>NotifySubscriptionManagerEndpointAddress</con:name><con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value></con:property><con:property><con:name>PatientCorrelationDB</con:name><con:value>patientcorrelationdb</con:value></con:property><con:property><con:name>PatientCorrelationTable</con:name><con:value>correlatedidentifiers</con:value></con:property><con:property><con:name>PseudonymAA</con:name><con:value>ABC</con:value></con:property>
		
		
		
		
		
		<con:property><con:name>PseudonymPatientID</con:name><con:value>PSEUDO001</con:value></con:property><con:property><con:name>RealAA</con:name><con:value>1.1.1</con:value></con:property><con:property><con:name>RealPatientID</con:name><con:value>D1234010050</con:value></con:property><con:property><con:name>RemoteAA</con:name><con:value>2.2</con:value></con:property><con:property><con:name>RemoteHCDescription</con:name><con:value>InternalTest2</con:value></con:property>
		
		
		
		
	<con:property><con:name>RemoteHCID</con:name><con:value>2.2</con:value></con:property><con:property><con:name>RemotePatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>SubscribePatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>SubscriptionDB</con:name><con:value>subscriptionrepository</con:value></con:property><con:property><con:name>SubscriptionEndpoint</con:name><con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/NotificationProducerService/HiemSubscription</con:value></con:property><con:property><con:name>SubscriptionManagerEndpointAddress</con:name><con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value></con:property><con:property><con:name>SubscriptionTable</con:name><con:value>subscription</con:value></con:property><con:property><con:name>UnsubSubscriptionID</con:name><con:value>3e74139f-5271-4db1-98c0-88748fa3e4e3</con:value></con:property></con:properties>
	<con:afterLoadScript>def propertiesFilename = project.path[0..(project.path.size()-4)] + 'properties'
def propertiesFile = new File(propertiesFilename)
if (propertiesFile.exists()) {
	def props = new Properties()
	props.load(new FileReader(propertiesFile))
	props.each { key, value ->
	    project.setPropertyValue(key, value)
	}
}


TimeZone.setDefault(TimeZone.getTimeZone("UTC"))
def testRunListener = [
  afterRun: { testRunner, runContext -> },
  afterStep: { testRunner, runContext, result -> },
  beforeStep: { testRunner, runContext -> },
  beforeStep: { testRunner, runContext, testStep -> },
  beforeRun: { testRunner, runContext -> 
    use (org.codehaus.groovy.runtime.TimeCategory) {
      def startDate = 5.minutes.ago
      def endDate = 5.minutes.from.now
      def expireDate = 30.days.from.now

      def df = "yyyy-MM-dd'T'HH:mm:ss'Z'"
      def dfSig = "MM/dd/yyyy' 'HH:mm:ss"

      runContext.testCase.setPropertyValue("startDate", startDate.format(df))
      runContext.testCase.setPropertyValue("endDate", endDate.format(df))
      runContext.testCase.setPropertyValue("sigDate", startDate.format(dfSig))
      runContext.testCase.setPropertyValue("expireDate", expireDate.format(df))
    }
  }   
] as com.eviware.soapui.model.testsuite.TestRunListener

project.testSuiteList*.testCaseList.flatten()*.addTestRunListener(testRunListener)



com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.findProperty = { propertyName ->
    return delegate.getProperty(propertyName) ?:
                delegate.testCase.getPropertyValue(propertyName) ?:
                delegate.testCase.testSuite.getPropertyValue(propertyName) ?:
                delegate.testCase.testSuite.project.getPropertyValue(propertyName)
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.withSql = { dbOrPropertyName, block ->
  def dbName = delegate.findProperty(dbOrPropertyName) ?: dbOrPropertyName
  def host = delegate.findProperty('DBHost')
  def port = delegate.findProperty('DBPort')
  def user = delegate.findProperty('DBUser')
  def pass = delegate.findProperty('DBPass')

  def connectString = "jdbc:mysql://${host}:${port}/${dbName}"
  def sql = groovy.sql.Sql.newInstance(connectString, user, pass, "com.mysql.jdbc.Driver");
  try {
     block(sql)
  } finally {
    sql.close()
  }
}
	</con:afterLoadScript>
	<con:wssContainer/>
	<con:databaseConnectionContainer/>
	<con:reporting>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:xmlTemplates/>
		<con:parameters/>
	</con:reporting>
<con:sensitiveInformation/></con:soapui-project>