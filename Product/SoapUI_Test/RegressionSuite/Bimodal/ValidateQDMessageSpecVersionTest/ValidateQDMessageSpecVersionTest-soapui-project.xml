<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project abortOnError="false" name="ValidateQDMessageSpecVersionTest" resourceRoot="${projectDir}" runType="SEQUENTIAL" soapui-version="4.5.1" activeEnvironment="Default" id="4da236a7-6e0d-43e2-acdd-53d456cb7699" xmlns:con="http://eviware.com/soapui/config">
  <con:settings/>
  <con:interface anonymous="optional" bindingName="{urn:gov:hhs:fha:nhinc:entitydocquery}EntityDocQueryBindingSoap" definition="../../../target/wsdl/EntityDocQuery.wsdl" name="EntityDocQueryBindingSoap" soapVersion="1_2" type="wsdl" wsaVersion="NONE" xsi:type="con:WsdlInterface" id="6a0292eb-f01d-4545-8fa1-54405c7bdb71" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
      <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
    </con:endpoints>
    <con:operation action="urn:gov:hhs:fha:nhinc:entitydocquery:RespondingGateway_CrossGatewayQueryRequest" anonymous="optional" bindingOperationName="RespondingGateway_CrossGatewayQuery" inputName="RespondingGateway_CrossGatewayQueryRequest" isOneWay="false" name="RespondingGateway_CrossGatewayQuery" outputName="RespondingGateway_CrossGatewayQueryResponse" receivesAttachments="false" sendsAttachments="false" type="Request-Response" id="f143bd51-7ac9-49d2-af36-8daecf12fbfc">
      <con:settings/>
    </con:operation>
  </con:interface>
  <con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdapterDocQueryBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:adapterdocquery}AdapterDocQueryBindingSoap" soapVersion="1_2" anonymous="optional" definition="../../target/wsdl/AdapterDocQuery.wsdl" id="0f29d572-5ac6-49a6-afc4-6b44656e464f" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:endpoints>
      <con:endpoint>http://localhost:${HttpDefaultPort}/Adapter/DocumentQuery/A_0/AdapterDocQueryUnsecured</con:endpoint>
    </con:endpoints>
    <con:operation isOneWay="false" action="urn:RespondingGateway_CrossGatewayQuery" name="RespondingGateway_CrossGatewayQuery" bindingOperationName="RespondingGateway_CrossGatewayQuery" type="Request-Response" outputName="RespondingGateway_CrossGatewayQueryResponse" inputName="RespondingGateway_CrossGatewayQueryRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional" id="e11aa640-006f-421d-bc60-7d6c29d1447e">
      <con:settings/>
      <con:call name="Request 1" id="fd7fd9af-611c-48cc-b92d-dc884f38a0c0">
        <con:settings/>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://GFE-ONC-WDEV28:1720/MockDQAdapter</con:endpoint>
        <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn4="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body>
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest id="?" comment="?" federated="false" federation="?" startIndex="0" maxResults="-1">
            <!--Optional:-->
            <urn2:RequestSlotList>
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
            </urn2:RequestSlotList>
            <urn1:ResponseOption returnType="RegistryObject" returnComposedObjects="false"/>
            <urn3:AdhocQuery id="?" home="?" lid="?" objectType="?" status="?">
               <!--Zero or more repetitions:-->
               <urn3:Slot name="?" slotType="?">
                  <urn3:ValueList>
                     <urn3:Value>?</urn3:Value>
                  </urn3:ValueList>
               </urn3:Slot>
               <!--Optional:-->
               <urn3:Name>
                  <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
               </urn3:Name>
               <!--Optional:-->
               <urn3:Description>
                  <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
               </urn3:Description>
               <!--Optional:-->
               <urn3:VersionInfo versionName="1.1" comment="?"/>
               <!--Zero or more repetitions:-->
               <urn3:Classification id="?" home="?" lid="?" objectType="?" status="?" classificationScheme="?" classifiedObject="?" classificationNode="?" nodeRepresentation="?">
                  <!--Zero or more repetitions:-->
                  <urn3:Slot name="?" slotType="?">
                     <urn3:ValueList>
                        <urn3:Value>?</urn3:Value>
                     </urn3:ValueList>
                  </urn3:Slot>
                  <!--Optional:-->
                  <urn3:Name>
                     <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                  </urn3:Name>
                  <!--Optional:-->
                  <urn3:Description>
                     <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                  </urn3:Description>
                  <!--Optional:-->
                  <urn3:VersionInfo versionName="1.1" comment="?"/>
                  <!--Zero or more repetitions:-->
                  <urn3:Classification/>
                  <!--Zero or more repetitions:-->
                  <urn3:ExternalIdentifier id="?" home="?" lid="?" objectType="?" status="?" registryObject="?" identificationScheme="?" value="?">
                     <!--Zero or more repetitions:-->
                     <urn3:Slot name="?" slotType="?">
                        <urn3:ValueList>
                           <urn3:Value>?</urn3:Value>
                        </urn3:ValueList>
                     </urn3:Slot>
                     <!--Optional:-->
                     <urn3:Name>
                        <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                     </urn3:Name>
                     <!--Optional:-->
                     <urn3:Description>
                        <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                     </urn3:Description>
                     <!--Optional:-->
                     <urn3:VersionInfo versionName="1.1" comment="?"/>
                     <!--Zero or more repetitions:-->
                     <urn3:Classification/>
                     <!--Zero or more repetitions:-->
                     <urn3:ExternalIdentifier/>
                  </urn3:ExternalIdentifier>
               </urn3:Classification>
               <!--Zero or more repetitions:-->
               <urn3:ExternalIdentifier id="?" home="?" lid="?" objectType="?" status="?" registryObject="?" identificationScheme="?" value="?">
                  <!--Zero or more repetitions:-->
                  <urn3:Slot name="?" slotType="?">
                     <urn3:ValueList>
                        <urn3:Value>?</urn3:Value>
                     </urn3:ValueList>
                  </urn3:Slot>
                  <!--Optional:-->
                  <urn3:Name>
                     <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                  </urn3:Name>
                  <!--Optional:-->
                  <urn3:Description>
                     <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                  </urn3:Description>
                  <!--Optional:-->
                  <urn3:VersionInfo versionName="1.1" comment="?"/>
                  <!--Zero or more repetitions:-->
                  <urn3:Classification id="?" home="?" lid="?" objectType="?" status="?" classificationScheme="?" classifiedObject="?" classificationNode="?" nodeRepresentation="?">
                     <!--Zero or more repetitions:-->
                     <urn3:Slot name="?" slotType="?">
                        <urn3:ValueList>
                           <urn3:Value>?</urn3:Value>
                        </urn3:ValueList>
                     </urn3:Slot>
                     <!--Optional:-->
                     <urn3:Name>
                        <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                     </urn3:Name>
                     <!--Optional:-->
                     <urn3:Description>
                        <urn3:LocalizedString xml:lang="en-US" charset="UTF-8" value="?"/>
                     </urn3:Description>
                     <!--Optional:-->
                     <urn3:VersionInfo versionName="1.1" comment="?"/>
                     <!--Zero or more repetitions:-->
                     <urn3:Classification/>
                     <!--Zero or more repetitions:-->
                     <urn3:ExternalIdentifier/>
                  </urn3:Classification>
                  <!--Zero or more repetitions:-->
                  <urn3:ExternalIdentifier/>
               </urn3:ExternalIdentifier>
               <!--Optional:-->
               <urn3:QueryExpression queryLanguage="?">
                  e
                  <!--You may enter ANY elements at this point-->
                  gero
               </urn3:QueryExpression>
            </urn3:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn4:address>
               <urn4:addressType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:addressType>
               <urn4:city>?</urn4:city>
               <urn4:country>?</urn4:country>
               <urn4:state>?</urn4:state>
               <urn4:streetAddress>?</urn4:streetAddress>
               <urn4:zipCode>?</urn4:zipCode>
            </urn4:address>
            <urn4:dateOfBirth>?</urn4:dateOfBirth>
            <urn4:explanationNonClaimantSignature>?</urn4:explanationNonClaimantSignature>
            <urn4:haveSecondWitnessSignature>?</urn4:haveSecondWitnessSignature>
            <urn4:haveSignature>?</urn4:haveSignature>
            <urn4:haveWitnessSignature>?</urn4:haveWitnessSignature>
            <urn4:homeCommunity>
               <urn4:description>?</urn4:description>
               <urn4:homeCommunityId>?</urn4:homeCommunityId>
               <urn4:name>?</urn4:name>
            </urn4:homeCommunity>
            <urn4:personName>
               <urn4:familyName>?</urn4:familyName>
               <urn4:givenName>?</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:nameType>
               <urn4:secondNameOrInitials>?</urn4:secondNameOrInitials>
               <urn4:fullName>?</urn4:fullName>
               <urn4:prefix>?</urn4:prefix>
               <urn4:suffix>?</urn4:suffix>
            </urn4:personName>
            <urn4:phoneNumber>
               <urn4:areaCode>?</urn4:areaCode>
               <urn4:countryCode>?</urn4:countryCode>
               <urn4:extension>?</urn4:extension>
               <urn4:localNumber>?</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:phoneNumberType>
            </urn4:phoneNumber>
            <urn4:secondWitnessAddress>
               <urn4:addressType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:addressType>
               <urn4:city>?</urn4:city>
               <urn4:country>?</urn4:country>
               <urn4:state>?</urn4:state>
               <urn4:streetAddress>?</urn4:streetAddress>
               <urn4:zipCode>?</urn4:zipCode>
            </urn4:secondWitnessAddress>
            <urn4:secondWitnessName>
               <urn4:familyName>?</urn4:familyName>
               <urn4:givenName>?</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:nameType>
               <urn4:secondNameOrInitials>?</urn4:secondNameOrInitials>
               <urn4:fullName>?</urn4:fullName>
               <urn4:prefix>?</urn4:prefix>
               <urn4:suffix>?</urn4:suffix>
            </urn4:secondWitnessName>
            <urn4:secondWitnessPhone>
               <urn4:areaCode>?</urn4:areaCode>
               <urn4:countryCode>?</urn4:countryCode>
               <urn4:extension>?</urn4:extension>
               <urn4:localNumber>?</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:phoneNumberType>
            </urn4:secondWitnessPhone>
            <urn4:SSN>?</urn4:SSN>
            <!--1 or more repetitions:-->
            <urn4:uniquePatientId>?</urn4:uniquePatientId>
            <urn4:witnessAddress>
               <urn4:addressType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:addressType>
               <urn4:city>?</urn4:city>
               <urn4:country>?</urn4:country>
               <urn4:state>?</urn4:state>
               <urn4:streetAddress>?</urn4:streetAddress>
               <urn4:zipCode>?</urn4:zipCode>
            </urn4:witnessAddress>
            <urn4:witnessName>
               <urn4:familyName>?</urn4:familyName>
               <urn4:givenName>?</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:nameType>
               <urn4:secondNameOrInitials>?</urn4:secondNameOrInitials>
               <urn4:fullName>?</urn4:fullName>
               <urn4:prefix>?</urn4:prefix>
               <urn4:suffix>?</urn4:suffix>
            </urn4:witnessName>
            <urn4:witnessPhone>
               <urn4:areaCode>?</urn4:areaCode>
               <urn4:countryCode>?</urn4:countryCode>
               <urn4:extension>?</urn4:extension>
               <urn4:localNumber>?</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:phoneNumberType>
            </urn4:witnessPhone>
            <urn4:userInfo>
               <urn4:personName>
                  <urn4:familyName>?</urn4:familyName>
                  <urn4:givenName>?</urn4:givenName>
                  <urn4:nameType>
                     <urn4:code>?</urn4:code>
                     <urn4:codeSystem>?</urn4:codeSystem>
                     <urn4:codeSystemName>?</urn4:codeSystemName>
                     <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                     <urn4:displayName>?</urn4:displayName>
                     <urn4:originalText>?</urn4:originalText>
                     <!--Zero or more repetitions:-->
                     <urn4:translation/>
                  </urn4:nameType>
                  <urn4:secondNameOrInitials>?</urn4:secondNameOrInitials>
                  <urn4:fullName>?</urn4:fullName>
                  <urn4:prefix>?</urn4:prefix>
                  <urn4:suffix>?</urn4:suffix>
               </urn4:personName>
               <urn4:userName>?</urn4:userName>
               <urn4:org>
                  <urn4:description>?</urn4:description>
                  <urn4:homeCommunityId>?</urn4:homeCommunityId>
                  <urn4:name>?</urn4:name>
               </urn4:org>
               <!--Optional:-->
               <urn4:roleCoded>
                  <urn4:code>?</urn4:code>
                  <urn4:codeSystem>?</urn4:codeSystem>
                  <urn4:codeSystemName>?</urn4:codeSystemName>
                  <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
                  <urn4:displayName>?</urn4:displayName>
                  <urn4:originalText>?</urn4:originalText>
                  <!--Zero or more repetitions:-->
                  <urn4:translation/>
               </urn4:roleCoded>
            </urn4:userInfo>
            <urn4:authorized>?</urn4:authorized>
            <!--Optional:-->
            <urn4:purposeOfDisclosureCoded>
               <urn4:code>?</urn4:code>
               <urn4:codeSystem>?</urn4:codeSystem>
               <urn4:codeSystemName>?</urn4:codeSystemName>
               <urn4:codeSystemVersion>?</urn4:codeSystemVersion>
               <urn4:displayName>?</urn4:displayName>
               <urn4:originalText>?</urn4:originalText>
               <!--Zero or more repetitions:-->
               <urn4:translation/>
            </urn4:purposeOfDisclosureCoded>
            <!--Optional:-->
            <urn4:samlAuthnStatement>
               <!--Optional:-->
               <urn4:authInstant>?</urn4:authInstant>
               <!--Optional:-->
               <urn4:sessionIndex>?</urn4:sessionIndex>
               <!--Optional:-->
               <urn4:authContextClassRef>?</urn4:authContextClassRef>
               <!--Optional:-->
               <urn4:subjectLocalityAddress>?</urn4:subjectLocalityAddress>
               <!--Optional:-->
               <urn4:subjectLocalityDNSName>?</urn4:subjectLocalityDNSName>
            </urn4:samlAuthnStatement>
            <!--Optional:-->
            <urn4:samlAuthzDecisionStatement>
               <!--Optional:-->
               <urn4:decision>?</urn4:decision>
               <!--Optional:-->
               <urn4:resource>?</urn4:resource>
               <!--Optional:-->
               <urn4:action>?</urn4:action>
               <!--Optional:-->
               <urn4:evidence>
                  <!--Optional:-->
                  <urn4:assertion>
                     <!--Optional:-->
                     <urn4:id>?</urn4:id>
                     <!--Optional:-->
                     <urn4:issueInstant>?</urn4:issueInstant>
                     <!--Optional:-->
                     <urn4:version>?</urn4:version>
                     <!--Optional:-->
                     <urn4:issuer>?</urn4:issuer>
                     <!--Optional:-->
                     <urn4:issuerFormat>?</urn4:issuerFormat>
                     <!--Optional:-->
                     <urn4:conditions>
                        <!--Optional:-->
                        <urn4:notBefore>?</urn4:notBefore>
                        <!--Optional:-->
                        <urn4:notOnOrAfter>?</urn4:notOnOrAfter>
                     </urn4:conditions>
                     <!--Zero or more repetitions:-->
                     <urn4:accessConsentPolicy>?</urn4:accessConsentPolicy>
                     <!--Zero or more repetitions:-->
                     <urn4:instanceAccessConsentPolicy>?</urn4:instanceAccessConsentPolicy>
                  </urn4:assertion>
               </urn4:evidence>
            </urn4:samlAuthzDecisionStatement>
            <!--Optional:-->
            <urn4:samlSignature>
               <!--Optional:-->
               <urn4:keyInfo>
                  <!--Optional:-->
                  <urn4:rsaKeyValueModulus>cid:995680764177</urn4:rsaKeyValueModulus>
                  <!--Optional:-->
                  <urn4:rsaKeyValueExponent>cid:1214967159425</urn4:rsaKeyValueExponent>
               </urn4:keyInfo>
               <!--Optional:-->
               <urn4:signatureValue>cid:1097555285042</urn4:signatureValue>
            </urn4:samlSignature>
            <!--Optional:-->
            <urn4:samlIssuer>
               <!--Optional:-->
               <urn4:issuer>?</urn4:issuer>
               <!--Optional:-->
               <urn4:issuerFormat>?</urn4:issuerFormat>
            </urn4:samlIssuer>
            <!--Optional:-->
            <urn4:messageId>?</urn4:messageId>
            <!--1 or more repetitions:-->
            <urn4:relatesToList>?</urn4:relatesToList>
         </urn:assertion>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
        <con:credentials>
          <con:authType>Global HTTP Settings</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:jmsPropertyConfig/>
        <con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:adapterdocquery/AdapterDocQueryPortType/RespondingGateway_CrossGatewayQueryRequest"/>
        <con:wsrmConfig version="1.2"/>
      </con:call>
    </con:operation>
  </con:interface>
  <con:testSuite name="Scenario 1" id="e3602d94-ca8f-4f0c-9f8f-ac50e0b59788">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="9a0f1d9f-ac55-4dac-ac10-8dde445665d6">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="fb142585-d8e2-4b0e-9fcc-8c3a8d43b785">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="7ce21c57-541c-42e0-a671-f7b7857b2d68">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="6f4227f1-19f2-4217-b2d8-8e0e1783e640">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="c36a8b4b-6502-417e-9473-1e79ea1985f8">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="231e3e1e-2ded-44c1-bd2a-ab53c7ff71a3">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="787149ec-9172-415f-837a-8dd999575de9"/>
            <con:assertion type="Schema Compliance" id="cc6a902d-2b00-4ff2-bfb7-c7f315d0c8cd">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="f550d065-c66b-41c9-81de-74ea35a0dca5"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="7a1c9685-b575-4d27-b39d-2f2e0024c67c">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario1.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="5807e83d-e7cc-40dc-aa6b-30e05560f815">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="4999c40a-87ed-408d-9fc8-55d7b62761bc">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario1.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="d23cce36-7011-48f8-86ae-c85d3c6010b5">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:35Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:35Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:35</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 2" searchProperties="true" id="6703d14f-b465-4cb0-8ff3-d9602449f2cd">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="9be9565a-a74d-4902-9506-6f5ad1aa8e03">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="a12910fb-f9a0-47f8-bda9-fa08c2bc0027">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="1cc67052-dd1b-4b51-80c2-26a9aa324cf8">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="8300894b-6305-4a3b-b43f-4ecaaaadaf2b">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="cbb0f193-f0ca-45bc-9313-11eea31779e0">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="d0a77e96-5f80-4879-b018-f035bf69a333"/>
            <con:assertion type="Schema Compliance" id="f56ddad1-a4d6-4b5c-867e-a9d73a2261b5">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="2c6ef047-aaa2-4c42-890f-d3b95c13ef31"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="67a6e591-46bb-4592-8a59-9607bf1fa260">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario1.case2";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="e879c851-a918-4dca-a463-6fa17762ff7e">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="841de66e-4fae-45ac-a1da-4d2ab7ac94ad">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario1.case2">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="571f1c09-40be-44d1-945c-b300b87d0ff1">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:37Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:37Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:37</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 2" id="aa7174d4-3eb6-495c-9570-8908639893fd">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="a2e2df8a-1634-4044-9669-7ba857b5996e">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="22b02a8a-8349-4e1a-91b7-2fe0b97aba89">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="2972ee96-24cc-488f-b8ba-afdcb91a06ea">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="463d8e45-dd56-4ef4-880b-a772b0d6c8b8">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="c0e18b8c-478a-4fb4-b13f-efe5df5ebd8b">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="c6ce1606-c5aa-4951-b9e0-8c705dbb8f7c">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="4e959fa8-d69d-41b4-942f-6a12ab3a523a"/>
            <con:assertion type="Schema Compliance" id="fbd3f33c-e3c0-4ee8-81ce-d61580f3bd6a">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="ce67d9c7-b76c-4fe2-b6a8-f66708bf49c1"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="4ce3dec0-ada9-4468-b5b2-be2e6f428bf8">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario2.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="1dfe95bb-c767-422c-b749-36a753fdb034">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="12902517-5faa-4500-abb4-d1b4c0d6c39e">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario2.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="f72631d0-9151-46d8-b0b5-2fedf4d72d97">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:38Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:38Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:38</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 2" searchProperties="true" id="1844dec6-f120-4b0f-b5d5-9462c173fbca">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="2d503e4b-6ca3-47e4-ae96-a3b979d6549d">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="90a31d0f-f726-4799-a8e8-d5e0f3c61872">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="76b0eb77-142b-433d-ac66-90482e835f1a">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="f38b5239-2a8f-419b-b671-27c0cf85e9b8">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="8e7d1084-3535-4a83-bf78-6b0a07fd381e">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="1cd48e6c-a4d7-4aab-9eba-a7ed5a55e308"/>
            <con:assertion type="Schema Compliance" id="04447557-80af-46f2-9705-1fa9c868c7bf">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="60f3b30f-84bd-43cd-adcf-622fd19a30f5"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="afbd32e9-2def-4f2c-8fab-d8374c96b6e8">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario2.case2";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="c738c73a-48b4-42ab-a556-154485f6c8f7">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="c0c487e4-123d-444d-a743-5fd1b8506f8b">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario2.case2">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="3a10683a-9df7-40b9-a6da-2dbae22aa686">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:40Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:40Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:40</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 3" id="0afcfb35-c762-4111-8d79-7f1a77262a4e">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="f1209adc-874c-4d94-8df4-a7f49642386f">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="172517ba-05fa-455e-81b5-3964b42574f0">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="78fb6338-1288-4812-8e64-b41ed2873e24">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="35401617-f0f4-4c07-a4cf-ede2e837aeb1">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="e335bb19-8e19-4374-8a91-a484f87f3b37">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="68737ba5-3ea5-4d08-940a-008de1d59af5">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="0f4eedf5-2c9a-4d6f-bd2e-50f0de88b9a6"/>
            <con:assertion type="Schema Compliance" id="c18c97f3-ca27-4b5f-b56e-640c3a26e70f">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="c6863544-40b4-4971-90f7-198f6ae7755f"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="82fb4b15-f636-4194-9fc0-391d322d8a54">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario3.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="dcbee0c1-111c-48ad-b4df-9253450058c5">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="44b528db-8a3c-4c6d-94ec-398d7615eec8">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario3.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="1105ca3c-a3af-4971-84a8-0589fc66bd07">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:41Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:41Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:41</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 2" searchProperties="true" id="6fc6fc10-fbcc-4305-8611-73182173983b">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="3cc835e4-000c-4c6d-92f4-8f615903d3e0">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="c5164b4f-c31c-451d-a631-d7c6e3e50838">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="7d341622-bd64-4255-8f35-e6128a435708">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="2c2804ab-2ad8-4615-95b3-bc9f8a177795">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="8e858d75-3dc1-44fb-8d69-ea9d1a82ac8e">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="8fa16c78-ba97-41c5-a94c-8893c42b2c2d"/>
            <con:assertion type="Schema Compliance" id="413f77fa-7fe8-49f1-8750-b396d22d2994">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="d4efbb06-19de-4f87-a6ab-943eddc194da"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="054f7a44-6aca-4b22-8091-0d52af388387">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario3.case2";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="6a056f42-eeb6-404f-9c85-61cefd152273">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="ec4dc009-5d33-442b-8c48-33052147b612">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario3.case2">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="046cbee6-5a20-4381-bd02-0c45397e54ba">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:43Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:43Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:43</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 4" id="89a9a9b4-f08b-477f-aa0f-cb067536ca59">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="0a91d312-53a3-4593-86ae-0903b92ed661">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="d59f4861-2e4b-43e3-a8d1-a75a75072f4b">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="7c8d56d7-0b19-448d-a1ca-44074be5aa6b">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="f48319ae-3e4f-4279-89cd-fa086de98e9b">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="fbc140af-8f74-46fd-824e-97c2a5e6f86a">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="612af4bd-da50-469b-b7e1-639135801255">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="d7f247f7-3eea-4415-8fba-b5e0828ca83f"/>
            <con:assertion type="Schema Compliance" id="99ba430d-35c6-4f1d-b540-f2ee62b4a661">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="b7643958-2ef6-4305-8796-7abd031481be"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="ffdca578-9213-4560-84b4-7bc9b47e53d3">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario4.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="68857c76-60cf-4272-b928-0d3e89b665aa">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="7cb8fb82-edb6-4d0a-b6c0-e46c3b52b80d">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario4.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="6b411407-ebe3-4ff3-883f-1d7e61c61df9">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:44Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:44Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:44</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 5" id="a7a88cf4-0f6b-4a31-b342-482433aeaf04">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="643e7aba-ea1d-440a-b72e-0dc891d93204">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="f5b92931-8b72-4d9f-858c-8e5d582d15ad">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="2cff1d6c-974e-426e-9c0e-f11a44a4bc4b">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="d85fe27d-81df-49c3-8f79-b1ec829575d0">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="9b7da7d5-53e7-4bf6-bec3-05725d00c94f">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="a8387ee4-1934-43ad-a789-97bd07299d3b">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="d462f88f-7d6d-49b3-8941-1bbed487786c"/>
            <con:assertion type="Schema Compliance" id="48311932-3554-4318-8ec0-1edabf01eb64">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="e914f0b5-d8fa-44bb-b0b3-0c69e24399f1"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="b0ddce9a-96b4-4258-a9d5-d7fad9aee338">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario5.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="93635ceb-2789-4053-ba68-1dc99dfd837c">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="7a75be0e-9331-4552-ad80-bfdd1841a0ba">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario5.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="51c3e43d-5929-4361-b737-fc08c0d6258a">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:46Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:46Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:46</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 6" id="5362a21a-e980-4746-ba2d-978e82ae67a5">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="e4854b07-0218-4e7a-89fe-797445aab2b7">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="98a672b3-e1c6-4a38-9aac-d51f2233e894">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="3e64877b-8513-40b3-9f81-1898a78168c4">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="118194fe-efee-47b8-9f4d-d29de3038b27">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="88f8b6e7-cdfe-481b-8118-605eb5c239f5">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="0d8da03a-f7db-4057-801c-9de19b16314e">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="41fbcdab-0fbc-4e27-a20a-990e32b12a0a"/>
            <con:assertion type="Schema Compliance" id="c09618a3-a006-48ea-8af4-63be24bdaeb4">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="24791793-6622-47bb-97a9-97bb282be12f"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="e16d1e23-5468-4e47-bebd-77d4f4fd7da2">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario6.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="d3fff3a4-f345-46bf-b014-b665c14307d4">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="a54a2727-2a2b-49c2-9265-66fbee3853a4">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario6.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="76ff85a0-d1d0-49de-aa47-e3a55f57f8b0">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:48Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:48Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:48</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 7" id="ec170909-76ae-41f6-9b05-7bfa7b21fb33">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="f951829c-b100-46a9-9e0f-d9379d2b6119">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="cce9fb0b-186f-4a58-8723-e8adad15e937">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="6f4dd492-48ae-49cb-a60d-a95037f0a474">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="f3c7330d-e91f-4704-8a03-e9ae8a1877dc">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="ebc41872-33a4-43cf-a8da-60d6eac82cd4">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="45efc9c3-b31c-4949-998a-81750743e330">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="0202fb24-fe1d-4c6b-ae34-401c687bf715"/>
            <con:assertion type="Schema Compliance" id="3fdd6d35-0439-459e-ad20-3505a20cadab">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="dd0ba0dd-305a-4cce-8fcb-fddcbee37d30"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="7b442e1e-64f9-4761-bd70-436fdfbb16d6">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario7.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="e4a78ff7-1055-455b-90d0-ad4f6074055a">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="eb178c8e-4851-40ca-a6d5-19363f0e777c">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario7.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="e1809069-bace-4d15-9365-0784abef31ec">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);</con:setupScript>
      <con:tearDownScript>def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.restoreConfiguration(dir, log);</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:49Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:49Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:49</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 1 - Passthrough" id="5b6ecdff-e7b2-4bd8-9e1d-adbcd3165a01">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="5a31cecc-6791-4fcc-9213-4e4bc8e16d1c">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="8f80d27c-eb92-4a31-a792-bd8af6be01cb">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="6901b4b2-f1f1-4e5a-b32e-c3fe1138efaf">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="87892689-b7ac-4660-86ef-90e16f10170e">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="18911772-6a38-46bd-a7e5-74d694f96e2c">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="aaf3877b-3d87-45a6-8872-9f32aa77ebc4">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="96da651a-28bd-4177-afd9-afbea3bf6553"/>
            <con:assertion type="Schema Compliance" id="da53e475-5b2f-49c2-8c99-2ee42b61f1d1">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="b9e5b056-99c5-4a61-8723-276b5a7acf63"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="0b4c6082-46f9-4115-b417-c6fe9fe9ddfb">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario1.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="63e7c865-ce3c-4a3e-b883-c67ed7b5de66">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="94abc68c-01c4-4d37-8968-e5dc53fde77d">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario1.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="4afd17a7-bb78-45f6-b27f-e7fda76f9676">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.20.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:51Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:51Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:51</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 2" searchProperties="true" id="23103755-b19c-484f-8f89-aa93f58f1d26">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="0325a626-66d3-4192-bb96-71654c4db874">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="eaff6049-184e-4c46-9e2e-1db9c2c3d225">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="4279367b-bcfa-42af-94fa-6f11e61ad429">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="22058da7-549d-409b-88d3-f2c607253d90">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="95359d9f-25a2-4809-b6be-f164b7be647c">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="d39af287-80b1-44a3-8297-529fdb1a915c"/>
            <con:assertion type="Schema Compliance" id="b67ea0bc-5c59-4517-9156-0969ea4ab4f9">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="5841d36e-edbe-4f01-a12c-919aa4091caa"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="329e14f3-8910-455d-bc24-94727c8508e1">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario1.case2";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="8f93b7f7-e671-4ac2-9c15-9de2731d3c83">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="eb01dd53-d9cc-49a5-9407-94aeeca15770">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario1.case2">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="79606753-b906-491f-97b5-7188d83a29c5">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.30.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:53Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:53Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:53</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 2 - Passthrough" id="497b0a1b-6be7-40cc-a6ac-f78ac6aee1f7">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="30fe3742-92bc-4641-9584-4023dbddf48b">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="3b12f518-ccef-4423-bf20-c60dd239f6f2">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="de4761a3-e3c0-4df0-8260-5e6d240082d8">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="f196c5d8-9613-406f-ab17-9689627da4da">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="7c2d9c7d-52e4-4f75-8930-cf542c976bc9">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="04851380-2083-4dc4-a354-f426d0fb9b18">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="7af90795-2c49-46b2-a0a2-9bd6b2c3003f"/>
            <con:assertion type="Schema Compliance" id="bffb56ef-c51f-4978-a079-2cac7995070b">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="4774ab9b-dc56-4c28-a932-02cdd1e97ee5"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="f5b0c84e-2eba-44a0-8c9d-1aeb3496518d">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario2.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="bd6e1867-b20c-44de-9611-e4fc2694622b">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="55b4ad84-1340-4bc4-9dd0-422ae72462d5">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario2.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="7b2c9111-f249-4fc1-8b5e-6d529bcd7756">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.20.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:54Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:54Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:54</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 2" searchProperties="true" id="c66f9f9d-ad18-457e-9596-401d5ef3c306">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="6603163f-f913-4d2b-89c2-052484736a8d">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="f2a0501c-eeef-4fff-909d-15679770101d">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="d1b1dc25-9674-4cf2-b892-99e74f0b3d0d">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="113cdf40-16d1-40be-aa9f-7e2741842256">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="c4176c68-f436-42c5-9364-17df82c8f1d2">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="e797d9c7-f937-4ce6-9e18-a5090dcfa3bc"/>
            <con:assertion type="Schema Compliance" id="139e862b-6644-4f67-8a08-487af4f7a95b">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="f4ad3b05-71d5-4d57-ad3e-345264423163"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="af3a9c83-d0c6-4f5f-8d43-49a3476be9d2">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario2.case2";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="84dc6ada-6b5a-4b3e-af3b-f5779c148369">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="064886f7-16fa-4e90-9f78-8a733051366c">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario2.case2">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="be29cdcd-929b-4100-a94d-9c515f98517d">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.30.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:56Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:56Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:56</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 3 - Passthrough" id="af390581-1046-4b94-8c60-97ef715c1a87">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="f365032e-330f-4cd0-a281-7614d50882fa">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="85d61e12-f6ba-4876-aa3d-fb8b878ccab1">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="7073b04c-9447-44ca-ba59-02f7fb50ed85">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="c2495e65-c5dc-4c74-828e-56a7f2aa6b8c">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="3d8d9ac0-efdd-4d59-877a-494c637cef24">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="a3cc711e-09c4-461b-89cc-e3eb2ae9e312">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="6a15abb8-24c3-4cf6-9069-a951bd7d05b7"/>
            <con:assertion type="Schema Compliance" id="aefca2b8-72c5-40a3-bfe5-8f59cc0a8a55">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="60cc1a24-44c6-41f8-92c4-f273f150703d"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="499d9301-571c-41f6-a53a-abe721597c1b">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario3.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="36f1db83-0c40-473c-8b7a-7e8a202943f3">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="980b6bf7-8f49-4c8e-a287-faa72cbd5aea">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario3.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="9bec92a0-0c4c-409b-bbe2-6397a08ca16f">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.20.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:57Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:57Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:57</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 2" searchProperties="true" id="93dde528-a12c-4ef7-b5c1-7fafe0e7b2b8">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="450e9e55-ef54-4996-a02e-560b68047056">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="aab28640-f90b-46b3-8d9e-f7a74653bd13">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="706c0c35-3037-4913-97b1-fa5df0133193">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="f8547c78-2432-4b41-bcce-5694c227be5b">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="01c98712-484c-4226-868f-488cff72d774">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="3061ce51-97a1-4d5f-b513-ef7ebcda865a"/>
            <con:assertion type="Schema Compliance" id="46c60233-718a-4973-b597-e7406e9af8a8">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="0174b00b-e2af-44c9-8e25-124dde0894a8"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="ad4eb0d1-63c5-4c71-b61c-a39198e1fe3b">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario3.case2";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="12d6a68e-0e45-46ef-a1f2-6e0a066b1b6b">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="2e0244e6-d9c3-46f9-9c75-b3804f02d4b1">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario3.case2">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="cad74f1a-80ad-4eb8-92e5-f2bd0fe940dc">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.30.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:20:59Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:30:59Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:20:59</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 4 - Passthrough" id="5bc47d54-6a75-4576-9a35-b54a6fc2a998">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="97f89561-77c3-4499-a299-75a1e7948856">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="3edad651-4eec-49d7-9df6-1b9e19c9b920">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="7e8b8dac-9529-43e0-8e0d-287c5e1d4e56">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="ed0a4c4e-c477-4e8c-8e99-727186b7cbc4">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="1c2fc00e-9f25-4e93-93c9-76f96d806756">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="9e53221a-f075-4837-80c9-536625889a97">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="9ef72649-ade3-46bd-8593-b6f16f95a47c"/>
            <con:assertion type="Schema Compliance" id="5eb07d63-fe59-4e48-aade-f2172d841924">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="48765e03-9891-46c7-ae93-bbbe91b8be3d"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="148e8cd7-5004-415a-b76e-580ba81f48a3">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario4.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="2f944cec-8a4f-475e-979d-96deb66ece77">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="36712264-cbc0-4969-936c-05e269039c3d">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario4.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="60b1f338-ce9f-438d-9c08-addc29c78db3">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.20.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:21:01Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:31:01Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:21:01</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 5 - Passthrough" id="77337b2c-c581-4aeb-b496-e62fea2e7fcb">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="39fb60bc-c5e5-4f12-aa82-29b76b79eb7e">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="bfccdfb6-b6b8-40d7-88a1-cd69e6764244">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="e43f699c-92c4-4f3c-aa6a-495a9c2a6e4f">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="6596b64f-bdb8-491d-8d3f-ac4bf3ae7018">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="67d72dfa-a846-4a40-9fb3-ec313dc12d88">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="17a337ff-5ad6-4e63-9840-3b9d8effaf7c">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="a1353aca-b479-441e-9afa-26845fac169d"/>
            <con:assertion type="Schema Compliance" id="e218e094-990d-41c7-bfe0-55b59baa04c8">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="3b233864-f8b2-4651-a726-5d523be686bf"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="4dd53b1c-8f31-44f0-921b-cc872b5bcccd">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario5.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="ec1f45b6-4d19-43d6-b144-4ae63a7d62c8">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="afb3e31f-14df-4dc6-98b5-0d6d405c1677">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario5.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="fe3f4ec3-0515-4861-a8d9-7e48be48dedf">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>2.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.20.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:21:02Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:31:02Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:21:02</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 6 - Passthrough" id="b184b83d-56bc-4a48-837f-e9e259be85d6">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="72611c42-e29b-4da3-a6a8-63a3c0a25e8e">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="31407b4a-285c-4899-b03e-6817ddb9261a">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a1",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="d1f2679e-915f-4ab6-8eca-0a0b37a7a3f2">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="479b848f-d304-47fd-81e7-699d803f96cd">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="90957874-4698-4ef8-b620-965460ed3930">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="93563412-90fd-4e6d-8b8b-7fda3a9c7e68">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="14757326-de07-4671-9e96-6e01800ee60c"/>
            <con:assertion type="Schema Compliance" id="d9cfe5ea-9a00-446b-bd60-8f8e76b17b8f">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="311f9d27-2aaf-4633-96f3-e4a6f57dd867"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="57fa0926-217e-45cb-8a35-11d5b798ab5b">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario6.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="7fb57aff-11e9-4b11-961b-dd3328a14729">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="5bbc95a8-24bb-46a6-ae41-7aa69babdf92">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario6.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="f43340d0-fc24-45fe-ab58-4cb37dd93466">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.30.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:21:04Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:31:04Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:21:04</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:testSuite name="Scenario 7 - Passthrough" id="9d759b35-1103-454d-9e4c-3d1922121845">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case 1" searchProperties="true" id="1e7f1507-0a9c-4893-b839-9a87432c19a2">
      <con:settings/>
      <con:testStep name="update config" type="groovy" id="d84f7bb7-2cac-4497-90e7-3a27d7221c98">
        <con:settings/>
        <con:config>
          <script>nhinc.FileUtils.updateProperty(context.findProperty('GatewayPropDir'), "gateway.properties", "documentQueryQuerySelf", "false", log);

def dir = context.findProperty('GatewayPropDir');
nhinc.FileUtils.backupFile(dir, "DocumentQueryProxyConfig.xml", log);
//Updating PolicyEngine for passthrough
def alias = 'adapterdocquery';
def aliasName = 'adapterdocquerywssecured';
def replaceName = 'adapterdocquerywsunsecured';
	
nhinc.FileUtils.updateSpringConfig(dir, "DocumentQueryProxyConfig.xml", alias, aliasName, replaceName, log);

nhinc.FileUtils.configureConnection("internalExchangeInfo.xml", dir, "1.1",
	"adapterdocquery", "http://localhost:1720/MockDQAdapter", "LEVEL_a0",
	log);</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear Correlation Table &amp; Add Correlation" type="groovy" id="57fea267-b01c-42f3-b975-1a48d8f355de">
        <con:settings/>
        <con:config>
          <script>context.withSql('PatientCorrelationDB') { sql -> 
		def table = context.findProperty('PatientCorrelationTable')

		sql.execute('delete from ' + table)

		def localAA = context.findProperty( "LocalAA" )
		def localPatientID = context.findProperty("LocalPatientID")
		def remoteAA = context.findProperty( "RemoteAA" )
		def remotePatientID = context.findProperty("RemotePatientID")
		def insertSql = "insert into " + table + " (correlationId, PatientAssigningAuthorityId, PatientId, CorrelatedPatientAssignAuthId, CorrelatedPatientId) " + 
		"values (1, ?, ?, ?, ?)"
		sql.executeUpdate(insertSql, [localAA, localPatientID, remoteAA, remotePatientID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Clear AA Mapping Table &amp; Add Mapping" type="groovy" id="d07532fc-9263-4faa-8f79-2fbe3434de14">
        <con:settings/>
        <con:config>
          <script>context.withSql('AAMappingDB') { sql -> 
		def table = context.findProperty('AAMappingTable')

		sql.execute('delete from ' + table)

		def remoteAA = context.findProperty( "RemoteAA" )
		def remoteHCID = context.findProperty("RemoteHCID")
		def insertSql = "insert into " + table + " (id, assigningauthorityid, homecommunityid) " + 
		"values (1, ?, ?)"
		sql.executeUpdate(insertSql, [remoteAA, remoteHCID])
		}</script>
        </con:config>
      </con:testStep>
      <con:testStep name="Document Query" type="request" id="dc0f7874-a861-4b17-853d-f989d1257b82">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:request name="Document Query" id="344d8bdc-e5fa-4885-a35f-83c05db78842">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:endpoint>
            <con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn3="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body testSuite="Entity_g1" testCase="Document Query">
      <urn:RespondingGateway_CrossGatewayQueryRequest>
         <urn1:AdhocQueryRequest federated="false" startIndex="0" maxResults="-1">
            <urn1:ResponseOption returnType="LeafClass" returnComposedObjects="false"/>
            <urn2:AdhocQuery home="urn:oid:1.1" id="urn:uuid:14d4debf-8f97-4251-9a74-a90016b0af0d">
               <urn2:Slot name="$XDSDocumentEntryPatientId">
                  <urn2:ValueList>
                     <urn2:Value>'${#Project#DQPatientID}^^^&amp;${#Project#LocalAA}&amp;ISO'</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryStatus">
                  <urn2:ValueList>
                     <urn2:Value>('urn:oasis:names:tc:ebxml-regrep:StatusType:Approved')</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCode">
                  <urn2:ValueList>
                     <urn2:Value>34133-9</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
               <urn2:Slot name="$XDSDocumentEntryClassCodeScheme">
                  <urn2:ValueList>
                     <urn2:Value>2.16.840.1.113883.6.1</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:AdhocQuery>
         </urn1:AdhocQueryRequest>
         <urn:assertion>
            <urn3:nationalProviderId>1234567890</urn3:nationalProviderId>
            <urn3:address xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>AddrCity</urn3:city>
               <urn3:country>AddrCountry</urn3:country>
               <urn3:state>AddrState</urn3:state>
               <urn3:streetAddress>AddrStreet</urn3:streetAddress>
               <urn3:zipCode>AddrZip</urn3:zipCode>
            </urn3:address>
            <urn3:dateOfBirth xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</urn3:dateOfBirth>
            <urn3:explanationNonClaimantSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</urn3:explanationNonClaimantSignature>
            <urn3:haveSecondWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSecondWitnessSignature>
            <urn3:haveSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveSignature>
            <urn3:haveWitnessSignature xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</urn3:haveWitnessSignature>
            <urn3:homeCommunity xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:description>${#Project#LocalHCDescription}</urn3:description>
               <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
               <urn3:name>${#Project#LocalHCDescription}</urn3:name>
            </urn3:homeCommunity>
            <urn3:personName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sandy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
               <urn3:fullName>Sandy S. Smith</urn3:fullName>
            </urn3:personName>
            <urn3:phoneNumber xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5436</urn3:extension>
               <urn3:localNumber>253-6849</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:phoneNumber>
            <urn3:secondWitnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>AddrCode</urn3:code>
                  <urn3:codeSystem>AddrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>AddrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>AddrCode</urn3:displayName>
                  <urn3:originalText>AddrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Addr2City</urn3:city>
               <urn3:country>Addr2Country</urn3:country>
               <urn3:state>Addr2State</urn3:state>
               <urn3:streetAddress>Addr2Street</urn3:streetAddress>
               <urn3:zipCode>Addr2Zip</urn3:zipCode>
            </urn3:secondWitnessAddress>
            <urn3:secondWitnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Sammy</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>s</urn3:secondNameOrInitials>
               <urn3:fullName>Sammy S. Smith</urn3:fullName>
            </urn3:secondWitnessName>
            <urn3:secondWitnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>5424</urn3:extension>
               <urn3:localNumber>542-6823</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:secondWitnessPhone>
            <urn3:SSN xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</urn3:SSN>
            <urn3:uniquePatientId xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn3:uniquePatientId>
            <urn3:witnessAddress xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:addressType>
                  <urn3:code>addrCode</urn3:code>
                  <urn3:codeSystem>addrCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>addrCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>addrCode</urn3:displayName>
                  <urn3:originalText>addrCode</urn3:originalText>
               </urn3:addressType>
               <urn3:city>Burnell</urn3:city>
               <urn3:country>USA</urn3:country>
               <urn3:state>FL</urn3:state>
               <urn3:streetAddress>825 North</urn3:streetAddress>
               <urn3:zipCode>32184</urn3:zipCode>
            </urn3:witnessAddress>
            <urn3:witnessName xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:familyName>Smith</urn3:familyName>
               <urn3:givenName>Scott</urn3:givenName>
               <urn3:nameType>
                  <urn3:code>nameCode</urn3:code>
                  <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>nameCode</urn3:displayName>
                  <urn3:originalText>nameCode</urn3:originalText>
               </urn3:nameType>
               <urn3:secondNameOrInitials>S.</urn3:secondNameOrInitials>
               <urn3:fullName>Scott S. Smith</urn3:fullName>
            </urn3:witnessName>
            <urn3:witnessPhone xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:areaCode>321</urn3:areaCode>
               <urn3:countryCode>1</urn3:countryCode>
               <urn3:extension>8432</urn3:extension>
               <urn3:localNumber>985-2239</urn3:localNumber>
               <urn3:phoneNumberType>
                  <urn3:code>phoneCode</urn3:code>
                  <urn3:codeSystem>phoneCodeSyst</urn3:codeSystem>
                  <urn3:codeSystemName>phoneCodeSystName</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>phoneCode</urn3:displayName>
                  <urn3:originalText>phoneCode</urn3:originalText>
               </urn3:phoneNumberType>
            </urn3:witnessPhone>
            <urn3:userInfo xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:personName>
                  <urn3:familyName>Skagerberg</urn3:familyName>
                  <urn3:givenName>Karl</urn3:givenName>
                  <urn3:nameType>
                     <urn3:code>nameCode</urn3:code>
                     <urn3:codeSystem>nameCodeSyst</urn3:codeSystem>
                     <urn3:codeSystemName>nameCodeSystName</urn3:codeSystemName>
                     <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                     <urn3:displayName>nameCode</urn3:displayName>
                     <urn3:originalText>nameCode</urn3:originalText>
                  </urn3:nameType>
                  <urn3:secondNameOrInitials>S</urn3:secondNameOrInitials>
                  <urn3:fullName>Kasrl S. Skagerberg</urn3:fullName>
               </urn3:personName>
               <urn3:userName>kskagerberg</urn3:userName>
               <urn3:org>
                  <urn3:description>${#Project#LocalHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#LocalHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#LocalHCDescription}</urn3:name>
               </urn3:org>
               <urn3:roleCoded>
                  <urn3:code>307969004</urn3:code>
                  <urn3:codeSystem>2.16.840.1.113883.6.96</urn3:codeSystem>
                  <urn3:codeSystemName>SNOMED_CT</urn3:codeSystemName>
                  <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
                  <urn3:displayName>Public Health</urn3:displayName>
                  <urn3:originalText>Public Health</urn3:originalText>
               </urn3:roleCoded>
            </urn3:userInfo>
            <urn3:authorized xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</urn3:authorized>
            <urn3:purposeOfDisclosureCoded xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:code>PUBLICHEALTH</urn3:code>
               <urn3:codeSystem>2.16.840.1.113883.3.18.7.1</urn3:codeSystem>
               <urn3:codeSystemName>nhin-purpose</urn3:codeSystemName>
               <urn3:codeSystemVersion>1.0</urn3:codeSystemVersion>
               <urn3:displayName>Use or disclosure of Psychotherapy Notes</urn3:displayName>
               <urn3:originalText>Use or disclosure of Psychotherapy Notes</urn3:originalText>
            </urn3:purposeOfDisclosureCoded>
            <urn3:samlAuthnStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:authInstant>2009-04-16T13:15:39Z</urn3:authInstant>
               <urn3:sessionIndex>987</urn3:sessionIndex>
               <urn3:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn3:authContextClassRef>
               <urn3:subjectLocalityAddress>1.1.1.1</urn3:subjectLocalityAddress>
               <urn3:subjectLocalityDNSName>connectopensource.org</urn3:subjectLocalityDNSName>
            </urn3:samlAuthnStatement>
            <urn3:samlAuthzDecisionStatement xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <urn3:decision>Permit</urn3:decision>
               <urn3:resource>https://1.1.1.1:8181/SamlReceiveService/SamlProcessWS</urn3:resource>
               <urn3:action>TestSaml</urn3:action>
               <urn3:evidence>
                  <urn3:assertion>
                     <urn3:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn3:id>
                     <urn3:issueInstant>2009-04-16T13:10:39.093Z</urn3:issueInstant>
                     <urn3:version>2.0</urn3:version>
                     <urn3:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn3:issuerFormat>
                     <urn3:issuer>CN=SAML User,OU=connect,O=FHA,L=Melbourne,ST=FL,C=US</urn3:issuer>
                     <urn3:conditions>
                        <urn3:notBefore>2009-04-16T13:10:39.093Z</urn3:notBefore>
                        <urn3:notOnOrAfter>2009-12-31T12:00:00.000Z</urn3:notOnOrAfter>
                     </urn3:conditions>
                     <urn3:accessConsentPolicy>urn:oid:1.2.3.4</urn3:accessConsentPolicy>
                     <urn3:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn3:instanceAccessConsentPolicy>
                  </urn3:assertion>
               </urn3:evidence>
            </urn3:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:NhinTargetCommunities>
            <urn3:nhinTargetCommunity>
               <urn3:homeCommunity>
                  <urn3:description>${#Project#RemoteHCDescription}</urn3:description>
                  <urn3:homeCommunityId>${#Project#RemoteHCID}</urn3:homeCommunityId>
                  <urn3:name>${#Project#RemoteHCDescription}</urn3:name>
               </urn3:homeCommunity>
            </urn3:nhinTargetCommunity>
         </urn:NhinTargetCommunities>
      </urn:RespondingGateway_CrossGatewayQueryRequest>
   </soap:Body>
</soap:Envelope>]]></con:request>
            <con:assertion type="SOAP Response" id="a8d1752e-907a-476a-b754-2723f89a9ae7"/>
            <con:assertion type="Schema Compliance" id="e6e54b62-a8ca-4ffc-a16f-63c456ed36c3">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="SOAP Fault Assertion" id="de134f24-ac64-423b-a81f-01f2966f7d54"/>
            <con:assertion name="DocID Match" type="GroovyScriptAssertion" id="8a175507-80a3-4027-a2ff-886d42ed1612">
              <con:configuration>
                <scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
				def holder = groovyUtils.getXmlHolder( messageExchange.responseContent );
				holder.namespaces["ns1"] = "urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0";
				holder.namespaces["ns3"] = "urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0";
				
				documentID = "mock.scenario7.case1";

				log.info("Doc ID used: " + documentID);
				def msgDocID = holder["//ns1:AdhocQueryResponse[1]/ns3:RegistryObjectList[1]/ns3:ExtrinsicObject[1]/ns3:ExternalIdentifier[@identificationScheme='urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab']/@value"];
				assert (documentID == msgDocID)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep>
      <con:testStep type="mockresponse" name="Mock Response" id="ef9abd43-03e9-4912-ae95-abd2b52421fa">
        <con:settings/>
        <con:config xsi:type="con:MockResponseStep" startStep="update config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>AdapterDocQueryBindingSoap</con:interface>
          <con:operation>RespondingGateway_CrossGatewayQuery</con:operation>
          <con:path>/MockDQAdapter</con:path>
          <con:port>1720</con:port>
          <con:response id="50799b7a-2299-43e9-92d6-1c600f577be9">
            <con:settings/>
            <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
   <soap:Header/>
   <soap:Body>
      <ns3:AdhocQueryResponse startIndex="0" status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success" totalResultCount="1" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns10="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns11="http://docs.oasis-open.org/wsn/t-1" xmlns:ns12="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://www.hhs.gov/healthit/nhin/cdc" xmlns:ns15="urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc" xmlns:ns16="http://nhinc.services.com/schema/auditmessage" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns5="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns7="http://www.w3.org/2005/08/addressing" xmlns:ns8="urn:oasis:names:tc:emergency:EDXL:DE:1.0" xmlns:ns9="http://docs.oasis-open.org/wsn/b-2">
         <ns2:ResponseSlotList/>
         <RegistryObjectList>
            <ExtrinsicObject home="urn:oid:1.1" id="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" isOpaque="false" mimeType="text/xml" objectType="urn:uuid:7edca82f-054d-47f2-a032-9b2a5b5186c1" status="Active">
               <Slot name="creationTime">
                  <ValueList>
                     <Value>20080627174924</Value>
                  </ValueList>
               </Slot>
               <Slot name="hash">
                  <ValueList>
                     <Value>ac0eec55d17eaa9c24054f8a7ecc5d3caa45d9f0</Value>
                  </ValueList>
               </Slot>
               <Slot name="intendedRecipient">
                  <ValueList>
                     <Value>Scott Borst</Value>
                  </ValueList>
               </Slot>
               <Slot name="languageCode">
                  <ValueList>
                     <Value>en-US</Value>
                  </ValueList>
               </Slot>
               <Slot name="legalAuthenticator">
                  <ValueList>
                     <Value>legal</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStartTime">
                  <ValueList>
                     <Value>20070911040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="serviceStopTime">
                  <ValueList>
                     <Value>20080627040000</Value>
                  </ValueList>
               </Slot>
               <Slot name="size">
                  <ValueList>
                     <Value>26934</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientId">
                  <ValueList>
                     <Value>D123402^^^&amp;1.1&amp;ISO</Value>
                  </ValueList>
               </Slot>
               <Slot name="sourcePatientInfo">
                  <ValueList>
                     <Value>PID-3|pid1^^^domain</Value>
                     <Value>PID-5|Schnur^Anna^^^</Value>
                     <Value>PID-7|19560813</Value>
                     <Value>PID-8|F</Value>
                     <Value>PID-11|312 HILL ROAD^^HILLSBORO^MO^37660^US</Value>
                  </ValueList>
               </Slot>
               <Slot name="URI">
                  <ValueList>
                     <Value>1.123402.11111</Value>
                  </ValueList>
               </Slot>
               <Slot name="repositoryUniqueId">
                  <ValueList>
                     <Value>1</Value>
                  </ValueList>
               </Slot>
               <Name>
                  <LocalizedString value="Schnur CONNECT TESTGATEWAY Document 1"/>
               </Name>
               <Description>
                  <LocalizedString value="Document 1 Schnur CONNECT TESTGATEWAY comments"/>
               </Description>
               <Classification classificationScheme="urn:uuid:93606bcf-9494-43ec-9b4e-a7748d1a838d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="">
                  <Slot name="authorPerson">
                     <ValueList>
                        <Value>Axolotl Elysium</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorInstitution">
                     <ValueList>
                        <Value>Test Two Workgroup</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorRole">
                     <ValueList>
                        <Value>Primary Care Provider</Value>
                     </ValueList>
                  </Slot>
                  <Slot name="authorSpecialty">
                     <ValueList>
                        <Value>General</Value>
                     </ValueList>
                  </Slot>
               </Classification>
               <Classification classificationScheme="urn:uuid:41a5887f-8865-4c09-adf7-e362475b143a" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="34133-9">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>2.16.840.1.113883.6.1</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Summarization of Episode Note"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f4f85eac-e6cb-4883-b524-f2705394840f" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="Confidential">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>Confidential</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="Confidential"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:a09d5840-386c-46f2-b5ad-9c3699a4309d" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="CDAR2/IHE 1.0">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>formatCodeScheme_value</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="formatCodeDisplayName_value"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f33fb8ac-18af-42cc-ae0e-ed0b0bdb91e1" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="UTF-8">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>UTF-8</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="UTF-8"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:cccf5598-8b07-4b77-a05e-ae952c785ead" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <Classification classificationScheme="urn:uuid:f0306f51-975f-434e-a61c-c59651d33983" classifiedObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" id="" nodeRepresentation="test">
                  <Slot name="codingScheme">
                     <ValueList>
                        <Value>test</Value>
                     </ValueList>
                  </Slot>
                  <Name>
                     <LocalizedString value="test"/>
                  </Name>
               </Classification>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:2e82c1f6-a085-4c72-9da3-8640a32e42ab" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="mock.scenario7.case1">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.uniqueId"/>
                  </Name>
               </ExternalIdentifier>
               <ExternalIdentifier id="" identificationScheme="urn:uuid:58a6f841-87b3-4a3e-92fd-a8ffeff98427" registryObject="urn:uuid:63bc1348-6f4c-496a-9c91-eb0c9efabf4b" value="D123401^^^&amp;2.2&amp;ISO">
                  <Name>
                     <LocalizedString value="XDSDocumentEntry.patientId"/>
                  </Name>
               </ExternalIdentifier>
            </ExtrinsicObject>
         </RegistryObjectList>
      </ns3:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
            <con:wsaConfig mustUnderstand="NONE" version="200508"/>
          </con:response>
          <con:assertion type="XPath Match" id="69880842-6d91-4b6b-99ea-bcf389b5d983">
            <con:configuration>
              <path>declare namespace s='http://www.w3.org/2003/05/soap-envelope';
declare namespace a='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace c='urn:gov:hhs:fha:nhinc:common:nhinccommon';

s:Envelope/s:Body/a:RespondingGateway_CrossGatewayQueryRequest/a:assertion/c:implementsSpecVersion</path>
              <content>3.0</content>
              <allowWildcards>false</allowWildcards>
              <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
              <ignoreComments>false</ignoreComments>
            </con:configuration>
          </con:assertion>
        </con:config>
      </con:testStep>
      <con:setupScript>nhinc.FileUtils.backupConfiguration(context.findProperty('GatewayPropDir'), log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "exchangeInfo_g1only.xml", context.findProperty('GatewayPropDir'), "exchangeInfo.xml", log);
nhinc.FileUtils.copyFile(context.expand(context.testCase.testSuite.project.resourceRoot), "internalExchangeInfo_g0.xml", context.findProperty('GatewayPropDir'), "internalExchangeInfo.xml", log);
context.setGatewayStandard(false);</con:setupScript>
      <con:tearDownScript>nhinc.FileUtils.restoreConfiguration(context.findProperty("GatewayPropDir"), log);
def isStandardMode = context.checkGatewayMode("docquery.30.inboundDocQuery",context);
context.setGatewayStandard(isStandardMode);
log.info "Set service in standard mode ${isStandardMode}";</con:tearDownScript>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2013-09-27T03:21:05Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2013-09-27T03:31:05Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>09/27/2013 03:21:05</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2013-10-27T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>FullPatientID</con:name>
          <con:value>'D123401^^^&amp;amp;1.1&amp;amp;ISO'</con:value>
        </con:property>
        <con:property>
          <con:name>PassThruOn</con:name>
          <con:value>false</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase>
    <con:properties/>
    <con:setupScript/>
    <con:tearDownScript/>
    <con:reportParameters/>
  </con:testSuite>
  <con:mockService port="8080" path="/" host="GFE-ONC-WDEV28" name="MockService 1" id="8bfb1c5f-cc80-42c9-aa67-e95466de499f">
    <con:settings>
      <con:setting id="com.eviware.soapui.impl.wsdl.mock.WsdlMockService@require-soap-action">false</con:setting>
    </con:settings>
    <con:mockOperation name="RespondingGateway_CrossGatewayQuery" interface="AdapterDocQueryBindingSoap" operation="RespondingGateway_CrossGatewayQuery" id="6f095867-ac1d-4687-a69a-5af1c445103a">
      <con:settings/>
      <con:dispatchStyle>SEQUENCE</con:dispatchStyle>
      <con:defaultResponse>Response 1</con:defaultResponse>
      <con:response name="Response 1" encoding="UTF-8" id="8bd2f1ad-89bf-49b0-93ee-88ec38054ece" httpResponseStatus="200">
        <con:settings/>
        <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body>
      <urn:AdhocQueryResponse status="?" requestId="?" startIndex="0" totalResultCount="?">
         <!--Optional:-->
         <urn1:ResponseSlotList>
            <!--Zero or more repetitions:-->
            <urn2:Slot name="?" slotType="?">
               <urn2:ValueList>
                  <urn2:Value>?</urn2:Value>
               </urn2:ValueList>
            </urn2:Slot>
         </urn1:ResponseSlotList>
         <!--Optional:-->
         <urn1:RegistryErrorList highestSeverity="?">
            <!--1 or more repetitions:-->
            <urn1:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn1:RegistryError>
         </urn1:RegistryErrorList>
         <urn2:RegistryObjectList>
            <!--Zero or more repetitions:-->
            <urn2:Identifiable id="?" home="?">
               <!--Zero or more repetitions:-->
               <urn2:Slot name="?" slotType="?">
                  <urn2:ValueList>
                     <urn2:Value>?</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:Identifiable>
         </urn2:RegistryObjectList>
      </urn:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
        <con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:adapterdocquery/AdapterDocQueryPortType/RespondingGateway_CrossGatewayQueryResponse"/>
      </con:response>
      <con:response name="Response 2" encoding="UTF-8" id="fd5b47e5-7c33-42a8-b47c-4d157e2401af" httpResponseStatus="200">
        <con:settings/>
        <con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:urn1="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:urn2="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soap:Header/>
   <soap:Body>
      <urn:AdhocQueryResponse status="?" requestId="?" startIndex="0" totalResultCount="?">
         <!--Optional:-->
         <urn1:ResponseSlotList>
            <!--Zero or more repetitions:-->
            <urn2:Slot name="?" slotType="?">
               <urn2:ValueList>
                  <urn2:Value>?</urn2:Value>
               </urn2:ValueList>
            </urn2:Slot>
         </urn1:ResponseSlotList>
         <!--Optional:-->
         <urn1:RegistryErrorList highestSeverity="?">
            <!--1 or more repetitions:-->
            <urn1:RegistryError codeContext="?" errorCode="?" severity="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error" location="?">?</urn1:RegistryError>
         </urn1:RegistryErrorList>
         <urn2:RegistryObjectList>
            <!--Zero or more repetitions:-->
            <urn2:Identifiable id="?" home="?">
               <!--Zero or more repetitions:-->
               <urn2:Slot name="?" slotType="?">
                  <urn2:ValueList>
                     <urn2:Value>?</urn2:Value>
                  </urn2:ValueList>
               </urn2:Slot>
            </urn2:Identifiable>
         </urn2:RegistryObjectList>
      </urn:AdhocQueryResponse>
   </soap:Body>
</soap:Envelope>]]></con:responseContent>
        <con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:adapterdocquery/AdapterDocQueryPortType/RespondingGateway_CrossGatewayQueryResponse"/>
      </con:response>
      <con:dispatchConfig/>
    </con:mockOperation>
    <con:properties/>
  </con:mockService>
  <con:requirements/>
  <con:properties>
    <con:property>
      <con:name>AAMappingDB</con:name>
      <con:value>assigningauthoritydb</con:value>
    </con:property>
    <con:property>
      <con:name>AAMappingTable</con:name>
      <con:value>aa_to_home_community_mapping</con:value>
    </con:property>
    <con:property>
      <con:name>AsyncMsgDB</con:name>
      <con:value>asyncmsgs</con:value>
    </con:property>
    <con:property>
      <con:name>AsyncMsgTable</con:name>
      <con:value>asyncmsgrepo</con:value>
    </con:property>
    <con:property>
      <con:name>AuditRepoDB</con:name>
      <con:value>auditrepo</con:value>
    </con:property>
    <con:property>
      <con:name>AuditRepoTable</con:name>
      <con:value>auditrepository</con:value>
    </con:property>
    <con:property>
      <con:name>BirthTime</con:name>
      <con:value>19630804</con:value>
    </con:property>
    <con:property>
      <con:name>City</con:name>
      <con:value>Melbourne</con:value>
    </con:property>
    <con:property>
      <con:name>Country</con:name>
      <con:value>US</con:value>
    </con:property>
    <con:property>
      <con:name>DateOfSignature</con:name>
      <con:value>20080520</con:value>
    </con:property>
    <con:property>
      <con:name>DBHost</con:name>
      <con:value>localhost</con:value>
    </con:property>
    <con:property>
      <con:name>DBPass</con:name>
      <con:value>nhincpass</con:value>
    </con:property>
    <con:property>
      <con:name>DBPort</con:name>
      <con:value>3306</con:value>
    </con:property>
    <con:property>
      <con:name>DBUser</con:name>
      <con:value>nhincuser</con:value>
    </con:property>
    <con:property>
      <con:name>DeferredPatientDiscoveryReqMessageID</con:name>
      <con:value>uuid:6666666666.66666.666.66</con:value>
    </con:property>
    <con:property>
      <con:name>DOB</con:name>
      <con:value>19800516</con:value>
    </con:property>
    <con:property>
      <con:name>DQDocID</con:name>
      <con:value>1.123401.55555</con:value>
    </con:property>
    <con:property>
      <con:name>DQPatientID</con:name>
      <con:value>D123401</con:value>
    </con:property>
    <con:property>
      <con:name>DQPTDocID</con:name>
      <con:value>1.123401.11111</con:value>
    </con:property>
    <con:property>
      <con:name>DRDocID</con:name>
      <con:value>1.123407.777777</con:value>
    </con:property>
    <con:property>
      <con:name>DRRepoID</con:name>
      <con:value>1</con:value>
    </con:property>
    <con:property>
      <con:name>DynamicDQDocID</con:name>
      <con:value>103.8.9284320.020.3590.75^1266324032288</con:value>
    </con:property>
    <con:property>
      <con:name>ExpirationDate</con:name>
      <con:value>20100520</con:value>
    </con:property>
    <con:property>
      <con:name>FamilyName</con:name>
      <con:value>Younger</con:value>
    </con:property>
    <con:property>
      <con:name>GatewayPropDir</con:name>
      <con:value/>
    </con:property>
    <con:property>
      <con:name>Gender</con:name>
      <con:value>M</con:value>
    </con:property>
    <con:property>
      <con:name>GivenName</con:name>
      <con:value>Gallow</con:value>
    </con:property>
    <con:property>
      <con:name>LocalAA</con:name>
      <con:value>1.1</con:value>
    </con:property>
    <con:property>
      <con:name>LocalHCDescription</con:name>
      <con:value>InternalTest1</con:value>
    </con:property>
    <con:property>
      <con:name>LocalHCID</con:name>
      <con:value>1.1</con:value>
    </con:property>
    <con:property>
      <con:name>LocalPatientID</con:name>
      <con:value>D123401</con:value>
    </con:property>
    <con:property>
      <con:name>NotificationEndpoint</con:name>
      <con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/NotificationConsumerService/HiemNotify</con:value>
    </con:property>
    <con:property>
      <con:name>NotifySubscriptionID</con:name>
      <con:value>24085385-ef54-4aaf-b027-d5896689be24</con:value>
    </con:property>
    <con:property>
      <con:name>NotifySubscriptionManagerEndpointAddress</con:name>
      <con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value>
    </con:property>
    <con:property>
      <con:name>PatientCorrelationDB</con:name>
      <con:value>patientcorrelationdb</con:value>
    </con:property>
    <con:property>
      <con:name>PatientCorrelationTable</con:name>
      <con:value>correlatedidentifiers</con:value>
    </con:property>
    <con:property>
      <con:name>project.name</con:name>
      <con:value>EntityValidation</con:value>
    </con:property>
    <con:property>
      <con:name>PurposeOfDisclosure</con:name>
      <con:value>Mental</con:value>
    </con:property>
    <con:property>
      <con:name>RemoteAA</con:name>
      <con:value>2.2</con:value>
    </con:property>
    <con:property>
      <con:name>RemoteHCDescription</con:name>
      <con:value>InternalTest2</con:value>
    </con:property>
    <con:property>
      <con:name>RemoteHCID</con:name>
      <con:value>2.2</con:value>
    </con:property>
    <con:property>
      <con:name>RemotePatientID</con:name>
      <con:value>D123401</con:value>
    </con:property>
    <con:property>
      <con:name>SSN</con:name>
      <con:value>123456789</con:value>
    </con:property>
    <con:property>
      <con:name>State</con:name>
      <con:value>FL</con:value>
    </con:property>
    <con:property>
      <con:name>StreetAddress</con:name>
      <con:value>123 Johnson Rd</con:value>
    </con:property>
    <con:property>
      <con:name>SubjectID</con:name>
      <con:value>1111</con:value>
    </con:property>
    <con:property>
      <con:name>SubscribePatientID</con:name>
      <con:value>D123401</con:value>
    </con:property>
    <con:property>
      <con:name>SubscriptionDB</con:name>
      <con:value>subscriptionrepository</con:value>
    </con:property>
    <con:property>
      <con:name>SubscriptionManagerEndpointAddress</con:name>
      <con:value>https://localhost:8181/Gateway/HIEM/2_0/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value>
    </con:property>
    <con:property>
      <con:name>SubscriptionTable</con:name>
      <con:value>subscription</con:value>
    </con:property>
    <con:property>
      <con:name>UniquePatientId</con:name>
      <con:value>1111^^^&amp;amp;1.1&amp;amp;ISO</con:value>
    </con:property>
    <con:property>
      <con:name>UnSubscriptionID</con:name>
      <con:value>6deec8e7-6e6c-4269-91c2-69cb777ab8b0</con:value>
    </con:property>
    <con:property>
      <con:name>ZipCode</con:name>
      <con:value>12345</con:value>
    </con:property>
    <con:property>
      <con:name>DQ_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentQuery/3_0/EntityService/EntityDocQueryUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DQ_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentQuery/2_0/EntityService/EntityDocQueryUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DS_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DS_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DSDefResp_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DSDefResp_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredResponseUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>PDDefReq_EntityEndpoint</con:name>
      <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredRequestUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>DR_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentRetrieve/3_0/EntityService/EntityDocRetrieve</con:value>
    </con:property>
    <con:property>
      <con:name>DR_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentRetrieve/2_0/EntityService/EntityDocRetrieve</con:value>
    </con:property>
    <con:property>
      <con:name>PDDefResp_EntityEndpoint</con:name>
      <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityService/EntityPatientDiscoveryDeferredResponseUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>PD_EntityEndpoint</con:name>
      <con:value>http://localhost:8080/Gateway/PatientDiscovery/1_0/EntityPatientDiscovery</con:value>
    </con:property>
    <con:property>
      <con:name>AD_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/AdminDistribution/2_0/AdministrativeDistribution_Service</con:value>
    </con:property>
    <con:property>
      <con:name>DSDefReq_EntityEndpoint_g1</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/2_0/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>AD_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/AdminDistribution/1_0/AdministrativeDistribution_Service</con:value>
    </con:property>
    <con:property>
      <con:name>DSDefReq_EntityEndpoint_g0</con:name>
      <con:value>http://localhost:8080/Gateway/DocumentSubmission/1_1/EntityService/EntityDocSubmissionDeferredRequestUnsecured</con:value>
    </con:property>
    <con:property>
      <con:name>ASUsername</con:name>
      <con:value>admin</con:value>
    </con:property>
    <con:property>
      <con:name>ASPassword</con:name>
      <con:value>adminadmin</con:value>
    </con:property>
    <con:property>
      <con:name>JMXHost</con:name>
      <con:value>localhost</con:value>
    </con:property>
    <con:property>
      <con:name>JMXPort</con:name>
      <con:value>9990</con:value>
    </con:property>
  </con:properties>
  <con:afterLoadScript>def propertiesFilename = project.path[0..(project.path.size()-4)] + 'properties'
def propertiesFile = new File(propertiesFilename)
if (propertiesFile.exists()) {
	def props = new Properties()
	props.load(new FileInputStream(propertiesFile))
	props.each { key, value ->
	    project.setPropertyValue(key, value)
	}
}

TimeZone.setDefault(TimeZone.getTimeZone("UTC"))
def testRunListener = [
afterRun: { testRunner, runContext -> },
afterStep: { testRunner, runContext, result -> },
beforeStep: { testRunner, runContext -> },
beforeStep: { testRunner, runContext, testStep -> },
beforeRun: { testRunner, runContext -> 
use (org.codehaus.groovy.runtime.TimeCategory) {
def startDate = 5.minutes.ago
def endDate = 5.minutes.from.now
def expireDate = 30.days.from.now

def df = "yyyy-MM-dd'T'HH:mm:ss'Z'"
def dfSig = "MM/dd/yyyy' 'HH:mm:ss"

runContext.testCase.setPropertyValue("startDate", startDate.format(df))
runContext.testCase.setPropertyValue("endDate", endDate.format(df))
runContext.testCase.setPropertyValue("sigDate", startDate.format(dfSig))
runContext.testCase.setPropertyValue("expireDate", expireDate.format(df))
}
}   
] as com.eviware.soapui.model.testsuite.TestRunListener

project.testSuiteList*.testCaseList.flatten()*.addTestRunListener(testRunListener)



com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.findProperty = { propertyName ->
return delegate.getProperty(propertyName) ?:
delegate.testCase.getPropertyValue(propertyName) ?:
delegate.testCase.testSuite.getPropertyValue(propertyName) ?:
delegate.testCase.testSuite.project.getPropertyValue(propertyName) ?:
com.eviware.soapui.SoapUI.globalProperties.getPropertyValue(propertyName)
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.withSql = { dbOrPropertyName, block ->
def dbName = delegate.findProperty(dbOrPropertyName) ?: dbOrPropertyName
def host = delegate.findProperty('DBHost')
def port = delegate.findProperty('DBPort')
def user = delegate.findProperty('DBUser')
def pass = delegate.findProperty('DBPass')

def connectString = "jdbc:mysql://${host}:${port}/${dbName}"
def sql = groovy.sql.Sql.newInstance(connectString, user, pass, "com.mysql.jdbc.Driver");
try {
block(sql)
} finally {
sql.close()
}
}

import javax.management.remote.JMXConnectorFactory as JmxFactory
import javax.management.remote.JMXServiceURL as JmxUrl
import javax.management.remote.*;

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.setGatewayStandard = { standard ->
  def username = delegate.findProperty("ASUsername");
  def password = delegate.findProperty("ASPassword");
  def jmxHost = delegate.findProperty("JMXHost");
  def jmxPort = delegate.findProperty("JMXPort");
  log.info "Value of the Param Name -->"+name;
  // use jmx to set passthru mode
  def env = [
    (JMXConnector.CREDENTIALS): (String[])[username, password]
  ];
  def serverUrl = 'service:jmx:http-remoting-jmx://'+jmxHost+ ':' + jmxPort;
  log.info "Standard valud-->"+standard
  def server = JmxFactory.connect(new JmxUrl(serverUrl), env);
  def config = new GroovyMBean(server.MBeanServerConnection, 'org.connectopensource.mbeans:type=Configuration');
  //set the Gateway to Standard Mode
    if (standard){
  	config.setStandardMode();
  	log.info "Inside STD"
  }
  else{
  	log.info "Inside PASS"
     config.setPassthruMode();	
  }
  server.close();
  return true;
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.isStandard = { serviceName, direction ->
  def username = delegate.findProperty("ASUsername");
  def password = delegate.findProperty("ASPassword");
  def jmxHost = delegate.findProperty("JMXHost");
  def jmxPort = delegate.findProperty("JMXPort");
  log.info "Value of the Param Name -->"+name;
  // use jmx to set passthru mode
  def env = [
    (JMXConnector.CREDENTIALS): (String[])[username, password]
  ];
  def serverUrl = 'service:jmx:http-remoting-jmx://'+jmxHost+ ':' + jmxPort;
   
  def server = JmxFactory.connect(new JmxUrl(serverUrl), env);
  def config = new GroovyMBean(server.MBeanServerConnection, 'org.connectopensource.mbeans:type=Configuration');
  //set the Gateway to Standard Mode
  def isStandard = config.isStandard(serviceName, direction);
  server.close();
  return isStandard;
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.setGatewayStandard = { standard, serviceName, direction ->
  def username = delegate.findProperty("ASUsername");
  def password = delegate.findProperty("ASPassword");
  def jmxHost = delegate.findProperty("JMXHost");
  def jmxPort = delegate.findProperty("JMXPort");
  log.info "Value of the Param Name -->"+name;
  // use jmx to set passthru mode
  def env = [
    (JMXConnector.CREDENTIALS): (String[])[username, password]
  ];
  def serverUrl = 'service:jmx:http-remoting-jmx://'+jmxHost+ ':' + jmxPort;
  log.info "Standard valud-->"+standard
  def server = JmxFactory.connect(new JmxUrl(serverUrl), env);
  def config = new GroovyMBean(server.MBeanServerConnection, 'org.connectopensource.mbeans:type=Configuration');
  //set the Gateway to Standard Mode
    if (standard){
  	config.setStandardMode(serviceName, direction);
  	log.info "Inside STD"
  }
  else{
  	log.info "Inside PASS"
     config.setPassthruMode(serviceName, direction);	
  }
  server.close();
  return true;
}
/*
 Return true if gateway.properties have standard mode set up
*/
com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.checkGatewayMode = {passthruProp, context ->
  log.info "calling checkGatewayMode for ${passthruProp}";
  def dir = context.findProperty('GatewayPropDir');
  def file = "gateway.properties";
  log.info "PassthruPro ${passthruProp} ";
  def passthruValue = nhinc.FileUtils.readProperty(dir, file, passthruProp, log);
  log.info "Passthrough property value = ${passthruValue} for key ${passthruProp}";
  if(passthruValue == null){
    return true;
  }else{
    return false;
   }
}</con:afterLoadScript>
  <con:wssContainer/>
  <con:databaseConnectionContainer/>
  <con:oAuth2ProfileContainer/>
  <con:reporting>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:xmlTemplates/>
    <con:parameters/>
  </con:reporting>
  <con:sensitiveInformation/>
</con:soapui-project>